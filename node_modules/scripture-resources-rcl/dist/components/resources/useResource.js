"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = require("react");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _deepFreeze = _interopRequireDefault(require("deep-freeze"));

var _useDeepCompareEffect = _interopRequireDefault(require("use-deep-compare-effect"));

var _core = require("../../core");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function cov_8n9o2o1pj() {
  var path = "D:\\Projects-unfoldingWord\\scripture-resources-rcl\\src\\components\\resources\\useResource.js";
  var hash = "e38dc3be3e9ec3ecd8874b597096b95500816fce";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "D:\\Projects-unfoldingWord\\scripture-resources-rcl\\src\\components\\resources\\useResource.js",
    statementMap: {
      "0": {
        start: {
          line: 16,
          column: 52
        },
        end: {
          line: 16,
          column: 62
        }
      },
      "1": {
        start: {
          line: 17,
          column: 34
        },
        end: {
          line: 17,
          column: 44
        }
      },
      "2": {
        start: {
          line: 19,
          column: 20
        },
        end: {
          line: 29,
          column: 45
        }
      },
      "3": {
        start: {
          line: 20,
          column: 4
        },
        end: {
          line: 28,
          column: 5
        }
      },
      "4": {
        start: {
          line: 21,
          column: 26
        },
        end: {
          line: 21,
          column: 34
        }
      },
      "5": {
        start: {
          line: 23,
          column: 6
        },
        end: {
          line: 27,
          column: 7
        }
      },
      "6": {
        start: {
          line: 24,
          column: 21
        },
        end: {
          line: 24,
          column: 46
        }
      },
      "7": {
        start: {
          line: 25,
          column: 8
        },
        end: {
          line: 25,
          column: 26
        }
      },
      "8": {
        start: {
          line: 26,
          column: 8
        },
        end: {
          line: 26,
          column: 49
        }
      },
      "9": {
        start: {
          line: 31,
          column: 2
        },
        end: {
          line: 39,
          column: 48
        }
      },
      "10": {
        start: {
          line: 32,
          column: 4
        },
        end: {
          line: 38,
          column: 6
        }
      },
      "11": {
        start: {
          line: 36,
          column: 8
        },
        end: {
          line: 36,
          column: 26
        }
      },
      "12": {
        start: {
          line: 41,
          column: 17
        },
        end: {
          line: 47,
          column: 3
        }
      },
      "13": {
        start: {
          line: 43,
          column: 25
        },
        end: {
          line: 43,
          column: 59
        }
      },
      "14": {
        start: {
          line: 44,
          column: 6
        },
        end: {
          line: 44,
          column: 29
        }
      },
      "15": {
        start: {
          line: 49,
          column: 2
        },
        end: {
          line: 55,
          column: 4
        }
      },
      "16": {
        start: {
          line: 58,
          column: 0
        },
        end: {
          line: 76,
          column: 2
        }
      }
    },
    fnMap: {
      "0": {
        name: "useResource",
        decl: {
          start: {
            line: 8,
            column: 9
          },
          end: {
            line: 8,
            column: 20
          }
        },
        loc: {
          start: {
            line: 15,
            column: 3
          },
          end: {
            line: 56,
            column: 1
          }
        },
        line: 15
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 19,
            column: 32
          },
          end: {
            line: 19,
            column: 33
          }
        },
        loc: {
          start: {
            line: 19,
            column: 44
          },
          end: {
            line: 29,
            column: 3
          }
        },
        line: 19
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 31,
            column: 12
          },
          end: {
            line: 31,
            column: 13
          }
        },
        loc: {
          start: {
            line: 31,
            column: 18
          },
          end: {
            line: 39,
            column: 3
          }
        },
        line: 31
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 35,
            column: 6
          },
          end: {
            line: 35,
            column: 7
          }
        },
        loc: {
          start: {
            line: 35,
            column: 21
          },
          end: {
            line: 37,
            column: 7
          }
        },
        line: 35
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 42,
            column: 4
          },
          end: {
            line: 42,
            column: 5
          }
        },
        loc: {
          start: {
            line: 42,
            column: 19
          },
          end: {
            line: 45,
            column: 5
          }
        },
        line: 42
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 20,
            column: 4
          },
          end: {
            line: 28,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 20,
            column: 4
          },
          end: {
            line: 28,
            column: 5
          }
        }, {
          start: {
            line: 20,
            column: 4
          },
          end: {
            line: 28,
            column: 5
          }
        }],
        line: 20
      },
      "1": {
        loc: {
          start: {
            line: 20,
            column: 8
          },
          end: {
            line: 20,
            column: 36
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 20,
            column: 8
          },
          end: {
            line: 20,
            column: 16
          }
        }, {
          start: {
            line: 20,
            column: 20
          },
          end: {
            line: 20,
            column: 36
          }
        }],
        line: 20
      },
      "2": {
        loc: {
          start: {
            line: 23,
            column: 6
          },
          end: {
            line: 27,
            column: 7
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 23,
            column: 6
          },
          end: {
            line: 27,
            column: 7
          }
        }, {
          start: {
            line: 23,
            column: 6
          },
          end: {
            line: 27,
            column: 7
          }
        }],
        line: 23
      },
      "3": {
        loc: {
          start: {
            line: 23,
            column: 10
          },
          end: {
            line: 23,
            column: 63
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 23,
            column: 10
          },
          end: {
            line: 23,
            column: 50
          }
        }, {
          start: {
            line: 23,
            column: 54
          },
          end: {
            line: 23,
            column: 63
          }
        }],
        line: 23
      },
      "4": {
        loc: {
          start: {
            line: 43,
            column: 25
          },
          end: {
            line: 43,
            column: 59
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 43,
            column: 25
          },
          end: {
            line: 43,
            column: 34
          }
        }, {
          start: {
            line: 43,
            column: 38
          },
          end: {
            line: 43,
            column: 59
          }
        }],
        line: 43
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "e38dc3be3e9ec3ecd8874b597096b95500816fce"
  };
  var coverage = global[gcv] || (global[gcv] = {});

  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }

  var actualCoverage = coverage[path];

  cov_8n9o2o1pj = function () {
    return actualCoverage;
  };

  return actualCoverage;
}

cov_8n9o2o1pj();

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance"); }

function _iterableToArrayLimit(arr, i) { if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === "[object Arguments]")) { return; } var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function useResource({
  resource,
  resourceLink,
  onResourceLink,
  reference,
  config,
  onResource
}) {
  cov_8n9o2o1pj().f[0]++;

  var _ref = (cov_8n9o2o1pj().s[0]++, (0, _react.useState)()),
      _ref2 = _slicedToArray(_ref, 2),
      projectIdentifier = _ref2[0],
      setProjectIdentifier = _ref2[1];

  var _ref3 = (cov_8n9o2o1pj().s[1]++, (0, _react.useState)()),
      _ref4 = _slicedToArray(_ref3, 2),
      usfmJson = _ref4[0],
      setUsfmJson = _ref4[1];

  var parseUsfm = (cov_8n9o2o1pj().s[2]++, (0, _react.useCallback)( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
    var _ref6, project, json;

    return regeneratorRuntime.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            cov_8n9o2o1pj().f[1]++;
            cov_8n9o2o1pj().s[3]++;

            if (!((cov_8n9o2o1pj().b[1][0]++, resource) && (cov_8n9o2o1pj().b[1][1]++, resource.project))) {
              _context.next = 21;
              break;
            }

            cov_8n9o2o1pj().b[0][0]++;
            _ref6 = (cov_8n9o2o1pj().s[4]++, resource), project = _ref6.project;
            cov_8n9o2o1pj().s[5]++;

            if (!((cov_8n9o2o1pj().b[3][0]++, project.identifier !== projectIdentifier) || (cov_8n9o2o1pj().b[3][1]++, !usfmJson))) {
              _context.next = 18;
              break;
            }

            cov_8n9o2o1pj().b[2][0]++;
            cov_8n9o2o1pj().s[6]++;
            _context.next = 11;
            return project.parseUsfm();

          case 11:
            json = _context.sent;
            cov_8n9o2o1pj().s[7]++;
            setUsfmJson(json);
            cov_8n9o2o1pj().s[8]++;
            setProjectIdentifier(project.identifier);
            _context.next = 19;
            break;

          case 18:
            cov_8n9o2o1pj().b[2][1]++;

          case 19:
            _context.next = 22;
            break;

          case 21:
            cov_8n9o2o1pj().b[0][1]++;

          case 22:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  })), [projectIdentifier, resource, usfmJson]));
  cov_8n9o2o1pj().s[9]++;
  (0, _useDeepCompareEffect.default)(() => {
    cov_8n9o2o1pj().f[2]++;
    cov_8n9o2o1pj().s[10]++;
    (0, _core.resourceFromResourceLink)({
      resourceLink,
      reference,
      config
    }).then(_resource => {
      cov_8n9o2o1pj().f[3]++;
      cov_8n9o2o1pj().s[11]++;
      update(_resource);
    });
  }, [resourceLink, reference, config, update]);
  var update = (cov_8n9o2o1pj().s[12]++, (0, _react.useCallback)(_resource => {
    cov_8n9o2o1pj().f[4]++;

    var __resource = (cov_8n9o2o1pj().s[13]++, (cov_8n9o2o1pj().b[4][0]++, _resource) && (cov_8n9o2o1pj().b[4][1]++, (0, _deepFreeze.default)(_resource)));

    cov_8n9o2o1pj().s[14]++;
    onResource(__resource);
  }, [onResource]));
  cov_8n9o2o1pj().s[15]++;
  return {
    state: resource,
    actions: {
      update,
      parseUsfm
    }
  };
}

cov_8n9o2o1pj().s[16]++;
useResource.propTypes = {
  /** the resource content */
  resource: _propTypes.default.object,

  /** reference: chapter and verse */
  reference: _propTypes.default.object,

  /** The link to parse and fetch the resource manifest */
  resourceLink: _propTypes.default.string.isRequired,

  /** The configuration of the server, and fetching */
  config: _propTypes.default.shape({
    server: _propTypes.default.string.isRequired,

    /** the overriding cache settings */
    cache: _propTypes.default.shape({
      /** cache age in ms */
      maxAge: _propTypes.default.number
    })
  }),

  /** action taken after a resource is acquired */
  onResource: _propTypes.default.func.isRequired
};
var _default = useResource;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3Jlc291cmNlcy91c2VSZXNvdXJjZS5qcyJdLCJuYW1lcyI6WyJ1c2VSZXNvdXJjZSIsInJlc291cmNlIiwicmVzb3VyY2VMaW5rIiwib25SZXNvdXJjZUxpbmsiLCJyZWZlcmVuY2UiLCJjb25maWciLCJvblJlc291cmNlIiwicHJvamVjdElkZW50aWZpZXIiLCJzZXRQcm9qZWN0SWRlbnRpZmllciIsInVzZm1Kc29uIiwic2V0VXNmbUpzb24iLCJwYXJzZVVzZm0iLCJwcm9qZWN0IiwiaWRlbnRpZmllciIsImpzb24iLCJ0aGVuIiwiX3Jlc291cmNlIiwidXBkYXRlIiwiX19yZXNvdXJjZSIsInN0YXRlIiwiYWN0aW9ucyIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsIm9iamVjdCIsInN0cmluZyIsImlzUmVxdWlyZWQiLCJzaGFwZSIsInNlcnZlciIsImNhY2hlIiwibWF4QWdlIiwibnVtYmVyIiwiZnVuYyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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QUFNLEVBQUVMLG1CQUFVRSxNQUFWLENBQWlCQyxVQURIOztBQUV0QjtBQUNBRyxJQUFBQSxLQUFLLEVBQUVOLG1CQUFVSSxLQUFWLENBQWdCO0FBQ3JCO0FBQ0FHLE1BQUFBLE1BQU0sRUFBRVAsbUJBQVVRO0FBRkcsS0FBaEI7QUFIZSxHQUFoQixDQVJjOztBQWdCdEI7QUFDQXhCLEVBQUFBLFVBQVUsRUFBRWdCLG1CQUFVUyxJQUFWLENBQWVOO0FBakJMLENBQXhCO2VBb0JlekIsVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZVN0YXRlLCB1c2VDYWxsYmFjayB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcclxuaW1wb3J0IGRlZXBGcmVlemUgZnJvbSAnZGVlcC1mcmVlemUnO1xyXG5pbXBvcnQgdXNlRWZmZWN0IGZyb20gJ3VzZS1kZWVwLWNvbXBhcmUtZWZmZWN0JztcclxuXHJcbmltcG9ydCB7IHJlc291cmNlRnJvbVJlc291cmNlTGluayB9IGZyb20gJy4uLy4uL2NvcmUnO1xyXG5cclxuZnVuY3Rpb24gdXNlUmVzb3VyY2Uoe1xyXG4gIHJlc291cmNlLFxyXG4gIHJlc291cmNlTGluayxcclxuICBvblJlc291cmNlTGluayxcclxuICByZWZlcmVuY2UsXHJcbiAgY29uZmlnLFxyXG4gIG9uUmVzb3VyY2UsXHJcbn0pIHtcclxuICBjb25zdCBbcHJvamVjdElkZW50aWZpZXIsIHNldFByb2plY3RJZGVudGlmaWVyXSA9IHVzZVN0YXRlKCk7XHJcbiAgY29uc3QgW3VzZm1Kc29uLCBzZXRVc2ZtSnNvbl0gPSB1c2VTdGF0ZSgpO1xyXG5cclxuICBjb25zdCBwYXJzZVVzZm0gPSB1c2VDYWxsYmFjayhhc3luYyAoKSA9PiB7XHJcbiAgICBpZiAocmVzb3VyY2UgJiYgcmVzb3VyY2UucHJvamVjdCkge1xyXG4gICAgICBjb25zdCB7IHByb2plY3QgfSA9IHJlc291cmNlO1xyXG5cclxuICAgICAgaWYgKHByb2plY3QuaWRlbnRpZmllciAhPT0gcHJvamVjdElkZW50aWZpZXIgfHwgIXVzZm1Kc29uKSB7XHJcbiAgICAgICAgY29uc3QganNvbiA9IGF3YWl0IHByb2plY3QucGFyc2VVc2ZtKCk7XHJcbiAgICAgICAgc2V0VXNmbUpzb24oanNvbik7XHJcbiAgICAgICAgc2V0UHJvamVjdElkZW50aWZpZXIocHJvamVjdC5pZGVudGlmaWVyKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0sIFtwcm9qZWN0SWRlbnRpZmllciwgcmVzb3VyY2UsIHVzZm1Kc29uXSk7XHJcblxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICByZXNvdXJjZUZyb21SZXNvdXJjZUxpbmsoe1xyXG4gICAgICByZXNvdXJjZUxpbmssIHJlZmVyZW5jZSwgY29uZmlnLFxyXG4gICAgfSkudGhlbihcclxuICAgICAgKF9yZXNvdXJjZSkgPT4ge1xyXG4gICAgICAgIHVwZGF0ZShfcmVzb3VyY2UpO1xyXG4gICAgICB9LFxyXG4gICAgKTtcclxuICB9LCBbcmVzb3VyY2VMaW5rLCByZWZlcmVuY2UsIGNvbmZpZywgdXBkYXRlXSk7XHJcblxyXG4gIGNvbnN0IHVwZGF0ZSA9IHVzZUNhbGxiYWNrKFxyXG4gICAgKF9yZXNvdXJjZSkgPT4ge1xyXG4gICAgICBjb25zdCBfX3Jlc291cmNlID0gX3Jlc291cmNlICYmIGRlZXBGcmVlemUoX3Jlc291cmNlKTtcclxuICAgICAgb25SZXNvdXJjZShfX3Jlc291cmNlKTtcclxuICAgIH0sXHJcbiAgICBbb25SZXNvdXJjZV0sXHJcbiAgKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHN0YXRlOiByZXNvdXJjZSxcclxuICAgIGFjdGlvbnM6IHtcclxuICAgICAgdXBkYXRlLFxyXG4gICAgICBwYXJzZVVzZm0sXHJcbiAgICB9LFxyXG4gIH07XHJcbn1cclxuXHJcbnVzZVJlc291cmNlLnByb3BUeXBlcyA9IHtcclxuICAvKiogdGhlIHJlc291cmNlIGNvbnRlbnQgKi9cclxuICByZXNvdXJjZTogUHJvcFR5cGVzLm9iamVjdCxcclxuICAvKiogcmVmZXJlbmNlOiBjaGFwdGVyIGFuZCB2ZXJzZSAqL1xyXG4gIHJlZmVyZW5jZTogUHJvcFR5cGVzLm9iamVjdCxcclxuICAvKiogVGhlIGxpbmsgdG8gcGFyc2UgYW5kIGZldGNoIHRoZSByZXNvdXJjZSBtYW5pZmVzdCAqL1xyXG4gIHJlc291cmNlTGluazogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxyXG4gIC8qKiBUaGUgY29uZmlndXJhdGlvbiBvZiB0aGUgc2VydmVyLCBhbmQgZmV0Y2hpbmcgKi9cclxuICBjb25maWc6IFByb3BUeXBlcy5zaGFwZSh7XHJcbiAgICBzZXJ2ZXI6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcclxuICAgIC8qKiB0aGUgb3ZlcnJpZGluZyBjYWNoZSBzZXR0aW5ncyAqL1xyXG4gICAgY2FjaGU6IFByb3BUeXBlcy5zaGFwZSh7XHJcbiAgICAgIC8qKiBjYWNoZSBhZ2UgaW4gbXMgKi9cclxuICAgICAgbWF4QWdlOiBQcm9wVHlwZXMubnVtYmVyLFxyXG4gICAgfSksXHJcbiAgfSksXHJcbiAgLyoqIGFjdGlvbiB0YWtlbiBhZnRlciBhIHJlc291cmNlIGlzIGFjcXVpcmVkICovXHJcbiAgb25SZXNvdXJjZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IHVzZVJlc291cmNlO1xyXG4iXX0=