"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _deepFreeze = _interopRequireDefault(require("deep-freeze"));

var _ = require("../..");

var _helpers = require("./helpers");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function useRepository(_ref) {
  var repositories = _ref.repositories,
      __full_name = _ref.full_name,
      urls = _ref.urls,
      defaultOwner = _ref.defaultOwner,
      defaultQuery = _ref.defaultQuery,
      config = _ref.config,
      authentication = _ref.authentication,
      __repository = _ref.repository,
      onRepository = _ref.onRepository,
      __branch = _ref.branch;

  var _useState = (0, _react.useState)(__branch),
      _useState2 = _slicedToArray(_useState, 2),
      branch = _useState2[0],
      setBranch = _useState2[1];

  var repository = __repository && (0, _deepFreeze.default)(__repository);

  var _ref2 = repository || {},
      full_name = _ref2.full_name;

  var user = authentication && authentication.user; // Due to objects not memoizing in useCallback, deconstruction is necessary
  // const { owner: { username: owner }, name: repo } = repository;

  var update = (0, _react.useCallback)(function (repo) {
    if (onRepository) {
      var _repo;

      if (repo) {
        _repo = _objectSpread(_objectSpread({}, repo), {}, {
          branch: branch
        });
        var tree_url = (0, _.repoTreeUrl)(_repo);
        _repo = _objectSpread(_objectSpread({}, _repo), {}, {
          tree_url: tree_url
        });
      }

      ;
      onRepository(_repo);
    }

    ;
  }, [branch, onRepository]);
  var read = (0, _react.useCallback)( /*#__PURE__*/function () {
    var _ref4 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(_ref3) {
      var owner, name, _repository;

      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              owner = _ref3.owner, name = _ref3.name;
              _context.next = 3;
              return (0, _helpers.readRepository)({
                owner: owner,
                repo: name,
                config: config
              });

            case 3:
              _repository = _context.sent;
              update(_repository);

            case 5:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function (_x) {
      return _ref4.apply(this, arguments);
    };
  }(), [config, update]);
  var updateBranch = (0, _react.useCallback)(function (_branch) {
    setBranch(_branch);
  }, []);
  var create = (0, _react.useCallback)( /*#__PURE__*/function () {
    var _ref5 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(settings) {
      var _repository;

      return regeneratorRuntime.wrap(function _callee2$(_context2) {
        while (1) {
          switch (_context2.prev = _context2.next) {
            case 0:
              _context2.next = 2;
              return (0, _helpers.createRepository)({
                settings: settings,
                config: config
              });

            case 2:
              _repository = _context2.sent;
              update(_repository);

            case 4:
            case "end":
              return _context2.stop();
          }
        }
      }, _callee2);
    }));

    return function (_x2) {
      return _ref5.apply(this, arguments);
    };
  }(), [config, update]);
  var dangerouslyDelete = (0, _react.useCallback)(function () {
    if (user && user.username === repository.owner.username) {
      (0, _helpers.deleteRepository)({
        repository: repository,
        config: config
      });
      window.setTimeout(update, 500);
    }

    ;
  }, [user, repository, config, update]);
  var fork = (0, _react.useCallback)( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {
    var _repo;

    return regeneratorRuntime.wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            if (!((user && user.username) !== repository.owner.username)) {
              _context3.next = 5;
              break;
            }

            _context3.next = 3;
            return (0, _helpers.forkRepository)({
              repository: repository,
              config: config
            });

          case 3:
            _repo = _context3.sent;
            update(_repo);

          case 5:
            ;

          case 6:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee3);
  })), [config, repository, update, user]);
  var save = (0, _react.useCallback)( /*#__PURE__*/function () {
    var _ref7 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4(settings) {
      var _repository;

      return regeneratorRuntime.wrap(function _callee4$(_context4) {
        while (1) {
          switch (_context4.prev = _context4.next) {
            case 0:
              if (!repository.permissions.admin) {
                _context4.next = 5;
                break;
              }

              _context4.next = 3;
              return (0, _helpers.saveRepository)({
                repository: repository,
                settings: settings,
                config: config
              });

            case 3:
              _repository = _context4.sent;
              update(_repository);

            case 5:
              ;

            case 6:
            case "end":
              return _context4.stop();
          }
        }
      }, _callee4);
    }));

    return function (_x3) {
      return _ref7.apply(this, arguments);
    };
  }(), [config, repository, update]);
  var storeZip = (0, _react.useCallback)( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5() {
    return regeneratorRuntime.wrap(function _callee5$(_context5) {
      while (1) {
        switch (_context5.prev = _context5.next) {
          case 0:
            _context5.next = 2;
            return (0, _helpers.storeRepositoryZip)({
              repository: repository,
              config: config
            });

          case 2:
          case "end":
            return _context5.stop();
        }
      }
    }, _callee5);
  })), [repository, config]);
  var removeZip = (0, _react.useCallback)( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6() {
    return regeneratorRuntime.wrap(function _callee6$(_context6) {
      while (1) {
        switch (_context6.prev = _context6.next) {
          case 0:
            _context6.next = 2;
            return (0, _helpers.removeRepositoryZip)({
              repository: repository,
              config: config
            });

          case 2:
          case "end":
            return _context6.stop();
        }
      }
    }, _callee6);
  })), [repository, config]);
  var fileFromZip = (0, _react.useCallback)( /*#__PURE__*/function () {
    var _ref10 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee7(filepath) {
      var file;
      return regeneratorRuntime.wrap(function _callee7$(_context7) {
        while (1) {
          switch (_context7.prev = _context7.next) {
            case 0:
              _context7.next = 2;
              return (0, _helpers.getFileFromRepositoryZip)({
                repository: repository,
                filepath: filepath,
                config: config
              });

            case 2:
              file = _context7.sent;
              return _context7.abrupt("return", file);

            case 4:
            case "end":
              return _context7.stop();
          }
        }
      }, _callee7);
    }));

    return function (_x4) {
      return _ref10.apply(this, arguments);
    };
  }(), [repository, config]);
  var forks = (0, _react.useCallback)(function () {
    (0, _helpers.repositoryForks)({
      repository: repository,
      config: config
    });
  }, [repository, config]);
  var close = (0, _react.useCallback)(function () {
    update();
  }, [update]);
  (0, _react.useEffect)(function () {
    if (__branch !== branch) {
      setBranch(__branch);
    }
  }, [__branch, branch]);
  (0, _react.useEffect)(function () {
    if (repository && branch !== repository.branch) {
      update(_objectSpread(_objectSpread({}, repository), {}, {
        branch: branch
      }));
    }
  }, [branch, repository, update]);
  (0, _react.useEffect)(function () {
    if (__full_name && !full_name) {
      var _full_name$split = __full_name.split('/'),
          _full_name$split2 = _slicedToArray(_full_name$split, 2),
          owner = _full_name$split2[0],
          name = _full_name$split2[1];

      read({
        owner: owner,
        name: name
      });
    }

    ;
  }, [full_name, __full_name, read]);
  var hasRepository = repository && repository.name && repository.owner && repository.permissions;
  var username = authentication && authentication.user && authentication.user.username;
  var components = {
    search: config && /*#__PURE__*/_react.default.createElement(_.Search, {
      defaultOwner: defaultOwner || username,
      defaultQuery: defaultQuery,
      onRepository: update,
      config: config
    }),
    browse: (urls || repositories) && /*#__PURE__*/_react.default.createElement(_.Repositories, {
      urls: urls,
      repositories: repositories,
      onRepository: update,
      config: config
    }),
    view: hasRepository && /*#__PURE__*/_react.default.createElement(_.Repository, {
      repository: repository,
      config: config,
      onRepository: onRepository
    }),
    form: hasRepository && /*#__PURE__*/_react.default.createElement(_.RepositoryForm, null)
  };

  var component = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null);

  if (hasRepository) {
    component = components.form;
  } else if (urls || repositories) {
    component = components.browse;
  } else if (config) {
    component = components.search;
  }

  ;
  return {
    state: repository,
    actions: {
      close: close,
      create: create,
      update: update,
      dangerouslyDelete: dangerouslyDelete,
      fork: fork,
      save: save,
      forks: forks,
      updateBranch: updateBranch,
      read: read,
      storeZip: storeZip,
      removeZip: removeZip,
      fileFromZip: fileFromZip
    },
    component: component,
    components: components,
    config: config
  };
}

;
useRepository.propTypes = {
  /** Repository data to render, if url not provided. */
  repository: _propTypes.default.shape({
    id: _propTypes.default.number,
    owner: _propTypes.default.object.isRequired,
    name: _propTypes.default.string.isRequired,
    full_name: _propTypes.default.string.isRequired,
    description: _propTypes.default.string.isRequired,
    html_url: _propTypes.default.string.isRequired,
    website: _propTypes.default.string.isRequired,
    tree_url: _propTypes.default.string,
    avatar_url: _propTypes.default.string,
    branch: _propTypes.default.string
  }),

  /** Function to call when repository is selected. */
  onRepository: _propTypes.default.func.isRequired,

  /** Full name of the repo, `owner/name` */
  full_name: _propTypes.default.string,

  /** Pass a previously returned authentication object to bypass login. */
  authentication: _propTypes.default.shape({
    user: _propTypes.default.object.isRequired,
    token: _propTypes.default.object.isRequired,
    config: _propTypes.default.object.isRequired,
    remember: _propTypes.default.bool
  }),

  /** Urls array to get repository data, if repository data is not provided. */
  urls: _propTypes.default.array,

  /** Repositories data array to render, if urls not provided. */
  repositories: _propTypes.default.array,

  /** Prefill the owner search field. */
  defaultOwner: _propTypes.default.string,

  /** Prefill the query search field. */
  defaultQuery: _propTypes.default.string,

  /** The name of the branch to read/write files */
  branch: _propTypes.default.string,

  /** Configuration to pass through to the Search/Repositories component. */
  config: _propTypes.default.shape({
    /** Configuration required for Search or Repositories if paths are provided as URL. */
    server: _propTypes.default.string
  }).isRequired
};
var _default = useRepository;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3JlcG9zaXRvcnkvdXNlUmVwb3NpdG9yeS5qcyJdLCJuYW1lcyI6WyJ1c2VSZXBvc2l0b3J5IiwicmVwb3NpdG9yaWVzIiwiX19mdWxsX25hbWUiLCJmdWxsX25hbWUiLCJ1cmxzIiwiZGVmYXVsdE93bmVyIiwiZGVmYXVsdFF1ZXJ5IiwiY29uZmlnIiwiYXV0aGVudGljYXRpb24iLCJfX3JlcG9zaXRvcnkiLCJyZXBvc2l0b3J5Iiwib25SZXBvc2l0b3J5IiwiX19icmFuY2giLCJicmFuY2giLCJzZXRCcmFuY2giLCJ1c2VyIiwidXBkYXRlIiwicmVwbyIsIl9yZXBvIiwidHJlZV91cmwiLCJyZWFkIiwib3duZXIiLCJuYW1lIiwiX3JlcG9zaXRvcnkiLCJ1cGRhdGVCcmFuY2giLCJfYnJhbmNoIiwiY3JlYXRlIiwic2V0dGluZ3MiLCJkYW5nZXJvdXNseURlbGV0ZSIsInVzZXJuYW1lIiwid2luZG93Iiwic2V0VGltZW91dCIsImZvcmsiLCJzYXZlIiwicGVybWlzc2lvbnMiLCJhZG1pbiIsInN0b3JlWmlwIiwicmVtb3ZlWmlwIiwiZmlsZUZyb21aaXAiLCJmaWxlcGF0aCIsImZpbGUiLCJmb3JrcyIsImNsb3NlIiwic3BsaXQiLCJoYXNSZXBvc2l0b3J5IiwiY29tcG9uZW50cyIsInNlYXJjaCIsImJyb3dzZSIsInZpZXciLCJmb3JtIiwiY29tcG9uZW50Iiwic3RhdGUiLCJhY3Rpb25zIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwic2hhcGUiLCJpZCIsIm51bWJlciIsIm9iamVjdCIsImlzUmVxdWlyZWQiLCJzdHJpbmciLCJkZXNjcmlwdGlvbiIsImh0bWxfdXJsIiwid2Vic2l0ZSIsImF2YXRhcl91cmwiLCJmdW5jIiwidG9rZW4iLCJyZW1lbWJlciIsImJvb2wiLCJhcnJheSIsInNlcnZlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7O0FBR0E7O0FBQ0E7O0FBRUE7O0FBR0E7Ozs7Ozs7Ozs7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VU0sTUFoQ0E7O0FBaUN4QjtBQUNBL0MsRUFBQUEsTUFBTSxFQUFFeUMsbUJBQVVNLE1BbENNOztBQW1DeEI7QUFDQXJELEVBQUFBLE1BQU0sRUFBRStDLG1CQUFVQyxLQUFWLENBQWdCO0FBQ3RCO0FBQ0FlLElBQUFBLE1BQU0sRUFBRWhCLG1CQUFVTTtBQUZJLEdBQWhCLEVBR0xEO0FBdkNxQixDQUExQjtlQTBDZTNELGEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtcclxuICB1c2VTdGF0ZSwgdXNlQ2FsbGJhY2ssIHVzZUVmZmVjdCxcclxufSBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XHJcbmltcG9ydCBkZWVwRnJlZXplIGZyb20gJ2RlZXAtZnJlZXplJztcclxuXHJcbmltcG9ydCB7XHJcbiAgUmVwb3NpdG9yeSwgUmVwb3NpdG9yeUZvcm0sIFJlcG9zaXRvcmllcywgU2VhcmNoLCByZXBvVHJlZVVybCxcclxufSBmcm9tICcuLi8uLic7XHJcbmltcG9ydCB7XHJcbiAgZGVsZXRlUmVwb3NpdG9yeSxcclxuICBmb3JrUmVwb3NpdG9yeSxcclxuICBzYXZlUmVwb3NpdG9yeSxcclxuICByZXBvc2l0b3J5Rm9ya3MsXHJcbiAgY3JlYXRlUmVwb3NpdG9yeSxcclxuICByZWFkUmVwb3NpdG9yeSxcclxuICBzdG9yZVJlcG9zaXRvcnlaaXAsXHJcbiAgcmVtb3ZlUmVwb3NpdG9yeVppcCxcclxuICBnZXRGaWxlRnJvbVJlcG9zaXRvcnlaaXAsXHJcbn0gZnJvbSAnLi9oZWxwZXJzJztcclxuXHJcbmZ1bmN0aW9uIHVzZVJlcG9zaXRvcnkoe1xyXG4gIHJlcG9zaXRvcmllcyxcclxuICBmdWxsX25hbWU6IF9fZnVsbF9uYW1lLFxyXG4gIHVybHMsXHJcbiAgZGVmYXVsdE93bmVyLFxyXG4gIGRlZmF1bHRRdWVyeSxcclxuICBjb25maWcsXHJcbiAgYXV0aGVudGljYXRpb24sXHJcbiAgcmVwb3NpdG9yeTogX19yZXBvc2l0b3J5LFxyXG4gIG9uUmVwb3NpdG9yeSxcclxuICBicmFuY2g6IF9fYnJhbmNoLFxyXG59KSB7XHJcbiAgY29uc3QgW2JyYW5jaCwgc2V0QnJhbmNoXSA9IHVzZVN0YXRlKF9fYnJhbmNoKTtcclxuICBjb25zdCByZXBvc2l0b3J5ID0gX19yZXBvc2l0b3J5ICYmIGRlZXBGcmVlemUoX19yZXBvc2l0b3J5KTtcclxuICBjb25zdCB7IGZ1bGxfbmFtZSB9ID0gcmVwb3NpdG9yeSB8fCB7fTtcclxuICBjb25zdCB1c2VyID0gYXV0aGVudGljYXRpb24gJiYgYXV0aGVudGljYXRpb24udXNlcjtcclxuXHJcbiAgLy8gRHVlIHRvIG9iamVjdHMgbm90IG1lbW9pemluZyBpbiB1c2VDYWxsYmFjaywgZGVjb25zdHJ1Y3Rpb24gaXMgbmVjZXNzYXJ5XHJcbiAgLy8gY29uc3QgeyBvd25lcjogeyB1c2VybmFtZTogb3duZXIgfSwgbmFtZTogcmVwbyB9ID0gcmVwb3NpdG9yeTtcclxuXHJcbiAgY29uc3QgdXBkYXRlID0gdXNlQ2FsbGJhY2soKHJlcG8pID0+IHtcclxuICAgIGlmIChvblJlcG9zaXRvcnkpIHtcclxuICAgICAgbGV0IF9yZXBvO1xyXG5cclxuICAgICAgaWYgKHJlcG8pIHtcclxuICAgICAgICBfcmVwbyA9IHsgLi4ucmVwbywgYnJhbmNoIH07XHJcbiAgICAgICAgY29uc3QgdHJlZV91cmwgPSByZXBvVHJlZVVybChfcmVwbyk7XHJcbiAgICAgICAgX3JlcG8gPSB7IC4uLl9yZXBvLCB0cmVlX3VybCB9O1xyXG4gICAgICB9O1xyXG4gICAgICBvblJlcG9zaXRvcnkoX3JlcG8pO1xyXG4gICAgfTtcclxuICB9LCBbYnJhbmNoLCBvblJlcG9zaXRvcnldKTtcclxuXHJcbiAgY29uc3QgcmVhZCA9IHVzZUNhbGxiYWNrKGFzeW5jICh7IG93bmVyLCBuYW1lIH0pID0+IHtcclxuICAgIGNvbnN0IF9yZXBvc2l0b3J5ID0gYXdhaXQgcmVhZFJlcG9zaXRvcnkoe1xyXG4gICAgICBvd25lciwgcmVwbzogbmFtZSwgY29uZmlnLFxyXG4gICAgfSk7XHJcbiAgICB1cGRhdGUoX3JlcG9zaXRvcnkpO1xyXG4gIH0sIFtjb25maWcsIHVwZGF0ZV0pO1xyXG5cclxuICBjb25zdCB1cGRhdGVCcmFuY2ggPSB1c2VDYWxsYmFjaygoX2JyYW5jaCkgPT4ge1xyXG4gICAgc2V0QnJhbmNoKF9icmFuY2gpO1xyXG4gIH0sIFtdKTtcclxuXHJcbiAgY29uc3QgY3JlYXRlID0gdXNlQ2FsbGJhY2soYXN5bmMgKHNldHRpbmdzKSA9PiB7XHJcbiAgICBjb25zdCBfcmVwb3NpdG9yeSA9IGF3YWl0IGNyZWF0ZVJlcG9zaXRvcnkoeyBzZXR0aW5ncywgY29uZmlnIH0pO1xyXG4gICAgdXBkYXRlKF9yZXBvc2l0b3J5KTtcclxuICB9LCBbY29uZmlnLCB1cGRhdGVdKTtcclxuXHJcbiAgY29uc3QgZGFuZ2Vyb3VzbHlEZWxldGUgPSB1c2VDYWxsYmFjaygoKSA9PiB7XHJcbiAgICBpZiAodXNlciAmJiB1c2VyLnVzZXJuYW1lID09PSByZXBvc2l0b3J5Lm93bmVyLnVzZXJuYW1lKSB7XHJcbiAgICAgIGRlbGV0ZVJlcG9zaXRvcnkoeyByZXBvc2l0b3J5LCBjb25maWcgfSk7XHJcbiAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KHVwZGF0ZSwgNTAwKTtcclxuICAgIH07XHJcbiAgfSwgW3VzZXIsIHJlcG9zaXRvcnksIGNvbmZpZywgdXBkYXRlXSk7XHJcblxyXG4gIGNvbnN0IGZvcmsgPSB1c2VDYWxsYmFjayhhc3luYyAoKSA9PiB7XHJcbiAgICBpZiAoKHVzZXIgJiYgdXNlci51c2VybmFtZSkgIT09IHJlcG9zaXRvcnkub3duZXIudXNlcm5hbWUpIHtcclxuICAgICAgY29uc3QgX3JlcG8gPSBhd2FpdCBmb3JrUmVwb3NpdG9yeSh7IHJlcG9zaXRvcnksIGNvbmZpZyB9KTtcclxuICAgICAgdXBkYXRlKF9yZXBvKTtcclxuICAgIH07XHJcbiAgfSwgW2NvbmZpZywgcmVwb3NpdG9yeSwgdXBkYXRlLCB1c2VyXSk7XHJcblxyXG4gIGNvbnN0IHNhdmUgPSB1c2VDYWxsYmFjayhhc3luYyAoc2V0dGluZ3MpID0+IHtcclxuICAgIGxldCBfcmVwb3NpdG9yeTtcclxuXHJcbiAgICBpZiAocmVwb3NpdG9yeS5wZXJtaXNzaW9ucy5hZG1pbikge1xyXG4gICAgICBfcmVwb3NpdG9yeSA9IGF3YWl0IHNhdmVSZXBvc2l0b3J5KHtcclxuICAgICAgICByZXBvc2l0b3J5LCBzZXR0aW5ncywgY29uZmlnLFxyXG4gICAgICB9KTtcclxuICAgICAgdXBkYXRlKF9yZXBvc2l0b3J5KTtcclxuICAgIH07XHJcbiAgfSwgW2NvbmZpZywgcmVwb3NpdG9yeSwgdXBkYXRlXSk7XHJcblxyXG4gIGNvbnN0IHN0b3JlWmlwID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT4ge1xyXG4gICAgYXdhaXQgc3RvcmVSZXBvc2l0b3J5WmlwKHsgcmVwb3NpdG9yeSwgY29uZmlnIH0pO1xyXG4gIH0sIFtyZXBvc2l0b3J5LCBjb25maWddKTtcclxuXHJcbiAgY29uc3QgcmVtb3ZlWmlwID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT57XHJcbiAgICBhd2FpdCByZW1vdmVSZXBvc2l0b3J5WmlwKHsgcmVwb3NpdG9yeSwgY29uZmlnIH0pO1xyXG4gIH0sIFtyZXBvc2l0b3J5LCBjb25maWddKTtcclxuXHJcbiAgY29uc3QgZmlsZUZyb21aaXAgPSB1c2VDYWxsYmFjayhhc3luYyAoZmlsZXBhdGgpID0+IHtcclxuICAgIGNvbnN0IGZpbGUgPSBhd2FpdCBnZXRGaWxlRnJvbVJlcG9zaXRvcnlaaXAoe1xyXG4gICAgICByZXBvc2l0b3J5LCBmaWxlcGF0aCwgY29uZmlnLFxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gZmlsZTtcclxuICB9LCBbcmVwb3NpdG9yeSwgY29uZmlnXSk7XHJcblxyXG4gIGNvbnN0IGZvcmtzID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xyXG4gICAgcmVwb3NpdG9yeUZvcmtzKHsgcmVwb3NpdG9yeSwgY29uZmlnIH0pO1xyXG4gIH0sIFtyZXBvc2l0b3J5LCBjb25maWddKTtcclxuXHJcbiAgY29uc3QgY2xvc2UgPSB1c2VDYWxsYmFjaygoKSA9PiB7XHJcbiAgICB1cGRhdGUoKTtcclxuICB9LCBbdXBkYXRlXSk7XHJcblxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoX19icmFuY2ggIT09IGJyYW5jaCkge1xyXG4gICAgICBzZXRCcmFuY2goX19icmFuY2gpO1xyXG4gICAgfVxyXG4gIH0sIFtfX2JyYW5jaCwgYnJhbmNoXSk7XHJcblxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAocmVwb3NpdG9yeSAmJiBicmFuY2ggIT09IHJlcG9zaXRvcnkuYnJhbmNoKSB7XHJcbiAgICAgIHVwZGF0ZSh7IC4uLnJlcG9zaXRvcnksIGJyYW5jaCB9KTtcclxuICAgIH1cclxuICB9LCBbYnJhbmNoLCByZXBvc2l0b3J5LCB1cGRhdGVdKTtcclxuXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChfX2Z1bGxfbmFtZSAmJiAhZnVsbF9uYW1lKSB7XHJcbiAgICAgIGNvbnN0IFtvd25lciwgbmFtZV0gPSBfX2Z1bGxfbmFtZS5zcGxpdCgnLycpO1xyXG4gICAgICByZWFkKHsgb3duZXIsIG5hbWUgfSk7XHJcbiAgICB9O1xyXG4gIH0sIFtmdWxsX25hbWUsIF9fZnVsbF9uYW1lLCByZWFkXSk7XHJcblxyXG4gIGNvbnN0IGhhc1JlcG9zaXRvcnkgPSByZXBvc2l0b3J5ICYmIHJlcG9zaXRvcnkubmFtZSAmJiByZXBvc2l0b3J5Lm93bmVyICYmIHJlcG9zaXRvcnkucGVybWlzc2lvbnM7XHJcblxyXG4gIGNvbnN0IHVzZXJuYW1lID0gYXV0aGVudGljYXRpb24gJiYgYXV0aGVudGljYXRpb24udXNlciAmJiBhdXRoZW50aWNhdGlvbi51c2VyLnVzZXJuYW1lO1xyXG4gIGNvbnN0IGNvbXBvbmVudHMgPSB7XHJcbiAgICBzZWFyY2g6IGNvbmZpZyAmJiAoXHJcbiAgICAgIDxTZWFyY2hcclxuICAgICAgICBkZWZhdWx0T3duZXI9e2RlZmF1bHRPd25lciB8fCB1c2VybmFtZX1cclxuICAgICAgICBkZWZhdWx0UXVlcnk9e2RlZmF1bHRRdWVyeX1cclxuICAgICAgICBvblJlcG9zaXRvcnk9e3VwZGF0ZX1cclxuICAgICAgICBjb25maWc9e2NvbmZpZ31cclxuICAgICAgLz5cclxuICAgICksXHJcbiAgICBicm93c2U6ICh1cmxzIHx8IHJlcG9zaXRvcmllcykgJiYgKFxyXG4gICAgICA8UmVwb3NpdG9yaWVzXHJcbiAgICAgICAgdXJscz17dXJsc31cclxuICAgICAgICByZXBvc2l0b3JpZXM9e3JlcG9zaXRvcmllc31cclxuICAgICAgICBvblJlcG9zaXRvcnk9e3VwZGF0ZX1cclxuICAgICAgICBjb25maWc9e2NvbmZpZ31cclxuICAgICAgLz5cclxuICAgICksXHJcbiAgICB2aWV3OiBoYXNSZXBvc2l0b3J5ICYmIChcclxuICAgICAgPFJlcG9zaXRvcnkgcmVwb3NpdG9yeT17cmVwb3NpdG9yeX0gY29uZmlnPXtjb25maWd9IG9uUmVwb3NpdG9yeT17b25SZXBvc2l0b3J5fSAvPlxyXG4gICAgKSxcclxuICAgIGZvcm06IGhhc1JlcG9zaXRvcnkgJiYgKFxyXG4gICAgICA8UmVwb3NpdG9yeUZvcm0gLz5cclxuICAgICksXHJcbiAgfTtcclxuXHJcbiAgbGV0IGNvbXBvbmVudCA9IDw+PC8+O1xyXG5cclxuICBpZiAoaGFzUmVwb3NpdG9yeSkge1xyXG4gICAgY29tcG9uZW50ID0gY29tcG9uZW50cy5mb3JtO1xyXG4gIH0gZWxzZSBpZiAodXJscyB8fCByZXBvc2l0b3JpZXMpIHtcclxuICAgIGNvbXBvbmVudCA9IGNvbXBvbmVudHMuYnJvd3NlO1xyXG4gIH0gZWxzZSBpZiAoY29uZmlnKSB7XHJcbiAgICBjb21wb25lbnQgPSBjb21wb25lbnRzLnNlYXJjaDtcclxuICB9O1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgc3RhdGU6IHJlcG9zaXRvcnksXHJcbiAgICBhY3Rpb25zOiB7XHJcbiAgICAgIGNsb3NlLFxyXG4gICAgICBjcmVhdGUsXHJcbiAgICAgIHVwZGF0ZSxcclxuICAgICAgZGFuZ2Vyb3VzbHlEZWxldGUsXHJcbiAgICAgIGZvcmssXHJcbiAgICAgIHNhdmUsXHJcbiAgICAgIGZvcmtzLFxyXG4gICAgICB1cGRhdGVCcmFuY2gsXHJcbiAgICAgIHJlYWQsXHJcbiAgICAgIHN0b3JlWmlwLFxyXG4gICAgICByZW1vdmVaaXAsXHJcbiAgICAgIGZpbGVGcm9tWmlwLFxyXG4gICAgfSxcclxuICAgIGNvbXBvbmVudCxcclxuICAgIGNvbXBvbmVudHMsXHJcbiAgICBjb25maWcsXHJcbiAgfTtcclxufTtcclxuXHJcbnVzZVJlcG9zaXRvcnkucHJvcFR5cGVzID0ge1xyXG4gIC8qKiBSZXBvc2l0b3J5IGRhdGEgdG8gcmVuZGVyLCBpZiB1cmwgbm90IHByb3ZpZGVkLiAqL1xyXG4gIHJlcG9zaXRvcnk6IFByb3BUeXBlcy5zaGFwZSh7XHJcbiAgICBpZDogUHJvcFR5cGVzLm51bWJlcixcclxuICAgIG93bmVyOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXHJcbiAgICBuYW1lOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXHJcbiAgICBmdWxsX25hbWU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcclxuICAgIGRlc2NyaXB0aW9uOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXHJcbiAgICBodG1sX3VybDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxyXG4gICAgd2Vic2l0ZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxyXG4gICAgdHJlZV91cmw6IFByb3BUeXBlcy5zdHJpbmcsXHJcbiAgICBhdmF0YXJfdXJsOiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gICAgYnJhbmNoOiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gIH0pLFxyXG4gIC8qKiBGdW5jdGlvbiB0byBjYWxsIHdoZW4gcmVwb3NpdG9yeSBpcyBzZWxlY3RlZC4gKi9cclxuICBvblJlcG9zaXRvcnk6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXHJcbiAgLyoqIEZ1bGwgbmFtZSBvZiB0aGUgcmVwbywgYG93bmVyL25hbWVgICovXHJcbiAgZnVsbF9uYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gIC8qKiBQYXNzIGEgcHJldmlvdXNseSByZXR1cm5lZCBhdXRoZW50aWNhdGlvbiBvYmplY3QgdG8gYnlwYXNzIGxvZ2luLiAqL1xyXG4gIGF1dGhlbnRpY2F0aW9uOiBQcm9wVHlwZXMuc2hhcGUoe1xyXG4gICAgdXNlcjogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxyXG4gICAgdG9rZW46IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcclxuICAgIGNvbmZpZzogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxyXG4gICAgcmVtZW1iZXI6IFByb3BUeXBlcy5ib29sLFxyXG4gIH0pLFxyXG4gIC8qKiBVcmxzIGFycmF5IHRvIGdldCByZXBvc2l0b3J5IGRhdGEsIGlmIHJlcG9zaXRvcnkgZGF0YSBpcyBub3QgcHJvdmlkZWQuICovXHJcbiAgdXJsczogUHJvcFR5cGVzLmFycmF5LFxyXG4gIC8qKiBSZXBvc2l0b3JpZXMgZGF0YSBhcnJheSB0byByZW5kZXIsIGlmIHVybHMgbm90IHByb3ZpZGVkLiAqL1xyXG4gIHJlcG9zaXRvcmllczogUHJvcFR5cGVzLmFycmF5LFxyXG4gIC8qKiBQcmVmaWxsIHRoZSBvd25lciBzZWFyY2ggZmllbGQuICovXHJcbiAgZGVmYXVsdE93bmVyOiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gIC8qKiBQcmVmaWxsIHRoZSBxdWVyeSBzZWFyY2ggZmllbGQuICovXHJcbiAgZGVmYXVsdFF1ZXJ5OiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gIC8qKiBUaGUgbmFtZSBvZiB0aGUgYnJhbmNoIHRvIHJlYWQvd3JpdGUgZmlsZXMgKi9cclxuICBicmFuY2g6IFByb3BUeXBlcy5zdHJpbmcsXHJcbiAgLyoqIENvbmZpZ3VyYXRpb24gdG8gcGFzcyB0aHJvdWdoIHRvIHRoZSBTZWFyY2gvUmVwb3NpdG9yaWVzIGNvbXBvbmVudC4gKi9cclxuICBjb25maWc6IFByb3BUeXBlcy5zaGFwZSh7XHJcbiAgICAvKiogQ29uZmlndXJhdGlvbiByZXF1aXJlZCBmb3IgU2VhcmNoIG9yIFJlcG9zaXRvcmllcyBpZiBwYXRocyBhcmUgcHJvdmlkZWQgYXMgVVJMLiAqL1xyXG4gICAgc2VydmVyOiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gIH0pLmlzUmVxdWlyZWQsXHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCB1c2VSZXBvc2l0b3J5O1xyXG4iXX0=