"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _core = require("@material-ui/core");

var _lodash = _interopRequireDefault(require("lodash.isequal"));

var _markdownTranslatable = require("markdown-translatable");

var _styles = _interopRequireDefault(require("./styles"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

// file to memory
var inputFilters = [[/<br>/gi, '\n'], [/^\u200B/, ''], [/\u200B$/, ''], ['\\n\\n> ', '\n\n> ']]; // screen to memory and thus to file

var outputFilters = [[/^\u200B/, ''], [/\u200B$/, ''], [/<br>/gi, '\n'], ['\n\n> ', '\\n\\n> ']];

function BlockEditableWrapper(_ref) {
  var columnData = _ref.columnData,
      original = _ref.original,
      translation = _ref.translation,
      rowIndex = _ref.rowIndex,
      columnIndex = _ref.columnIndex,
      preview = _ref.preview,
      handleEdit = _ref.handleEdit;
  var classes = (0, _styles["default"])();

  var subheading = /*#__PURE__*/_react["default"].createElement(_core.Typography, {
    className: classes.subheading,
    variant: "subtitle2",
    align: "left",
    color: "textSecondary"
  }, columnData.name);

  var originalValue = original || '*empty*';
  var translationValue = translation || '';
  return /*#__PURE__*/_react["default"].createElement("div", {
    className: classes.row
  }, /*#__PURE__*/_react["default"].createElement("div", {
    className: classes.original
  }, /*#__PURE__*/_react["default"].createElement(_core.Grid, {
    container: true,
    spacing: 2
  }, subheading.props.children !== "OccurrenceNote" ? /*#__PURE__*/_react["default"].createElement(_react["default"].Fragment, null, /*#__PURE__*/_react["default"].createElement(_core.Grid, {
    item: true,
    xs: 4,
    style: {
      padding: '15px 0px 0px 0px'
    }
  }, subheading), /*#__PURE__*/_react["default"].createElement(_core.Grid, {
    item: true,
    xs: 6,
    style: {
      marginTop: '-15px',
      marginLeft: '2px',
      padding: '20px 10px 0px 28px'
    }
  }, /*#__PURE__*/_react["default"].createElement(_markdownTranslatable.BlockEditable, {
    key: "".concat(rowIndex, "-").concat(columnIndex, "-original"),
    preview: preview,
    markdown: originalValue,
    editable: false,
    inputFilters: inputFilters,
    outputFilters: outputFilters
  }))) : ''), /*#__PURE__*/_react["default"].createElement(_core.Grid, {
    container: true,
    spacing: 2
  }, subheading.props.children == "OccurrenceNote" ? /*#__PURE__*/_react["default"].createElement(_react["default"].Fragment, null, /*#__PURE__*/_react["default"].createElement(_core.Grid, {
    item: true,
    xs: 4,
    style: {
      padding: '15px 0px 0px 0px',
      marginTop: '6px'
    }
  }, subheading), /*#__PURE__*/_react["default"].createElement(_markdownTranslatable.BlockEditable, {
    key: "".concat(rowIndex, "-").concat(columnIndex, "-original"),
    preview: preview,
    markdown: originalValue,
    editable: false,
    inputFilters: inputFilters,
    outputFilters: outputFilters
  })) : '')), /*#__PURE__*/_react["default"].createElement("div", {
    className: classes.translation
  }, /*#__PURE__*/_react["default"].createElement(_core.Grid, {
    container: true,
    spacing: 2
  }, subheading.props.children !== "OccurrenceNote" ? /*#__PURE__*/_react["default"].createElement(_react["default"].Fragment, null, /*#__PURE__*/_react["default"].createElement(_core.Grid, {
    item: true,
    xs: 4,
    style: {
      padding: '15px 0px 0px 0px'
    }
  }, subheading), /*#__PURE__*/_react["default"].createElement(_core.Grid, {
    item: true,
    xs: 6,
    style: {
      marginTop: '-15px',
      marginLeft: '2px',
      padding: '20px 10px 0px 28px'
    }
  }, /*#__PURE__*/_react["default"].createElement(_markdownTranslatable.BlockEditable, {
    key: "".concat(rowIndex, "-").concat(columnIndex, "-target"),
    debounce: 1000,
    preview: preview,
    markdown: translationValue,
    editable: true,
    inputFilters: inputFilters,
    outputFilters: outputFilters,
    onEdit: handleEdit
  }))) : ''), /*#__PURE__*/_react["default"].createElement(_core.Grid, {
    container: true,
    spacing: 2
  }, subheading.props.children == "OccurrenceNote" ? /*#__PURE__*/_react["default"].createElement(_react["default"].Fragment, null, /*#__PURE__*/_react["default"].createElement(_core.Grid, {
    item: true,
    xs: 4,
    style: {
      padding: '15px 0px 0px 0px',
      marginTop: '6px'
    }
  }, subheading), /*#__PURE__*/_react["default"].createElement(_markdownTranslatable.BlockEditable, {
    key: "".concat(rowIndex, "-").concat(columnIndex, "-target"),
    debounce: 1000,
    preview: preview,
    markdown: translationValue,
    editable: true,
    inputFilters: inputFilters,
    outputFilters: outputFilters,
    onEdit: handleEdit
  })) : '')));
}

function Cell(props) {
  var value = props.value,
      _props$tableMeta = props.tableMeta,
      columnData = _props$tableMeta.columnData,
      columnIndex = _props$tableMeta.columnIndex,
      rowIndex = _props$tableMeta.rowIndex,
      preview = props.preview,
      onEdit = props.onEdit,
      delimiters = props.delimiters;
  var classes = (0, _styles["default"])();

  var _value$split = value.split(delimiters.cell),
      _value$split2 = _slicedToArray(_value$split, 2),
      original = _value$split2[0],
      translation = _value$split2[1];

  function handleEdit(markdown) {
    onEdit({
      rowIndex: rowIndex,
      columnIndex: columnIndex - 1,
      value: markdown
    });
  }

  ;
  return /*#__PURE__*/_react["default"].createElement("div", {
    className: "cell-".concat(rowIndex, "-").concat(columnIndex, " ") + classes.root
  }, /*#__PURE__*/_react["default"].createElement(BlockEditableWrapper, {
    columnData: columnData,
    original: original,
    translation: translation,
    rowIndex: rowIndex,
    columnIndex: columnIndex,
    preview: preview,
    handleEdit: handleEdit
  }));
}

;
Cell.propTypes = {
  /** Value of the cell */
  value: _propTypes["default"].string.isRequired,

  /** The tableMeta passed from MUIDataTables */
  tableMeta: _propTypes["default"].object.isRequired,

  /** The function to render the rowHeader */
  rowHeader: _propTypes["default"].func,

  /** Set html preview mode, false renders raw markdown */
  preview: _propTypes["default"].bool,

  /** The delimiters for converting the file into rows/columns */
  delimiters: _propTypes["default"].shape({
    /** Delimiters to convert a files into rows "\n" */
    row: _propTypes["default"].string.isRequired,

    /** Delimiters to convert a row into cells "\t" */
    cell: _propTypes["default"].string.isRequired
  }).isRequired,

  /** Handle database updates */
  onEdit: _propTypes["default"].func.isRequired
};
Cell.defaultProps = {
  delimiters: {
    row: '\n',
    cell: '\t'
  }
};

var shouldReRender = function shouldReRender(prevProps, nextProps) {
  return (0, _lodash["default"])(prevProps.tableMeta, nextProps.tableMeta) && (0, _lodash["default"])(prevProps.preview, nextProps.preview) && (0, _lodash["default"])(prevProps.value, nextProps.value) && (0, _lodash["default"])(prevProps.page, nextProps.page);
};

var _default = /*#__PURE__*/(0, _react.memo)(Cell, shouldReRender);

exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2NlbGwvQ2VsbC5qcyJdLCJuYW1lcyI6WyJpbnB1dEZpbHRlcnMiLCJvdXRwdXRGaWx0ZXJzIiwiQmxvY2tFZGl0YWJsZVdyYXBwZXIiLCJjb2x1bW5EYXRhIiwib3JpZ2luYWwiLCJ0cmFuc2xhdGlvbiIsInJvd0luZGV4IiwiY29sdW1uSW5kZXgiLCJwcmV2aWV3IiwiaGFuZGxlRWRpdCIsImNsYXNzZXMiLCJzdWJoZWFkaW5nIiwibmFtZSIsIm9yaWdpbmFsVmFsdWUiLCJ0cmFuc2xhdGlvblZhbHVlIiwicm93IiwicHJvcHMiLCJjaGlsZHJlbiIsInBhZGRpbmciLCJtYXJnaW5Ub3AiLCJtYXJnaW5MZWZ0IiwiQ2VsbCIsInZhbHVlIiwidGFibGVNZXRhIiwib25FZGl0IiwiZGVsaW1pdGVycyIsInNwbGl0IiwiY2VsbCIsIm1hcmtkb3duIiwicm9vdCIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsInN0cmluZyIsImlzUmVxdWlyZWQiLCJvYmplY3QiLCJyb3dIZWFkZXIiLCJmdW5jIiwiYm9vbCIsInNoYXBlIiwiZGVmYXVsdFByb3BzIiwic2hvdWxkUmVSZW5kZXIiLCJwcmV2UHJvcHMiLCJuZXh0UHJvcHMiLCJwYWdlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQTtBQUNBLElBQU1BLFlBQVksR0FBRyxDQUNuQixDQUFDLFFBQUQsRUFBVyxJQUFYLENBRG1CLEVBRW5CLENBQUMsU0FBRCxFQUFXLEVBQVgsQ0FGbUIsRUFFSCxDQUFDLFNBQUQsRUFBVyxFQUFYLENBRkcsRUFHbkIsQ0FBQyxVQUFELEVBQWEsUUFBYixDQUhtQixDQUFyQixDLENBTUE7O0FBQ0EsSUFBTUMsYUFBYSxHQUFHLENBQ3BCLENBQUMsU0FBRCxFQUFXLEVBQVgsQ0FEb0IsRUFDSixDQUFDLFNBQUQsRUFBVyxFQUFYLENBREksRUFF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b0JBWixJQUFJLENBQUNrQixZQUFMLEdBQW9CO0FBQ2xCZCxFQUFBQSxVQUFVLEVBQUU7QUFDVlYsSUFBQUEsR0FBRyxFQUFFLElBREs7QUFFVlksSUFBQUEsSUFBSSxFQUFFO0FBRkk7QUFETSxDQUFwQjs7QUFRQSxJQUFNYSxjQUFjLEdBQUcsU0FBakJBLGNBQWlCLENBQUNDLFNBQUQsRUFBWUMsU0FBWjtBQUFBLFNBQ3JCLHdCQUFRRCxTQUFTLENBQUNsQixTQUFsQixFQUE2Qm1CLFNBQVMsQ0FBQ25CLFNBQXZDLEtBQ0Ysd0JBQVFrQixTQUFTLENBQUNqQyxPQUFsQixFQUEyQmtDLFNBQVMsQ0FBQ2xDLE9BQXJDLENBREUsSUFFRix3QkFBUWlDLFNBQVMsQ0FBQ25CLEtBQWxCLEVBQXlCb0IsU0FBUyxDQUFDcEIsS0FBbkMsQ0FGRSxJQUdGLHdCQUFRbUIsU0FBUyxDQUFDRSxJQUFsQixFQUF3QkQsU0FBUyxDQUFDQyxJQUFsQyxDQUp1QjtBQUFBLENBQXZCOzs0QkFNZSxpQkFBS3RCLElBQUwsRUFBV21CLGNBQVgsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBtZW1vIH0gZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xyXG5pbXBvcnQgeyBUeXBvZ3JhcGh5LCBHcmlkIH0gZnJvbSAnQG1hdGVyaWFsLXVpL2NvcmUnO1xyXG5pbXBvcnQgaXNFcXVhbCBmcm9tICdsb2Rhc2guaXNlcXVhbCc7XHJcblxyXG5pbXBvcnQgeyBCbG9ja0VkaXRhYmxlIH0gZnJvbSAnbWFya2Rvd24tdHJhbnNsYXRhYmxlJztcclxuaW1wb3J0IHVzZVN0eWxlcyBmcm9tICcuL3N0eWxlcyc7XHJcblxyXG4vLyBmaWxlIHRvIG1lbW9yeVxyXG5jb25zdCBpbnB1dEZpbHRlcnMgPSBbXHJcbiAgWy88YnI+L2dpLCAnXFxuJ10sIFxyXG4gIFsvXlxcdTIwMEIvLCcnXSwgWy9cXHUyMDBCJC8sJyddLCBcclxuICBbJ1xcXFxuXFxcXG4+ICcsICdcXG5cXG4+ICddLFxyXG5dO1xyXG5cclxuLy8gc2NyZWVuIHRvIG1lbW9yeSBhbmQgdGh1cyB0byBmaWxlXHJcbmNvbnN0IG91dHB1dEZpbHRlcnMgPSBbXHJcbiAgWy9eXFx1MjAwQi8sJyddLCBbL1xcdTIwMEIkLywnJ10sIFxyXG4gIFsvPGJyPi9naSwgJ1xcbiddLCBcclxuICBbJ1xcblxcbj4gJywgJ1xcXFxuXFxcXG4+ICddLFxyXG5dO1xyXG5cclxuZnVuY3Rpb24gQmxvY2tFZGl0YWJsZVdyYXBwZXIoe1xyXG4gIGNvbHVtbkRhdGEsXHJcbiAgb3JpZ2luYWwsXHJcbiAgdHJhbnNsYXRpb24sXHJcbiAgcm93SW5kZXgsXHJcbiAgY29sdW1uSW5kZXgsXHJcbiAgcHJldmlldyxcclxuICBoYW5kbGVFZGl0LFxyXG59KSB7XHJcbiAgY29uc3QgY2xhc3NlcyA9IHVzZVN0eWxlcygpO1xyXG4gIGNvbnN0IHN1YmhlYWRpbmcgPSAoXHJcbiAgICA8VHlwb2dyYXBoeSBjbGFzc05hbWU9e2NsYXNzZXMuc3ViaGVhZGluZ30gdmFyaWFudD0nc3VidGl0bGUyJyBhbGlnbj0nbGVmdCcgY29sb3I9J3RleHRTZWNvbmRhcnknPlxyXG4gICAgICB7Y29sdW1uRGF0YS5uYW1lfVxyXG4gICAgPC9UeXBvZ3JhcGh5PlxyXG4gICk7XHJcbiAgY29uc3Qgb3JpZ2luYWxWYWx1ZSA9IG9yaWdpbmFsIHx8ICcqZW1wdHkqJztcclxuICBjb25zdCB0cmFuc2xhdGlvblZhbHVlID0gdHJhbnNsYXRpb24gfHwgJyc7XHJcblxyXG4gIHJldHVybiAoXHJcbiAgICA8ZGl2IGNsYXNzTmFtZT17Y2xhc3Nlcy5yb3d9PlxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT17Y2xhc3Nlcy5vcmlnaW5hbH0+XHJcbiAgICAgIDxHcmlkIGNvbnRhaW5lciBzcGFjaW5nPXsyfT5cclxuICAgICAgICAgIHtzdWJoZWFkaW5nLnByb3BzLmNoaWxkcmVuICE9PSBcIk9jY3VycmVuY2VOb3RlXCI/XHJcbiAgICAgICAgICAgIDw+XHJcbiAgICAgICAgICAgICAgPEdyaWQgaXRlbSB4cz17NH0gc3R5bGU9e3twYWRkaW5nOiAnMTVweCAwcHggMHB4IDBweCd9fSA+XHJcbiAgICAgICAgICAgICAgICB7c3ViaGVhZGluZ31cclxuICAgICAgICAgICAgICA8L0dyaWQ+XHJcbiAgICAgICAgICAgICAgPEdyaWQgaXRlbSB4cz17Nn0gc3R5bGU9e3sgbWFyZ2luVG9wOictMTVweCcsIG1hcmdpbkxlZnQ6JzJweCcsIHBhZGRpbmc6ICcyMHB4IDEwcHggMHB4IDI4cHgnfX0+XHJcbiAgICAgICAgICAgICAgICA8QmxvY2tFZGl0YWJsZVxyXG4gICAgICAgICAgICAgICAgICBrZXk9e2Ake3Jvd0luZGV4fS0ke2NvbHVtbkluZGV4fS1vcmlnaW5hbGB9XHJcbiAgICAgICAgICAgICAgICAgIHByZXZpZXc9e3ByZXZpZXd9XHJcbiAgICAgICAgICAgICAgICAgIG1hcmtkb3duPXtvcmlnaW5hbFZhbHVlfVxyXG4gICAgICAgICAgICAgICAgICBlZGl0YWJsZT17ZmFsc2V9XHJcbiAgICAgICAgICAgICAgICAgIGlucHV0RmlsdGVycz17aW5wdXRGaWx0ZXJzfVxyXG4gICAgICAgICAgICAgICAgICBvdXRwdXRGaWx0ZXJzPXtvdXRwdXRGaWx0ZXJzfVxyXG4gICAgICAgICAgICAgICAgLz5cclxuICAgICAgICAgICAgICA8L0dyaWQ+XHJcbiAgICAgICAgICAgIDwvPjonJ1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIDwvR3JpZD5cclxuICAgICAgICA8R3JpZCBjb250YWluZXIgc3BhY2luZz17Mn0+XHJcbiAgICAgICAgICB7c3ViaGVhZGluZy5wcm9wcy5jaGlsZHJlbiA9PSBcIk9jY3VycmVuY2VOb3RlXCI/XHJcbiAgICAgICAgICAgIDw+XHJcbiAgICAgICAgICAgICAgPEdyaWQgaXRlbSB4cz17NH0gc3R5bGU9e3twYWRkaW5nOiAnMTVweCAwcHggMHB4IDBweCcsIG1hcmdpblRvcDogJzZweCd9fSA+XHJcbiAgICAgICAgICAgICAge3N1YmhlYWRpbmd9XHJcbiAgICAgICAgICAgICAgPC9HcmlkPlxyXG4gICAgICAgICAgICAgIDxCbG9ja0VkaXRhYmxlXHJcbiAgICAgICAgICAgICAgICBrZXk9e2Ake3Jvd0luZGV4fS0ke2NvbHVtbkluZGV4fS1vcmlnaW5hbGB9XHJcbiAgICAgICAgICAgICAgICBwcmV2aWV3PXtwcmV2aWV3fVxyXG4gICAgICAgICAgICAgICAgbWFya2Rvd249e29yaWdpbmFsVmFsdWV9XHJcbiAgICAgICAgICAgICAgICBlZGl0YWJsZT17ZmFsc2V9XHJcbiAgICAgICAgICAgICAgICBpbnB1dEZpbHRlcnM9e2lucHV0RmlsdGVyc31cclxuICAgICAgICAgICAgICAgIG91dHB1dEZpbHRlcnM9e291dHB1dEZpbHRlcnN9XHJcbiAgICAgICAgICAgICAgLz5cclxuICAgICAgICAgICAgPC8+OicnXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgPC9HcmlkPlxyXG4gICAgICA8L2Rpdj5cclxuICAgICAgPGRpdiBjbGFzc05hbWU9e2NsYXNzZXMudHJhbnNsYXRpb259PlxyXG4gICAgICAgIDxHcmlkIGNvbnRhaW5lciBzcGFjaW5nPXsyfT5cclxuICAgICAgICAgIHtzdWJoZWFkaW5nLnByb3BzLmNoaWxkcmVuICE9PSBcIk9jY3VycmVuY2VOb3RlXCI/XHJcbiAgICAgICAgICAgIDw+XHJcbiAgICAgICAgICAgICAgPEdyaWQgaXRlbSB4cz17NH0gc3R5bGU9e3twYWRkaW5nOiAnMTVweCAwcHggMHB4IDBweCd9fT5cclxuICAgICAgICAgICAgICAgIHtzdWJoZWFkaW5nfVxyXG4gICAgICAgICAgICAgIDwvR3JpZD5cclxuICAgICAgICAgICAgICA8R3JpZCBpdGVtIHhzPXs2fSBzdHlsZT17eyBtYXJnaW5Ub3A6Jy0xNXB4JywgbWFyZ2luTGVmdDonMnB4JywgcGFkZGluZzogJzIwcHggMTBweCAwcHggMjhweCd9fT5cclxuICAgICAgICAgICAgICAgIDxCbG9ja0VkaXRhYmxlXHJcbiAgICAgICAgICAgICAgICAgIGtleT17YCR7cm93SW5kZXh9LSR7Y29sdW1uSW5kZXh9LXRhcmdldGB9XHJcbiAgICAgICAgICAgICAgICAgIGRlYm91bmNlPXsxMDAwfVxyXG4gICAgICAgICAgICAgICAgICBwcmV2aWV3PXtwcmV2aWV3fVxyXG4gICAgICAgICAgICAgICAgICBtYXJrZG93bj17dHJhbnNsYXRpb25WYWx1ZX1cclxuICAgICAgICAgICAgICAgICAgZWRpdGFibGU9e3RydWV9XHJcbiAgICAgICAgICAgICAgICAgIGlucHV0RmlsdGVycz17aW5wdXRGaWx0ZXJzfVxyXG4gICAgICAgICAgICAgICAgICBvdXRwdXRGaWx0ZXJzPXtvdXRwdXRGaWx0ZXJzfVxyXG4gICAgICAgICAgICAgICAgICBvbkVkaXQ9e2hhbmRsZUVkaXR9XHJcbiAgICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICAgIDwvR3JpZD5cclxuICAgICAgICAgICAgPC8+OicnXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgPC9HcmlkPlxyXG4gICAgICAgIDxHcmlkIGNvbnRhaW5lciBzcGFjaW5nPXsyfT5cclxuICAgICAgICAgIHtzdWJoZWFkaW5nLnByb3BzLmNoaWxkcmVuID09IFwiT2NjdXJyZW5jZU5vdGVcIj9cclxuICAgICAgICAgICAgPD5cclxuICAgICAgICAgICAgICA8R3JpZCBpdGVtIHhzPXs0fSBzdHlsZT17e3BhZGRpbmc6JzE1cHggMHB4IDBweCAwcHgnLCBtYXJnaW5Ub3A6ICc2cHgnfX0gPlxyXG4gICAgICAgICAgICAgICAge3N1YmhlYWRpbmd9XHJcbiAgICAgICAgICAgICAgPC9HcmlkPlxyXG4gICAgICAgICAgICAgIDxCbG9ja0VkaXRhYmxlXHJcbiAgICAgICAgICAgICAgICBrZXk9e2Ake3Jvd0luZGV4fS0ke2NvbHVtbkluZGV4fS10YXJnZXRgfVxyXG4gICAgICAgICAgICAgICAgZGVib3VuY2U9ezEwMDB9XHJcbiAgICAgICAgICAgICAgICBwcmV2aWV3PXtwcmV2aWV3fVxyXG4gICAgICAgICAgICAgICAgbWFya2Rvd249e3RyYW5zbGF0aW9uVmFsdWV9XHJcbiAgICAgICAgICAgICAgICBlZGl0YWJsZT17dHJ1ZX1cclxuICAgICAgICAgICAgICAgIGlucHV0RmlsdGVycz17aW5wdXRGaWx0ZXJzfVxyXG4gICAgICAgICAgICAgICAgb3V0cHV0RmlsdGVycz17b3V0cHV0RmlsdGVyc31cclxuICAgICAgICAgICAgICAgIG9uRWRpdD17aGFuZGxlRWRpdH1cclxuICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICA8Lz46JydcclxuICAgICAgICAgIH1cclxuICAgICAgICA8L0dyaWQ+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgPC9kaXY+XHJcbiAgKTtcclxufVxyXG5cclxuZnVuY3Rpb24gQ2VsbChwcm9wcykge1xyXG4gIGNvbnN0IHtcclxuICAgIHZhbHVlLFxyXG4gICAgdGFibGVNZXRhOiB7XHJcbiAgICAgIGNvbHVtbkRhdGEsXHJcbiAgICAgIGNvbHVtbkluZGV4LFxyXG4gICAgICByb3dJbmRleCxcclxuICAgIH0sXHJcbiAgICBwcmV2aWV3LFxyXG4gICAgb25FZGl0LFxyXG4gICAgZGVsaW1pdGVycyxcclxuICB9ID0gcHJvcHM7XHJcbiAgY29uc3QgY2xhc3NlcyA9IHVzZVN0eWxlcygpO1xyXG4gIGNvbnN0IFtvcmlnaW5hbCwgdHJhbnNsYXRpb25dID0gdmFsdWUuc3BsaXQoZGVsaW1pdGVycy5jZWxsKTtcclxuXHJcbiAgZnVuY3Rpb24gaGFuZGxlRWRpdChtYXJrZG93bil7XHJcbiAgICBvbkVkaXQoe1xyXG4gICAgICByb3dJbmRleCwgY29sdW1uSW5kZXg6IGNvbHVtbkluZGV4IC0gMSwgdmFsdWU6IG1hcmtkb3duLFxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIChcclxuICAgIDxkaXYgY2xhc3NOYW1lPXtgY2VsbC0ke3Jvd0luZGV4fS0ke2NvbHVtbkluZGV4fSBgICsgY2xhc3Nlcy5yb290fT5cclxuICAgICAgPEJsb2NrRWRpdGFibGVXcmFwcGVyXHJcbiAgICAgICAgY29sdW1uRGF0YT17Y29sdW1uRGF0YX1cclxuICAgICAgICBvcmlnaW5hbD17b3JpZ2luYWx9XHJcbiAgICAgICAgdHJhbnNsYXRpb249e3RyYW5zbGF0aW9ufVxyXG4gICAgICAgIHJvd0luZGV4PXtyb3dJbmRleH1cclxuICAgICAgICBjb2x1bW5JbmRleD17Y29sdW1uSW5kZXh9XHJcbiAgICAgICAgcHJldmlldz17cHJldmlld31cclxuICAgICAgICBoYW5kbGVFZGl0PXtoYW5kbGVFZGl0fVxyXG4gICAgICAvPlxyXG4gICAgPC9kaXY+XHJcbiAgKTtcclxufTtcclxuXHJcbkNlbGwucHJvcFR5cGVzID0ge1xyXG4gIC8qKiBWYWx1ZSBvZiB0aGUgY2VsbCAqL1xyXG4gIHZhbHVlOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXHJcbiAgLyoqIFRoZSB0YWJsZU1ldGEgcGFzc2VkIGZyb20gTVVJRGF0YVRhYmxlcyAqL1xyXG4gIHRhYmxlTWV0YTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxyXG4gIC8qKiBUaGUgZnVuY3Rpb24gdG8gcmVuZGVyIHRoZSByb3dIZWFkZXIgKi9cclxuICByb3dIZWFkZXI6IFByb3BUeXBlcy5mdW5jLFxyXG4gIC8qKiBTZXQgaHRtbCBwcmV2aWV3IG1vZGUsIGZhbHNlIHJlbmRlcnMgcmF3IG1hcmtkb3duICovXHJcbiAgcHJldmlldzogUHJvcFR5cGVzLmJvb2wsXHJcbiAgLyoqIFRoZSBkZWxpbWl0ZXJzIGZvciBjb252ZXJ0aW5nIHRoZSBmaWxlIGludG8gcm93cy9jb2x1bW5zICovXHJcbiAgZGVsaW1pdGVyczogUHJvcFR5cGVzLnNoYXBlKHtcclxuICAgIC8qKiBEZWxpbWl0ZXJzIHRvIGNvbnZlcnQgYSBmaWxlcyBpbnRvIHJvd3MgXCJcXG5cIiAqL1xyXG4gICAgcm93OiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXHJcbiAgICAvKiogRGVsaW1pdGVycyB0byBjb252ZXJ0IGEgcm93IGludG8gY2VsbHMgXCJcXHRcIiAqL1xyXG4gICAgY2VsbDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxyXG4gIH0pLmlzUmVxdWlyZWQsXHJcbiAgLyoqIEhhbmRsZSBkYXRhYmFzZSB1cGRhdGVzICovXHJcbiAgb25FZGl0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxyXG59O1xyXG5cclxuQ2VsbC5kZWZhdWx0UHJvcHMgPSB7XHJcbiAgZGVsaW1pdGVyczoge1xyXG4gICAgcm93OiAnXFxuJyxcclxuICAgIGNlbGw6ICdcXHQnLFxyXG4gIH0sXHJcbn07XHJcblxyXG5cclxuY29uc3Qgc2hvdWxkUmVSZW5kZXIgPSAocHJldlByb3BzLCBuZXh0UHJvcHMpID0+XHJcbiAgaXNFcXVhbChwcmV2UHJvcHMudGFibGVNZXRhLCBuZXh0UHJvcHMudGFibGVNZXRhKSAmJlxyXG5pc0VxdWFsKHByZXZQcm9wcy5wcmV2aWV3LCBuZXh0UHJvcHMucHJldmlldykgJiZcclxuaXNFcXVhbChwcmV2UHJvcHMudmFsdWUsIG5leHRQcm9wcy52YWx1ZSkgJiZcclxuaXNFcXVhbChwcmV2UHJvcHMucGFnZSwgbmV4dFByb3BzLnBhZ2UpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgbWVtbyhDZWxsLCBzaG91bGRSZVJlbmRlcik7XHJcbiJdfQ==