"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.markdownToHtml = exports.htmlToMarkdown = exports.fromDisplay = exports.toDisplay = void 0;

var _turndown = _interopRequireDefault(require("turndown"));

var _turndownPluginGfm = require("turndown-plugin-gfm");

var _showdown = _interopRequireDefault(require("showdown"));

var _string = require("./string");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var turndownService = new _turndown.default({
  headingStyle: 'atx'
});
turndownService.use(_turndownPluginGfm.gfm);
turndownService.addRule('strikethrough', {
  filter: ['del', 's', 'strike'],
  replacement: function replacement(content) {
    return "~".concat(content, "~");
  }
});
turndownService.addRule('underline', {
  filter: ['u'],
  replacement: function replacement(content) {
    return "<u>".concat(content, "</u>");
  }
}); // bold-italic <strong><em>...</em></strong>
// See below: emphasis rule allows bold-italic to pass through as _content_.

turndownService.addRule('bold-italic', {
  filter: function filter(node, options) {
    return node.nodeName === 'STRONG' && node.childNodes && node.childNodes.length == 1 && node.childNodes[0].nodeName === 'EM';
  },
  replacement: function replacement(content) {
    return "**".concat(content, "**");
  }
}); // <em> node NOT under a <strong> node.
// Will allow the embedded <em>content</em> to pass through as _content_

turndownService.addRule('emphasis', {
  //filter: ['em'],filter: (node, options) => {
  filter: function filter(node, options) {
    return node.nodeName === 'EM' && node.parentNode && node.parentNode.nodeName != 'STRONG';
  },
  replacement: function replacement(content) {
    return "*".concat(content, "*");
  }
});
var markdownToHtmlConverter = new _showdown.default.Converter({
  openLinksInNewWindow: true
});

var toDisplay = function toDisplay(content) {
  return content.replace(/&/g, '&amp;').replace(/<br\\?>/g, '\n').replace(/</g, '&lt;').replace(/>/g, '&gt;');
};

exports.toDisplay = toDisplay;

var fromDisplay = function fromDisplay(content) {
  return content.replace(/&nbsp;/, ' ').replace(/<br><div>/g, '<div>').replace(/<div>([\s\S]*)<\/div>/g, '\n$1').replace(/<br\\?>/g, '\n').replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&');
};

exports.fromDisplay = fromDisplay;

var htmlToMarkdown = function htmlToMarkdown(_ref) {
  var html = _ref.html,
      _ref$outputFilters = _ref.outputFilters,
      outputFilters = _ref$outputFilters === void 0 ? [] : _ref$outputFilters;
  var markdown = turndownService.turndown(html); // Fix up resource links:

  markdown = markdown.replace(/\\\[\\\[rc:/g, '[[rc:');
  markdown = markdown.replace(/\\\]\\\]/g, ']]');
  markdown = markdown.replace(/\[\]\(rc:\/\/([^)]*)\)/g, '[[rc://$1]]'); // Asterisk inside of RC link:

  markdown = markdown.replace(/(\[\[.*)(\\\*)(.*\]\])/g, '$1*$3');
  markdown = (0, _string.filter)({
    string: markdown,
    filters: outputFilters
  }); // Strip NBSP from beginning or end.
  // See below (markdownToHtml) where this NBSP is added to empty blocks.

  while (markdown.match(/^\u200B/)) {
    markdown = markdown.replace(/\u200B/, '');
  }

  while (markdown.match(/\u200B$/)) {
    markdown = markdown.replace(/\u200B$/, '');
  } // Replace double space.


  markdown = markdown.replace(/(\d+)\. {2,}/g, '$1. ');
  return markdown;
};

exports.htmlToMarkdown = htmlToMarkdown;

var markdownToHtml = function markdownToHtml(_ref2) {
  var markdown = _ref2.markdown,
      _ref2$inputFilters = _ref2.inputFilters,
      inputFilters = _ref2$inputFilters === void 0 ? [] : _ref2$inputFilters;

  var _markdown = (markdown || '').slice(0); // Make "easy" blockquote:


  _markdown = _markdown.replace(/\n\>/g, '  \n\>');
  _markdown = _markdown.replace(/\<br\>\>/g, '  \<br\>\>'); // Prevent "    *" from being considered as <pre><code>....

  _markdown = _markdown.replace(/^\ \ \ \ \*/mg, '*');
  _markdown = (0, _string.filter)({
    string: _markdown,
    filters: inputFilters
  });
  var html = markdownToHtmlConverter.makeHtml(_markdown);
  html = html.replace(/<br\s.\\?>/ig, '<br/>'); // Insert NBSP into empty blocks.
  // See above (htmlToMarkdown) where this NBSP is later stripped out.

  if (!html || html === '') {
    html = '<p>&#8203;</p>';
  }

  return html;
};

exports.markdownToHtml = markdownToHtml;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb3JlL21hcmtkb3duLWNvbnZlcnRlci50cyJdLCJuYW1lcyI6WyJ0dXJuZG93blNlcnZpY2UiLCJUdXJuZG93blNlcnZpY2UiLCJoZWFkaW5nU3R5bGUiLCJ1c2UiLCJnZm0iLCJhZGRSdWxlIiwiZmlsdGVyIiwicmVwbGFjZW1lbnQiLCJjb250ZW50Iiwibm9kZSIsIm9wdGlvbnMiLCJub2RlTmFtZSIsImNoaWxkTm9kZXMiLCJsZW5ndGgiLCJwYXJlbnROb2RlIiwibWFya2Rvd25Ub0h0bWxDb252ZXJ0ZXIiLCJzaG93ZG93biIsIkNvbnZlcnRlciIsIm9wZW5MaW5rc0luTmV3V2luZG93IiwidG9EaXNwbGF5IiwicmVwbGFjZSIsImZyb21EaXNwbGF5IiwiaHRtbFRvTWFya2Rvd24iLCJodG1sIiwib3V0cHV0RmlsdGVycyIsIm1hcmtkb3duIiwidHVybmRvd24iLCJzdHJpbmciLCJmaWx0ZXJzIiwibWF0Y2giLCJtYXJrZG93blRvSHRtbCIsImlucHV0RmlsdGVycyIsIl9tYXJrZG93biIsInNsaWNlIiwibWFrZUh0bWwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBLElBQU1BLGVBQWUsR0FBRyxJQUFJQyxpQkFBSixDQUFvQjtBQUFFQyxFQUFBQSxZQUFZLEVBQUU7QUFBaEIsQ0FBcEIsQ0FBeEI7QUFDQUYsZUFBZSxDQUFDRyxHQUFoQixDQUFvQkMsc0JBQXBCO0FBQ0FKLGVBQWUsQ0FBQ0ssT0FBaEIsQ0FBd0IsZUFBeEIsRUFBeUM7QUFDdkNDLEVBQUFBLE1BQU0sRUFBRSxDQUFDLEtBQUQsRUFBUSxHQUFSLEVBQWEsUUFBYixDQUQrQjtBQUV2Q0MsRUFBQUEsV0FBVyxFQUFFLHFCQUFDQyxPQUFEO0FBQUEsc0JBQWlCQSxPQUFqQjtBQUFBO0FBRjBCLENBQXpDO0FBSUFSLGVBQWUsQ0FBQ0ssT0FBaEIsQ0FBd0IsV0FBeEIsRUFBcUM7QUFDbkNDLEVBQUFBLE1BQU0sRUFBRSxD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T2pFOztBQUNBWSxFQUFBQSxTQUFTLEdBQUdBLFNBQVMsQ0FBQ1osT0FBVixDQUFrQixlQUFsQixFQUFtQyxHQUFuQyxDQUFaO0FBRUFZLEVBQUFBLFNBQVMsR0FBRyxvQkFBTztBQUFFTCxJQUFBQSxNQUFNLEVBQUVLLFNBQVY7QUFBcUJKLElBQUFBLE9BQU8sRUFBRUc7QUFBOUIsR0FBUCxDQUFaO0FBRUEsTUFBSVIsSUFBSSxHQUFHUix1QkFBdUIsQ0FBQ21CLFFBQXhCLENBQWlDRixTQUFqQyxDQUFYO0FBQ0FULEVBQUFBLElBQUksR0FBR0EsSUFBSSxDQUFDSCxPQUFMLENBQWEsY0FBYixFQUE2QixPQUE3QixDQUFQLENBYmlFLENBZWpFO0FBQ0E7O0FBQ0EsTUFBSSxDQUFDRyxJQUFELElBQVNBLElBQUksS0FBSyxFQUF0QixFQUEwQjtBQUN4QkEsSUFBQUEsSUFBSSxHQUFHLGdCQUFQO0FBQ0Q7O0FBQ0QsU0FBT0EsSUFBUDtBQUNELENBckJNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFR1cm5kb3duU2VydmljZSBmcm9tICd0dXJuZG93bic7XHJcbmltcG9ydCB7IGdmbSB9IGZyb20gJ3R1cm5kb3duLXBsdWdpbi1nZm0nO1xyXG5pbXBvcnQgc2hvd2Rvd24gZnJvbSAnc2hvd2Rvd24nO1xyXG5pbXBvcnQgeyBmaWx0ZXIgfSBmcm9tICcuL3N0cmluZyc7XHJcblxyXG5jb25zdCB0dXJuZG93blNlcnZpY2UgPSBuZXcgVHVybmRvd25TZXJ2aWNlKHsgaGVhZGluZ1N0eWxlOiAnYXR4JyB9KTtcclxudHVybmRvd25TZXJ2aWNlLnVzZShnZm0pO1xyXG50dXJuZG93blNlcnZpY2UuYWRkUnVsZSgnc3RyaWtldGhyb3VnaCcsIHtcclxuICBmaWx0ZXI6IFsnZGVsJywgJ3MnLCAnc3RyaWtlJ10sXHJcbiAgcmVwbGFjZW1lbnQ6IChjb250ZW50KSA9PiBgfiR7Y29udGVudH1+YCxcclxufSk7XHJcbnR1cm5kb3duU2VydmljZS5hZGRSdWxlKCd1bmRlcmxpbmUnLCB7XHJcbiAgZmlsdGVyOiBbJ3UnXSxcclxuICByZXBsYWNlbWVudDogKGNvbnRlbnQpID0+IGA8dT4ke2NvbnRlbnR9PC91PmAsXHJcbn0pO1xyXG4vLyBib2xkLWl0YWxpYyA8c3Ryb25nPjxlbT4uLi48L2VtPjwvc3Ryb25nPlxyXG4vLyBTZWUgYmVsb3c6IGVtcGhhc2lzIHJ1bGUgYWxsb3dzIGJvbGQtaXRhbGljIHRvIHBhc3MgdGhyb3VnaCBhcyBfY29udGVudF8uXHJcbnR1cm5kb3duU2VydmljZS5hZGRSdWxlKCdib2xkLWl0YWxpYycsIHtcclxuICBmaWx0ZXI6IChub2RlLCBvcHRpb25zKSA9PiB7XHJcbiAgICByZXR1cm4gbm9kZS5ub2RlTmFtZSA9PT0gJ1NUUk9ORycgJiYgbm9kZS5jaGlsZE5vZGVzICYmIG5vZGUuY2hpbGROb2Rlcy5sZW5ndGggPT0gMSAmJiBub2RlLmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUgPT09ICdFTSc7XHJcbiAgfSxcclxuICByZXBsYWNlbWVudDogKGNvbnRlbnQpID0+IHtcclxuICAgIHJldHVybiBgKioke2NvbnRlbnR9KipgO1xyXG4gIH0sXHJcbn0pO1xyXG4vLyA8ZW0+IG5vZGUgTk9UIHVuZGVyIGEgPHN0cm9uZz4gbm9kZS5cclxuLy8gV2lsbCBhbGxvdyB0aGUgZW1iZWRkZWQgPGVtPmNvbnRlbnQ8L2VtPiB0byBwYXNzIHRocm91Z2ggYXMgX2NvbnRlbnRfXHJcbnR1cm5kb3duU2VydmljZS5hZGRSdWxlKCdlbXBoYXNpcycsIHtcclxuICAvL2ZpbHRlcjogWydlbSddLGZpbHRlcjogKG5vZGUsIG9wdGlvbnMpID0+IHtcclxuICBmaWx0ZXI6IChub2RlLCBvcHRpb25zKSA9PiB7XHJcbiAgICByZXR1cm4gbm9kZS5ub2RlTmFtZSA9PT0gJ0VNJyAmJiBub2RlLnBhcmVudE5vZGUgJiYgbm9kZS5wYXJlbnROb2RlLm5vZGVOYW1lICE9ICdTVFJPTkcnO1xyXG4gIH0sXHJcbiAgcmVwbGFjZW1lbnQ6IChjb250ZW50KSA9PiBgKiR7Y29udGVudH0qYCxcclxufSk7XHJcblxyXG5jb25zdCBtYXJrZG93blRvSHRtbENvbnZlcnRlciA9IG5ldyBzaG93ZG93bi5Db252ZXJ0ZXIoe29wZW5MaW5rc0luTmV3V2luZG93OiB0cnVlfSk7XHJcblxyXG5leHBvcnQgY29uc3QgdG9EaXNwbGF5ID0gKGNvbnRlbnQpID0+IGNvbnRlbnQucmVwbGFjZSgvJi9nLCAnJmFtcDsnKVxyXG4gIC5yZXBsYWNlKC88YnJcXFxcPz4vZywgJ1xcbicpXHJcbiAgLnJlcGxhY2UoLzwvZywgJyZsdDsnKVxyXG4gIC5yZXBsYWNlKC8+L2csICcmZ3Q7Jyk7XHJcblxyXG5leHBvcnQgY29uc3QgZnJvbURpc3BsYXkgPSAoY29udGVudCkgPT4gY29udGVudC5yZXBsYWNlKC8mbmJzcDsvLCAnICcpXHJcbiAgLnJlcGxhY2UoLzxicj48ZGl2Pi9nLCAnPGRpdj4nKVxyXG4gIC5yZXBsYWNlKC88ZGl2PihbXFxzXFxTXSopPFxcL2Rpdj4vZywgJ1xcbiQxJylcclxuICAucmVwbGFjZSgvPGJyXFxcXD8+L2csICdcXG4nKVxyXG4gIC5yZXBsYWNlKC8mbHQ7L2csICc8JylcclxuICAucmVwbGFjZSgvJmd0Oy9nLCAnPicpXHJcbiAgLnJlcGxhY2UoLyZhbXA7L2csICcmJyk7XHJcblxyXG5leHBvcnQgY29uc3QgaHRtbFRvTWFya2Rvd24gPSAoeyBodG1sLCBvdXRwdXRGaWx0ZXJzID0gW10gfSkgPT4ge1xyXG4gIGxldCBtYXJrZG93biA9IHR1cm5kb3duU2VydmljZS50dXJuZG93bihodG1sKTtcclxuXHJcbiAgLy8gRml4IHVwIHJlc291cmNlIGxpbmtzOlxyXG4gIG1hcmtkb3duID0gbWFya2Rvd24ucmVwbGFjZSgvXFxcXFxcW1xcXFxcXFtyYzovZywgJ1tbcmM6Jyk7XHJcbiAgbWFya2Rvd24gPSBtYXJrZG93bi5yZXBsYWNlKC9cXFxcXFxdXFxcXFxcXS9nLCAnXV0nKTtcclxuICBtYXJrZG93biA9IG1hcmtkb3duLnJlcGxhY2UoL1xcW1xcXVxcKHJjOlxcL1xcLyhbXildKilcXCkvZywgJ1tbcmM6Ly8kMV1dJyk7XHJcbiAgLy8gQXN0ZXJpc2sgaW5zaWRlIG9mIFJDIGxpbms6XHJcbiAgbWFya2Rvd24gPSBtYXJrZG93bi5yZXBsYWNlKC8oXFxbXFxbLiopKFxcXFxcXCopKC4qXFxdXFxdKS9nLCAnJDEqJDMnKTtcclxuXHJcbiAgbWFya2Rvd24gPSBmaWx0ZXIoeyBzdHJpbmc6IG1hcmtkb3duLCBmaWx0ZXJzOiBvdXRwdXRGaWx0ZXJzIH0pO1xyXG5cclxuICAvLyBTdHJpcCBOQlNQIGZyb20gYmVnaW5uaW5nIG9yIGVuZC5cclxuICAvLyBTZWUgYmVsb3cgKG1hcmtkb3duVG9IdG1sKSB3aGVyZSB0aGlzIE5CU1AgaXMgYWRkZWQgdG8gZW1wdHkgYmxvY2tzLlxyXG4gIHdoaWxlIChtYXJrZG93bi5tYXRjaCgvXlxcdTIwMEIvKSlcclxuICB7XHJcbiAgICBtYXJrZG93biA9IG1hcmtkb3duLnJlcGxhY2UoL1xcdTIwMEIvLCAnJyk7XHJcbiAgfVxyXG4gIHdoaWxlIChtYXJrZG93bi5tYXRjaCgvXFx1MjAwQiQvKSlcclxuICB7XHJcbiAgICBtYXJrZG93biA9IG1hcmtkb3duLnJlcGxhY2UoL1xcdTIwMEIkLywgJycpO1xyXG4gIH1cclxuXHJcbiAgLy8gUmVwbGFjZSBkb3VibGUgc3BhY2UuXHJcbiAgbWFya2Rvd24gPSBtYXJrZG93bi5yZXBsYWNlKC8oXFxkKylcXC4gezIsfS9nLCAnJDEuICcpO1xyXG5cclxuICByZXR1cm4gbWFya2Rvd247XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgbWFya2Rvd25Ub0h0bWwgPSAoeyBtYXJrZG93biwgaW5wdXRGaWx0ZXJzID0gW10gfSkgPT4ge1xyXG4gIGxldCBfbWFya2Rvd24gPSAobWFya2Rvd24gfHwgJycpLnNsaWNlKDApO1xyXG5cclxuICAvLyBNYWtlIFwiZWFzeVwiIGJsb2NrcXVvdGU6XHJcbiAgX21hcmtkb3duID0gX21hcmtkb3duLnJlcGxhY2UoL1xcblxcPi9nLCAnICBcXG5cXD4nKTtcclxuICBfbWFya2Rvd24gPSBfbWFya2Rvd24ucmVwbGFjZSgvXFw8YnJcXD5cXD4vZywgJyAgXFw8YnJcXD5cXD4nKTtcclxuXHJcbiAgLy8gUHJldmVudCBcIiAgICAqXCIgZnJvbSBiZWluZyBjb25zaWRlcmVkIGFzIDxwcmU+PGNvZGU+Li4uLlxyXG4gIF9tYXJrZG93biA9IF9tYXJrZG93bi5yZXBsYWNlKC9eXFwgXFwgXFwgXFwgXFwqL21nLCAnKicpO1xyXG5cclxuICBfbWFya2Rvd24gPSBmaWx0ZXIoeyBzdHJpbmc6IF9tYXJrZG93biwgZmlsdGVyczogaW5wdXRGaWx0ZXJzIH0pO1xyXG5cclxuICBsZXQgaHRtbCA9IG1hcmtkb3duVG9IdG1sQ29udmVydGVyLm1ha2VIdG1sKF9tYXJrZG93bik7XHJcbiAgaHRtbCA9IGh0bWwucmVwbGFjZSgvPGJyXFxzLlxcXFw/Pi9pZywgJzxici8+Jyk7XHJcblxyXG4gIC8vIEluc2VydCBOQlNQIGludG8gZW1wdHkgYmxvY2tzLlxyXG4gIC8vIFNlZSBhYm92ZSAoaHRtbFRvTWFya2Rvd24pIHdoZXJlIHRoaXMgTkJTUCBpcyBsYXRlciBzdHJpcHBlZCBvdXQuXHJcbiAgaWYgKCFodG1sIHx8IGh0bWwgPT09ICcnKSB7XHJcbiAgICBodG1sID0gJzxwPiYjODIwMzs8L3A+JztcclxuICB9XHJcbiAgcmV0dXJuIGh0bWw7XHJcbn07XHJcbiJdfQ==