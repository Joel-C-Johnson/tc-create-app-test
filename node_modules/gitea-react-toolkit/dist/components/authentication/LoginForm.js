"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.LoginFormComponent = void 0;

var _react = _interopRequireWildcard(require("react"));

var _useDeepCompareEffect = _interopRequireDefault(require("use-deep-compare-effect"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _core = require("@material-ui/core");

var _icons = require("@material-ui/icons");

var _useStyles = require("./useStyles");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function LoginForm(_ref) {
  var config = _ref.config,
      authentication = _ref.authentication,
      actionText = _ref.actionText,
      errorText = _ref.errorText,
      onSubmit = _ref.onSubmit;
  var classes = (0, _useStyles.useStyles)();

  var _authentication = authentication || {
    user: {}
  };

  var _username = _authentication.user.username;
  var _remember = _authentication.remember;

  var _useState = (0, _react.useState)({
    username: _username,
    remember: _remember
  }),
      _useState2 = _slicedToArray(_useState, 2),
      formData = _useState2[0],
      setFormData = _useState2[1];

  var username = formData.username,
      password = formData.password,
      remember = formData.remember;
  (0, _useDeepCompareEffect.default)(function () {
    if (_authentication) {
      var _formData = _objectSpread({}, formData);

      if (_authentication.user.username) {
        _formData.username = _authentication.user.username;
      }

      if (_authentication.remember) {
        _formData.remember = _authentication.remember;
      }

      setFormData(_formData);
    } else {
      var _formData2 = _objectSpread({}, formData);

      _formData2.password = '';
      setFormData(_formData2);
    }
  }, [_authentication]);
  var user;
  if (authentication) user = authentication.user;

  var updateFormData = function updateFormData(event) {
    var _event$target = event.target,
        type = _event$target.type,
        name = _event$target.name,
        value = _event$target.value,
        checked = _event$target.checked;

    var _formData = _objectSpread({}, formData);

    if (type === 'checkbox') _formData[value] = checked;else _formData[name] = value;
    setFormData(_formData);
  };

  var footer = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null);

  if (config && config.server) {
    footer = /*#__PURE__*/_react.default.createElement("div", {
      className: classes.footer_container
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: classes.footer_column
    }, /*#__PURE__*/_react.default.createElement(_core.Typography, {
      variant: "caption"
    }, "Need an account?\xA0"), /*#__PURE__*/_react.default.createElement(_core.Typography, {
      color: "primary",
      variant: "caption",
      component: "a",
      target: "_blank",
      href: "".concat(config.server, "/user/sign_up")
    }, "Register now.")), /*#__PURE__*/_react.default.createElement("div", {
      className: classes.footer_column
    }, /*#__PURE__*/_react.default.createElement(_core.Typography, {
      color: "primary",
      variant: "caption",
      component: "a",
      target: "_blank",
      href: "".concat(config.server, "/user/forgot_password")
    }, "Forgot password?")));
  }

  return /*#__PURE__*/_react.default.createElement("div", {
    className: classes.root
  }, /*#__PURE__*/_react.default.createElement(_core.Avatar, {
    className: classes.avatar,
    src: user && user.avatar_url ? user.avatar_url : null
  }, /*#__PURE__*/_react.default.createElement(_icons.LockOutlined, null)), /*#__PURE__*/_react.default.createElement(_core.Typography, {
    component: "h1",
    variant: "h5"
  }, user ? user.full_name : actionText), errorText ? /*#__PURE__*/_react.default.createElement(_core.Typography, {
    "data-test": "login-error-text",
    component: "p",
    style: {
      color: 'red'
    }
  }, errorText) : /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null), /*#__PURE__*/_react.default.createElement("form", {
    className: classes.form
  }, /*#__PURE__*/_react.default.createElement(_core.TextField, {
    "data-test": "username-input",
    name: "username",
    type: "text",
    label: "Username",
    required: true,
    variant: "outlined",
    margin: "normal",
    fullWidth: true,
    autoComplete: "username",
    disabled: !!user,
    defaultValue: username,
    onChange: updateFormData
  }), /*#__PURE__*/_react.default.createElement(_core.TextField, {
    "data-test": "password-input",
    name: "password",
    type: "password",
    label: "Password",
    required: true,
    variant: "outlined",
    margin: "normal",
    fullWidth: true,
    autoComplete: "current-password",
    disabled: !!user,
    onChange: updateFormData
  }), /*#__PURE__*/_react.default.createElement(_core.FormControlLabel, {
    "data-test": "remember-checkbox",
    label: "Keep me logged in",
    control: /*#__PURE__*/_react.default.createElement(_core.Checkbox, {
      color: "primary",
      value: "remember",
      disabled: !!user,
      checked: remember,
      id: 'remember-' + Math.random(),
      onChange: updateFormData
    })
  }), /*#__PURE__*/_react.default.createElement(_core.Button, {
    "data-test": user ? 'logout-button' : 'submit-button',
    type: "button",
    fullWidth: true,
    variant: "contained",
    color: "primary",
    className: classes.submit,
    onClick: function onClick() {
      return onSubmit(formData);
    }
  }, user ? 'Logout' : actionText), footer));
}

;
LoginForm.propTypes = {
  /** Configuration to use for sign up/forgot password flow */
  config: _propTypes.default.shape({
    server: _propTypes.default.string.isRequired
  }),

  /** Callback function to propogate the username and password entered. */
  onSubmit: _propTypes.default.func.isRequired,

  /** The text to describe the action of logging in. */
  actionText: _propTypes.default.string,

  /** The text to describe the error when Authentication fails. */
  errorText: _propTypes.default.string,

  /** The authenticated user object */
  authentication: _propTypes.default.shape({
    user: _propTypes.default.object
  })
};
LoginForm.defaultProps = {
  actionText: 'Login'
};
var LoginFormComponent = LoginForm;
exports.LoginFormComponent = LoginFormComponent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2F1dGhlbnRpY2F0aW9uL0xvZ2luRm9ybS5qcyJdLCJuYW1lcyI6WyJMb2dpbkZvcm0iLCJjb25maWciLCJhdXRoZW50aWNhdGlvbiIsImFjdGlvblRleHQiLCJlcnJvclRleHQiLCJvblN1Ym1pdCIsImNsYXNzZXMiLCJfYXV0aGVudGljYXRpb24iLCJ1c2VyIiwiX3VzZXJuYW1lIiwidXNlcm5hbWUiLCJfcmVtZW1iZXIiLCJyZW1lbWJlciIsImZvcm1EYXRhIiwic2V0Rm9ybURhdGEiLCJwYXNzd29yZCIsIl9mb3JtRGF0YSIsInVwZGF0ZUZvcm1EYXRhIiwiZXZlbnQiLCJ0YXJnZXQiLCJ0eXBlIiwibmFtZSIsInZhbHVlIiwiY2hlY2tlZCIsImZvb3RlciIsInNlcnZlciIsImZvb3Rlcl9jb250YWluZXIiLCJmb290ZXJfY29sdW1uIiwicm9vdCIsImF2YXRhciIsImF2YXRhcl91cmwiLCJmdWxsX25hbWUiLCJjb2xvciIsImZvcm0iLCJNYXRoIiwicmFuZG9tIiwic3VibWl0IiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwic2hhcGUiLCJzdHJpbmciLCJpc1JlcXVpcmVkIiwiZnVuYyIsIm9iamVjdCIsImRlZmF1bHRQcm9wcyIsIkxvZ2luRm9ybUNvbXBvbmVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBUUE7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsU0FBU0EsU0FBVCxPQU1HO0FBQUEsTUFMREMsTUFLQyxRQUxEQSxNQUtDO0FBQUEsTUFKREMsY0FJQyxRQUpEQSxjQUlDO0FBQUEsTUFIREMsVUFHQyxRQUhEQSxVQUdDO0FBQUEsTUFGREMsU0FFQyxRQUZEQSxTQUVDO0FBQUEsTUFEREMsUUFDQyxRQUREQSxRQUNDO0FBQ0QsTUFBTUMsT0FBTyxHQUFHLDJCQUFoQjs7QUFDQSxNQUFNQyxlQUFlLEdBQUdMLGNBQWMsSUFBSTtBQUFF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O0FBQ0UsSUFBQSxLQUFLLEVBQUMsU0FEUjtBQUVFLElBQUEsU0FBUyxFQUFFRixPQUFPLENBQUM4QixNQUZyQjtBQUdFLElBQUEsT0FBTyxFQUFFO0FBQUEsYUFBTS9CLFFBQVEsQ0FBQ1EsUUFBRCxDQUFkO0FBQUE7QUFIWCxLQUlJTCxJQUFELEdBQVMsUUFBVCxHQUFvQkwsVUFKdkIsQ0FuQkYsRUF5QkdxQixNQXpCSCxDQVhGLENBREY7QUF5Q0Q7O0FBQUE7QUFFRHhCLFNBQVMsQ0FBQ3FDLFNBQVYsR0FBc0I7QUFDcEI7QUFDQXBDLEVBQUFBLE1BQU0sRUFBRXFDLG1CQUFVQyxLQUFWLENBQWdCO0FBQUVkLElBQUFBLE1BQU0sRUFBRWEsbUJBQVVFLE1BQVYsQ0FBaUJDO0FBQTNCLEdBQWhCLENBRlk7O0FBR3BCO0FBQ0FwQyxFQUFBQSxRQUFRLEVBQUVpQyxtQkFBVUksSUFBVixDQUFlRCxVQUpMOztBQUtwQjtBQUNBdEMsRUFBQUEsVUFBVSxFQUFFbUMsbUJBQVVFLE1BTkY7O0FBT3BCO0FBQ0FwQyxFQUFBQSxTQUFTLEVBQUVrQyxtQkFBVUUsTUFSRDs7QUFTcEI7QUFDQXRDLEVBQUFBLGNBQWMsRUFBRW9DLG1CQUFVQyxLQUFWLENBQWdCO0FBQUUvQixJQUFBQSxJQUFJLEVBQUU4QixtQkFBVUs7QUFBbEIsR0FBaEI7QUFWSSxDQUF0QjtBQWFBM0MsU0FBUyxDQUFDNEMsWUFBVixHQUF5QjtBQUFFekMsRUFBQUEsVUFBVSxFQUFFO0FBQWQsQ0FBekI7QUFFTyxJQUFNMEMsa0JBQWtCLEdBQUc3QyxTQUEzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHVzZUVmZmVjdCBmcm9tICd1c2UtZGVlcC1jb21wYXJlLWVmZmVjdCc7XHJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XHJcbmltcG9ydCB7XHJcbiAgQXZhdGFyLFxyXG4gIEJ1dHRvbixcclxuICBGb3JtQ29udHJvbExhYmVsLFxyXG4gIENoZWNrYm94LFxyXG4gIFR5cG9ncmFwaHksXHJcbiAgVGV4dEZpZWxkLFxyXG59IGZyb20gJ0BtYXRlcmlhbC11aS9jb3JlJztcclxuaW1wb3J0IHsgTG9ja091dGxpbmVkIH0gZnJvbSAnQG1hdGVyaWFsLXVpL2ljb25zJztcclxuaW1wb3J0IHsgdXNlU3R5bGVzIH0gZnJvbSAnLi91c2VTdHlsZXMnO1xyXG5cclxuZnVuY3Rpb24gTG9naW5Gb3JtKHtcclxuICBjb25maWcsXHJcbiAgYXV0aGVudGljYXRpb24sXHJcbiAgYWN0aW9uVGV4dCxcclxuICBlcnJvclRleHQsXHJcbiAgb25TdWJtaXQsXHJcbn0pIHtcclxuICBjb25zdCBjbGFzc2VzID0gdXNlU3R5bGVzKCk7XHJcbiAgY29uc3QgX2F1dGhlbnRpY2F0aW9uID0gYXV0aGVudGljYXRpb24gfHwgeyB1c2VyOiB7fSB9O1xyXG4gIGNvbnN0IF91c2VybmFtZSA9IF9hdXRoZW50aWNhdGlvbi51c2VyLnVzZXJuYW1lO1xyXG4gIGNvbnN0IF9yZW1lbWJlciA9IF9hdXRoZW50aWNhdGlvbi5yZW1lbWJlcjtcclxuICBjb25zdCBbZm9ybURhdGEsIHNldEZvcm1EYXRhXSA9IHVzZVN0YXRlKHsgdXNlcm5hbWU6IF91c2VybmFtZSwgcmVtZW1iZXI6IF9yZW1lbWJlciB9KTtcclxuICBjb25zdCB7IHVzZXJuYW1lLCBwYXNzd29yZCwgcmVtZW1iZXIgfSA9IGZvcm1EYXRhO1xyXG5cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKF9hdXRoZW50aWNhdGlvbikge1xyXG4gICAgICBsZXQgX2Zvcm1EYXRhID0geyAuLi5mb3JtRGF0YSB9O1xyXG5cclxuICAgICAgaWYgKF9hdXRoZW50aWNhdGlvbi51c2VyLnVzZXJuYW1lKSB7XHJcbiAgICAgICAgX2Zvcm1EYXRhLnVzZXJuYW1lID0gX2F1dGhlbnRpY2F0aW9uLnVzZXIudXNlcm5hbWU7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKF9hdXRoZW50aWNhdGlvbi5yZW1lbWJlcikge1xyXG4gICAgICAgIF9mb3JtRGF0YS5yZW1lbWJlciA9IF9hdXRoZW50aWNhdGlvbi5yZW1lbWJlcjtcclxuICAgICAgfVxyXG4gICAgICBzZXRGb3JtRGF0YShfZm9ybURhdGEpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGV0IF9mb3JtRGF0YSA9IHsgLi4uZm9ybURhdGEgfTtcclxuICAgICAgX2Zvcm1EYXRhLnBhc3N3b3JkID0gJyc7XHJcbiAgICAgIHNldEZvcm1EYXRhKF9mb3JtRGF0YSk7XHJcbiAgICB9XHJcbiAgfSwgW19hdXRoZW50aWNhdGlvbl0pO1xyXG5cclxuXHJcblxyXG4gIGxldCB1c2VyO1xyXG5cclxuICBpZiAoYXV0aGVudGljYXRpb24pIHVzZXIgPSBhdXRoZW50aWNhdGlvbi51c2VyO1xyXG5cclxuICBjb25zdCB1cGRhdGVGb3JtRGF0YSA9IChldmVudCkgPT4ge1xyXG4gICAgY29uc3Qge1xyXG4gICAgICB0eXBlLCBuYW1lLCB2YWx1ZSwgY2hlY2tlZCxcclxuICAgIH0gPSBldmVudC50YXJnZXQ7XHJcbiAgICBjb25zdCBfZm9ybURhdGEgPSB7IC4uLmZvcm1EYXRhIH07XHJcblxyXG4gICAgaWYgKHR5cGUgPT09ICdjaGVja2JveCcpIF9mb3JtRGF0YVt2YWx1ZV0gPSBjaGVja2VkO1xyXG4gICAgZWxzZSBfZm9ybURhdGFbbmFtZV0gPSB2YWx1ZTtcclxuXHJcbiAgICBzZXRGb3JtRGF0YShfZm9ybURhdGEpO1xyXG4gIH07XHJcblxyXG4gIGxldCBmb290ZXIgPSA8PjwvPjtcclxuXHJcbiAgaWYgKGNvbmZpZyAmJiBjb25maWcuc2VydmVyKSB7XHJcbiAgICBmb290ZXIgPSAoXHJcbiAgICAgIDxkaXYgY2xhc3NOYW1lPXtjbGFzc2VzLmZvb3Rlcl9jb250YWluZXJ9PlxyXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPXtjbGFzc2VzLmZvb3Rlcl9jb2x1bW59PlxyXG4gICAgICAgICAgPFR5cG9ncmFwaHkgdmFyaWFudD1cImNhcHRpb25cIj5OZWVkIGFuIGFjY291bnQ/Jm5ic3A7PC9UeXBvZ3JhcGh5PlxyXG4gICAgICAgICAgPFR5cG9ncmFwaHkgY29sb3I9XCJwcmltYXJ5XCIgdmFyaWFudD1cImNhcHRpb25cIiBjb21wb25lbnQ9XCJhXCIgdGFyZ2V0PVwiX2JsYW5rXCIgaHJlZj17YCR7Y29uZmlnLnNlcnZlcn0vdXNlci9zaWduX3VwYH0+UmVnaXN0ZXIgbm93LjwvVHlwb2dyYXBoeT5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT17Y2xhc3Nlcy5mb290ZXJfY29sdW1ufT5cclxuICAgICAgICAgIDxUeXBvZ3JhcGh5IGNvbG9yPVwicHJpbWFyeVwiIHZhcmlhbnQ9XCJjYXB0aW9uXCIgY29tcG9uZW50PVwiYVwiIHRhcmdldD1cIl9ibGFua1wiIGhyZWY9e2Ake2NvbmZpZy5zZXJ2ZXJ9L3VzZXIvZm9yZ290X3Bhc3N3b3JkYH0+Rm9yZ290IHBhc3N3b3JkPzwvVHlwb2dyYXBoeT5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgPC9kaXY+XHJcbiAgICApO1xyXG4gIH1cclxuICByZXR1cm4gKFxyXG4gICAgPGRpdiBjbGFzc05hbWU9e2NsYXNzZXMucm9vdH0+XHJcbiAgICAgIDxBdmF0YXIgY2xhc3NOYW1lPXtjbGFzc2VzLmF2YXRhcn0gc3JjPXt1c2VyICYmIHVzZXIuYXZhdGFyX3VybCA/IHVzZXIuYXZhdGFyX3VybCA6IG51bGx9PlxyXG4gICAgICAgIDxMb2NrT3V0bGluZWQgLz5cclxuICAgICAgPC9BdmF0YXI+XHJcbiAgICAgIDxUeXBvZ3JhcGh5IGNvbXBvbmVudD1cImgxXCIgdmFyaWFudD1cImg1XCI+XHJcbiAgICAgICAgeyh1c2VyKSA/IHVzZXIuZnVsbF9uYW1lIDogYWN0aW9uVGV4dH1cclxuICAgICAgPC9UeXBvZ3JhcGh5PlxyXG4gICAgICB7ZXJyb3JUZXh0ID8gKFxyXG4gICAgICAgIDxUeXBvZ3JhcGh5IGRhdGEtdGVzdD1cImxvZ2luLWVycm9yLXRleHRcIiBjb21wb25lbnQ9XCJwXCIgc3R5bGU9e3sgY29sb3I6ICdyZWQnIH19PlxyXG4gICAgICAgICAge2Vycm9yVGV4dH1cclxuICAgICAgICA8L1R5cG9ncmFwaHk+KSA6IDw+PC8+fVxyXG4gICAgICA8Zm9ybSBjbGFzc05hbWU9e2NsYXNzZXMuZm9ybX0+XHJcbiAgICAgICAgPFRleHRGaWVsZCBkYXRhLXRlc3Q9XCJ1c2VybmFtZS1pbnB1dFwiIG5hbWU9XCJ1c2VybmFtZVwiIHR5cGU9XCJ0ZXh0XCIgbGFiZWw9XCJVc2VybmFtZVwiIHJlcXVpcmVkXHJcbiAgICAgICAgICB2YXJpYW50PVwib3V0bGluZWRcIiBtYXJnaW49XCJub3JtYWxcIiBmdWxsV2lkdGggYXV0b0NvbXBsZXRlPVwidXNlcm5hbWVcIlxyXG4gICAgICAgICAgZGlzYWJsZWQ9eyEhdXNlcn0gZGVmYXVsdFZhbHVlPXt1c2VybmFtZX1cclxuICAgICAgICAgIG9uQ2hhbmdlPXt1cGRhdGVGb3JtRGF0YX1cclxuICAgICAgICAvPlxyXG4gICAgICAgIDxUZXh0RmllbGQgZGF0YS10ZXN0PVwicGFzc3dvcmQtaW5wdXRcIiBuYW1lPVwicGFzc3dvcmRcIiB0eXBlPVwicGFzc3dvcmRcIiBsYWJlbD1cIlBhc3N3b3JkXCIgcmVxdWlyZWRcclxuICAgICAgICAgIHZhcmlhbnQ9XCJvdXRsaW5lZFwiIG1hcmdpbj1cIm5vcm1hbFwiIGZ1bGxXaWR0aCBhdXRvQ29tcGxldGU9XCJjdXJyZW50LXBhc3N3b3JkXCJcclxuICAgICAgICAgIGRpc2FibGVkPXshIXVzZXJ9XHJcbiAgICAgICAgICBvbkNoYW5nZT17dXBkYXRlRm9ybURhdGF9XHJcbiAgICAgICAgLz5cclxuICAgICAgICA8Rm9ybUNvbnRyb2xMYWJlbFxyXG4gICAgICAgICAgZGF0YS10ZXN0PVwicmVtZW1iZXItY2hlY2tib3hcIlxyXG4gICAgICAgICAgbGFiZWw9XCJLZWVwIG1lIGxvZ2dlZCBpblwiXHJcbiAgICAgICAgICBjb250cm9sPXtcclxuICAgICAgICAgICAgPENoZWNrYm94IGNvbG9yPVwicHJpbWFyeVwiIHZhbHVlPVwicmVtZW1iZXJcIiBkaXNhYmxlZD17ISF1c2VyfSBjaGVja2VkPXtyZW1lbWJlcn1cclxuICAgICAgICAgICAgICBpZD17J3JlbWVtYmVyLScgKyBNYXRoLnJhbmRvbSgpfSBvbkNoYW5nZT17dXBkYXRlRm9ybURhdGF9IC8+XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgLz5cclxuICAgICAgICA8QnV0dG9uIGRhdGEtdGVzdD17dXNlciA/ICdsb2dvdXQtYnV0dG9uJyA6ICdzdWJtaXQtYnV0dG9uJ30gdHlwZT1cImJ1dHRvblwiIGZ1bGxXaWR0aCB2YXJpYW50PVwiY29udGFpbmVkXCJcclxuICAgICAgICAgIGNvbG9yPSdwcmltYXJ5J1xyXG4gICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzLnN1Ym1pdH1cclxuICAgICAgICAgIG9uQ2xpY2s9eygpID0+IG9uU3VibWl0KGZvcm1EYXRhKX0+XHJcbiAgICAgICAgICB7KHVzZXIpID8gJ0xvZ291dCcgOiBhY3Rpb25UZXh0fVxyXG4gICAgICAgIDwvQnV0dG9uPlxyXG4gICAgICAgIHtmb290ZXJ9XHJcbiAgICAgIDwvZm9ybT5cclxuICAgIDwvZGl2ID5cclxuICApO1xyXG59O1xyXG5cclxuTG9naW5Gb3JtLnByb3BUeXBlcyA9IHtcclxuICAvKiogQ29uZmlndXJhdGlvbiB0byB1c2UgZm9yIHNpZ24gdXAvZm9yZ290IHBhc3N3b3JkIGZsb3cgKi9cclxuICBjb25maWc6IFByb3BUeXBlcy5zaGFwZSh7IHNlcnZlcjogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkIH0pLFxyXG4gIC8qKiBDYWxsYmFjayBmdW5jdGlvbiB0byBwcm9wb2dhdGUgdGhlIHVzZXJuYW1lIGFuZCBwYXNzd29yZCBlbnRlcmVkLiAqL1xyXG4gIG9uU3VibWl0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxyXG4gIC8qKiBUaGUgdGV4dCB0byBkZXNjcmliZSB0aGUgYWN0aW9uIG9mIGxvZ2dpbmcgaW4uICovXHJcbiAgYWN0aW9uVGV4dDogUHJvcFR5cGVzLnN0cmluZyxcclxuICAvKiogVGhlIHRleHQgdG8gZGVzY3JpYmUgdGhlIGVycm9yIHdoZW4gQXV0aGVudGljYXRpb24gZmFpbHMuICovXHJcbiAgZXJyb3JUZXh0OiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gIC8qKiBUaGUgYXV0aGVudGljYXRlZCB1c2VyIG9iamVjdCAqL1xyXG4gIGF1dGhlbnRpY2F0aW9uOiBQcm9wVHlwZXMuc2hhcGUoeyB1c2VyOiBQcm9wVHlwZXMub2JqZWN0IH0pLFxyXG59O1xyXG5cclxuTG9naW5Gb3JtLmRlZmF1bHRQcm9wcyA9IHsgYWN0aW9uVGV4dDogJ0xvZ2luJyB9O1xyXG5cclxuZXhwb3J0IGNvbnN0IExvZ2luRm9ybUNvbXBvbmVudCA9IExvZ2luRm9ybTtcclxuIl19