"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _useDeepCompareEffect = _interopRequireDefault(require("use-deep-compare-effect"));

var _helpers = require("./helpers");

var _ = require("..");

var _dcsCatalogNextApis = require("./dcsCatalogNextApis");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function useFile(_ref) {
  var authentication = _ref.authentication,
      repository = _ref.repository,
      filepath = _ref.filepath,
      onFilepath = _ref.onFilepath,
      defaultContent = _ref.defaultContent,
      _config = _ref.config,
      _ref$create = _ref.create,
      create = _ref$create === void 0 ? false : _ref$create,
      onOpenValidation = _ref.onOpenValidation,
      onLoadCache = _ref.onLoadCache,
      onSaveCache = _ref.onSaveCache,
      onConfirmClose = _ref.onConfirmClose,
      releaseFlag = _ref.releaseFlag;

  var _useState = (0, _react.useState)(),
      _useState2 = _slicedToArray(_useState, 2),
      file = _useState2[0],
      setFile = _useState2[1];

  var _useState3 = (0, _react.useState)(false),
      _useState4 = _slicedToArray(_useState3, 2),
      isChanged = _useState4[0],
      setIsChanged = _useState4[1];

  var _useState5 = (0, _react.useState)(),
      _useState6 = _slicedToArray(_useState5, 2),
      blob = _useState6[0],
      setBlob = _useState6[1];

  var _useContext = (0, _react.useContext)(_.RepositoryContext),
      updateBranch = _useContext.actions.updateBranch,
      repositoryConfig = _useContext.config;

  var config = _config || repositoryConfig;
  var branch = repository && (repository.branch || repository.default_branch);

  var _useState7 = (0, _react.useState)(),
      _useState8 = _slicedToArray(_useState7, 2),
      deleted = _useState8[0],
      setDeleted = _useState8[1];

  var _setBlob = (0, _react.useCallback)(function (_blob) {
    if (blob && _blob && onConfirmClose) {
      if (onConfirmClose()) {
        setBlob(_blob);
      }
    } else {
      setBlob(_blob);
    }
  }, [blob, setBlob, onConfirmClose]);

  var _useBlob = (0, _.useBlob)({
    blob: blob,
    onBlob: _setBlob,
    config: config,
    repository: repository,
    filepath: filepath,
    releaseFlag: releaseFlag
  }),
      blobState = _useBlob.state,
      blobActions = _useBlob.actions,
      blobComponents = _useBlob.components;

  var _ref2 = repository && repository.permissions ? repository.permissions : {},
      writeable = _ref2.push;

  var update = (0, _react.useCallback)(function (_file) {
    setFile(_file);
  }, []);
  (0, _react.useEffect)(function () {
    setIsChanged(false);
  }, [file, deleted, closed]);
  var read = (0, _react.useCallback)( /*#__PURE__*/function () {
    var _ref3 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(_filepath) {
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              if (!onFilepath) {
                _context.next = 3;
                break;
              }

              _context.next = 3;
              return onFilepath(_filepath);

            case 3:
              ;

            case 4:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function (_x) {
      return _ref3.apply(this, arguments);
    };
  }(), [onFilepath]);
  var load = (0, _react.useCallback)( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {
    var _file, defaultCachedContentFile, content, _publishedContent, _repository$catalog, _repository$catalog$p, prodTag;

    return regeneratorRuntime.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            if (!(config && repository && filepath)) {
              _context2.next = 29;
              break;
            }

            _context2.next = 3;
            return (0, _helpers.ensureFile)({
              filepath: filepath,
              defaultContent: defaultContent,
              authentication: authentication,
              config: config,
              repository: repository,
              branch: branch,
              onOpenValidation: onOpenValidation
            });

          case 3:
            _file = _context2.sent;
            console.log("ensureFile:");
            console.log(_file);
            // if (loadDefaultCachedContentFile) { 
            //   console.log("_file.html_url");
            //   console.log(_file.html_url);
            //   defaultCachedContentFile = await loadDefaultCachedContentFile(_file.html_url);
            // }
            console.log("GRT // onLoadCache!", _file, _file.html_url);

            if (!(onLoadCache && _file && _file.html_url)) {
              _context2.next = 11;
              break;
            }

            _context2.next = 10;
            return onLoadCache({
              authentication: authentication,
              repository: repository,
              branch: branch,
              html_url: _file.html_url
            });

          case 10:
            defaultCachedContentFile = _context2.sent;

          case 11:
            console.log("GRT defaultContent", '|', defaultContent);
            console.log("GRT defaultCachedContent", '|', defaultCachedContentFile);

            if (defaultCachedContentFile) {
              console.log(defaultCachedContentFile.sha);
            }

            if (_file) {
              console.log(_file.sha);
            } // let content;
            // content = await repositoryActions.fileFromZip(filepath);
            //const content = await getContentFromFile(_file);
            // Allow app to provide CACHED ("offline" content);
            // Might be different BRANCH (different user) or different FILE.
            // Might be STALE (sha has changed on DCS).
            // (NOTE: STALE cache would mean THIS user edited the same file in another browser.)


            if (!(defaultCachedContentFile && defaultCachedContentFile.content && defaultCachedContentFile.sha && defaultCachedContentFile.html_url && defaultCachedContentFile.filepath && defaultCachedContentFile.timestamp && defaultCachedContentFile.sha === _file.sha && defaultCachedContentFile.html_url === _file.html_url)) {
              _context2.next = 19;
              break;
            }

            // Load autosaved content:
            content = defaultCachedContentFile.content;
            _context2.next = 28;
            break;

          case 19:
            if (_file && _file.content && defaultCachedContentFile && defaultCachedContentFile.content && defaultCachedContentFile.filepath && defaultCachedContentFile.sha && defaultCachedContentFile.timestamp) {
              console.log(_file);
              console.log(defaultCachedContentFile);
              alert("A previous file was autosaved. The autosaved file will be overwritten.\n\n" + "File: " + defaultCachedContentFile.filepath + ".\n" + "Edited: " + defaultCachedContentFile.timestamp.toLocaleString() + ".");
            } // Get SERVER content: Overwrite cache:


            _context2.next = 22;
            return (0, _helpers.getContentFromFile)(_file);

          case 22:
            content = _context2.sent;
            // Check catalog next:
            prodTag = (_repository$catalog = repository.catalog) === null || _repository$catalog === void 0 ? void 0 : (_repository$catalog$p = _repository$catalog.prod) === null || _repository$catalog$p === void 0 ? void 0 : _repository$catalog$p.branch_or_tag_name;

            if (!prodTag) {
              _context2.next = 28;
              break;
            }

            _context2.next = 27;
            return (0, _dcsCatalogNextApis.fetchCatalogContent)('unfoldingword', repository.name, prodTag, filepath, config);

          case 27:
            _publishedContent = _context2.sent;

          case 28:
            update(_objectSpread(_objectSpread({}, _file), {}, {
              branch: branch,
              content: content,
              filepath: _file.path,
              publishedContent: _publishedContent
            }));

          case 29:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  })), [authentication, branch, config, defaultContent, onLoadCache, filepath, repository, update]);
  var createFile = (0, _react.useCallback)( /*#__PURE__*/function () {
    var _ref6 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(_ref5) {
      var _branch, _filepath, _defaultContent, onOpenValidation, _file;

      return regeneratorRuntime.wrap(function _callee3$(_context3) {
        while (1) {
          switch (_context3.prev = _context3.next) {
            case 0:
              _branch = _ref5.branch, _filepath = _ref5.filepath, _defaultContent = _ref5.defaultContent, onOpenValidation = _ref5.onOpenValidation;

              if (!(config && repository)) {
                _context3.next = 7;
                break;
              }

              _context3.next = 4;
              return (0, _helpers.ensureFile)({
                authentication: authentication,
                config: config,
                repository: repository,
                branch: _branch,
                filepath: _filepath,
                defaultContent: _defaultContent,
                onOpenValidation: onOpenValidation
              });

            case 4:
              _file = _context3.sent;

              if (_file) {
                updateBranch(_branch);
                onFilepath(_filepath);
              }

              ;

            case 7:
            case "end":
              return _context3.stop();
          }
        }
      }, _callee3);
    }));

    return function (_x2) {
      return _ref6.apply(this, arguments);
    };
  }(), [authentication, config, repository, updateBranch, onFilepath]);
  var close = (0, _react.useCallback)(function () {
    if (blobActions && blobActions.close) {
      blobActions.close();
    }

    ;

    if (onFilepath) {
      onFilepath();
    }

    ;
    update();
  }, [update, blobActions, onFilepath]);
  var save = (0, _react.useCallback)( /*#__PURE__*/function () {
    var _ref7 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5(content) {
      return regeneratorRuntime.wrap(function _callee5$(_context5) {
        while (1) {
          switch (_context5.prev = _context5.next) {
            case 0:
              console.log("GRT save // will save file");
              _context5.next = 3;
              return (0, _helpers.saveFile)({
                authentication: authentication,
                repository: repository,
                branch: branch,
                file: file,
                content: content
              }).then(
              /*#__PURE__*/
              // Empty cache if user has saved this file
              // (save() will not happen for "OFFLINE" system files)
              _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {
                return regeneratorRuntime.wrap(function _callee4$(_context4) {
                  while (1) {
                    switch (_context4.prev = _context4.next) {
                      case 0:
                        console.log("GRT save // will EMPTY cache");
                        _context4.next = 3;
                        return saveCache(null);

                      case 3:
                        console.log("GRT save // will load file");
                        _context4.next = 6;
                        return load();

                      case 6:
                      case "end":
                        return _context4.stop();
                    }
                  }
                }, _callee4);
              })));

            case 3:
            case "end":
              return _context5.stop();
          }
        }
      }, _callee5);
    }));

    return function (_x3) {
      return _ref7.apply(this, arguments);
    };
  }(), [writeable, authentication, repository, branch, file, load, _helpers.saveFile, saveCache]);
  var saveCache = (0, _react.useCallback)( /*#__PURE__*/function () {
    var _ref9 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6(content) {
      return regeneratorRuntime.wrap(function _callee6$(_context6) {
        while (1) {
          switch (_context6.prev = _context6.next) {
            case 0:
              if (!onSaveCache) {
                _context6.next = 3;
                break;
              }

              _context6.next = 3;
              return onSaveCache({
                authentication: authentication,
                repository: repository,
                branch: branch,
                file: file,
                content: content
              });

            case 3:
            case "end":
              return _context6.stop();
          }
        }
      }, _callee6);
    }));

    return function (_x4) {
      return _ref9.apply(this, arguments);
    };
  }(), [writeable, authentication, repository, branch, file, onSaveCache]);
  var dangerouslyDelete = (0, _react.useCallback)( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee7() {
    var _deleted;

    return regeneratorRuntime.wrap(function _callee7$(_context7) {
      while (1) {
        switch (_context7.prev = _context7.next) {
          case 0:
            if (!writeable) {
              _context7.next = 5;
              break;
            }

            _context7.next = 3;
            return (0, _helpers.deleteFile)({
              authentication: authentication,
              repository: repository,
              file: file,
              branch: branch
            });

          case 3:
            _deleted = _context7.sent;

            if (_deleted) {
              setDeleted(true);
            }

          case 5:
            ;

          case 6:
          case "end":
            return _context7.stop();
        }
      }
    }, _callee7);
  })), [file, authentication, branch, repository, writeable]);
  (0, _useDeepCompareEffect.default)(function () {
    var notLoaded = !file && filepath && !deleted;
    var loadNew = file && filepath && file.filepath !== filepath;

    if (notLoaded || loadNew) {
      load();
    }
  }, [deleted, filepath, load, file]);
  var blobFilepath = blobState && blobState.filepath;
  (0, _react.useEffect)(function () {
    if (blobFilepath && onFilepath) {
      onFilepath(blobFilepath);
    }

    ;
  }, [blobFilepath, onFilepath]);
  (0, _useDeepCompareEffect.default)(function () {
    // if there is a file but no repository, close file.
    if (!repository && file) close();
  }, [repository, file, close]);
  (0, _react.useEffect)(function () {
    if (deleted) {
      close();
      setDeleted(false);
    }

    ;
  }, [deleted, close]);
  var actions = {
    update: update,
    load: load,
    read: read,
    save: save,
    saveCache: saveCache,
    onSaveCache: onSaveCache,
    onLoadCache: onLoadCache,
    close: close,
    dangerouslyDelete: dangerouslyDelete,
    setIsChanged: setIsChanged,
    onConfirmClose: onConfirmClose
  };
  var components = {
    create: repository && /*#__PURE__*/_react.default.createElement(_.FileForm, {
      branch: branch,
      defaultContent: defaultContent,
      onSubmit: createFile
    }),
    browse: repository && blobComponents.browse,
    fileCard: repository && file && /*#__PURE__*/_react.default.createElement(_.FileCard, {
      authentication: authentication,
      repository: repository,
      file: _objectSpread(_objectSpread({}, file), actions)
    })
  };

  var component = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null);

  if (file) {
    component = components.fileCard;
  } else if (!filepath) {
    if (create) {
      component = components.create;
    } else {
      component = components.browse;
    }
  }

  return {
    state: file,
    stateValues: {
      isChanged: isChanged
    },
    actions: actions,
    component: component,
    components: components
  };
}

;
useFile.propTypes = {
  /** The full filepath for the file. */
  filepath: _propTypes.default.string,

  /** Function to propogate filepath when the Blob is selected. */
  onFilepath: _propTypes.default.func,

  /** Authentication object returned from a successful withAuthentication login. */
  authentication: _propTypes.default.shape({
    config: _propTypes.default.shape({
      server: _propTypes.default.string.isRequired,
      headers: _propTypes.default.shape({
        Authorization: _propTypes.default.string.isRequired
      }).isRequired
    }).isRequired,
    user: _propTypes.default.shape({
      username: _propTypes.default.string.isRequired,
      email: _propTypes.default.string.isRequired
    }).isRequired
  }),

  /** Repository tree_url can be used in place of blobConfig */
  repository: _propTypes.default.shape({
    owner: _propTypes.default.shape({
      username: _propTypes.default.string.isRequired
    }),
    name: _propTypes.default.string.isRequired
  }).isRequired,

  /** use a form to create a new file */
  create: _propTypes.default.bool
};
var _default = useFile;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2ZpbGUvdXNlRmlsZS5qcyJdLCJuYW1lcyI6WyJ1c2VGaWxlIiwiYXV0aGVudGljYXRpb24iLCJyZXBvc2l0b3J5IiwiZmlsZXBhdGgiLCJvbkZpbGVwYXRoIiwiZGVmYXVsdENvbnRlbnQiLCJfY29uZmlnIiwiY29uZmlnIiwiY3JlYXRlIiwib25PcGVuVmFsaWRhdGlvbiIsIm9uTG9hZENhY2hlIiwib25TYXZlQ2FjaGUiLCJvbkNvbmZpcm1DbG9zZSIsInJlbGVhc2VGbGFnIiwiZmlsZSIsInNldEZpbGUiLCJpc0NoYW5nZWQiLCJzZXRJc0NoYW5nZWQiLCJibG9iIiwic2V0QmxvYiIsIlJlcG9zaXRvcnlDb250ZXh0IiwidXBkYXRlQnJhbmNoIiwiYWN0aW9ucyIsInJlcG9zaXRvcnlDb25maWciLCJicmFuY2giLCJkZWZhdWx0X2JyYW5jaCIsImRlbGV0ZWQiLCJzZXREZWxldGVkIiwiX3NldEJsb2IiLCJfYmxvYiIsIm9uQmxvYiIsImJsb2JTdGF0ZSIsInN0YXRlIiwiYmxvYkFjdGlvbnMiLCJibG9iQ29tcG9uZW50cyIsImNvbXBvbmVudHMiLCJwZXJtaXNzaW9ucyIsIndyaXRlYWJsZSIsInB1c2giLCJ1cGRhdGUiLCJfZmlsZSIsImNsb3NlZCIsInJlYWQiLCJfZmlsZXBhdGgiLCJsb2FkIiwiY29uc29sZSIsImxvZyIsImh0bWxfdXJsIiwiZGVmYXVsdENhY2hlZENvbnRlbnRGaWxlIiwic2hhIiwiY29udGVudCIsInRpbWVzdGFtcCIsImFsZXJ0IiwidG9Mb2NhbGVTdHJpbmciLCJwcm9kVGFnIiwiY2F0YWxvZyIsInByb2QiLCJicmFuY2hfb3JfdGFnX25hbWUiLCJuYW1lIiwiX3B1Ymxpc2hlZENvbnRlbnQiLCJwYXRoIiwicHVibGlzaGVkQ29udGVudCIsImNyZWF0ZUZpbGUiLCJfYnJhbmNoIiwiX2RlZmF1bHRDb250ZW50IiwiY2xvc2UiLCJzYXZlIiwidGhlbiIsInNhdmVDYWNoZSIsInNhdmVGaWxlIiwiZGFuZ2Vyb3VzbHlEZWxldGUiLCJfZGVsZXRlZCIsIm5vdExvYWRlZCIsImxvYWROZXciLCJibG9iRmlsZXBhdGgiLCJicm93c2UiLCJmaWxlQ2FyZCIsImNvbXBvbmVudCIsInN0YXRlVmFsdWVzIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwic3RyaW5nIiwiZnVuYyIsInNoYXBlIiwic2VydmVyIiwiaXNSZXF1aXJlZCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwidXNlciIsInVzZXJuYW1lIiwiZW1haWwiLCJvd25lciIsImJvb2wiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUlBOztBQUNBOztBQUVBOztBQUdBOztBQUdBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxTQUFTQSxPQUFULE9BYUc7QUFBQSxNQVpEQyxjQVlDLFFBWkRBLGNBWUM7QUFBQSxNQVhEQyxVQVdDLFFBWERBLFVBV0M7QUFBQSxNQVZEQyxRQVVDLFFBVkRBLFFBVUM7QUFBQSxNQVREQyxVQVNDLFFBVERBLFVBU0M7QUFBQSxNQVJEQyxjQVFDLFFBUkRBLGNBUUM7QUFBQSxNQVBPQyxPQU9QLFFBUERDLE1BT0M7QUFBQSx5QkFOREMsTUFNQztBQUFBLE1BTkRBLE1BTUMsNEJBTk0sS0FNTjtBQUFBLE1BTERDLGdCQUtDLFFBTERBLGdCQUtDO0FBQUEsTUFKREMsV0FJQyxRQUpEQSxXQUlDO0FBQUEsTUFIREMsV0FHQyxRQUhEQSxXQUdDO0FBQUEsTUFGREMsY0FFQyxRQUZEQSxjQUVDO0FBQUEsTUFEREMsV0FDQyxRQUREQSxXQUNDOztBQUFBLGtCQUN1QixzQkFEdkI7QUFBQTtBQUFBLE1BQ01DLElBRE47QUFBQSxNQUNZQyxPQURaOztBQUFBLG1CQUVpQyxxQkFBUyxLQUFULENBRmpDO0FBQUE7QUFBQSxNQUVNQyxTQUZOO0FBQUEsTUFFaUJDLFlBRmpCOztBQUFBLG1CQUd1QixzQkFIdkI7QUFBQTtBQUFBLE1BR01DLElBSE47QUFBQSxNQUdZQyxPQUhaOztBQUFBLG9C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QUs5QkcsSUFBQUEsSUFBSSxFQUFFUixtQkFBVUcsS0FBVixDQUFnQjtBQUNwQk0sTUFBQUEsUUFBUSxFQUFFVCxtQkFBVUMsTUFBVixDQUFpQkksVUFEUDtBQUVwQkssTUFBQUEsS0FBSyxFQUFFVixtQkFBVUMsTUFBVixDQUFpQkk7QUFGSixLQUFoQixFQUdIQTtBQVIyQixHQUFoQixDQU5FOztBQWdCbEI7QUFDQW5GLEVBQUFBLFVBQVUsRUFBRThFLG1CQUFVRyxLQUFWLENBQWdCO0FBQzFCUSxJQUFBQSxLQUFLLEVBQUVYLG1CQUFVRyxLQUFWLENBQWdCO0FBQUVNLE1BQUFBLFFBQVEsRUFBRVQsbUJBQVVDLE1BQVYsQ0FBaUJJO0FBQTdCLEtBQWhCLENBRG1CO0FBRTFCM0IsSUFBQUEsSUFBSSxFQUFFc0IsbUJBQVVDLE1BQVYsQ0FBaUJJO0FBRkcsR0FBaEIsRUFHVEEsVUFwQmU7O0FBcUJsQjtBQUNBN0UsRUFBQUEsTUFBTSxFQUFFd0UsbUJBQVVZO0FBdEJBLENBQXBCO2VBeUJlNUYsTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwge1xyXG4gIHVzZVN0YXRlLCB1c2VDYWxsYmFjaywgdXNlQ29udGV4dCxcclxuICB1c2VFZmZlY3QsIHVzZU1lbW9cclxufSBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XHJcbmltcG9ydCB1c2VEZWVwQ29tcGFyZUVmZmVjdCBmcm9tICd1c2UtZGVlcC1jb21wYXJlLWVmZmVjdCc7XHJcblxyXG5pbXBvcnQge1xyXG4gIGdldENvbnRlbnRGcm9tRmlsZSwgc2F2ZUZpbGUsIGVuc3VyZUZpbGUsIGRlbGV0ZUZpbGUsXHJcbn0gZnJvbSAnLi9oZWxwZXJzJztcclxuaW1wb3J0IHtcclxuICBGaWxlQ2FyZCwgRmlsZUZvcm0sIHVzZUJsb2IsIFJlcG9zaXRvcnlDb250ZXh0LFxyXG59IGZyb20gJy4uJztcclxuaW1wb3J0IHtmZXRjaENhdGFsb2dDb250ZW50fSBmcm9tICcuL2Rjc0NhdGFsb2dOZXh0QXBpcyc7XHJcblxyXG5mdW5jdGlvbiB1c2VGaWxlKHtcclxuICBhdXRoZW50aWNhdGlvbixcclxuICByZXBvc2l0b3J5LFxyXG4gIGZpbGVwYXRoLFxyXG4gIG9uRmlsZXBhdGgsXHJcbiAgZGVmYXVsdENvbnRlbnQsXHJcbiAgY29uZmlnOiBfY29uZmlnLFxyXG4gIGNyZWF0ZT1mYWxzZSxcclxuICBvbk9wZW5WYWxpZGF0aW9uLFxyXG4gIG9uTG9hZENhY2hlLFxyXG4gIG9uU2F2ZUNhY2hlLFxyXG4gIG9uQ29uZmlybUNsb3NlLFxyXG4gIHJlbGVhc2VGbGFnLFxyXG59KSB7XHJcbiAgY29uc3QgW2ZpbGUsIHNldEZpbGVdID0gdXNlU3RhdGUoKTtcclxuICBjb25zdCBbaXNDaGFuZ2VkLCBzZXRJc0NoYW5nZWRdID0gdXNlU3RhdGUoZmFsc2UpO1xyXG4gIGNvbnN0IFtibG9iLCBzZXRCbG9iXSA9IHVzZVN0YXRlKCk7XHJcblxyXG4gIGNvbnN0IHsgYWN0aW9uczogeyB1cGRhdGVCcmFuY2ggfSwgY29uZmlnOiByZXBvc2l0b3J5Q29uZmlnIH0gPSB1c2VDb250ZXh0KFJlcG9zaXRvcnlDb250ZXh0KTtcclxuXHJcbiAgY29uc3QgY29uZmlnID0gX2NvbmZpZyB8fCByZXBvc2l0b3J5Q29uZmlnO1xyXG4gIGNvbnN0IGJyYW5jaCA9IHJlcG9zaXRvcnkgJiYgKHJlcG9zaXRvcnkuYnJhbmNoIHx8IHJlcG9zaXRvcnkuZGVmYXVsdF9icmFuY2gpO1xyXG4gIGNvbnN0IFtkZWxldGVkLCBzZXREZWxldGVkXSA9IHVzZVN0YXRlKCk7XHJcblxyXG4gIGNvbnN0IF9zZXRCbG9iID0gdXNlQ2FsbGJhY2soKF9ibG9iKSA9PiB7XHJcbiAgICBpZiAoYmxvYiAmJiBfYmxvYiAmJiBvbkNvbmZpcm1DbG9zZSkge1xyXG4gICAgICBpZiAob25Db25maXJtQ2xvc2UoKSlcclxuICAgICAge1xyXG4gICAgICAgIHNldEJsb2IoX2Jsb2IpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2V7XHJcbiAgICAgIHNldEJsb2IoX2Jsb2IpO1xyXG4gICAgfVxyXG4gIH0sW2Jsb2IsIHNldEJsb2IsIG9uQ29uZmlybUNsb3NlXSk7XHJcblxyXG4gIGNvbnN0IHtcclxuICAgIHN0YXRlOiBibG9iU3RhdGUsIGFjdGlvbnM6IGJsb2JBY3Rpb25zLCBjb21wb25lbnRzOiBibG9iQ29tcG9uZW50cyxcclxuICB9ID0gdXNlQmxvYih7XHJcbiAgICBibG9iLCBvbkJsb2I6IF9zZXRCbG9iLCBjb25maWcsIHJlcG9zaXRvcnksIGZpbGVwYXRoLCByZWxlYXNlRmxhZyxcclxuICB9KTtcclxuXHJcbiAgY29uc3QgeyBwdXNoOiB3cml0ZWFibGUgfSA9IChyZXBvc2l0b3J5ICYmIHJlcG9zaXRvcnkucGVybWlzc2lvbnMpID8gcmVwb3NpdG9yeS5wZXJtaXNzaW9ucyA6IHt9O1xyXG5cclxuICBjb25zdCB1cGRhdGUgPSB1c2VDYWxsYmFjaygoX2ZpbGUpID0+IHtcclxuICAgIHNldEZpbGUoX2ZpbGUpO1xyXG4gIH0sIFtdKTtcclxuXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIHNldElzQ2hhbmdlZChmYWxzZSk7XHJcbiAgfSwgW2ZpbGUsIGRlbGV0ZWQsIGNsb3NlZF0pO1xyXG5cclxuICBjb25zdCByZWFkID0gdXNlQ2FsbGJhY2soYXN5bmMgKF9maWxlcGF0aCkgPT4ge1xyXG4gICAgaWYgKG9uRmlsZXBhdGgpIHtcclxuICAgICAgYXdhaXQgb25GaWxlcGF0aChfZmlsZXBhdGgpO1xyXG4gICAgfTtcclxuICB9LCBbb25GaWxlcGF0aF0pO1xyXG5cclxuICBjb25zdCBsb2FkID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT4ge1xyXG4gICAgaWYgKGNvbmZpZyAmJiByZXBvc2l0b3J5ICYmIGZpbGVwYXRoKSB7XHJcbiAgICAgIGNvbnN0IF9maWxlID0gYXdhaXQgZW5zdXJlRmlsZSh7XHJcbiAgICAgICAgZmlsZXBhdGgsIGRlZmF1bHRDb250ZW50LCBhdXRoZW50aWNhdGlvbiwgY29uZmlnLCByZXBvc2l0b3J5LCBicmFuY2gsIG9uT3BlblZhbGlkYXRpb24sXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc29sZS5sb2coXCJlbnN1cmVGaWxlOlwiKTtcclxuICAgICAgY29uc29sZS5sb2coX2ZpbGUpO1xyXG5cclxuICAgICAgbGV0IGRlZmF1bHRDYWNoZWRDb250ZW50RmlsZTtcclxuICAgICAgLy8gaWYgKGxvYWREZWZhdWx0Q2FjaGVkQ29udGVudEZpbGUpIHsgXHJcbiAgICAgIC8vICAgY29uc29sZS5sb2coXCJfZmlsZS5odG1sX3VybFwiKTtcclxuICAgICAgLy8gICBjb25zb2xlLmxvZyhfZmlsZS5odG1sX3VybCk7XHJcbiAgICAgIC8vICAgZGVmYXVsdENhY2hlZENvbnRlbnRGaWxlID0gYXdhaXQgbG9hZERlZmF1bHRDYWNoZWRDb250ZW50RmlsZShfZmlsZS5odG1sX3VybCk7XHJcbiAgICAgIC8vIH1cclxuICAgICAgY29uc29sZS5sb2coXCJHUlQgLy8gb25Mb2FkQ2FjaGUhXCIsIF9maWxlLCBfZmlsZS5odG1sX3VybCk7XHJcbiAgICAgIGlmIChvbkxvYWRDYWNoZSAmJiBfZmlsZSAmJiBfZmlsZS5odG1sX3VybClcclxuICAgICAge1xyXG4gICAgICAgIGRlZmF1bHRDYWNoZWRDb250ZW50RmlsZSA9IGF3YWl0IG9uTG9hZENhY2hlKHthdXRoZW50aWNhdGlvbiwgcmVwb3NpdG9yeSwgYnJhbmNoLCBodG1sX3VybDogX2ZpbGUuaHRtbF91cmx9KTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgY29uc29sZS5sb2coXCJHUlQgZGVmYXVsdENvbnRlbnRcIiwgJ3wnLCBkZWZhdWx0Q29udGVudCk7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiR1JUIGRlZmF1bHRDYWNoZWRDb250ZW50XCIsICd8JywgZGVmYXVsdENhY2hlZENvbnRlbnRGaWxlKTtcclxuXHJcbiAgICAgIGlmIChkZWZhdWx0Q2FjaGVkQ29udGVudEZpbGUpXHJcbiAgICAgIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhkZWZhdWx0Q2FjaGVkQ29udGVudEZpbGUuc2hhKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoX2ZpbGUpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhfZmlsZS5zaGEpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBsZXQgY29udGVudDtcclxuICAgICAgLy8gY29udGVudCA9IGF3YWl0IHJlcG9zaXRvcnlBY3Rpb25zLmZpbGVGcm9tWmlwKGZpbGVwYXRoKTtcclxuICAgICAgLy9jb25zdCBjb250ZW50ID0gYXdhaXQgZ2V0Q29udGVudEZyb21GaWxlKF9maWxlKTtcclxuXHJcbiAgICAgIC8vIEFsbG93IGFwcCB0byBwcm92aWRlIENBQ0hFRCAoXCJvZmZsaW5lXCIgY29udGVudCk7XHJcbiAgICAgIC8vIE1pZ2h0IGJlIGRpZmZlcmVudCBCUkFOQ0ggKGRpZmZlcmVudCB1c2VyKSBvciBkaWZmZXJlbnQgRklMRS5cclxuICAgICAgLy8gTWlnaHQgYmUgU1RBTEUgKHNoYSBoYXMgY2hhbmdlZCBvbiBEQ1MpLlxyXG4gICAgICAvLyAoTk9URTogU1RBTEUgY2FjaGUgd291bGQgbWVhbiBUSElTIHVzZXIgZWRpdGVkIHRoZSBzYW1lIGZpbGUgaW4gYW5vdGhlciBicm93c2VyLilcclxuICAgICAgbGV0IGNvbnRlbnQ7XHJcbiAgICAgIGxldCBfcHVibGlzaGVkQ29udGVudDtcclxuXHJcbiAgICAgIGlmIChkZWZhdWx0Q2FjaGVkQ29udGVudEZpbGUgJiYgZGVmYXVsdENhY2hlZENvbnRlbnRGaWxlLmNvbnRlbnQgJiYgZGVmYXVsdENhY2hlZENvbnRlbnRGaWxlLnNoYSBcclxuICAgICAgICAgICYmIGRlZmF1bHRDYWNoZWRDb250ZW50RmlsZS5odG1sX3VybCAmJiBkZWZhdWx0Q2FjaGVkQ29udGVudEZpbGUuZmlsZXBhdGggJiYgZGVmYXVsdENhY2hlZENvbnRlbnRGaWxlLnRpbWVzdGFtcCBcclxuICAgICAgICAgICYmIGRlZmF1bHRDYWNoZWRDb250ZW50RmlsZS5zaGEgPT09IF9maWxlLnNoYVxyXG4gICAgICAgICAgJiYgZGVmYXVsdENhY2hlZENvbnRlbnRGaWxlLmh0bWxfdXJsID09PSBfZmlsZS5odG1sX3VybFxyXG4gICAgICApIHtcclxuICAgICAgICAvLyBMb2FkIGF1dG9zYXZlZCBjb250ZW50OlxyXG4gICAgICAgIGNvbnRlbnQgPSBkZWZhdWx0Q2FjaGVkQ29udGVudEZpbGUuY29udGVudDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZiAoX2ZpbGUgJiYgX2ZpbGUuY29udGVudCBcclxuICAgICAgICAgICAgJiYgZGVmYXVsdENhY2hlZENvbnRlbnRGaWxlICYmIGRlZmF1bHRDYWNoZWRDb250ZW50RmlsZS5jb250ZW50IFxyXG4gICAgICAgICAgICAmJiBkZWZhdWx0Q2FjaGVkQ29udGVudEZpbGUuZmlsZXBhdGggJiYgZGVmYXVsdENhY2hlZENvbnRlbnRGaWxlLnNoYVxyXG4gICAgICAgICAgICAmJiBkZWZhdWx0Q2FjaGVkQ29udGVudEZpbGUudGltZXN0YW1wKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhfZmlsZSk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhkZWZhdWx0Q2FjaGVkQ29udGVudEZpbGUpO1xyXG4gICAgICAgICAgYWxlcnQoXHJcbiAgICAgICAgICAgIFwiQSBwcmV2aW91cyBmaWxlIHdhcyBhdXRvc2F2ZWQuIFRoZSBhdXRvc2F2ZWQgZmlsZSB3aWxsIGJlIG92ZXJ3cml0dGVuLlxcblxcblwiICtcclxuICAgICAgICAgICAgXCJGaWxlOiBcIiArIGRlZmF1bHRDYWNoZWRDb250ZW50RmlsZS5maWxlcGF0aCArIFwiLlxcblwiICtcclxuICAgICAgICAgICAgXCJFZGl0ZWQ6IFwiICsgZGVmYXVsdENhY2hlZENvbnRlbnRGaWxlLnRpbWVzdGFtcC50b0xvY2FsZVN0cmluZygpICsgXCIuXCJcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEdldCBTRVJWRVIgY29udGVudDogT3ZlcndyaXRlIGNhY2hlOlxyXG4gICAgICAgIGNvbnRlbnQgPSBhd2FpdCBnZXRDb250ZW50RnJvbUZpbGUoX2ZpbGUpO1xyXG5cclxuICAgICAgICAvLyBDaGVjayBjYXRhbG9nIG5leHQ6XHJcbiAgICAgICAgY29uc3QgcHJvZFRhZyA9IHJlcG9zaXRvcnkuY2F0YWxvZz8ucHJvZD8uYnJhbmNoX29yX3RhZ19uYW1lO1xyXG4gICAgICAgIGlmICggcHJvZFRhZyApIHtcclxuICAgICAgICAgIF9wdWJsaXNoZWRDb250ZW50ID0gYXdhaXQgZmV0Y2hDYXRhbG9nQ29udGVudCgndW5mb2xkaW5nd29yZCcsIHJlcG9zaXRvcnkubmFtZSwgcHJvZFRhZywgZmlsZXBhdGgsIGNvbmZpZyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICB1cGRhdGUoe1xyXG4gICAgICAgIC4uLl9maWxlLCBicmFuY2gsIGNvbnRlbnQsIGZpbGVwYXRoOiBfZmlsZS5wYXRoLCBwdWJsaXNoZWRDb250ZW50OiBfcHVibGlzaGVkQ29udGVudCxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfSwgW2F1dGhlbnRpY2F0aW9uLCBicmFuY2gsIGNvbmZpZywgZGVmYXVsdENvbnRlbnQsIG9uTG9hZENhY2hlLCBmaWxlcGF0aCwgcmVwb3NpdG9yeSwgdXBkYXRlXSk7XHJcblxyXG4gIGNvbnN0IGNyZWF0ZUZpbGUgPSB1c2VDYWxsYmFjayhhc3luYyAoe1xyXG4gICAgYnJhbmNoOiBfYnJhbmNoLCBmaWxlcGF0aDogX2ZpbGVwYXRoLCBkZWZhdWx0Q29udGVudDogX2RlZmF1bHRDb250ZW50LCBvbk9wZW5WYWxpZGF0aW9uLFxyXG4gIH0pID0+IHtcclxuICAgIGlmIChjb25maWcgJiYgcmVwb3NpdG9yeSkge1xyXG4gICAgICBjb25zdCBfZmlsZSA9IGF3YWl0IGVuc3VyZUZpbGUoe1xyXG4gICAgICAgIGF1dGhlbnRpY2F0aW9uLCBjb25maWcsIHJlcG9zaXRvcnksXHJcbiAgICAgICAgYnJhbmNoOiBfYnJhbmNoLFxyXG4gICAgICAgIGZpbGVwYXRoOiBfZmlsZXBhdGgsXHJcbiAgICAgICAgZGVmYXVsdENvbnRlbnQ6IF9kZWZhdWx0Q29udGVudCxcclxuICAgICAgICBvbk9wZW5WYWxpZGF0aW9uLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmIChfZmlsZSkge1xyXG4gICAgICAgIHVwZGF0ZUJyYW5jaChfYnJhbmNoKTtcclxuICAgICAgICBvbkZpbGVwYXRoKF9maWxlcGF0aCk7XHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfSwgW2F1dGhlbnRpY2F0aW9uLCBjb25maWcsIHJlcG9zaXRvcnksIHVwZGF0ZUJyYW5jaCwgb25GaWxlcGF0aF0pO1xyXG5cclxuICBjb25zdCBjbG9zZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcclxuICAgIGlmIChibG9iQWN0aW9ucyAmJiBibG9iQWN0aW9ucy5jbG9zZSkge1xyXG4gICAgICBibG9iQWN0aW9ucy5jbG9zZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBpZiAob25GaWxlcGF0aCkge1xyXG4gICAgICBvbkZpbGVwYXRoKCk7XHJcbiAgICB9O1xyXG4gICAgdXBkYXRlKCk7XHJcbiAgfSwgW3VwZGF0ZSwgYmxvYkFjdGlvbnMsIG9uRmlsZXBhdGhdKTtcclxuXHJcbiAgY29uc3Qgc2F2ZSA9IHVzZUNhbGxiYWNrKGFzeW5jIChjb250ZW50KSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhcIkdSVCBzYXZlIC8vIHdpbGwgc2F2ZSBmaWxlXCIpO1xyXG4gICAgYXdhaXQgc2F2ZUZpbGUoe1xyXG4gICAgICBhdXRoZW50aWNhdGlvbiwgcmVwb3NpdG9yeSwgYnJhbmNoLCBmaWxlLCBjb250ZW50LFxyXG4gICAgfSkudGhlbihcclxuICAgICAgLy8gRW1wdHkgY2FjaGUgaWYgdXNlciBoYXMgc2F2ZWQgdGhpcyBmaWxlXHJcbiAgICAgIC8vIChzYXZlKCkgd2lsbCBub3QgaGFwcGVuIGZvciBcIk9GRkxJTkVcIiBzeXN0ZW0gZmlsZXMpXHJcbiAgICAgIGFzeW5jKCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiR1JUIHNhdmUgLy8gd2lsbCBFTVBUWSBjYWNoZVwiKTtcclxuICAgICAgICBhd2FpdCBzYXZlQ2FjaGUobnVsbCk7IFxyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiR1JUIHNhdmUgLy8gd2lsbCBsb2FkIGZpbGVcIik7XHJcbiAgICAgICAgYXdhaXQgbG9hZCgpO1xyXG4gICAgICB9XHJcbiAgICApO1xyXG4gIH0sIFt3cml0ZWFibGUsIGF1dGhlbnRpY2F0aW9uLCByZXBvc2l0b3J5LCBicmFuY2gsIGZpbGUsIGxvYWQsIHNhdmVGaWxlLCBzYXZlQ2FjaGVdKTtcclxuXHJcbiAgY29uc3Qgc2F2ZUNhY2hlID0gdXNlQ2FsbGJhY2soYXN5bmMgKGNvbnRlbnQpID0+IHtcclxuICAgIGlmIChvblNhdmVDYWNoZSkge1xyXG4gICAgICBhd2FpdCBvblNhdmVDYWNoZSh7YXV0aGVudGljYXRpb24sIHJlcG9zaXRvcnksIGJyYW5jaCwgZmlsZSwgY29udGVudH0pO1xyXG4gICAgfVxyXG4gIH0sIFt3cml0ZWFibGUsIGF1dGhlbnRpY2F0aW9uLCByZXBvc2l0b3J5LCBicmFuY2gsIGZpbGUsIG9uU2F2ZUNhY2hlXSk7XHJcblxyXG4gIGNvbnN0IGRhbmdlcm91c2x5RGVsZXRlID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT4ge1xyXG4gICAgaWYgKHdyaXRlYWJsZSkge1xyXG4gICAgICBjb25zdCBfZGVsZXRlZCA9IGF3YWl0IGRlbGV0ZUZpbGUoe1xyXG4gICAgICAgIGF1dGhlbnRpY2F0aW9uLCByZXBvc2l0b3J5LCBmaWxlLCBicmFuY2gsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKF9kZWxldGVkKSB7XHJcbiAgICAgICAgc2V0RGVsZXRlZCh0cnVlKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9LCBbZmlsZSwgYXV0aGVudGljYXRpb24sIGJyYW5jaCwgcmVwb3NpdG9yeSwgd3JpdGVhYmxlXSk7XHJcblxyXG4gIHVzZURlZXBDb21wYXJlRWZmZWN0KCgpID0+IHtcclxuICAgIGNvbnN0IG5vdExvYWRlZCA9ICghZmlsZSAmJiBmaWxlcGF0aCAmJiAhZGVsZXRlZCk7XHJcbiAgICBjb25zdCBsb2FkTmV3ID0gKGZpbGUgJiYgZmlsZXBhdGggJiYgZmlsZS5maWxlcGF0aCAhPT0gZmlsZXBhdGgpO1xyXG5cclxuICAgIGlmIChub3RMb2FkZWQgfHwgbG9hZE5ldykge1xyXG4gICAgICBsb2FkKCk7XHJcbiAgICB9XHJcbiAgfSwgW2RlbGV0ZWQsIGZpbGVwYXRoLCBsb2FkLCBmaWxlXSk7XHJcblxyXG4gIGNvbnN0IGJsb2JGaWxlcGF0aCA9IGJsb2JTdGF0ZSAmJiBibG9iU3RhdGUuZmlsZXBhdGg7XHJcblxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoYmxvYkZpbGVwYXRoICYmIG9uRmlsZXBhdGgpIHtcclxuICAgICAgb25GaWxlcGF0aChibG9iRmlsZXBhdGgpO1xyXG4gICAgfTtcclxuICB9LCBbYmxvYkZpbGVwYXRoLCBvbkZpbGVwYXRoXSk7XHJcblxyXG4gIHVzZURlZXBDb21wYXJlRWZmZWN0KCgpID0+IHsgLy8gaWYgdGhlcmUgaXMgYSBmaWxlIGJ1dCBubyByZXBvc2l0b3J5LCBjbG9zZSBmaWxlLlxyXG4gICAgaWYgKCFyZXBvc2l0b3J5ICYmIGZpbGUpIGNsb3NlKCk7XHJcbiAgfSwgW3JlcG9zaXRvcnksIGZpbGUsIGNsb3NlXSk7XHJcblxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoZGVsZXRlZCkge1xyXG4gICAgICBjbG9zZSgpO1xyXG4gICAgICBzZXREZWxldGVkKGZhbHNlKTtcclxuICAgIH07XHJcbiAgfSwgW2RlbGV0ZWQsIGNsb3NlXSk7XHJcblxyXG4gIGNvbnN0IGFjdGlvbnMgPSB7XHJcbiAgICB1cGRhdGUsXHJcbiAgICBsb2FkLFxyXG4gICAgcmVhZCxcclxuICAgIHNhdmUsXHJcbiAgICBzYXZlQ2FjaGUsXHJcbiAgICBvblNhdmVDYWNoZSxcclxuICAgIG9uTG9hZENhY2hlLFxyXG4gICAgY2xvc2UsXHJcbiAgICBkYW5nZXJvdXNseURlbGV0ZSxcclxuICAgIHNldElzQ2hhbmdlZCxcclxuICAgIG9uQ29uZmlybUNsb3NlLFxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGNvbXBvbmVudHMgPSB7XHJcbiAgICBjcmVhdGU6IHJlcG9zaXRvcnkgJiYgKFxyXG4gICAgICA8RmlsZUZvcm1cclxuICAgICAgICBicmFuY2g9e2JyYW5jaH1cclxuICAgICAgICBkZWZhdWx0Q29udGVudD17ZGVmYXVsdENvbnRlbnR9XHJcbiAgICAgICAgb25TdWJtaXQ9e2NyZWF0ZUZpbGV9XHJcbiAgICAgIC8+XHJcbiAgICApLFxyXG4gICAgYnJvd3NlOiByZXBvc2l0b3J5ICYmIGJsb2JDb21wb25lbnRzLmJyb3dzZSxcclxuICAgIGZpbGVDYXJkOiByZXBvc2l0b3J5ICYmIGZpbGUgJiYgKFxyXG4gICAgICA8RmlsZUNhcmRcclxuICAgICAgICBhdXRoZW50aWNhdGlvbj17YXV0aGVudGljYXRpb259XHJcbiAgICAgICAgcmVwb3NpdG9yeT17cmVwb3NpdG9yeX1cclxuICAgICAgICBmaWxlPXt7IC4uLmZpbGUsIC4uLmFjdGlvbnMgfX1cclxuICAgICAgLz5cclxuICAgICksXHJcbiAgfTtcclxuXHJcbiAgbGV0IGNvbXBvbmVudCA9IDw+PC8+O1xyXG5cclxuICBpZiAoZmlsZSkge1xyXG4gICAgY29tcG9uZW50ID0gY29tcG9uZW50cy5maWxlQ2FyZDtcclxuICB9IGVsc2UgaWYgKCFmaWxlcGF0aCkge1xyXG4gICAgaWYgKGNyZWF0ZSkge1xyXG4gICAgICBjb21wb25lbnQgPSBjb21wb25lbnRzLmNyZWF0ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbXBvbmVudCA9IGNvbXBvbmVudHMuYnJvd3NlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHN0YXRlOiBmaWxlLFxyXG4gICAgc3RhdGVWYWx1ZXM6IHtpc0NoYW5nZWR9LFxyXG4gICAgYWN0aW9ucyxcclxuICAgIGNvbXBvbmVudCxcclxuICAgIGNvbXBvbmVudHMsXHJcbiAgfTtcclxufTtcclxuXHJcbnVzZUZpbGUucHJvcFR5cGVzID0ge1xyXG4gIC8qKiBUaGUgZnVsbCBmaWxlcGF0aCBmb3IgdGhlIGZpbGUuICovXHJcbiAgZmlsZXBhdGg6IFByb3BUeXBlcy5zdHJpbmcsXHJcbiAgLyoqIEZ1bmN0aW9uIHRvIHByb3BvZ2F0ZSBmaWxlcGF0aCB3aGVuIHRoZSBCbG9iIGlzIHNlbGVjdGVkLiAqL1xyXG4gIG9uRmlsZXBhdGg6IFByb3BUeXBlcy5mdW5jLFxyXG4gIC8qKiBBdXRoZW50aWNhdGlvbiBvYmplY3QgcmV0dXJuZWQgZnJvbSBhIHN1Y2Nlc3NmdWwgd2l0aEF1dGhlbnRpY2F0aW9uIGxvZ2luLiAqL1xyXG4gIGF1dGhlbnRpY2F0aW9uOiBQcm9wVHlwZXMuc2hhcGUoe1xyXG4gICAgY29uZmlnOiBQcm9wVHlwZXMuc2hhcGUoe1xyXG4gICAgICBzZXJ2ZXI6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcclxuICAgICAgaGVhZGVyczogUHJvcFR5cGVzLnNoYXBlKHsgQXV0aG9yaXphdGlvbjogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkIH0pLmlzUmVxdWlyZWQsXHJcbiAgICB9KS5pc1JlcXVpcmVkLFxyXG4gICAgdXNlcjogUHJvcFR5cGVzLnNoYXBlKHtcclxuICAgICAgdXNlcm5hbWU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcclxuICAgICAgZW1haWw6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcclxuICAgIH0pLmlzUmVxdWlyZWQsXHJcbiAgfSksXHJcbiAgLyoqIFJlcG9zaXRvcnkgdHJlZV91cmwgY2FuIGJlIHVzZWQgaW4gcGxhY2Ugb2YgYmxvYkNvbmZpZyAqL1xyXG4gIHJlcG9zaXRvcnk6IFByb3BUeXBlcy5zaGFwZSh7XHJcbiAgICBvd25lcjogUHJvcFR5cGVzLnNoYXBlKHsgdXNlcm5hbWU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCB9KSxcclxuICAgIG5hbWU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcclxuICB9KS5pc1JlcXVpcmVkLFxyXG4gIC8qKiB1c2UgYSBmb3JtIHRvIGNyZWF0ZSBhIG5ldyBmaWxlICovXHJcbiAgY3JlYXRlOiBQcm9wVHlwZXMuYm9vbCxcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IHVzZUZpbGU7XHJcbiJdfQ==