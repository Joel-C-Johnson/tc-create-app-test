"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireWildcard(require("react"));

var _useDeepCompareEffect = _interopRequireDefault(require("use-deep-compare-effect"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _styles = require("@material-ui/core/styles");

var _core = require("@material-ui/core");

var _path = _interopRequireDefault(require("path"));

var _ = require("..");

var _icons = require("@material-ui/icons");

var _core2 = require("../../core");

var _localStrings = require("../../core/localStrings");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

var useStyles = (0, _styles.makeStyles)(function (theme) {
  return {
    avatar: {
      borderRadius: '20%'
    },
    errorMessage: {
      color: _core.colors.red[500]
    }
  };
});

function Organization(_ref) {
  var _ref$url = _ref.url,
      url = _ref$url === void 0 ? '' : _ref$url,
      _ref$config = _ref.config,
      config = _ref$config === void 0 ? {} : _ref$config,
      organization = _ref.organization,
      _ref$onOrganization = _ref.onOrganization,
      onOrganization = _ref$onOrganization === void 0 ? function () {} : _ref$onOrganization,
      selected = _ref.selected,
      _ref$messages = _ref.messages;
  _ref$messages = _ref$messages === void 0 ? {} : _ref$messages;
  var _ref$messages$primary = _ref$messages.primaryLoading,
      primaryLoading = _ref$messages$primary === void 0 ? 'Loading…' : _ref$messages$primary,
      _ref$messages$seconda = _ref$messages.secondaryLoading,
      secondaryLoading = _ref$messages$seconda === void 0 ? 'Attempting to load organization details…' : _ref$messages$seconda,
      _ref$messages$primary2 = _ref$messages.primaryError,
      primaryError = _ref$messages$primary2 === void 0 ? 'No organization' : _ref$messages$primary2,
      _ref$messages$seconda2 = _ref$messages.secondaryError,
      secondaryError = _ref$messages$seconda2 === void 0 ? 'Please provide a valid organization object or url.' : _ref$messages$seconda2;
  var classes = useStyles();

  var _useState = (0, _react.useState)(organization),
      _useState2 = _slicedToArray(_useState, 2),
      org = _useState2[0],
      setOrg = _useState2[1];

  var _useState3 = (0, _react.useState)(true),
      _useState4 = _slicedToArray(_useState3, 2),
      loading = _useState4[0],
      setLoading = _useState4[1];

  var _ref2 = (0, _react.useContext)(_.AuthenticationContext) || {},
      contextAuthentication = _ref2.state;

  var getData = (0, _react.useCallback)( /*#__PURE__*/function () {
    var _ref4 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(_ref3) {
      var _config, _url, data;

      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              _config = _ref3.config, _url = _ref3.url;
              _context.next = 3;
              return (0, _core2.get)({
                config: _config,
                url: _url
              });

            case 3:
              data = _context.sent;
              setOrg(data);

            case 5:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function (_x) {
      return _ref4.apply(this, arguments);
    };
  }(), []);
  (0, _useDeepCompareEffect.default)(function () {
    if (url) {
      setLoading(true);
      getData({
        config: config,
        url: url
      });
    } else if (organization) {
      setOrg(organization);
    }

    setLoading(false);
  }, [url, organization, config, getData]);

  var _onOrganization = (0, _react.useCallback)( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {
    var user, hasWritePermissions;
    return regeneratorRuntime.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            if (!(org === undefined)) {
              _context2.next = 3;
              break;
            }

            onOrganization(org);
            return _context2.abrupt("return");

          case 3:
            // first get the user (if logged in)
            // if not logged in, go ahead and set the org
            user = contextAuthentication.user.login;

            if (user) {
              _context2.next = 7;
              break;
            }

            onOrganization(org);
            return _context2.abrupt("return");

          case 7:
            _context2.next = 9;
            return (0, _core2.isSelectedOrgWritable)({
              org: org,
              user: user,
              config: config
            });

          case 9:
            hasWritePermissions = _context2.sent;

            if (!hasWritePermissions) {
              alert("Your door43 user account doesn't have permission to edit the " + "files in the organization you have chosen.\n" + "Please contact your organization administrator and request write permissions.");
            } else {
              onOrganization(org);
            }

          case 11:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  })), [org, onOrganization]);

  var _ref6 = org || {},
      avatar_url = _ref6.avatar_url,
      description = _ref6.description,
      full_name = _ref6.full_name,
      username = _ref6.username;

  var primary = full_name || username || loading && primaryLoading || !org && primaryError;
  var secondary = description || loading && secondaryLoading || !org && secondaryError;
  var orgUrl = "https://git.door43.org/".concat(username);
  return /*#__PURE__*/_react.default.createElement(_core.ListItem, {
    selected: selected,
    "data-test": "organization-item",
    alignItems: "flex-start",
    button: true,
    ContainerComponent: "div",
    onClick: _onOrganization
  }, /*#__PURE__*/_react.default.createElement(_core.ListItemAvatar, null, /*#__PURE__*/_react.default.createElement(_core.Avatar, {
    alt: full_name || username,
    src: avatar_url,
    className: classes.avatar
  })), /*#__PURE__*/_react.default.createElement(_core.ListItemText, {
    primary: primary,
    secondary: secondary,
    classes: {
      secondary: full_name == null && username == null && loading !== true ? classes.errorMessage : null
    }
  }), org && /*#__PURE__*/_react.default.createElement(_core.ListItemSecondaryAction, null, /*#__PURE__*/_react.default.createElement(_core.Tooltip, {
    title: (0, _localStrings.localString)('OpenOrg'),
    arrow: true
  }, /*#__PURE__*/_react.default.createElement(_core.IconButton, {
    "aria-label": "Open Link",
    onClick: function onClick() {
      window.open(orgUrl, '_blank');
    }
  }, /*#__PURE__*/_react.default.createElement(_icons.Code, null)))));
}

Organization.propTypes = {
  /** Organization data to render, if url not provided. */
  organization: _propTypes.default.shape({
    avatar_url: _propTypes.default.string.isRequired,
    description: _propTypes.default.string.isRequired,
    full_name: _propTypes.default.string.isRequired,
    id: _propTypes.default.number.isRequired,
    location: _propTypes.default.string.isRequired,
    username: _propTypes.default.string.isRequired,
    visibility: _propTypes.default.string.isRequired,
    website: _propTypes.default.string.isRequired
  }),

  /** Function to call when organization is selected. */
  onOrganization: _propTypes.default.func.isRequired,

  /** Url to get organization data, if organization data is not provided. */
  url: _propTypes.default.string,

  /** Configuration required if paths are provided as URL. */
  config: _propTypes.default.shape({
    server: _propTypes.default.string.isRequired
  }),

  /** The selected organization */
  selected: _propTypes.default.bool,
  messages: _propTypes.default.shape({
    primaryError: _propTypes.default.string,
    secondaryError: _propTypes.default.string,
    primaryLoading: _propTypes.default.string,
    secondaryLoading: _propTypes.default.string
  })
};
var _default = Organization;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL29yZ2FuaXphdGlvbi9Pcmdhbml6YXRpb24uanMiXSwibmFtZXMiOlsidXNlU3R5bGVzIiwidGhlbWUiLCJhdmF0YXIiLCJib3JkZXJSYWRpdXMiLCJlcnJvck1lc3NhZ2UiLCJjb2xvciIsImNvbG9ycyIsInJlZCIsIk9yZ2FuaXphdGlvbiIsInVybCIsImNvbmZpZyIsIm9yZ2FuaXphdGlvbiIsIm9uT3JnYW5pemF0aW9uIiwic2VsZWN0ZWQiLCJtZXNzYWdlcyIsInByaW1hcnlMb2FkaW5nIiwic2Vjb25kYXJ5TG9hZGluZyIsInByaW1hcnlFcnJvciIsInNlY29uZGFyeUVycm9yIiwiY2xhc3NlcyIsIm9yZyIsInNldE9yZyIsImxvYWRpbmciLCJzZXRMb2FkaW5nIiwiQXV0aGVudGljYXRpb25Db250ZXh0IiwiY29udGV4dEF1dGhlbnRpY2F0aW9uIiwic3RhdGUiLCJnZXREYXRhIiwiX2NvbmZpZyIsIl91cmwiLCJkYXRhIiwiX29uT3JnYW5pemF0aW9uIiwidW5kZWZpbmVkIiwidXNlciIsImxvZ2luIiwiaGFzV3JpdGVQZXJtaXNzaW9ucyIsImFsZXJ0IiwiYXZhdGFyX3VybCIsImRlc2NyaXB0aW9uIiwiZnVsbF9uYW1lIiwidXNlcm5hbWUiLCJwcmltYXJ5Iiwic2Vjb25kYXJ5Iiwib3JnVXJsIiwid2luZG93Iiwib3BlbiIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsInNoYXBlIiwic3RyaW5nIiwiaXNSZXF1aXJlZCIsImlkIiwibnVtYmVyIiwibG9jYXRpb24iLCJ2aXNpYmlsaXR5Iiwid2Vic2l0ZSIsImZ1bmMiLCJzZXJ2ZXIiLCJib29sIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFVQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUEsU0FBUyxHQUFHLHdCQUFXLFVBQUNDLEtBQUQ7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STVCQyxJQUFBQSxFQUFFLEVBQUVKLG1CQUFVSyxNQUFWLENBQWlCRixVQUpPO0FBSzVCRyxJQUFBQSxRQUFRLEVBQUVOLG1CQUFVRSxNQUFWLENBQWlCQyxVQUxDO0FBTTVCVixJQUFBQSxRQUFRLEVBQUVPLG1CQUFVRSxNQUFWLENBQWlCQyxVQU5DO0FBTzVCSSxJQUFBQSxVQUFVLEVBQUVQLG1CQUFVRSxNQUFWLENBQWlCQyxVQVBEO0FBUTVCSyxJQUFBQSxPQUFPLEVBQUVSLG1CQUFVRSxNQUFWLENBQWlCQztBQVJFLEdBQWhCLENBRlM7O0FBWXZCO0FBQ0F0QyxFQUFBQSxjQUFjLEVBQUVtQyxtQkFBVVMsSUFBVixDQUFlTixVQWJSOztBQWN2QjtBQUNBekMsRUFBQUEsR0FBRyxFQUFFc0MsbUJBQVVFLE1BZlE7O0FBZ0J2QjtBQUNBdkMsRUFBQUEsTUFBTSxFQUFFcUMsbUJBQVVDLEtBQVYsQ0FBZ0I7QUFBRVMsSUFBQUEsTUFBTSxFQUFFVixtQkFBVUUsTUFBVixDQUFpQkM7QUFBM0IsR0FBaEIsQ0FqQmU7O0FBa0J2QjtBQUNBckMsRUFBQUEsUUFBUSxFQUFFa0MsbUJBQVVXLElBbkJHO0FBb0J2QjVDLEVBQUFBLFFBQVEsRUFBRWlDLG1CQUFVQyxLQUFWLENBQWdCO0FBQ3hCL0IsSUFBQUEsWUFBWSxFQUFFOEIsbUJBQVVFLE1BREE7QUFFeEIvQixJQUFBQSxjQUFjLEVBQUU2QixtQkFBVUUsTUFGRjtBQUd4QmxDLElBQUFBLGNBQWMsRUFBRWdDLG1CQUFVRSxNQUhGO0FBSXhCakMsSUFBQUEsZ0JBQWdCLEVBQUUrQixtQkFBVUU7QUFKSixHQUFoQjtBQXBCYSxDQUF6QjtlQTRCZXpDLFkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlU3RhdGUsIHVzZUNhbGxiYWNrLCB1c2VDb250ZXh0IH0gZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgdXNlRWZmZWN0IGZyb20gJ3VzZS1kZWVwLWNvbXBhcmUtZWZmZWN0JztcclxuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcclxuaW1wb3J0IHsgbWFrZVN0eWxlcyB9IGZyb20gJ0BtYXRlcmlhbC11aS9jb3JlL3N0eWxlcyc7XHJcbmltcG9ydCB7XHJcbiAgQXZhdGFyLFxyXG4gIExpc3RJdGVtLFxyXG4gIExpc3RJdGVtQXZhdGFyLFxyXG4gIExpc3RJdGVtVGV4dCxcclxuICBMaXN0SXRlbVNlY29uZGFyeUFjdGlvbixcclxuICBJY29uQnV0dG9uLFxyXG4gIGNvbG9ycyxcclxuICBUb29sdGlwLFxyXG59IGZyb20gJ0BtYXRlcmlhbC11aS9jb3JlJztcclxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XHJcbmltcG9ydCB7IEF1dGhlbnRpY2F0aW9uQ29udGV4dCB9IGZyb20gJy4uJztcclxuXHJcbmltcG9ydCB7IENvZGUgfSBmcm9tICdAbWF0ZXJpYWwtdWkvaWNvbnMnO1xyXG5pbXBvcnQgeyBnZXQsIGlzU2VsZWN0ZWRPcmdXcml0YWJsZX0gZnJvbSAnLi4vLi4vY29yZSc7XHJcbmltcG9ydCB7IGxvY2FsU3RyaW5nIH0gZnJvbSBcIi4uLy4uL2NvcmUvbG9jYWxTdHJpbmdzXCI7XHJcblxyXG5jb25zdCB1c2VTdHlsZXMgPSBtYWtlU3R5bGVzKCh0aGVtZSkgPT4gKHtcclxuICBhdmF0YXI6IHsgYm9yZGVyUmFkaXVzOiAnMjAlJyB9LFxyXG4gIGVycm9yTWVzc2FnZTogeyBjb2xvcjogY29sb3JzLnJlZFs1MDBdIH0sXHJcbn0pKTtcclxuXHJcbmZ1bmN0aW9uIE9yZ2FuaXphdGlvbih7XHJcbiAgdXJsID0gJycsXHJcbiAgY29uZmlnID0ge30sXHJcbiAgb3JnYW5pemF0aW9uLFxyXG4gIG9uT3JnYW5pemF0aW9uID0gKCkgPT4ge30sXHJcbiAgc2VsZWN0ZWQsXHJcbiAgbWVzc2FnZXM6IHtcclxuICAgIHByaW1hcnlMb2FkaW5nID0gJ0xvYWRpbmfigKYnLFxyXG4gICAgc2Vjb25kYXJ5TG9hZGluZyA9ICdBdHRlbXB0aW5nIHRvIGxvYWQgb3JnYW5pemF0aW9uIGRldGFpbHPigKYnLFxyXG5cclxuICAgIHByaW1hcnlFcnJvciA9ICdObyBvcmdhbml6YXRpb24nLFxyXG4gICAgc2Vjb25kYXJ5RXJyb3IgPSAnUGxlYXNlIHByb3ZpZGUgYSB2YWxpZCBvcmdhbml6YXRpb24gb2JqZWN0IG9yIHVybC4nLFxyXG4gIH0gPSB7fSxcclxufSkge1xyXG4gIGNvbnN0IGNsYXNzZXMgPSB1c2VTdHlsZXMoKTtcclxuICBjb25zdCBbb3JnLCBzZXRPcmddID0gdXNlU3RhdGUob3JnYW5pemF0aW9uKTtcclxuICBjb25zdCBbbG9hZGluZywgc2V0TG9hZGluZ10gPSB1c2VTdGF0ZSh0cnVlKTtcclxuICBjb25zdCB7IHN0YXRlOiBjb250ZXh0QXV0aGVudGljYXRpb24gfSA9IHVzZUNvbnRleHQoQXV0aGVudGljYXRpb25Db250ZXh0KSB8fCB7fTtcclxuXHJcbiAgY29uc3QgZ2V0RGF0YSA9IHVzZUNhbGxiYWNrKGFzeW5jICh7IGNvbmZpZzogX2NvbmZpZywgdXJsOiBfdXJsIH0pID0+IHtcclxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBnZXQoeyBjb25maWc6IF9jb25maWcsIHVybDogX3VybCB9KTtcclxuICAgIHNldE9yZyhkYXRhKTtcclxuICB9LCBbXSk7XHJcblxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAodXJsKSB7XHJcbiAgICAgIHNldExvYWRpbmcodHJ1ZSk7XHJcbiAgICAgIGdldERhdGEoeyBjb25maWcsIHVybCB9KTtcclxuICAgIH0gZWxzZSBpZiAob3JnYW5pemF0aW9uKSB7XHJcbiAgICAgIHNldE9yZyhvcmdhbml6YXRpb24pO1xyXG4gICAgfVxyXG4gICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgfSwgW3VybCwgb3JnYW5pemF0aW9uLCBjb25maWcsIGdldERhdGFdKTtcclxuXHJcbiAgY29uc3QgX29uT3JnYW5pemF0aW9uID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT4ge1xyXG4gICAgaWYgKCBvcmcgPT09IHVuZGVmaW5lZCApIHtcclxuICAgICAgb25Pcmdhbml6YXRpb24ob3JnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGZpcnN0IGdldCB0aGUgdXNlciAoaWYgbG9nZ2VkIGluKVxyXG4gICAgLy8gaWYgbm90IGxvZ2dlZCBpbiwgZ28gYWhlYWQgYW5kIHNldCB0aGUgb3JnXHJcbiAgICBsZXQgdXNlciA9IGNvbnRleHRBdXRoZW50aWNhdGlvbi51c2VyLmxvZ2luO1xyXG4gICAgaWYgKCAhdXNlciApIHtcclxuICAgICAgb25Pcmdhbml6YXRpb24ob3JnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGlmIHVzZXIgZG9lcyBub3QgaGF2ZSB3cml0ZSBhY2Nlc3MgdG8gdGhlIG9yZ1xyXG4gICAgLy8gaS5lLiwgaXMgb25seSBpbiB0ZWFtcyB3aXRoIHJlYWQgYWNjZXNzXHJcbiAgICAvLyB0aGVuIHNob3cgYWxlcnQgYW5kIGRvIG5vdCBzZXQgdGhlIG9yZ1xyXG4gICAgLy8gbWFrZSB0aGUgdXNlciBwaWNrIGFub3RoZXJcclxuICAgIGNvbnN0IGhhc1dyaXRlUGVybWlzc2lvbnMgPSBhd2FpdCBpc1NlbGVjdGVkT3JnV3JpdGFibGUoe29yZyx1c2VyLGNvbmZpZ30pO1xyXG4gICAgaWYgKCAhIGhhc1dyaXRlUGVybWlzc2lvbnMgKSB7XHJcbiAgICAgIGFsZXJ0KFxyXG4gICAgICAgIFwiWW91ciBkb29yNDMgdXNlciBhY2NvdW50IGRvZXNuJ3QgaGF2ZSBwZXJtaXNzaW9uIHRvIGVkaXQgdGhlIFwiICtcclxuICAgICAgICBcImZpbGVzIGluIHRoZSBvcmdhbml6YXRpb24geW91IGhhdmUgY2hvc2VuLlxcblwiICtcclxuICAgICAgICBcIlBsZWFzZSBjb250YWN0IHlvdXIgb3JnYW5pemF0aW9uIGFkbWluaXN0cmF0b3IgYW5kIHJlcXVlc3Qgd3JpdGUgcGVybWlzc2lvbnMuXCJcclxuICAgICAgKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIG9uT3JnYW5pemF0aW9uKG9yZyk7XHJcbiAgICB9XHJcbiAgfSwgW29yZywgb25Pcmdhbml6YXRpb25dKTtcclxuXHJcbiAgY29uc3Qge1xyXG4gICAgYXZhdGFyX3VybCwgZGVzY3JpcHRpb24sIGZ1bGxfbmFtZSwgdXNlcm5hbWUsXHJcbiAgfSA9IG9yZyB8fCB7fTtcclxuXHJcbiAgY29uc3QgcHJpbWFyeSA9XHJcbiAgICBmdWxsX25hbWUgfHxcclxuICAgIHVzZXJuYW1lIHx8XHJcbiAgICAobG9hZGluZyAmJiBwcmltYXJ5TG9hZGluZykgfHxcclxuICAgICghb3JnICYmIHByaW1hcnlFcnJvcik7XHJcbiAgY29uc3Qgc2Vjb25kYXJ5ID1cclxuICAgIGRlc2NyaXB0aW9uIHx8IChsb2FkaW5nICYmIHNlY29uZGFyeUxvYWRpbmcpIHx8ICghb3JnICYmIHNlY29uZGFyeUVycm9yKTtcclxuICBjb25zdCBvcmdVcmwgPSBgaHR0cHM6Ly9naXQuZG9vcjQzLm9yZy8ke3VzZXJuYW1lfWA7XHJcbiAgcmV0dXJuIChcclxuICAgIDxMaXN0SXRlbVxyXG4gICAgICBzZWxlY3RlZD17c2VsZWN0ZWR9XHJcbiAgICAgIGRhdGEtdGVzdD0nb3JnYW5pemF0aW9uLWl0ZW0nXHJcbiAgICAgIGFsaWduSXRlbXM9J2ZsZXgtc3RhcnQnXHJcbiAgICAgIGJ1dHRvblxyXG4gICAgICBDb250YWluZXJDb21wb25lbnQ9J2RpdidcclxuICAgICAgb25DbGljaz17X29uT3JnYW5pemF0aW9ufVxyXG4gICAgPlxyXG4gICAgICA8TGlzdEl0ZW1BdmF0YXI+XHJcbiAgICAgICAgPEF2YXRhclxyXG4gICAgICAgICAgYWx0PXtmdWxsX25hbWUgfHwgdXNlcm5hbWV9XHJcbiAgICAgICAgICBzcmM9e2F2YXRhcl91cmx9XHJcbiAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzZXMuYXZhdGFyfVxyXG4gICAgICAgIC8+XHJcbiAgICAgIDwvTGlzdEl0ZW1BdmF0YXI+XHJcbiAgICAgIDxMaXN0SXRlbVRleHRcclxuICAgICAgICBwcmltYXJ5PXtwcmltYXJ5fVxyXG4gICAgICAgIHNlY29uZGFyeT17c2Vjb25kYXJ5fVxyXG4gICAgICAgIGNsYXNzZXM9e3tcclxuICAgICAgICAgIHNlY29uZGFyeTpcclxuICAgICAgICAgICAgZnVsbF9uYW1lID09IG51bGwgJiYgdXNlcm5hbWUgPT0gbnVsbCAmJiBsb2FkaW5nICE9PSB0cnVlXHJcbiAgICAgICAgICAgICAgPyBjbGFzc2VzLmVycm9yTWVzc2FnZVxyXG4gICAgICAgICAgICAgIDogbnVsbCxcclxuICAgICAgICB9fVxyXG4gICAgICAvPlxyXG4gICAgICB7b3JnICYmIChcclxuICAgICAgICA8TGlzdEl0ZW1TZWNvbmRhcnlBY3Rpb24+XHJcbiAgICAgICAgICA8VG9vbHRpcCB0aXRsZT17bG9jYWxTdHJpbmcoJ09wZW5PcmcnKX0gYXJyb3c+XHJcbiAgICAgICAgICA8SWNvbkJ1dHRvblxyXG4gICAgICAgICAgICBhcmlhLWxhYmVsPSdPcGVuIExpbmsnXHJcbiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcclxuICAgICAgICAgICAgICB3aW5kb3cub3BlbihvcmdVcmwsICdfYmxhbmsnKTtcclxuICAgICAgICAgICAgfX1cclxuICAgICAgICAgID5cclxuICAgICAgICAgICAgPENvZGUgLz5cclxuICAgICAgICAgIDwvSWNvbkJ1dHRvbj5cclxuICAgICAgICAgIDwvVG9vbHRpcD5cclxuICAgICAgICA8L0xpc3RJdGVtU2Vjb25kYXJ5QWN0aW9uPlxyXG4gICAgICApfVxyXG4gICAgPC9MaXN0SXRlbT5cclxuICApO1xyXG59XHJcblxyXG5Pcmdhbml6YXRpb24ucHJvcFR5cGVzID0ge1xyXG4gIC8qKiBPcmdhbml6YXRpb24gZGF0YSB0byByZW5kZXIsIGlmIHVybCBub3QgcHJvdmlkZWQuICovXHJcbiAgb3JnYW5pemF0aW9uOiBQcm9wVHlwZXMuc2hhcGUoe1xyXG4gICAgYXZhdGFyX3VybDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxyXG4gICAgZGVzY3JpcHRpb246IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcclxuICAgIGZ1bGxfbmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxyXG4gICAgaWQ6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcclxuICAgIGxvY2F0aW9uOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXHJcbiAgICB1c2VybmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxyXG4gICAgdmlzaWJpbGl0eTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxyXG4gICAgd2Vic2l0ZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxyXG4gIH0pLFxyXG4gIC8qKiBGdW5jdGlvbiB0byBjYWxsIHdoZW4gb3JnYW5pemF0aW9uIGlzIHNlbGVjdGVkLiAqL1xyXG4gIG9uT3JnYW5pemF0aW9uOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxyXG4gIC8qKiBVcmwgdG8gZ2V0IG9yZ2FuaXphdGlvbiBkYXRhLCBpZiBvcmdhbml6YXRpb24gZGF0YSBpcyBub3QgcHJvdmlkZWQuICovXHJcbiAgdXJsOiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gIC8qKiBDb25maWd1cmF0aW9uIHJlcXVpcmVkIGlmIHBhdGhzIGFyZSBwcm92aWRlZCBhcyBVUkwuICovXHJcbiAgY29uZmlnOiBQcm9wVHlwZXMuc2hhcGUoeyBzZXJ2ZXI6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCB9KSxcclxuICAvKiogVGhlIHNlbGVjdGVkIG9yZ2FuaXphdGlvbiAqL1xyXG4gIHNlbGVjdGVkOiBQcm9wVHlwZXMuYm9vbCxcclxuICBtZXNzYWdlczogUHJvcFR5cGVzLnNoYXBlKHtcclxuICAgIHByaW1hcnlFcnJvcjogUHJvcFR5cGVzLnN0cmluZyxcclxuICAgIHNlY29uZGFyeUVycm9yOiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gICAgcHJpbWFyeUxvYWRpbmc6IFByb3BUeXBlcy5zdHJpbmcsXHJcbiAgICBzZWNvbmRhcnlMb2FkaW5nOiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gIH0pLFxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgT3JnYW5pemF0aW9uO1xyXG4iXX0=