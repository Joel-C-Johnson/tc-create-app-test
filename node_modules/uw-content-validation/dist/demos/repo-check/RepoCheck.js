"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");var _typeof = require("@babel/runtime/helpers/typeof");Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react = _interopRequireWildcard(require("react"));
var _styles = require("@material-ui/core/styles");
var _noticeProcessingFunctions = require("../notice-processing-functions");
var _RenderProcessedResults = require("../RenderProcessedResults");
var _core = require("../../core");
var _checkRepo = require("./checkRepo");

var _utilities = require("../../core/utilities");function _getRequireWildcardCache(nodeInterop) {if (typeof WeakMap !== "function") return null;var cacheBabelInterop = new WeakMap();var cacheNodeInterop = new WeakMap();return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {return nodeInterop ? cacheNodeInterop : cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj, nodeInterop) {if (!nodeInterop && obj && obj.__esModule) {return obj;}if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") {return { default: obj };}var cache = _getRequireWildcardCache(nodeInterop);if (cache && cache.has(obj)) {return cache.get(obj);}var newObj = {};var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;for (var key in obj) {if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;if (desc && (desc.get || desc.set)) {Object.defineProperty(newObj, key, desc);} else {newObj[key] = obj[key];}}}newObj.default = obj;if (cache) {cache.set(obj, newObj);}return newObj;} // eslint-disable-next-line no-unused-vars


// const REPO_VALIDATOR_VERSION_STRING = '0.2.5';


function RepoCheck( /*username, languageCode,*/props) {
  /*
  Check an entire repository
   Loads the zip file and the repo tree
      and then checks all the individual files
  */


  // debugLog(`I'm here in RepoCheck v${REPO_VALIDATOR_VERSION_STRING}`);
  // consoleLogObject("props", props);
  // consoleLogObject("props.classes", props.classes);

  var username = props.username;
  // debugLog(`username='${username}'`);
  var repoName = props.repoName;
  // debugLog(`repoName='${repoName}'`);
  var branchOrRelease = props.branchOrRelease;
  // debugLog(`branch='${branch}'`);
  if (branchOrRelease === undefined) branchOrRelease = 'master';

  var checkingOptions = { // Uncomment any of these to test them
    // excerptLength: 25,
    suppressNoticeDisablingFlag: true // Leave this one as true (otherwise demo checks are less efficient)
  };
  // NOTE: I removed this again as it didn’t really seem to make sense to enable it here
  //          Also, I don’t think the results were getting returned correctly yet
  // if (repoName && repoName.endsWith('_tn')) {
  //     // TODO: Should the user be able to turn this off and on ????
  //     checkingOptions.disableLinkedTAArticlesCheckFlag = false;
  //     checkingOptions.disableLinkedTWArticlesCheckFlag = false;
  // }
  // Or this allows the parameters to be specified as a RepoCheck property
  if (props.excerptLength) checkingOptions.excerptLength = (0, _core.ourParseInt)(props.excerptLength);
  if (props.cutoffPriorityLevel) checkingOptions.cutoffPriorityLevel = (0, _core.ourParseInt)(props.cutoffPriorityLevel);


  var _useState = (0, _react.useState)("Waiting-checkRepo"),_useState2 = (0, _slicedToArray2.default)(_useState, 2),result = _useState2[0],setResultValue = _useState2[1];
  (0, _react.useEffect)(function () {
    // debugLog("RepoCheck.useEffect() called with ", JSON.stringify(props));

    // Use an IIFE (Immediately Invoked Function Expression)
    //  e.g., see https://medium.com/javascript-in-plain-english/https-medium-com-javascript-in-plain-english-stop-feeling-iffy-about-using-an-iife-7b0292aba174
    (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {var _repoName$split, _repoName$split2, languageCode, repoCode, repoPreloadList, successFlag, renderSummary, rawCRResults, processOptions, displayType, processedResults, _processedResults, _processedResults2;return _regenerator.default.wrap(function _callee$(_context) {while (1) {switch (_context.prev = _context.next) {case 0:if (!(




              !props.wait || props.wait !== 'N')) {_context.next = 3;break;}
              setResultValue( /*#__PURE__*/_react.default.createElement("p", null, /*#__PURE__*/_react.default.createElement("span", { style: { color: 'blue' } }, "Waiting for user\u2026"), " (Adjust settings below as necessary and then set ", /*#__PURE__*/_react.default.createElement("b", null, "wait='N'"), " to start)"));return _context.abrupt("return");case 3:if (



              username) {_context.next = 6;break;}
              setResultValue( /*#__PURE__*/_react.default.createElement("p", { style: { color: 'red' } }, "No ", /*#__PURE__*/_react.default.createElement("b", null, "username"), " set!"));return _context.abrupt("return");case 6:if (


              repoName) {_context.next = 9;break;}
              setResultValue( /*#__PURE__*/_react.default.createElement("p", { style: { color: 'red' } }, "No ", /*#__PURE__*/_react.default.createElement("b", null, "repoName"), " set!"));return _context.abrupt("return");case 9:if (!(



              props.reloadAllFilesFirst && props.reloadAllFilesFirst.slice(0).toUpperCase() === 'Y')) {_context.next = 16;break;}
              (0, _utilities.userLog)("Clearing cache before running respository check…");
              setResultValue( /*#__PURE__*/_react.default.createElement("p", { style: { color: 'orange' } }, "Clearing cache before running repository check\u2026"));_context.next = 14;return (
                (0, _core.clearCaches)());case 14:_context.next = 18;break;case 16:_context.next = 18;return (

                (0, _core.clearCheckedArticleCache)());case 18: // otherwise we wouldn't see any of the warnings again from checking these
              _repoName$split =
              repoName.split('_'), _repoName$split2 = (0, _slicedToArray2.default)(_repoName$split, 2), languageCode = _repoName$split2[0], repoCode = _repoName$split2[1];
              repoCode = repoCode.toUpperCase();
              if (repoCode === 'TN2') repoCode = 'TN';else
              if (repoCode === 'TQ2') repoCode = 'TQ';
              // debugLog(`RepoCheck languageCode='${languageCode}' repoCode='${repoCode}'`);

              // Load whole repos, especially if we are going to check files in manifests
              // NOTE: We make TWO calls to preloadReposIfNecessary()
              //          because the branchOrRelease only applies to the repo being checked
              //          for all other repos, we just use `master`
              repoPreloadList = repoCode === 'TW' ? [] : ['TW'];
              if (repoCode !== 'UHB' && repoCode !== 'UGNT' && repoCode !== 'TA')
              repoPreloadList.push('TA'); // Original languages only have TW links
              // if (repoCode !== 'TA' && repoCode !== 'TW') repoPreloadList.push(repoCode);
              if (repoCode.startsWith('OBS-') || repoCode === 'TWL') {repoPreloadList.unshift('UGNT');repoPreloadList.unshift('UHB');repoPreloadList.push('OBS');}
              setResultValue( /*#__PURE__*/_react.default.createElement("p", { style: { color: 'magenta' } }, "Preloading ", repoCode, " and ", repoPreloadList.length, " repos for ", /*#__PURE__*/_react.default.createElement("i", null, username), " ", languageCode, " ready for ", repoName, " repo check\u2026"));
              (0, _utilities.logicAssert)(repoPreloadList.indexOf(repoCode) === -1);_context.next = 28;return (
                (0, _core.preloadReposIfNecessary)(username, languageCode, [], branchOrRelease, [repoCode]));case 28:_context.t0 = _context.sent;if (!_context.t0) {_context.next = 31;break;}_context.t0 =
              (0, _core.preloadReposIfNecessary)(username, languageCode, [], 'master', repoPreloadList);case 31:successFlag = _context.t0;
              if (!successFlag)
              console.error("RepoCheck error: Failed to pre-load all repos");

              // Display our "waiting" message
              setResultValue( /*#__PURE__*/_react.default.createElement("p", { style: { color: 'magenta' } }, "Checking ", /*#__PURE__*/_react.default.createElement("b", null, repoName), " repo\u2026"));

              // Put all this in a try/catch block coz otherwise it’s difficult to debug/view errors
              _context.prev = 34;








































              renderSummary = function renderSummary(processedResults) {
                var repoLink = branchOrRelease === undefined ? "https://git.door43.org/".concat(username, "/").concat(repoName, "/") : "https://git.door43.org/".concat(username, "/").concat(repoName, "/src/branch/").concat(branchOrRelease, "/");
                return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/
                _react.default.createElement("p", null, "Checked ", /*#__PURE__*/_react.default.createElement("b", null, username, " ", repoName), " (from ", /*#__PURE__*/_react.default.createElement("i", null, branchOrRelease === undefined ? 'DEFAULT' : branchOrRelease), " ", /*#__PURE__*/_react.default.createElement("a", { rel: "noopener noreferrer", target: "_blank", href: repoLink }, "branch"), ")"), /*#__PURE__*/
                _react.default.createElement(_RenderProcessedResults.RenderCheckedFilesList, { username: username, results: processedResults }), /*#__PURE__*/
                _react.default.createElement(_RenderProcessedResults.RenderTotals, { rawNoticeListLength: rawCRResults.noticeList.length, results: processedResults }));


              };rawCRResults = {};_context.prev = 37;_context.next = 40;return (0, _checkRepo.checkRepo)(username, repoName, branchOrRelease, "", setResultValue, checkingOptions);case 40:rawCRResults = _context.sent;_context.next = 47;break;case 43:_context.prev = 43;_context.t1 = _context["catch"](37);rawCRResults = { successList: [], noticeList: [] };rawCRResults.noticeList.push({ priority: 999, message: "checkRepo function FAILED", repoName: repoName, excerpt: _context.t1, location: repoName }); // debugLog("RepoCheck trace is", checkRepoError.trace);
            case 47: // debugLog("checkRepo() returned", typeof rawCRResults); //, JSON.stringify(rawCRResults));
              // Add some extra fields to our rawCRResults object in case we need this information again later
              rawCRResults.checkType = 'Repo';rawCRResults.username = username;rawCRResults.languageCode = languageCode;rawCRResults.checkedOptions = checkingOptions; // debugLog("Here with RC rawCRResults", typeof rawCRResults);
              // Now do our final handling of the result -- we have some options available
              processOptions = {// Uncomment any of these to test them
                // 'maximumSimilarMessages': 4, // default is 3 -- 0 means don’t suppress
                // 'errorPriorityLevel': 800, // default is 700
                // 'cutoffPriorityLevel': 100, // default is 0
                // 'sortBy': 'ByRepo', // default is 'ByPriority', also have 'AsFound'
                // 'ignorePriorityNumberList': [123, 202], // default is []
              }; // Or this allows the parameters to be specified as a RepoCheck property
              if (props.maximumSimilarMessages) processOptions.maximumSimilarMessages = (0, _core.ourParseInt)(props.maximumSimilarMessages);if (props.errorPriorityLevel) processOptions.errorPriorityLevel = (0, _core.ourParseInt)(props.errorPriorityLevel); // if (props.cutoffPriorityLevel) processOptions.cutoffPriorityLevel = ourParseInt(props.cutoffPriorityLevel);
              if (props.sortBy) processOptions.sortBy = props.sortBy; // if (props.ignorePriorityNumberList) processOptions.ignorePriorityNumberList = props.ignorePriorityNumberList;
              if (props.showDisabledNoticesFlag) processOptions.showDisabledNoticesFlag = props.showDisabledNoticesFlag.toLowerCase() === 'true';displayType = 'ErrorsWarnings'; // default
              if (props.displayType) displayType = props.displayType;if (displayType === 'ErrorsWarnings') {processedResults = (0, _noticeProcessingFunctions.processNoticesToErrorsWarnings)(rawCRResults, processOptions); // displayPropertyNames("RC processedResults", processedResults);
                //             userLog(`RepoCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)
                //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()}`, "numHiddenErrors=" + processedResults.numHiddenErrors.toLocaleString(), "numHiddenWarnings=" + processedResults.numHiddenWarnings.toLocaleString());
                // debugLog("Here now in rendering bit!");
                if (processedResults.errorList.length || processedResults.warningList.length) setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, renderSummary(processedResults), /*#__PURE__*/_react.default.createElement(_RenderProcessedResults.RenderSuccessesErrorsWarnings, { results: processedResults })));else // no errors or warnings
                  setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, renderSummary(processedResults), /*#__PURE__*/_react.default.createElement(_RenderProcessedResults.RenderSuccessesErrorsWarnings, { results: processedResults })));} else if (displayType === 'SevereMediumLow') {
                _processedResults = (0, _noticeProcessingFunctions.processNoticesToSevereMediumLow)(rawCRResults, processOptions);
                //             userLog(`RepoCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)
                //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()}`, "numHiddenErrors=" + processedResults.numHiddenErrors.toLocaleString(), "numHiddenWarnings=" + processedResults.numHiddenWarnings.toLocaleString());

                if (_processedResults.severeList.length || _processedResults.mediumList.length || _processedResults.lowList.length)
                setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null,
                renderSummary(_processedResults), /*#__PURE__*/
                _react.default.createElement(_RenderProcessedResults.RenderSuccessesSevereMediumLow, { results: _processedResults })));else

                  // no severe, medium, or low notices
                  setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null,
                  renderSummary(_processedResults), /*#__PURE__*/
                  _react.default.createElement(_RenderProcessedResults.RenderSuccessesSevereMediumLow, { results: _processedResults })));

              } else if (displayType === 'SingleList') {
                _processedResults2 = (0, _noticeProcessingFunctions.processNoticesToSingleList)(rawCRResults, processOptions);
                // debugLog(`RepoCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s) and ${processedResults.warningList.length.toLocaleString()} notice(s)
                //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numHiddenWarnings=${processedResults.numHiddenWarnings.toLocaleString()}`);

                if (_processedResults2.warningList.length)
                setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null,
                renderSummary(_processedResults2), /*#__PURE__*/
                _react.default.createElement(_RenderProcessedResults.RenderSuccessesNoticesGradient, { results: _processedResults2 })));else

                  // no warnings
                  setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null,
                  renderSummary(_processedResults2), /*#__PURE__*/
                  _react.default.createElement(_RenderProcessedResults.RenderSuccessesNoticesGradient, { results: _processedResults2 })));

              } else setResultValue( /*#__PURE__*/_react.default.createElement("b", { style: { color: 'red' } }, "Invalid displayType='", displayType, "'"));

              // debugLog("Finished rendering bit.");
              _context.next = 65;break;case 61:_context.prev = 61;_context.t2 = _context["catch"](34);
              console.error("RepoCheck main code block got error: ".concat(_context.t2.message));
              setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/
              _react.default.createElement("p", { style: { color: 'red' } }, "RepoCheck main code block got error: ", /*#__PURE__*/_react.default.createElement("b", null, _context.t2.message))));case 65:case "end":return _context.stop();}}}, _callee, null, [[34, 61], [37, 43]]);}))();


    // end of async part in unnamedFunction
    // Doesn’t work if we add this to next line: languageCode,username,repoName,branch,checkingOptions,props
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []); // end of useEffect part

  // {/* <div className={classes.root}> */}
  return /*#__PURE__*/(
    _react.default.createElement("div", { className: "Fred" },
    result));


}

// RepoCheck.propTypes = {
//   /** @ignore */
//   username: PropTypes.object.isRequired,
//   /** @ignore */
//   languageCode: PropTypes.object.isRequired,
//   props: PropTypes.object,
// };

var styles = function styles(theme) {return {
    root: {} };};var _default =



(0, _styles.withStyles)(styles)(RepoCheck);exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kZW1vcy9yZXBvLWNoZWNrL1JlcG9DaGVjay5qcyJdLCJuYW1lcyI6WyJSZXBvQ2hlY2siLCJwcm9wcyIsInVzZXJuYW1lIiwicmVwb05hbWUiLCJicmFuY2hPclJlbGVhc2UiLCJ1bmRlZmluZWQiLCJjaGVja2luZ09wdGlvbnMiLCJzdXBwcmVzc05vdGljZURpc2FibGluZ0ZsYWciLCJleGNlcnB0TGVuZ3RoIiwiY3V0b2ZmUHJpb3JpdHlMZXZlbCIsInJlc3VsdCIsInNldFJlc3VsdFZhbHVlIiwid2FpdCIsImNvbG9yIiwicmVsb2FkQWxsRmlsZXNGaXJzdCIsInNsaWNlIiwidG9VcHBlckNhc2UiLCJzcGxpdCIsImxhbmd1YWdlQ29kZSIsInJlcG9Db2RlIiwicmVwb1ByZWxvYWRMaXN0IiwicHVzaCIsInN0YXJ0c1dpdGgiLCJ1bnNoaWZ0IiwibGVuZ3RoIiwiaW5kZXhPZiIsInN1Y2Nlc3NGbGFnIiwiY29uc29sZSIsImVycm9yIiwicmVuZGVyU3VtbWFyeSIsInByb2Nlc3NlZFJlc3VsdHMiLCJyZXBvTGluayIsInJhd0NSUmVzdWx0cyIsIm5vdGljZUxpc3QiLCJzdWNjZXNzTGlzdCIsInByaW9yaXR5IiwibWVzc2FnZSIsImV4Y2VycHQiLCJsb2NhdGlvbiIsImNoZWNrVHlwZSIsImNoZWNrZWRPcHRpb25zIiwicHJvY2Vzc09wdGlvbnMiLCJtYXhpbXVtU2ltaWxhck1lc3NhZ2VzIiwiZXJyb3JQcmlvcml0eUxldmVsIiwic29ydEJ5Iiwic2hvd0Rpc2FibGVkTm90aWNlc0ZsYWciLCJ0b0xvd2VyQ2FzZSIsImRpc3BsYXlUeXBlIiwiZXJyb3JMaXN0Iiwid2FybmluZ0xpc3QiLCJzZXZlcmVMaXN0IiwibWVkaXVtTGlzdCIsImxvd0xpc3QiLCJzdHlsZXMiLCJ0aGVtZSIsInJvb3QiXSwibWFwcGluZ3MiOiJtZ0JBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGlELG1sQ0FEQTs7O0FBSUE7OztBQUdB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NkNBQUMsc0RBQUQsSUFBZ0MsT0FBTyxFQUFFQSxrQkFBekMsR0FGVyxDQUFELENBQWQsQ0FESjs7QUFLSztBQUNEbkIsa0JBQUFBLGNBQWMsZUFBQztBQUNWa0Isa0JBQUFBLGFBQWEsQ0FBQ0Msa0JBQUQsQ0FESDtBQUVYLCtDQUFDLHNEQUFELElBQWdDLE9BQU8sRUFBRUEsa0JBQXpDLEdBRlcsQ0FBRCxDQUFkOztBQUlQLGVBZk0sTUFlQW5CLGNBQWMsZUFBQyxvQ0FBRyxLQUFLLEVBQUUsRUFBRUUsS0FBSyxFQUFFLEtBQVQsRUFBViw2QkFBa0RrQyxXQUFsRCxNQUFELENBQWQ7O0FBRVA7QUF6SlA7QUEySk9wQixjQUFBQSxPQUFPLENBQUNDLEtBQVIsZ0RBQXNELFlBQVFRLE9BQTlEO0FBQ0F6QixjQUFBQSxjQUFjLGVBQUM7QUFDWCxrREFBRyxLQUFLLEVBQUUsRUFBRUUsS0FBSyxFQUFFLEtBQVQsRUFBViwwREFBaUUsd0NBQUksWUFBUXVCLE9BQVosQ0FBakUsQ0FEVyxDQUFELENBQWQsQ0E1SlAscUZBQUQ7OztBQWdLTTtBQUNOO0FBQ0E7QUFDSCxHQXhLRCxFQXdLRyxFQXhLSCxFQXJDa0QsQ0E2TTFDOztBQUVSO0FBQ0E7QUFDSSwwQ0FBSyxTQUFTLEVBQUMsTUFBZjtBQUNLMUIsSUFBQUEsTUFETCxDQURKOzs7QUFLSDs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxJQUFNMkMsTUFBTSxHQUFHLFNBQVRBLE1BQVMsQ0FBQUMsS0FBSyxVQUFLO0FBQ3JCQyxJQUFBQSxJQUFJLEVBQUUsRUFEZSxFQUFMLEVBQXBCLEM7Ozs7QUFLZSx3QkFBV0YsTUFBWCxFQUFtQnJELFNBQW5CLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlU3RhdGUsIHVzZUVmZmVjdCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHdpdGhTdHlsZXMgfSBmcm9tICdAbWF0ZXJpYWwtdWkvY29yZS9zdHlsZXMnO1xuaW1wb3J0IHsgcHJvY2Vzc05vdGljZXNUb0Vycm9yc1dhcm5pbmdzLCBwcm9jZXNzTm90aWNlc1RvU2V2ZXJlTWVkaXVtTG93LCBwcm9jZXNzTm90aWNlc1RvU2luZ2xlTGlzdCB9IGZyb20gJy4uL25vdGljZS1wcm9jZXNzaW5nLWZ1bmN0aW9ucyc7XG5pbXBvcnQgeyBSZW5kZXJDaGVja2VkRmlsZXNMaXN0LCBSZW5kZXJTdWNjZXNzZXNFcnJvcnNXYXJuaW5ncywgUmVuZGVyU3VjY2Vzc2VzU2V2ZXJlTWVkaXVtTG93LCBSZW5kZXJTdWNjZXNzZXNOb3RpY2VzR3JhZGllbnQsIFJlbmRlclRvdGFscyB9IGZyb20gJy4uL1JlbmRlclByb2Nlc3NlZFJlc3VsdHMnO1xuaW1wb3J0IHsgY2xlYXJDYWNoZXMsIGNsZWFyQ2hlY2tlZEFydGljbGVDYWNoZSwgcHJlbG9hZFJlcG9zSWZOZWNlc3NhcnksIG91clBhcnNlSW50IH0gZnJvbSAnLi4vLi4vY29yZSc7XG5pbXBvcnQgeyBjaGVja1JlcG8gfSBmcm9tICcuL2NoZWNrUmVwbyc7XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbmltcG9ydCB7IGxvZ2ljQXNzZXJ0LCB1c2VyTG9nLCBkZWJ1Z0xvZyB9IGZyb20gJy4uLy4uL2NvcmUvdXRpbGl0aWVzJztcblxuXG4vLyBjb25zdCBSRVBPX1ZBTElEQVRPUl9WRVJTSU9OX1NUUklORyA9ICcwLjIuNSc7XG5cblxuZnVuY3Rpb24gUmVwb0NoZWNrKC8qdXNlcm5hbWUsIGxhbmd1YWdlQ29kZSwqLyBwcm9wcykge1xuICAgIC8qXG4gICAgQ2hlY2sgYW4gZW50aXJlIHJlcG9zaXRvcnlcblxuICAgIExvYWRzIHRoZSB6aXAgZmlsZSBhbmQgdGhlIHJlcG8gdHJlZVxuICAgICAgICBhbmQgdGhlbiBjaGVja3MgYWxsIHRoZSBpbmRpdmlkdWFsIGZpbGVzXG4gICAgKi9cblxuICAgIC8vIGRlYnVnTG9nKGBJJ20gaGVyZSBpbiBSZXBvQ2hlY2sgdiR7UkVQT19WQUxJREFUT1JfVkVSU0lPTl9TVFJJTkd9YCk7XG4gICAgLy8gY29uc29sZUxvZ09iamVjdChcInByb3BzXCIsIHByb3BzKTtcbiAgICAvLyBjb25zb2xlTG9nT2JqZWN0KFwicHJvcHMuY2xhc3Nlc1wiLCBwcm9wcy5jbGFzc2VzKTtcblxuICAgIGNvbnN0IHVzZXJuYW1lID0gcHJvcHMudXNlcm5hbWU7XG4gICAgLy8gZGVidWdMb2coYHVzZXJuYW1lPScke3VzZXJuYW1lfSdgKTtcbiAgICBjb25zdCByZXBvTmFtZSA9IHByb3BzLnJlcG9OYW1lO1xuICAgIC8vIGRlYnVnTG9nKGByZXBvTmFtZT0nJHtyZXBvTmFtZX0nYCk7XG4gICAgbGV0IGJyYW5jaE9yUmVsZWFzZSA9IHByb3BzLmJyYW5jaE9yUmVsZWFzZTtcbiAgICAvLyBkZWJ1Z0xvZyhgYnJhbmNoPScke2JyYW5jaH0nYCk7XG4gICAgaWYgKGJyYW5jaE9yUmVsZWFzZSA9PT0gdW5kZWZpbmVkKSBicmFuY2hPclJlbGVhc2UgPSAnbWFzdGVyJztcblxuICAgIGNvbnN0IGNoZWNraW5nT3B0aW9ucyA9IHsgLy8gVW5jb21tZW50IGFueSBvZiB0aGVzZSB0byB0ZXN0IHRoZW1cbiAgICAgICAgLy8gZXhjZXJwdExlbmd0aDogMjUsXG4gICAgICAgIHN1cHByZXNzTm90aWNlRGlzYWJsaW5nRmxhZzogdHJ1ZSwgLy8gTGVhdmUgdGhpcyBvbmUgYXMgdHJ1ZSAob3RoZXJ3aXNlIGRlbW8gY2hlY2tzIGFyZSBsZXNzIGVmZmljaWVudClcbiAgICB9O1xuICAgIC8vIE5PVEU6IEkgcmVtb3ZlZCB0aGlzIGFnYWluIGFzIGl0IGRpZG7igJl0IHJlYWxseSBzZWVtIHRvIG1ha2Ugc2Vuc2UgdG8gZW5hYmxlIGl0IGhlcmVcbiAgICAvLyAgICAgICAgICBBbHNvLCBJIGRvbuKAmXQgdGhpbmsgdGhlIHJlc3VsdHMgd2VyZSBnZXR0aW5nIHJldHVybmVkIGNvcnJlY3RseSB5ZXRcbiAgICAvLyBpZiAocmVwb05hbWUgJiYgcmVwb05hbWUuZW5kc1dpdGgoJ190bicpKSB7XG4gICAgLy8gICAgIC8vIFRPRE86IFNob3VsZCB0aGUgdXNlciBiZSBhYmxlIHRvIHR1cm4gdGhpcyBvZmYgYW5kIG9uID8/Pz9cbiAgICAvLyAgICAgY2hlY2tpbmdPcHRpb25zLmRpc2FibGVMaW5rZWRUQUFydGljbGVzQ2hlY2tGbGFnID0gZmFsc2U7XG4gICAgLy8gICAgIGNoZWNraW5nT3B0aW9ucy5kaXNhYmxlTGlua2VkVFdBcnRpY2xlc0NoZWNrRmxhZyA9IGZhbHNlO1xuICAgIC8vIH1cbiAgICAvLyBPciB0aGlzIGFsbG93cyB0aGUgcGFyYW1ldGVycyB0byBiZSBzcGVjaWZpZWQgYXMgYSBSZXBvQ2hlY2sgcHJvcGVydHlcbiAgICBpZiAocHJvcHMuZXhjZXJwdExlbmd0aCkgY2hlY2tpbmdPcHRpb25zLmV4Y2VycHRMZW5ndGggPSBvdXJQYXJzZUludChwcm9wcy5leGNlcnB0TGVuZ3RoKTtcbiAgICBpZiAocHJvcHMuY3V0b2ZmUHJpb3JpdHlMZXZlbCkgY2hlY2tpbmdPcHRpb25zLmN1dG9mZlByaW9yaXR5TGV2ZWwgPSBvdXJQYXJzZUludChwcm9wcy5jdXRvZmZQcmlvcml0eUxldmVsKTtcblxuXG4gICAgY29uc3QgW3Jlc3VsdCwgc2V0UmVzdWx0VmFsdWVdID0gdXNlU3RhdGUoXCJXYWl0aW5nLWNoZWNrUmVwb1wiKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICAvLyBkZWJ1Z0xvZyhcIlJlcG9DaGVjay51c2VFZmZlY3QoKSBjYWxsZWQgd2l0aCBcIiwgSlNPTi5zdHJpbmdpZnkocHJvcHMpKTtcblxuICAgICAgICAvLyBVc2UgYW4gSUlGRSAoSW1tZWRpYXRlbHkgSW52b2tlZCBGdW5jdGlvbiBFeHByZXNzaW9uKVxuICAgICAgICAvLyAgZS5nLiwgc2VlIGh0dHBzOi8vbWVkaXVtLmNvbS9qYXZhc2NyaXB0LWluLXBsYWluLWVuZ2xpc2gvaHR0cHMtbWVkaXVtLWNvbS1qYXZhc2NyaXB0LWluLXBsYWluLWVuZ2xpc2gtc3RvcC1mZWVsaW5nLWlmZnktYWJvdXQtdXNpbmctYW4taWlmZS03YjAyOTJhYmExNzRcbiAgICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIGRlYnVnTG9nKFwiU3RhcnRlZCBSZXBvQ2hlY2sudW5uYW1lZEZ1bmN0aW9uKClcIik7XG5cbiAgICAgICAgICAgIC8vIE5PVEUgZnJvbSBSSkg6IEkgY2Fu4oCZdCBmaW5kIHRoZSBjb3JyZWN0IFJlYWN0IHBsYWNlIGZvciB0aGlzIC8gd2F5IHRvIGRvIHRoaXNcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgc28gaXQgc2hvd3MgYSB3YXJuaW5nIGZvciB0aGUgdXNlciwgYW5kIGRvZXNu4oCZdCBjb250aW51ZSB0byB0cnkgdG8gcHJvY2Vzc1xuICAgICAgICAgICAgaWYgKCFwcm9wcy53YWl0IHx8IHByb3BzLndhaXQgIT09ICdOJykge1xuICAgICAgICAgICAgICAgIHNldFJlc3VsdFZhbHVlKDxwPjxzcGFuIHN0eWxlPXt7IGNvbG9yOiAnYmx1ZScgfX0+V2FpdGluZyBmb3IgdXNlcuKApjwvc3Bhbj4gKEFkanVzdCBzZXR0aW5ncyBiZWxvdyBhcyBuZWNlc3NhcnkgYW5kIHRoZW4gc2V0IDxiPndhaXQ9J04nPC9iPiB0byBzdGFydCk8L3A+KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghdXNlcm5hbWUpIHtcbiAgICAgICAgICAgICAgICBzZXRSZXN1bHRWYWx1ZSg8cCBzdHlsZT17eyBjb2xvcjogJ3JlZCcgfX0+Tm8gPGI+dXNlcm5hbWU8L2I+IHNldCE8L3A+KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXJlcG9OYW1lKSB7XG4gICAgICAgICAgICAgICAgc2V0UmVzdWx0VmFsdWUoPHAgc3R5bGU9e3sgY29sb3I6ICdyZWQnIH19Pk5vIDxiPnJlcG9OYW1lPC9iPiBzZXQhPC9wPik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocHJvcHMucmVsb2FkQWxsRmlsZXNGaXJzdCAmJiBwcm9wcy5yZWxvYWRBbGxGaWxlc0ZpcnN0LnNsaWNlKDApLnRvVXBwZXJDYXNlKCkgPT09ICdZJykge1xuICAgICAgICAgICAgICAgIHVzZXJMb2coXCJDbGVhcmluZyBjYWNoZSBiZWZvcmUgcnVubmluZyByZXNwb3NpdG9yeSBjaGVja+KAplwiKTtcbiAgICAgICAgICAgICAgICBzZXRSZXN1bHRWYWx1ZSg8cCBzdHlsZT17eyBjb2xvcjogJ29yYW5nZScgfX0+Q2xlYXJpbmcgY2FjaGUgYmVmb3JlIHJ1bm5pbmcgcmVwb3NpdG9yeSBjaGVja+KApjwvcD4pO1xuICAgICAgICAgICAgICAgIGF3YWl0IGNsZWFyQ2FjaGVzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGF3YWl0IGNsZWFyQ2hlY2tlZEFydGljbGVDYWNoZSgpOyAvLyBvdGhlcndpc2Ugd2Ugd291bGRuJ3Qgc2VlIGFueSBvZiB0aGUgd2FybmluZ3MgYWdhaW4gZnJvbSBjaGVja2luZyB0aGVzZVxuXG4gICAgICAgICAgICBsZXQgW2xhbmd1YWdlQ29kZSwgcmVwb0NvZGVdID0gcmVwb05hbWUuc3BsaXQoJ18nKTtcbiAgICAgICAgICAgIHJlcG9Db2RlID0gcmVwb0NvZGUudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIGlmIChyZXBvQ29kZSA9PT0gJ1ROMicpIHJlcG9Db2RlID0gJ1ROJztcbiAgICAgICAgICAgIGVsc2UgaWYgKHJlcG9Db2RlID09PSAnVFEyJykgcmVwb0NvZGUgPSAnVFEnO1xuICAgICAgICAgICAgLy8gZGVidWdMb2coYFJlcG9DaGVjayBsYW5ndWFnZUNvZGU9JyR7bGFuZ3VhZ2VDb2RlfScgcmVwb0NvZGU9JyR7cmVwb0NvZGV9J2ApO1xuXG4gICAgICAgICAgICAvLyBMb2FkIHdob2xlIHJlcG9zLCBlc3BlY2lhbGx5IGlmIHdlIGFyZSBnb2luZyB0byBjaGVjayBmaWxlcyBpbiBtYW5pZmVzdHNcbiAgICAgICAgICAgIC8vIE5PVEU6IFdlIG1ha2UgVFdPIGNhbGxzIHRvIHByZWxvYWRSZXBvc0lmTmVjZXNzYXJ5KClcbiAgICAgICAgICAgIC8vICAgICAgICAgIGJlY2F1c2UgdGhlIGJyYW5jaE9yUmVsZWFzZSBvbmx5IGFwcGxpZXMgdG8gdGhlIHJlcG8gYmVpbmcgY2hlY2tlZFxuICAgICAgICAgICAgLy8gICAgICAgICAgZm9yIGFsbCBvdGhlciByZXBvcywgd2UganVzdCB1c2UgYG1hc3RlcmBcbiAgICAgICAgICAgIGNvbnN0IHJlcG9QcmVsb2FkTGlzdCA9IHJlcG9Db2RlID09PSAnVFcnID8gW10gOiBbJ1RXJ107XG4gICAgICAgICAgICBpZiAocmVwb0NvZGUgIT09ICdVSEInICYmIHJlcG9Db2RlICE9PSAnVUdOVCcgJiYgcmVwb0NvZGUgIT09ICdUQScpXG4gICAgICAgICAgICAgICAgcmVwb1ByZWxvYWRMaXN0LnB1c2goJ1RBJyk7IC8vIE9yaWdpbmFsIGxhbmd1YWdlcyBvbmx5IGhhdmUgVFcgbGlua3NcbiAgICAgICAgICAgIC8vIGlmIChyZXBvQ29kZSAhPT0gJ1RBJyAmJiByZXBvQ29kZSAhPT0gJ1RXJykgcmVwb1ByZWxvYWRMaXN0LnB1c2gocmVwb0NvZGUpO1xuICAgICAgICAgICAgaWYgKHJlcG9Db2RlLnN0YXJ0c1dpdGgoJ09CUy0nKSB8fCByZXBvQ29kZSA9PT0gJ1RXTCcpIHsgcmVwb1ByZWxvYWRMaXN0LnVuc2hpZnQoJ1VHTlQnKTsgcmVwb1ByZWxvYWRMaXN0LnVuc2hpZnQoJ1VIQicpOyByZXBvUHJlbG9hZExpc3QucHVzaCgnT0JTJyk7IH1cbiAgICAgICAgICAgIHNldFJlc3VsdFZhbHVlKDxwIHN0eWxlPXt7IGNvbG9yOiAnbWFnZW50YScgfX0+UHJlbG9hZGluZyB7cmVwb0NvZGV9IGFuZCB7cmVwb1ByZWxvYWRMaXN0Lmxlbmd0aH0gcmVwb3MgZm9yIDxpPnt1c2VybmFtZX08L2k+IHtsYW5ndWFnZUNvZGV9IHJlYWR5IGZvciB7cmVwb05hbWV9IHJlcG8gY2hlY2vigKY8L3A+KTtcbiAgICAgICAgICAgIGxvZ2ljQXNzZXJ0KHJlcG9QcmVsb2FkTGlzdC5pbmRleE9mKHJlcG9Db2RlKSA9PT0gLTEpO1xuICAgICAgICAgICAgY29uc3Qgc3VjY2Vzc0ZsYWcgPSBhd2FpdCBwcmVsb2FkUmVwb3NJZk5lY2Vzc2FyeSh1c2VybmFtZSwgbGFuZ3VhZ2VDb2RlLCBbXSwgYnJhbmNoT3JSZWxlYXNlLCBbcmVwb0NvZGVdKVxuICAgICAgICAgICAgICAgICYmIHByZWxvYWRSZXBvc0lmTmVjZXNzYXJ5KHVzZXJuYW1lLCBsYW5ndWFnZUNvZGUsIFtdLCAnbWFzdGVyJywgcmVwb1ByZWxvYWRMaXN0KTtcbiAgICAgICAgICAgIGlmICghc3VjY2Vzc0ZsYWcpXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgUmVwb0NoZWNrIGVycm9yOiBGYWlsZWQgdG8gcHJlLWxvYWQgYWxsIHJlcG9zYClcblxuICAgICAgICAgICAgLy8gRGlzcGxheSBvdXIgXCJ3YWl0aW5nXCIgbWVzc2FnZVxuICAgICAgICAgICAgc2V0UmVzdWx0VmFsdWUoPHAgc3R5bGU9e3sgY29sb3I6ICdtYWdlbnRhJyB9fT5DaGVja2luZyA8Yj57cmVwb05hbWV9PC9iPiByZXBv4oCmPC9wPik7XG5cbiAgICAgICAgICAgIC8vIFB1dCBhbGwgdGhpcyBpbiBhIHRyeS9jYXRjaCBibG9jayBjb3ogb3RoZXJ3aXNlIGl04oCZcyBkaWZmaWN1bHQgdG8gZGVidWcvdmlldyBlcnJvcnNcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgbGV0IHJhd0NSUmVzdWx0cyA9IHt9O1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEVtcHR5IHN0cmluZyBiZWxvdyBpcyBmb3IgbG9jYXRpb25cbiAgICAgICAgICAgICAgICAgICAgcmF3Q1JSZXN1bHRzID0gYXdhaXQgY2hlY2tSZXBvKHVzZXJuYW1lLCByZXBvTmFtZSwgYnJhbmNoT3JSZWxlYXNlLCBcIlwiLCBzZXRSZXN1bHRWYWx1ZSwgY2hlY2tpbmdPcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gZGVidWdMb2coYHJhd0NSUmVzdWx0cyBrZXlzOiAke09iamVjdC5rZXlzKHJhd0NSUmVzdWx0cyl9YCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRlYnVnTG9nKGByYXdDUlJlc3VsdHM6ICR7SlNPTi5zdHJpbmdpZnkocmF3Q1JSZXN1bHRzKX1gKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gbG9naWNBc3NlcnQoJ2NoZWNrZWRGaWxlQ291bnQnIGluIHJhd0NSUmVzdWx0cywgYEV4cGVjdGVkIHJhd0NCUHNSZXN1bHRzIHRvIGNvbnRhaW4gJ2NoZWNrZWRGaWxlQ291bnQnOiAke09iamVjdC5rZXlzKHJhd0NSUmVzdWx0cyl9YCk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoY2hlY2tSZXBvRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmF3Q1JSZXN1bHRzID0geyBzdWNjZXNzTGlzdDogW10sIG5vdGljZUxpc3Q6IFtdIH07XG4gICAgICAgICAgICAgICAgICAgIHJhd0NSUmVzdWx0cy5ub3RpY2VMaXN0LnB1c2goeyBwcmlvcml0eTogOTk5LCBtZXNzYWdlOiBcImNoZWNrUmVwbyBmdW5jdGlvbiBGQUlMRURcIiwgcmVwb05hbWUsIGV4Y2VycHQ6IGNoZWNrUmVwb0Vycm9yLCBsb2NhdGlvbjogcmVwb05hbWUgfSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRlYnVnTG9nKFwiUmVwb0NoZWNrIHRyYWNlIGlzXCIsIGNoZWNrUmVwb0Vycm9yLnRyYWNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gZGVidWdMb2coXCJjaGVja1JlcG8oKSByZXR1cm5lZFwiLCB0eXBlb2YgcmF3Q1JSZXN1bHRzKTsgLy8sIEpTT04uc3RyaW5naWZ5KHJhd0NSUmVzdWx0cykpO1xuXG4gICAgICAgICAgICAgICAgLy8gQWRkIHNvbWUgZXh0cmEgZmllbGRzIHRvIG91ciByYXdDUlJlc3VsdHMgb2JqZWN0IGluIGNhc2Ugd2UgbmVlZCB0aGlzIGluZm9ybWF0aW9uIGFnYWluIGxhdGVyXG4gICAgICAgICAgICAgICAgcmF3Q1JSZXN1bHRzLmNoZWNrVHlwZSA9ICdSZXBvJztcbiAgICAgICAgICAgICAgICByYXdDUlJlc3VsdHMudXNlcm5hbWUgPSB1c2VybmFtZTtcbiAgICAgICAgICAgICAgICByYXdDUlJlc3VsdHMubGFuZ3VhZ2VDb2RlID0gbGFuZ3VhZ2VDb2RlO1xuICAgICAgICAgICAgICAgIHJhd0NSUmVzdWx0cy5jaGVja2VkT3B0aW9ucyA9IGNoZWNraW5nT3B0aW9ucztcblxuICAgICAgICAgICAgICAgIC8vIGRlYnVnTG9nKFwiSGVyZSB3aXRoIFJDIHJhd0NSUmVzdWx0c1wiLCB0eXBlb2YgcmF3Q1JSZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAvLyBOb3cgZG8gb3VyIGZpbmFsIGhhbmRsaW5nIG9mIHRoZSByZXN1bHQgLS0gd2UgaGF2ZSBzb21lIG9wdGlvbnMgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgbGV0IHByb2Nlc3NPcHRpb25zID0geyAvLyBVbmNvbW1lbnQgYW55IG9mIHRoZXNlIHRvIHRlc3QgdGhlbVxuICAgICAgICAgICAgICAgICAgICAvLyAnbWF4aW11bVNpbWlsYXJNZXNzYWdlcyc6IDQsIC8vIGRlZmF1bHQgaXMgMyAtLSAwIG1lYW5zIGRvbuKAmXQgc3VwcHJlc3NcbiAgICAgICAgICAgICAgICAgICAgLy8gJ2Vycm9yUHJpb3JpdHlMZXZlbCc6IDgwMCwgLy8gZGVmYXVsdCBpcyA3MDBcbiAgICAgICAgICAgICAgICAgICAgLy8gJ2N1dG9mZlByaW9yaXR5TGV2ZWwnOiAxMDAsIC8vIGRlZmF1bHQgaXMgMFxuICAgICAgICAgICAgICAgICAgICAvLyAnc29ydEJ5JzogJ0J5UmVwbycsIC8vIGRlZmF1bHQgaXMgJ0J5UHJpb3JpdHknLCBhbHNvIGhhdmUgJ0FzRm91bmQnXG4gICAgICAgICAgICAgICAgICAgIC8vICdpZ25vcmVQcmlvcml0eU51bWJlckxpc3QnOiBbMTIzLCAyMDJdLCAvLyBkZWZhdWx0IGlzIFtdXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAvLyBPciB0aGlzIGFsbG93cyB0aGUgcGFyYW1ldGVycyB0byBiZSBzcGVjaWZpZWQgYXMgYSBSZXBvQ2hlY2sgcHJvcGVydHlcbiAgICAgICAgICAgICAgICBpZiAocHJvcHMubWF4aW11bVNpbWlsYXJNZXNzYWdlcykgcHJvY2Vzc09wdGlvbnMubWF4aW11bVNpbWlsYXJNZXNzYWdlcyA9IG91clBhcnNlSW50KHByb3BzLm1heGltdW1TaW1pbGFyTWVzc2FnZXMpO1xuICAgICAgICAgICAgICAgIGlmIChwcm9wcy5lcnJvclByaW9yaXR5TGV2ZWwpIHByb2Nlc3NPcHRpb25zLmVycm9yUHJpb3JpdHlMZXZlbCA9IG91clBhcnNlSW50KHByb3BzLmVycm9yUHJpb3JpdHlMZXZlbCk7XG4gICAgICAgICAgICAgICAgLy8gaWYgKHByb3BzLmN1dG9mZlByaW9yaXR5TGV2ZWwpIHByb2Nlc3NPcHRpb25zLmN1dG9mZlByaW9yaXR5TGV2ZWwgPSBvdXJQYXJzZUludChwcm9wcy5jdXRvZmZQcmlvcml0eUxldmVsKTtcbiAgICAgICAgICAgICAgICBpZiAocHJvcHMuc29ydEJ5KSBwcm9jZXNzT3B0aW9ucy5zb3J0QnkgPSBwcm9wcy5zb3J0Qnk7XG4gICAgICAgICAgICAgICAgLy8gaWYgKHByb3BzLmlnbm9yZVByaW9yaXR5TnVtYmVyTGlzdCkgcHJvY2Vzc09wdGlvbnMuaWdub3JlUHJpb3JpdHlOdW1iZXJMaXN0ID0gcHJvcHMuaWdub3JlUHJpb3JpdHlOdW1iZXJMaXN0O1xuICAgICAgICAgICAgICAgIGlmIChwcm9wcy5zaG93RGlzYWJsZWROb3RpY2VzRmxhZykgcHJvY2Vzc09wdGlvbnMuc2hvd0Rpc2FibGVkTm90aWNlc0ZsYWcgPSBwcm9wcy5zaG93RGlzYWJsZWROb3RpY2VzRmxhZy50b0xvd2VyQ2FzZSgpID09PSAndHJ1ZSc7XG5cbiAgICAgICAgICAgICAgICBsZXQgZGlzcGxheVR5cGUgPSAnRXJyb3JzV2FybmluZ3MnOyAvLyBkZWZhdWx0XG4gICAgICAgICAgICAgICAgaWYgKHByb3BzLmRpc3BsYXlUeXBlKSBkaXNwbGF5VHlwZSA9IHByb3BzLmRpc3BsYXlUeXBlO1xuXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gcmVuZGVyU3VtbWFyeShwcm9jZXNzZWRSZXN1bHRzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcG9MaW5rID0gYnJhbmNoT3JSZWxlYXNlID09PSB1bmRlZmluZWQgPyBgaHR0cHM6Ly9naXQuZG9vcjQzLm9yZy8ke3VzZXJuYW1lfS8ke3JlcG9OYW1lfS9gIDogYGh0dHBzOi8vZ2l0LmRvb3I0My5vcmcvJHt1c2VybmFtZX0vJHtyZXBvTmFtZX0vc3JjL2JyYW5jaC8ke2JyYW5jaE9yUmVsZWFzZX0vYDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICg8ZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPHA+Q2hlY2tlZCA8Yj57dXNlcm5hbWV9IHtyZXBvTmFtZX08L2I+IChmcm9tIDxpPnticmFuY2hPclJlbGVhc2UgPT09IHVuZGVmaW5lZCA/ICdERUZBVUxUJyA6IGJyYW5jaE9yUmVsZWFzZX08L2k+IDxhIHJlbD1cIm5vb3BlbmVyIG5vcmVmZXJyZXJcIiB0YXJnZXQ9XCJfYmxhbmtcIiBocmVmPXtyZXBvTGlua30+YnJhbmNoPC9hPik8L3A+XG4gICAgICAgICAgICAgICAgICAgICAgICA8UmVuZGVyQ2hlY2tlZEZpbGVzTGlzdCB1c2VybmFtZT17dXNlcm5hbWV9IHJlc3VsdHM9e3Byb2Nlc3NlZFJlc3VsdHN9IC8+XG4gICAgICAgICAgICAgICAgICAgICAgICA8UmVuZGVyVG90YWxzIHJhd05vdGljZUxpc3RMZW5ndGg9e3Jhd0NSUmVzdWx0cy5ub3RpY2VMaXN0Lmxlbmd0aH0gcmVzdWx0cz17cHJvY2Vzc2VkUmVzdWx0c30gLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIHsvKiA8UmVuZGVyUmF3UmVzdWx0cyByZXN1bHRzPXtyYXdDUlJlc3VsdHN9IC8+ICovfVxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj4pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChkaXNwbGF5VHlwZSA9PT0gJ0Vycm9yc1dhcm5pbmdzJykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9jZXNzZWRSZXN1bHRzID0gcHJvY2Vzc05vdGljZXNUb0Vycm9yc1dhcm5pbmdzKHJhd0NSUmVzdWx0cywgcHJvY2Vzc09wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICAvLyBkaXNwbGF5UHJvcGVydHlOYW1lcyhcIlJDIHByb2Nlc3NlZFJlc3VsdHNcIiwgcHJvY2Vzc2VkUmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIHVzZXJMb2coYFJlcG9DaGVjayBnb3QgYmFjayBwcm9jZXNzZWRSZXN1bHRzIHdpdGggJHtwcm9jZXNzZWRSZXN1bHRzLnN1Y2Nlc3NMaXN0Lmxlbmd0aC50b0xvY2FsZVN0cmluZygpfSBzdWNjZXNzIG1lc3NhZ2UocyksICR7cHJvY2Vzc2VkUmVzdWx0cy5lcnJvckxpc3QubGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCl9IGVycm9yKHMpIGFuZCAke3Byb2Nlc3NlZFJlc3VsdHMud2FybmluZ0xpc3QubGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCl9IHdhcm5pbmcocylcbiAgICAgICAgICAgICAgICAgICAgLy8gICBudW1JZ25vcmVkTm90aWNlcz0ke3Byb2Nlc3NlZFJlc3VsdHMubnVtSWdub3JlZE5vdGljZXMudG9Mb2NhbGVTdHJpbmcoKX1gLCBcIm51bUhpZGRlbkVycm9ycz1cIiArIHByb2Nlc3NlZFJlc3VsdHMubnVtSGlkZGVuRXJyb3JzLnRvTG9jYWxlU3RyaW5nKCksIFwibnVtSGlkZGVuV2FybmluZ3M9XCIgKyBwcm9jZXNzZWRSZXN1bHRzLm51bUhpZGRlbldhcm5pbmdzLnRvTG9jYWxlU3RyaW5nKCkpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGRlYnVnTG9nKFwiSGVyZSBub3cgaW4gcmVuZGVyaW5nIGJpdCFcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NlZFJlc3VsdHMuZXJyb3JMaXN0Lmxlbmd0aCB8fCBwcm9jZXNzZWRSZXN1bHRzLndhcm5pbmdMaXN0Lmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFJlc3VsdFZhbHVlKDw+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge3JlbmRlclN1bW1hcnkocHJvY2Vzc2VkUmVzdWx0cyl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPFJlbmRlclN1Y2Nlc3Nlc0Vycm9yc1dhcm5pbmdzIHJlc3VsdHM9e3Byb2Nlc3NlZFJlc3VsdHN9IC8+XG4gICAgICAgICAgICAgICAgICAgICAgICA8Lz4pO1xuICAgICAgICAgICAgICAgICAgICBlbHNlIC8vIG5vIGVycm9ycyBvciB3YXJuaW5nc1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0UmVzdWx0VmFsdWUoPD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7cmVuZGVyU3VtbWFyeShwcm9jZXNzZWRSZXN1bHRzKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8UmVuZGVyU3VjY2Vzc2VzRXJyb3JzV2FybmluZ3MgcmVzdWx0cz17cHJvY2Vzc2VkUmVzdWx0c30gLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvPik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaXNwbGF5VHlwZSA9PT0gJ1NldmVyZU1lZGl1bUxvdycpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkUmVzdWx0cyA9IHByb2Nlc3NOb3RpY2VzVG9TZXZlcmVNZWRpdW1Mb3cocmF3Q1JSZXN1bHRzLCBwcm9jZXNzT3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIHVzZXJMb2coYFJlcG9DaGVjayBnb3QgYmFjayBwcm9jZXNzZWRSZXN1bHRzIHdpdGggJHtwcm9jZXNzZWRSZXN1bHRzLnN1Y2Nlc3NMaXN0Lmxlbmd0aC50b0xvY2FsZVN0cmluZygpfSBzdWNjZXNzIG1lc3NhZ2UocyksICR7cHJvY2Vzc2VkUmVzdWx0cy5lcnJvckxpc3QubGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCl9IGVycm9yKHMpIGFuZCAke3Byb2Nlc3NlZFJlc3VsdHMud2FybmluZ0xpc3QubGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCl9IHdhcm5pbmcocylcbiAgICAgICAgICAgICAgICAgICAgLy8gICBudW1JZ25vcmVkTm90aWNlcz0ke3Byb2Nlc3NlZFJlc3VsdHMubnVtSWdub3JlZE5vdGljZXMudG9Mb2NhbGVTdHJpbmcoKX1gLCBcIm51bUhpZGRlbkVycm9ycz1cIiArIHByb2Nlc3NlZFJlc3VsdHMubnVtSGlkZGVuRXJyb3JzLnRvTG9jYWxlU3RyaW5nKCksIFwibnVtSGlkZGVuV2FybmluZ3M9XCIgKyBwcm9jZXNzZWRSZXN1bHRzLm51bUhpZGRlbldhcm5pbmdzLnRvTG9jYWxlU3RyaW5nKCkpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzZWRSZXN1bHRzLnNldmVyZUxpc3QubGVuZ3RoIHx8IHByb2Nlc3NlZFJlc3VsdHMubWVkaXVtTGlzdC5sZW5ndGggfHwgcHJvY2Vzc2VkUmVzdWx0cy5sb3dMaXN0Lmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFJlc3VsdFZhbHVlKDw+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge3JlbmRlclN1bW1hcnkocHJvY2Vzc2VkUmVzdWx0cyl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPFJlbmRlclN1Y2Nlc3Nlc1NldmVyZU1lZGl1bUxvdyByZXN1bHRzPXtwcm9jZXNzZWRSZXN1bHRzfSAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC8+KTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSAvLyBubyBzZXZlcmUsIG1lZGl1bSwgb3IgbG93IG5vdGljZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFJlc3VsdFZhbHVlKDw+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge3JlbmRlclN1bW1hcnkocHJvY2Vzc2VkUmVzdWx0cyl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPFJlbmRlclN1Y2Nlc3Nlc1NldmVyZU1lZGl1bUxvdyByZXN1bHRzPXtwcm9jZXNzZWRSZXN1bHRzfSAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC8+KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRpc3BsYXlUeXBlID09PSAnU2luZ2xlTGlzdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkUmVzdWx0cyA9IHByb2Nlc3NOb3RpY2VzVG9TaW5nbGVMaXN0KHJhd0NSUmVzdWx0cywgcHJvY2Vzc09wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICAvLyBkZWJ1Z0xvZyhgUmVwb0NoZWNrIGdvdCBiYWNrIHByb2Nlc3NlZFJlc3VsdHMgd2l0aCAke3Byb2Nlc3NlZFJlc3VsdHMuc3VjY2Vzc0xpc3QubGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCl9IHN1Y2Nlc3MgbWVzc2FnZShzKSBhbmQgJHtwcm9jZXNzZWRSZXN1bHRzLndhcm5pbmdMaXN0Lmxlbmd0aC50b0xvY2FsZVN0cmluZygpfSBub3RpY2UocylcbiAgICAgICAgICAgICAgICAgICAgLy8gICBudW1JZ25vcmVkTm90aWNlcz0ke3Byb2Nlc3NlZFJlc3VsdHMubnVtSWdub3JlZE5vdGljZXMudG9Mb2NhbGVTdHJpbmcoKX0gbnVtSGlkZGVuV2FybmluZ3M9JHtwcm9jZXNzZWRSZXN1bHRzLm51bUhpZGRlbldhcm5pbmdzLnRvTG9jYWxlU3RyaW5nKCl9YCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NlZFJlc3VsdHMud2FybmluZ0xpc3QubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0UmVzdWx0VmFsdWUoPD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7cmVuZGVyU3VtbWFyeShwcm9jZXNzZWRSZXN1bHRzKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8UmVuZGVyU3VjY2Vzc2VzTm90aWNlc0dyYWRpZW50IHJlc3VsdHM9e3Byb2Nlc3NlZFJlc3VsdHN9IC8+XG4gICAgICAgICAgICAgICAgICAgICAgICA8Lz4pO1xuICAgICAgICAgICAgICAgICAgICBlbHNlIC8vIG5vIHdhcm5pbmdzXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRSZXN1bHRWYWx1ZSg8PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtyZW5kZXJTdW1tYXJ5KHByb2Nlc3NlZFJlc3VsdHMpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxSZW5kZXJTdWNjZXNzZXNOb3RpY2VzR3JhZGllbnQgcmVzdWx0cz17cHJvY2Vzc2VkUmVzdWx0c30gLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvPik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHNldFJlc3VsdFZhbHVlKDxiIHN0eWxlPXt7IGNvbG9yOiAncmVkJyB9fT5JbnZhbGlkIGRpc3BsYXlUeXBlPSd7ZGlzcGxheVR5cGV9JzwvYj4pXG5cbiAgICAgICAgICAgICAgICAvLyBkZWJ1Z0xvZyhcIkZpbmlzaGVkIHJlbmRlcmluZyBiaXQuXCIpO1xuICAgICAgICAgICAgfSBjYXRjaCAocmNFcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFJlcG9DaGVjayBtYWluIGNvZGUgYmxvY2sgZ290IGVycm9yOiAke3JjRXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgICAgICAgICBzZXRSZXN1bHRWYWx1ZSg8PlxuICAgICAgICAgICAgICAgICAgICA8cCBzdHlsZT17eyBjb2xvcjogJ3JlZCcgfX0+UmVwb0NoZWNrIG1haW4gY29kZSBibG9jayBnb3QgZXJyb3I6IDxiPntyY0Vycm9yLm1lc3NhZ2V9PC9iPjwvcD5cbiAgICAgICAgICAgICAgICA8Lz4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSgpOyAvLyBlbmQgb2YgYXN5bmMgcGFydCBpbiB1bm5hbWVkRnVuY3Rpb25cbiAgICAgICAgLy8gRG9lc27igJl0IHdvcmsgaWYgd2UgYWRkIHRoaXMgdG8gbmV4dCBsaW5lOiBsYW5ndWFnZUNvZGUsdXNlcm5hbWUscmVwb05hbWUsYnJhbmNoLGNoZWNraW5nT3B0aW9ucyxwcm9wc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gICAgfSwgW10pOyAvLyBlbmQgb2YgdXNlRWZmZWN0IHBhcnRcblxuICAgIC8vIHsvKiA8ZGl2IGNsYXNzTmFtZT17Y2xhc3Nlcy5yb290fT4gKi99XG4gICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJGcmVkXCI+XG4gICAgICAgICAgICB7cmVzdWx0fVxuICAgICAgICA8L2Rpdj5cbiAgICApO1xufVxuXG4vLyBSZXBvQ2hlY2sucHJvcFR5cGVzID0ge1xuLy8gICAvKiogQGlnbm9yZSAqL1xuLy8gICB1c2VybmFtZTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuLy8gICAvKiogQGlnbm9yZSAqL1xuLy8gICBsYW5ndWFnZUNvZGU6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbi8vICAgcHJvcHM6IFByb3BUeXBlcy5vYmplY3QsXG4vLyB9O1xuXG5jb25zdCBzdHlsZXMgPSB0aGVtZSA9PiAoe1xuICAgIHJvb3Q6IHtcbiAgICB9LFxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IHdpdGhTdHlsZXMoc3R5bGVzKShSZXBvQ2hlY2spO1xuIl19