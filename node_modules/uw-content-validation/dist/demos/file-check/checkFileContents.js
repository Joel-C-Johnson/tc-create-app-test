"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");var _typeof = require("@babel/runtime/helpers/typeof");Object.defineProperty(exports, "__esModule", { value: true });exports.checkFileContents = checkFileContents;var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var books = _interopRequireWildcard(require("../../core/books/books"));
var _core = require("../../core");function _getRequireWildcardCache(nodeInterop) {if (typeof WeakMap !== "function") return null;var cacheBabelInterop = new WeakMap();var cacheNodeInterop = new WeakMap();return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {return nodeInterop ? cacheNodeInterop : cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj, nodeInterop) {if (!nodeInterop && obj && obj.__esModule) {return obj;}if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") {return { default: obj };}var cache = _getRequireWildcardCache(nodeInterop);if (cache && cache.has(obj)) {return cache.get(obj);}var newObj = {};var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;for (var key in obj) {if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;if (desc && (desc.get || desc.set)) {Object.defineProperty(newObj, key, desc);} else {newObj[key] = obj[key];}}}newObj.default = obj;if (cache) {cache.set(obj, newObj);}return newObj;}function ownKeys(object, enumerableOnly) {var keys = Object.keys(object);if (Object.getOwnPropertySymbols) {var symbols = Object.getOwnPropertySymbols(object);if (enumerableOnly) {symbols = symbols.filter(function (sym) {return Object.getOwnPropertyDescriptor(object, sym).enumerable;});}keys.push.apply(keys, symbols);}return keys;}function _objectSpread(target) {for (var i = 1; i < arguments.length; i++) {var source = arguments[i] != null ? arguments[i] : {};if (i % 2) {ownKeys(Object(source), true).forEach(function (key) {(0, _defineProperty2.default)(target, key, source[key]);});} else if (Object.getOwnPropertyDescriptors) {Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));} else {ownKeys(Object(source)).forEach(function (key) {Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));});}}return target;}










// const CHECK_FILE_CONTENTS_VERSION_STRING = '0.5.0';


/**
 *
 * @param {string} username for Door43.org
 * @param {string} languageCode, e.g., 'en'
 * @param {string} repoCode, e.g., 'LT', 'TN', 'TN2', 'TQ', 'TWL', etc.
 * @param {string} branch, e.g., 'master'
 * @param {string} filepath -- often just a filename
 * @param {string} fileContent
 * @param {string} givenLocation
 * @param {Object} checkingOptions
 */function
checkFileContents(_x, _x2, _x3, _x4, _x5, _x6, _x7, _x8) {return _checkFileContents.apply(this, arguments);}function _checkFileContents() {_checkFileContents = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(username, languageCode, repoCode, branch, filepath, fileContent, givenLocation, checkingOptions) {var startTime, ourCFLocation, filebits, filename, filenameLower, repoName, checkFileResult, filenameMain, bookID, checkFunction, _filenameMain, _bookID, _filenameMain2, _bookID2,






























































































    addFilenameField;return _regenerator.default.wrap(function _callee$(_context) {while (1) {switch (_context.prev = _context.next) {case 0:addFilenameField = function _addFilenameField(noticeObject) {
              if (noticeObject.debugChain) noticeObject.debugChain = "checkFileContents ".concat(noticeObject.debugChain);
              if (noticeObject.fieldName === filepath) delete noticeObject.fieldName;
              // TODO: Might we need to add username, repoName, or branch here ???
              return noticeObject.extra ? noticeObject : _objectSpread(_objectSpread({}, noticeObject), {}, { filename: filepath }); // NOTE: might be an indirect check on a TA or TW article
            }; // Determine the file type from the filename extension
            //  and return the results of checking that kind of file text
            // functionLog(`checkFileContents(un='${username}', lC='${languageCode}', rC='${repoCode}', rBr='${branch}', fn='${filepath}', ${fileContent.length} chars, ${givenLocation}, ${JSON.stringify(checkingOptions)})â€¦`);
            //parameterAssert(username !== undefined, "checkFileContents: 'username' parameter should be defined");
            //parameterAssert(typeof username === 'string', `checkFileContents: 'username' parameter should be a string not a '${typeof username}': ${username}`);
            //parameterAssert(languageCode !== undefined, "checkFileContents: 'languageCode' parameter should be defined");
            //parameterAssert(typeof languageCode === 'string', `checkFileContents: 'languageCode' parameter should be a string not a '${typeof languageCode}': ${languageCode}`);
            //parameterAssert(repoCode !== undefined, "checkFileContents: 'repoCode' parameter should be defined");
            //parameterAssert(typeof repoCode === 'string', `checkFileContents: 'repoCode' parameter should be a string not a '${typeof repoCode}': ${repoCode}`);
            //parameterAssert(REPO_CODES_LIST.includes(repoCode), `checkFileContents: 'repoCode' parameter should not be '${repoCode}'`);
            //parameterAssert(branch !== undefined, "checkFileContents: 'branch' parameter should be defined");
            //parameterAssert(typeof branch === 'string', `checkFileContents: 'branch' parameter should be a string not a '${typeof branch}': ${branch}`);
            //parameterAssert(filepath !== undefined, "checkFileContents: 'filepath' parameter should be defined");
            //parameterAssert(typeof filepath === 'string', `checkFileContents: 'filepath' parameter should be a string not a '${typeof filepath}': ${filepath}`);
            //parameterAssert(fileContent !== undefined, "checkFileContents: 'fileContent' parameter should be defined");
            //parameterAssert(typeof fileContent === 'string', `checkFileContents: 'fileContent' parameter should be a string not a '${typeof fileContent}': ${fileContent.length}`);
            //parameterAssert(givenLocation !== undefined, "checkFileContents: 'givenLocation' parameter should be defined");
            //parameterAssert(typeof givenLocation === 'string', `checkFileContents: 'givenLocation' parameter should be a string not a '${typeof givenLocation}': ${givenLocation}`);
            //parameterAssert(checkingOptions !== undefined, "checkFileContents: 'checkingOptions' parameter should be defined");
            startTime = new Date();ourCFLocation = givenLocation;if (ourCFLocation[0] !== ' ') ourCFLocation = ' ' + ourCFLocation;filebits = filepath.split('/');filename = filebits[filebits.length - 1]; // debugLog(`checkFileContents from filepath='${filepath}' got (${filebits.length}) ${filebits} and then '${filename}'`);
            filenameLower = filename.toLowerCase();repoName = (0, _core.formRepoName)(languageCode, repoCode);checkFileResult = { checkedFileCount: 0 };if (!filenameLower.endsWith('.tsv')) {_context.next = 26;break;}filenameMain = filepath.substring(0, filepath.length - 4); // drop .tsv
            // functionLog(`checkFileContents have TSV filenameMain=${filenameMain}`);
            bookID = filenameMain.startsWith("".concat(languageCode, "_")) || filenameMain.startsWith('en_') ? filenameMain.substring(filenameMain.length - 3) : filenameMain.substring(filenameMain.length - 3, filenameMain.length).toUpperCase(); // functionLog(`checkFileContents have TSV bookID=${bookID}`);
            //parameterAssert(bookID === 'OBS' || books.isValidBookID(bookID), `checkFileContents: '${bookID}' is not a valid USFM book identifier`);
            if (!(filepath.startsWith("".concat(languageCode, "_")) || filenameMain.startsWith('en_'))) {_context.next = 19;break;}(0, _core.logicAssert)(repoCode === 'TN', "These filenames ".concat(filenameMain, " are only for TN ").concat(repoCode));_context.next = 16;return (0, _core.checkTN_TSV9Table)(languageCode, repoCode, bookID, filepath, fileContent, ourCFLocation, checkingOptions);case 16:checkFileResult = _context.sent;_context.next = 24;break;case 19: // let adjustedRepoCode = repoCode;
            // if (adjustedRepoCode.startsWith('OBS-'))
            //   adjustedRepoCode = adjustedRepoCode.substring(4); // Remove the 'OBS-' from the beginning
            (0, _core.logicAssert)(repoCode !== 'TN' && repoCode !== 'TQ' && repoCode !== 'OBS-TN' && repoCode !== 'OBS-TQ' && repoCode !== 'OBS_SN' && repoCode !== 'OBS-SQ', "This code with ".concat(filenameMain, " is not for ").concat(repoCode));checkFunction = { 'TWL': _core.checkTWL_TSV6Table, 'OBS-TWL': _core.checkTWL_TSV6Table, 'TN2': _core.checkNotesTSV7Table, 'OBS-TN2': _core.checkNotesTSV7Table, 'TQ2': _core.checkQuestionsTSV7Table, 'OBS-TQ2': _core.checkQuestionsTSV7Table, 'SN': _core.checkNotesTSV7Table, 'OBS-SN2': _core.checkNotesTSV7Table, 'SQ': _core.checkQuestionsTSV7Table, 'OBS-SQ2': _core.checkQuestionsTSV7Table }[repoCode]; // debugLog(`checkFileContents() got ${checkFunction} function for ${repoCode}`);
            _context.next = 23;return checkFunction(languageCode, repoCode, bookID, filepath, fileContent, ourCFLocation, checkingOptions);case 23:checkFileResult = _context.sent;case 24:_context.next = 79;break;case 26:if (!filenameLower.endsWith('.usfm')) {_context.next = 34;break;}_filenameMain = filepath.substring(0, filepath.length - 5); // drop .usfm
            // debugLog(`Have USFM filenameMain=${filenameMain}`);
            _bookID = _filenameMain.substring(_filenameMain.length - 3); // debugLog(`Have USFM bookcode=${bookID}`);
            //parameterAssert(books.isValidBookID(bookID), `checkFileContents: '${bookID}' is not a valid USFM book identifier`);
            _context.next = 31;return (0, _core.checkUSFMText)(languageCode, repoCode, _bookID, filepath, fileContent, ourCFLocation, checkingOptions);case 31:checkFileResult = _context.sent;_context.next = 79;break;case 34:if (!filenameLower.endsWith('.sfm')) {_context.next = 44;break;}_filenameMain2 = filepath.substring(0, filepath.length - 4); // drop .sfm
            (0, _core.userLog)("checkFileContents have SFM filenameMain=".concat(_filenameMain2));_bookID2 = _filenameMain2.substring(2, 5);(0, _core.userLog)("checkFileContents have SFM bookcode=".concat(_bookID2)); //parameterAssert(books.isValidBookID(bookID), `checkFileContents: '${bookID}' is not a valid USFM book identifier`);
            _context.next = 41;return (0, _core.checkUSFMText)(languageCode, repoCode, _bookID2, filepath, fileContent, ourCFLocation, checkingOptions);case 41:checkFileResult = _context.sent;_context.next = 79;break;case 44:if (!filenameLower.endsWith('.md')) {_context.next = 56;break;}if (!(repoCode === 'UHAL' && filename[0] === 'H' && filename.length === 8 || repoCode === 'UGL' && filename === '01.md')) {_context.next = 51;break;}_context.next = 48;return (0, _core.checkLexiconFileContents)(languageCode, repoCode, filepath, fileContent, ourCFLocation, checkingOptions);case 48:checkFileResult = _context.sent;_context.next = 54;break;case 51:_context.next = 53;return (0, _core.checkMarkdownFileContents)(languageCode, repoCode, filepath, fileContent, ourCFLocation, checkingOptions);case 53:checkFileResult = _context.sent;case 54:_context.next = 79;break;case 56:if (!filenameLower.endsWith('.txt')) {_context.next = 60;break;}checkFileResult = (0, _core.checkPlainText)(languageCode, repoCode, 'text', filepath, fileContent, ourCFLocation, checkingOptions);_context.next = 79;break;case 60:if (!(filenameLower === 'manifest.yaml')) {_context.next = 66;break;}_context.next = 63;return (0, _core.checkManifestText)(languageCode, repoCode, username, repoName, branch, fileContent, ourCFLocation, checkingOptions);case 63:checkFileResult = _context.sent;_context.next = 79;break;case 66:if (!filenameLower.endsWith('.yaml')) {_context.next = 70;break;}checkFileResult = (0, _core.checkYAMLText)(languageCode, repoCode, filepath, fileContent, ourCFLocation, checkingOptions);_context.next = 79;break;case 70:if (!filenameLower.startsWith('license')) {_context.next = 77;break;}_context.next = 73;return (0, _core.checkMarkdownFileContents)(languageCode, repoCode, filepath, fileContent, ourCFLocation, checkingOptions);case 73:checkFileResult = _context.sent;checkFileResult.noticeList.unshift({ priority: 982, message: "File extension is not recognized, so treated as markdown.", filename: filepath, location: ourCFLocation });_context.next = 79;break;case 77:checkFileResult = (0, _core.checkPlainText)(languageCode, repoCode, 'raw', filepath, fileContent, ourCFLocation, checkingOptions);checkFileResult.noticeList.unshift({ priority: 995, message: "File extension is not recognized, so treated as plain text.", filename: filepath, location: ourCFLocation });case 79:checkFileResult.noticeList = checkFileResult.noticeList.map(addFilenameField); // Add some extra fields to our checkFileResult object
            //  in case we need this information again later
            checkFileResult.checkedFileCount += 1;checkFileResult.checkedFilename = filepath;checkFileResult.checkedFilesize = fileContent.length;checkFileResult.checkedOptions = checkingOptions;checkFileResult.elapsedSeconds = (new Date() - startTime) / 1000; // seconds
            // debugLog(`checkFileContents() returning ${JSON.stringify(checkFileResult)}`);
            return _context.abrupt("return", checkFileResult);case 86:case "end":return _context.stop();}}}, _callee);}));return _checkFileContents.apply(this, arguments);}; // end of checkFileContents()
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kZW1vcy9maWxlLWNoZWNrL2NoZWNrRmlsZUNvbnRlbnRzLmpzIl0sIm5hbWVzIjpbImNoZWNrRmlsZUNvbnRlbnRzIiwidXNlcm5hbWUiLCJsYW5ndWFnZUNvZGUiLCJyZXBvQ29kZSIsImJyYW5jaCIsImZpbGVwYXRoIiwiZmlsZUNvbnRlbnQiLCJnaXZlbkxvY2F0aW9uIiwiY2hlY2tpbmdPcHRpb25zIiwiYWRkRmlsZW5hbWVGaWVsZCIsIm5vdGljZU9iamVjdCIsImRlYnVnQ2hhaW4iLCJmaWVsZE5hbWUiLCJleHRyYSIsImZpbGVuYW1lIiwic3RhcnRUaW1lIiwiRGF0ZSIsIm91ckNGTG9jYXRpb24iLCJmaWxlYml0cyIsInNwbGl0IiwibGVuZ3RoIiwiZmlsZW5hbWVMb3dlciIsInRvTG93ZXJDYXNlIiwicmVwb05hbWUiLCJjaGVja0ZpbGVSZXN1bHQiLCJjaGVja2VkRmlsZUNvdW50IiwiZW5kc1dpdGgiLCJmaWxlbmFtZU1haW4iLCJzdWJzdHJpbmciLCJib29rSUQiLCJzdGFydHNXaXRoIiwidG9VcHBlckNhc2UiLCJjaGVja0Z1bmN0aW9uIiwiY2hlY2tUV0xfVFNWNlRhYmxlIiwiY2hlY2tOb3Rlc1RTVjdUYWJsZSIsImNoZWNrUXVlc3Rpb25zVFNWN1RhYmxlIiwibm90aWNlTGlzdCIsInVuc2hpZnQiLCJwcmlvcml0eSIsIm1lc3NhZ2UiLCJsb2NhdGlvbiIsIm1hcCIsImNoZWNrZWRGaWxlbmFtZSIsImNoZWNrZWRGaWxlc2l6ZSIsImNoZWNrZWRPcHRpb25zIiwiZWxhcHNlZFNlY29uZHMiXSwibWFwcGluZ3MiOiI7QUFDQTtBQUNBLGtDOzs7Ozs7Ozs7OztBQVdBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEc7QUFDc0JBLGlCLHVOQUFmLGlCQUFpQ0MsUUFBakMsRUFBMkNDLFlBQTNDLEVBQXlEQyxRQUF6RCxFQUFtRUMsTUFBbkUsRUFBMkVDLFFBQTNFLEVBQXFGQyxXQUFyRixFQUFrR0MsYUFBbEcsRUFBaUhDLGVBQWpIOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQStGSUMsSUFBQUEsZ0JBL0ZKLHlIQStGSUEsZ0JBL0ZKLDhCQStGcUJDLFlBL0ZyQixFQStGbUM7QUFDdEMsa0JBQUlBLFlBQVksQ0FBQ0MsVUFBakIsRUFBNkJELFlBQVksQ0FBQ0MsVUFBYiwrQkFBK0NELFlBQVksQ0FBQ0MsVUFBNUQ7QUFDN0Isa0JBQUlELFlBQVksQ0FBQ0UsU0FBYixLQUEyQlAsUUFBL0IsRUFBeUMsT0FBT0ssWUFBWSxDQUFDRSxTQUFwQjtBQUN6QztBQUNBLHFCQUFPRixZQUFZLENBQUNHLEtBQWIsR0FBcUJILFlBQXJCLG1DQUF5Q0EsWUFBekMsU0FBdURJLFFBQVEsRUFBRVQsUUFBakUsR0FBUCxDQUpzQyxDQUk4QztBQUNyRixhQXBHSSxFQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRU1VLFlBQUFBLFNBckJELEdBcUJhLElBQUlDLElBQUosRUFyQmIsQ0F1QkRDLGFBdkJDLEdBdUJlVixhQXZCZixDQXdCTCxJQUFJVSxhQUFhLENBQUMsQ0FBRCxDQUFiLEtBQXFCLEdBQXpCLEVBQThCQSxhQUFhLEdBQUcsTUFBTUEsYUFBdEIsQ0FFeEJDLFFBMUJELEdBMEJZYixRQUFRLENBQUNjLEtBQVQsQ0FBZSxHQUFmLENBMUJaLENBMkJDTCxRQTNCRCxHQTJCWUksUUFBUSxDQUFDQSxRQUFRLENBQUNFLE1BQVQsR0FBZ0IsQ0FBakIsQ0EzQnBCLEVBNEJMO0FBQ01DLFlBQUFBLGFBN0JELEdBNkJpQlAsUUFBUSxDQUFDUSxXQUFULEVBN0JqQixDQThCQ0MsUUE5QkQsR0E4Qlksd0JBQWFyQixZQUFiLEVBQTJCQyxRQUEzQixDQTlCWixDQWdDRHFCLGVBaENDLEdBZ0NpQixFQUFFQyxnQkFBZ0IsRUFBRSxDQUFwQixFQWhDakIsTUFpQ0RKLGFBQWEsQ0FBQ0ssUUFBZCxDQUF1QixNQUF2QixDQWpDQyw2QkFrQ0dDLFlBbENILEdBa0NrQnRCLFFBQVEsQ0FBQ3VCLFNBQVQsQ0FBbUIsQ0FBbkIsRUFBc0J2QixRQUFRLENBQUNlLE1BQVQsR0FBa0IsQ0FBeEMsQ0FsQ2xCLEVBa0M4RDtBQUNqRTtBQUNNUyxZQUFBQSxNQXBDSCxHQW9DWUYsWUFBWSxDQUFDRyxVQUFiLFdBQTJCNUIsWUFBM0IsV0FBK0N5QixZQUFZLENBQUNHLFVBQWIsQ0FBd0IsS0FBeEIsQ0FBL0MsR0FBZ0ZILFlBQVksQ0FBQ0MsU0FBYixDQUF1QkQsWUFBWSxDQUFDUCxNQUFiLEdBQXNCLENBQTdDLENBQWhGLEdBQWtJTyxZQUFZLENBQUNDLFNBQWIsQ0FBdUJELFlBQVksQ0FBQ1AsTUFBYixHQUFzQixDQUE3QyxFQUFnRE8sWUFBWSxDQUFDUCxNQUE3RCxFQUFxRVcsV0FBckUsRUFwQzlJLEVBcUNIO0FBQ0E7QUF0Q0csa0JBdUNDMUIsUUFBUSxDQUFDeUIsVUFBVCxXQUF1QjVCLFlBQXZCLFdBQTJDeUIsWUFBWSxDQUFDRyxVQUFiLENBQXdCLEtBQXhCLENBdkM1Qyw4QkF3Q0QsdUJBQVkzQixRQUFRLEtBQUssSUFBekIsNEJBQWtEd0IsWUFBbEQsOEJBQWtGeEIsUUFBbEYsR0F4Q0MsMEJBeUN1Qiw2QkFBa0JELFlBQWxCLEVBQWdDQyxRQUFoQyxFQUEwQzBCLE1BQTFDLEVBQWtEeEIsUUFBbEQsRUFBNERDLFdBQTVELEVBQXlFVyxhQUF6RSxFQUF3RlQsZUFBeEYsQ0F6Q3ZCLFNBeUNEZ0IsZUF6Q0MsbURBMkNEO0FBQ0E7QUFDQTtBQUNBLG1DQUFZckIsUUFBUSxLQUFLLElBQWIsSUFBcUJBLFFBQVEsS0FBSyxJQUFsQyxJQUEwQ0EsUUFBUSxLQUFLLFFBQXZELElBQW1FQSxRQUFRLEtBQUssUUFBaEYsSUFBNEZBLFFBQVEsS0FBSyxRQUF6RyxJQUFxSEEsUUFBUSxLQUFLLFFBQTlJLDJCQUEwS3dCLFlBQTFLLHlCQUFxTXhCLFFBQXJNLEdBQ002QixhQS9DTCxHQStDcUIsRUFDcEIsT0FBT0Msd0JBRGEsRUFDTyxXQUFXQSx3QkFEbEIsRUFFcEIsT0FBT0MseUJBRmEsRUFFUSxXQUFXQSx5QkFGbkIsRUFHcEIsT0FBT0MsNkJBSGEsRUFHWSxXQUFXQSw2QkFIdkIsRUFJcEIsTUFBTUQseUJBSmMsRUFJTyxXQUFXQSx5QkFKbEIsRUFLcEIsTUFBTUMsNkJBTGMsRUFLVyxXQUFXQSw2QkFMdEIsR0FNcEJoQyxRQU5vQixDQS9DckIsRUFzREQ7QUF0REMsc0NBdUR1QjZCLGFBQWEsQ0FBQzlCLFlBQUQsRUFBZUMsUUFBZixFQUF5QjBCLE1BQXpCLEVBQWlDeEIsUUFBakMsRUFBMkNDLFdBQTNDLEVBQXdEVyxhQUF4RCxFQUF1RVQsZUFBdkUsQ0F2RHBDLFNBdUREZ0IsZUF2REMsK0RBMERJSCxhQUFhLENBQUNLLFFBQWQsQ0FBdUIsT0FBdkIsQ0ExREosNkJBMkRHQyxhQTNESCxHQTJEa0J0QixRQUFRLENBQUN1QixTQUFULENBQW1CLENBQW5CLEVBQXNCdkIsUUFBUSxDQUFDZSxNQUFULEdBQWtCLENBQXhDLENBM0RsQixFQTJEOEQ7QUFDakU7QUFDTVMsWUFBQUEsT0E3REgsR0E2RFlGLGFBQVksQ0FBQ0MsU0FBYixDQUF1QkQsYUFBWSxDQUFDUCxNQUFiLEdBQXNCLENBQTdDLENBN0RaLEVBOERIO0FBQ0E7QUEvREcsc0NBZ0VxQix5QkFBY2xCLFlBQWQsRUFBNEJDLFFBQTVCLEVBQXNDMEIsT0FBdEMsRUFBOEN4QixRQUE5QyxFQUF3REMsV0FBeEQsRUFBcUVXLGFBQXJFLEVBQW9GVCxlQUFwRixDQWhFckIsU0FnRUhnQixlQWhFRyx1REFpRU1ILGFBQWEsQ0FBQ0ssUUFBZCxDQUF1QixNQUF2QixDQWpFTiw2QkFrRUdDLGNBbEVILEdBa0VrQnRCLFFBQVEsQ0FBQ3VCLFNBQVQsQ0FBbUIsQ0FBbkIsRUFBc0J2QixRQUFRLENBQUNlLE1BQVQsR0FBa0IsQ0FBeEMsQ0FsRWxCLEVBa0U4RDtBQUNqRSxpRkFBbURPLGNBQW5ELEdBQ01FLFFBcEVILEdBb0VZRixjQUFZLENBQUNDLFNBQWIsQ0FBdUIsQ0FBdkIsRUFBMEIsQ0FBMUIsQ0FwRVosQ0FxRUgsaUVBQStDQyxRQUEvQyxHQXJFRyxDQXNFSDtBQXRFRyxzQ0F1RXFCLHlCQUFjM0IsWUFBZCxFQUE0QkMsUUFBNUIsRUFBc0MwQixRQUF0QyxFQUE4Q3hCLFFBQTlDLEVBQXdEQyxXQUF4RCxFQUFxRVcsYUFBckUsRUFBb0ZULGVBQXBGLENBdkVyQixTQXVFSGdCLGVBdkVHLHVEQXdFTUgsYUFBYSxDQUFDSyxRQUFkLENBQXVCLEtBQXZCLENBeEVOLG1DQXlFRXZCLFFBQVEsS0FBSyxNQUFiLElBQXVCVyxRQUFRLENBQUMsQ0FBRCxDQUFSLEtBQWdCLEdBQXZDLElBQThDQSxRQUFRLENBQUNNLE1BQVQsS0FBb0IsQ0FBbkUsSUFDRWpCLFFBQVEsS0FBSyxLQUFiLElBQXNCVyxRQUFRLEtBQUssT0ExRXRDLHdEQTJFdUIsb0NBQXlCWixZQUF6QixFQUF1Q0MsUUFBdkMsRUFBaURFLFFBQWpELEVBQTJEQyxXQUEzRCxFQUF3RVcsYUFBeEUsRUFBdUZULGVBQXZGLENBM0V2QixTQTJFRGdCLGVBM0VDLDRFQTZFdUIscUNBQTBCdEIsWUFBMUIsRUFBd0NDLFFBQXhDLEVBQWtERSxRQUFsRCxFQUE0REMsV0FBNUQsRUFBeUVXLGFBQXpFLEVBQXdGVCxlQUF4RixDQTdFdkIsU0E2RURnQixlQTdFQywrREE4RUlILGFBQWEsQ0FBQ0ssUUFBZCxDQUF1QixNQUF2QixDQTlFSiw2QkErRUhGLGVBQWUsR0FBRywwQkFBZXRCLFlBQWYsRUFBNkJDLFFBQTdCLEVBQXVDLE1BQXZDLEVBQStDRSxRQUEvQyxFQUF5REMsV0FBekQsRUFBc0VXLGFBQXRFLEVBQXFGVCxlQUFyRixDQUFsQixDQS9FRyx1Q0FnRklhLGFBQWEsS0FBSyxlQWhGdEIsd0RBaUZxQiw2QkFBa0JuQixZQUFsQixFQUFnQ0MsUUFBaEMsRUFBMENGLFFBQTFDLEVBQW9Ec0IsUUFBcEQsRUFBOERuQixNQUE5RCxFQUFzRUUsV0FBdEUsRUFBbUZXLGFBQW5GLEVBQWtHVCxlQUFsRyxDQWpGckIsU0FpRkhnQixlQWpGRyx1REFrRklILGFBQWEsQ0FBQ0ssUUFBZCxDQUF1QixPQUF2QixDQWxGSiw2QkFtRkhGLGVBQWUsR0FBRyx5QkFBY3RCLFlBQWQsRUFBNEJDLFFBQTVCLEVBQXNDRSxRQUF0QyxFQUFnREMsV0FBaEQsRUFBNkRXLGFBQTdELEVBQTRFVCxlQUE1RSxDQUFsQixDQW5GRyxzQ0FvRklhLGFBQWEsQ0FBQ1MsVUFBZCxDQUF5QixTQUF6QixDQXBGSix1REFxRnFCLHFDQUEwQjVCLFlBQTFCLEVBQXdDQyxRQUF4QyxFQUFrREUsUUFBbEQsRUFBNERDLFdBQTVELEVBQXlFVyxhQUF6RSxFQUF3RlQsZUFBeEYsQ0FyRnJCLFNBcUZIZ0IsZUFyRkcsaUJBc0ZIQSxlQUFlLENBQUNZLFVBQWhCLENBQTJCQyxPQUEzQixDQUFtQyxFQUFFQyxRQUFRLEVBQUUsR0FBWixFQUFpQkMsT0FBTyxFQUFFLDJEQUExQixFQUF1RnpCLFFBQVEsRUFBRVQsUUFBakcsRUFBMkdtQyxRQUFRLEVBQUV2QixhQUFySCxFQUFuQyxFQXRGRyxpQ0F3RkhPLGVBQWUsR0FBRywwQkFBZXRCLFlBQWYsRUFBNkJDLFFBQTdCLEVBQXVDLEtBQXZDLEVBQThDRSxRQUE5QyxFQUF3REMsV0FBeEQsRUFBcUVXLGFBQXJFLEVBQW9GVCxlQUFwRixDQUFsQixDQUNBZ0IsZUFBZSxDQUFDWSxVQUFoQixDQUEyQkMsT0FBM0IsQ0FBbUMsRUFBRUMsUUFBUSxFQUFFLEdBQVosRUFBaUJDLE9BQU8sRUFBRSw2REFBMUIsRUFBeUZ6QixRQUFRLEVBQUVULFFBQW5HLEVBQTZHbUMsUUFBUSxFQUFFdkIsYUFBdkgsRUFBbkMsRUF6RkcsUUFxR0xPLGVBQWUsQ0FBQ1ksVUFBaEIsR0FBNkJaLGVBQWUsQ0FBQ1ksVUFBaEIsQ0FBMkJLLEdBQTNCLENBQStCaEMsZ0JBQS9CLENBQTdCLENBckdLLENBdUdMO0FBQ0E7QUFDQWUsWUFBQUEsZUFBZSxDQUFDQyxnQkFBaEIsSUFBb0MsQ0FBcEMsQ0FDQUQsZUFBZSxDQUFDa0IsZUFBaEIsR0FBa0NyQyxRQUFsQyxDQUNBbUIsZUFBZSxDQUFDbUIsZUFBaEIsR0FBa0NyQyxXQUFXLENBQUNjLE1BQTlDLENBQ0FJLGVBQWUsQ0FBQ29CLGNBQWhCLEdBQWlDcEMsZUFBakMsQ0FFQWdCLGVBQWUsQ0FBQ3FCLGNBQWhCLEdBQWlDLENBQUMsSUFBSTdCLElBQUosS0FBYUQsU0FBZCxJQUEyQixJQUE1RCxDQTlHSyxDQThHNkQ7QUFDbEU7QUEvR0ssNkNBZ0hFUyxlQWhIRiwyRCxxREFpSE4sQyxDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG5pbXBvcnQgKiBhcyBib29rcyBmcm9tICcuLi8uLi9jb3JlL2Jvb2tzL2Jvb2tzJztcbmltcG9ydCB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICBSRVBPX0NPREVTX0xJU1QsXG4gIGZvcm1SZXBvTmFtZSxcbiAgY2hlY2tVU0ZNVGV4dCwgY2hlY2tNYXJrZG93bkZpbGVDb250ZW50cywgY2hlY2tMZXhpY29uRmlsZUNvbnRlbnRzLCBjaGVja1BsYWluVGV4dCwgY2hlY2tZQU1MVGV4dCwgY2hlY2tNYW5pZmVzdFRleHQsXG4gIGNoZWNrVE5fVFNWOVRhYmxlLCBjaGVja05vdGVzVFNWN1RhYmxlLCBjaGVja1F1ZXN0aW9uc1RTVjdUYWJsZSwgY2hlY2tUV0xfVFNWNlRhYmxlLFxufSBmcm9tICcuLi8uLi9jb3JlJztcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuaW1wb3J0IHsgdXNlckxvZywgZGVidWdMb2csIGZ1bmN0aW9uTG9nLCBwYXJhbWV0ZXJBc3NlcnQsIGxvZ2ljQXNzZXJ0IH0gZnJvbSAnLi4vLi4vY29yZSc7XG5cblxuLy8gY29uc3QgQ0hFQ0tfRklMRV9DT05URU5UU19WRVJTSU9OX1NUUklORyA9ICcwLjUuMCc7XG5cblxuLyoqXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVzZXJuYW1lIGZvciBEb29yNDMub3JnXG4gKiBAcGFyYW0ge3N0cmluZ30gbGFuZ3VhZ2VDb2RlLCBlLmcuLCAnZW4nXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVwb0NvZGUsIGUuZy4sICdMVCcsICdUTicsICdUTjInLCAnVFEnLCAnVFdMJywgZXRjLlxuICogQHBhcmFtIHtzdHJpbmd9IGJyYW5jaCwgZS5nLiwgJ21hc3RlcidcbiAqIEBwYXJhbSB7c3RyaW5nfSBmaWxlcGF0aCAtLSBvZnRlbiBqdXN0IGEgZmlsZW5hbWVcbiAqIEBwYXJhbSB7c3RyaW5nfSBmaWxlQ29udGVudFxuICogQHBhcmFtIHtzdHJpbmd9IGdpdmVuTG9jYXRpb25cbiAqIEBwYXJhbSB7T2JqZWN0fSBjaGVja2luZ09wdGlvbnNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrRmlsZUNvbnRlbnRzKHVzZXJuYW1lLCBsYW5ndWFnZUNvZGUsIHJlcG9Db2RlLCBicmFuY2gsIGZpbGVwYXRoLCBmaWxlQ29udGVudCwgZ2l2ZW5Mb2NhdGlvbiwgY2hlY2tpbmdPcHRpb25zKSB7XG4gIC8vIERldGVybWluZSB0aGUgZmlsZSB0eXBlIGZyb20gdGhlIGZpbGVuYW1lIGV4dGVuc2lvblxuICAvLyAgYW5kIHJldHVybiB0aGUgcmVzdWx0cyBvZiBjaGVja2luZyB0aGF0IGtpbmQgb2YgZmlsZSB0ZXh0XG4gIC8vIGZ1bmN0aW9uTG9nKGBjaGVja0ZpbGVDb250ZW50cyh1bj0nJHt1c2VybmFtZX0nLCBsQz0nJHtsYW5ndWFnZUNvZGV9JywgckM9JyR7cmVwb0NvZGV9JywgckJyPScke2JyYW5jaH0nLCBmbj0nJHtmaWxlcGF0aH0nLCAke2ZpbGVDb250ZW50Lmxlbmd0aH0gY2hhcnMsICR7Z2l2ZW5Mb2NhdGlvbn0sICR7SlNPTi5zdHJpbmdpZnkoY2hlY2tpbmdPcHRpb25zKX0p4oCmYCk7XG4gIC8vcGFyYW1ldGVyQXNzZXJ0KHVzZXJuYW1lICE9PSB1bmRlZmluZWQsIFwiY2hlY2tGaWxlQ29udGVudHM6ICd1c2VybmFtZScgcGFyYW1ldGVyIHNob3VsZCBiZSBkZWZpbmVkXCIpO1xuICAvL3BhcmFtZXRlckFzc2VydCh0eXBlb2YgdXNlcm5hbWUgPT09ICdzdHJpbmcnLCBgY2hlY2tGaWxlQ29udGVudHM6ICd1c2VybmFtZScgcGFyYW1ldGVyIHNob3VsZCBiZSBhIHN0cmluZyBub3QgYSAnJHt0eXBlb2YgdXNlcm5hbWV9JzogJHt1c2VybmFtZX1gKTtcbiAgLy9wYXJhbWV0ZXJBc3NlcnQobGFuZ3VhZ2VDb2RlICE9PSB1bmRlZmluZWQsIFwiY2hlY2tGaWxlQ29udGVudHM6ICdsYW5ndWFnZUNvZGUnIHBhcmFtZXRlciBzaG91bGQgYmUgZGVmaW5lZFwiKTtcbiAgLy9wYXJhbWV0ZXJBc3NlcnQodHlwZW9mIGxhbmd1YWdlQ29kZSA9PT0gJ3N0cmluZycsIGBjaGVja0ZpbGVDb250ZW50czogJ2xhbmd1YWdlQ29kZScgcGFyYW1ldGVyIHNob3VsZCBiZSBhIHN0cmluZyBub3QgYSAnJHt0eXBlb2YgbGFuZ3VhZ2VDb2RlfSc6ICR7bGFuZ3VhZ2VDb2RlfWApO1xuICAvL3BhcmFtZXRlckFzc2VydChyZXBvQ29kZSAhPT0gdW5kZWZpbmVkLCBcImNoZWNrRmlsZUNvbnRlbnRzOiAncmVwb0NvZGUnIHBhcmFtZXRlciBzaG91bGQgYmUgZGVmaW5lZFwiKTtcbiAgLy9wYXJhbWV0ZXJBc3NlcnQodHlwZW9mIHJlcG9Db2RlID09PSAnc3RyaW5nJywgYGNoZWNrRmlsZUNvbnRlbnRzOiAncmVwb0NvZGUnIHBhcmFtZXRlciBzaG91bGQgYmUgYSBzdHJpbmcgbm90IGEgJyR7dHlwZW9mIHJlcG9Db2RlfSc6ICR7cmVwb0NvZGV9YCk7XG4gIC8vcGFyYW1ldGVyQXNzZXJ0KFJFUE9fQ09ERVNfTElTVC5pbmNsdWRlcyhyZXBvQ29kZSksIGBjaGVja0ZpbGVDb250ZW50czogJ3JlcG9Db2RlJyBwYXJhbWV0ZXIgc2hvdWxkIG5vdCBiZSAnJHtyZXBvQ29kZX0nYCk7XG4gIC8vcGFyYW1ldGVyQXNzZXJ0KGJyYW5jaCAhPT0gdW5kZWZpbmVkLCBcImNoZWNrRmlsZUNvbnRlbnRzOiAnYnJhbmNoJyBwYXJhbWV0ZXIgc2hvdWxkIGJlIGRlZmluZWRcIik7XG4gIC8vcGFyYW1ldGVyQXNzZXJ0KHR5cGVvZiBicmFuY2ggPT09ICdzdHJpbmcnLCBgY2hlY2tGaWxlQ29udGVudHM6ICdicmFuY2gnIHBhcmFtZXRlciBzaG91bGQgYmUgYSBzdHJpbmcgbm90IGEgJyR7dHlwZW9mIGJyYW5jaH0nOiAke2JyYW5jaH1gKTtcbiAgLy9wYXJhbWV0ZXJBc3NlcnQoZmlsZXBhdGggIT09IHVuZGVmaW5lZCwgXCJjaGVja0ZpbGVDb250ZW50czogJ2ZpbGVwYXRoJyBwYXJhbWV0ZXIgc2hvdWxkIGJlIGRlZmluZWRcIik7XG4gIC8vcGFyYW1ldGVyQXNzZXJ0KHR5cGVvZiBmaWxlcGF0aCA9PT0gJ3N0cmluZycsIGBjaGVja0ZpbGVDb250ZW50czogJ2ZpbGVwYXRoJyBwYXJhbWV0ZXIgc2hvdWxkIGJlIGEgc3RyaW5nIG5vdCBhICcke3R5cGVvZiBmaWxlcGF0aH0nOiAke2ZpbGVwYXRofWApO1xuICAvL3BhcmFtZXRlckFzc2VydChmaWxlQ29udGVudCAhPT0gdW5kZWZpbmVkLCBcImNoZWNrRmlsZUNvbnRlbnRzOiAnZmlsZUNvbnRlbnQnIHBhcmFtZXRlciBzaG91bGQgYmUgZGVmaW5lZFwiKTtcbiAgLy9wYXJhbWV0ZXJBc3NlcnQodHlwZW9mIGZpbGVDb250ZW50ID09PSAnc3RyaW5nJywgYGNoZWNrRmlsZUNvbnRlbnRzOiAnZmlsZUNvbnRlbnQnIHBhcmFtZXRlciBzaG91bGQgYmUgYSBzdHJpbmcgbm90IGEgJyR7dHlwZW9mIGZpbGVDb250ZW50fSc6ICR7ZmlsZUNvbnRlbnQubGVuZ3RofWApO1xuICAvL3BhcmFtZXRlckFzc2VydChnaXZlbkxvY2F0aW9uICE9PSB1bmRlZmluZWQsIFwiY2hlY2tGaWxlQ29udGVudHM6ICdnaXZlbkxvY2F0aW9uJyBwYXJhbWV0ZXIgc2hvdWxkIGJlIGRlZmluZWRcIik7XG4gIC8vcGFyYW1ldGVyQXNzZXJ0KHR5cGVvZiBnaXZlbkxvY2F0aW9uID09PSAnc3RyaW5nJywgYGNoZWNrRmlsZUNvbnRlbnRzOiAnZ2l2ZW5Mb2NhdGlvbicgcGFyYW1ldGVyIHNob3VsZCBiZSBhIHN0cmluZyBub3QgYSAnJHt0eXBlb2YgZ2l2ZW5Mb2NhdGlvbn0nOiAke2dpdmVuTG9jYXRpb259YCk7XG4gIC8vcGFyYW1ldGVyQXNzZXJ0KGNoZWNraW5nT3B0aW9ucyAhPT0gdW5kZWZpbmVkLCBcImNoZWNrRmlsZUNvbnRlbnRzOiAnY2hlY2tpbmdPcHRpb25zJyBwYXJhbWV0ZXIgc2hvdWxkIGJlIGRlZmluZWRcIik7XG5cbiAgY29uc3Qgc3RhcnRUaW1lID0gbmV3IERhdGUoKTtcblxuICBsZXQgb3VyQ0ZMb2NhdGlvbiA9IGdpdmVuTG9jYXRpb247XG4gIGlmIChvdXJDRkxvY2F0aW9uWzBdICE9PSAnICcpIG91ckNGTG9jYXRpb24gPSAnICcgKyBvdXJDRkxvY2F0aW9uO1xuXG4gIGNvbnN0IGZpbGViaXRzID0gZmlsZXBhdGguc3BsaXQoJy8nKTtcbiAgY29uc3QgZmlsZW5hbWUgPSBmaWxlYml0c1tmaWxlYml0cy5sZW5ndGgtMV07XG4gIC8vIGRlYnVnTG9nKGBjaGVja0ZpbGVDb250ZW50cyBmcm9tIGZpbGVwYXRoPScke2ZpbGVwYXRofScgZ290ICgke2ZpbGViaXRzLmxlbmd0aH0pICR7ZmlsZWJpdHN9IGFuZCB0aGVuICcke2ZpbGVuYW1lfSdgKTtcbiAgY29uc3QgZmlsZW5hbWVMb3dlciA9IGZpbGVuYW1lLnRvTG93ZXJDYXNlKCk7XG4gIGNvbnN0IHJlcG9OYW1lID0gZm9ybVJlcG9OYW1lKGxhbmd1YWdlQ29kZSwgcmVwb0NvZGUpO1xuXG4gIGxldCBjaGVja0ZpbGVSZXN1bHQgPSB7IGNoZWNrZWRGaWxlQ291bnQ6IDAgfTtcbiAgaWYgKGZpbGVuYW1lTG93ZXIuZW5kc1dpdGgoJy50c3YnKSkge1xuICAgIGNvbnN0IGZpbGVuYW1lTWFpbiA9IGZpbGVwYXRoLnN1YnN0cmluZygwLCBmaWxlcGF0aC5sZW5ndGggLSA0KTsgLy8gZHJvcCAudHN2XG4gICAgLy8gZnVuY3Rpb25Mb2coYGNoZWNrRmlsZUNvbnRlbnRzIGhhdmUgVFNWIGZpbGVuYW1lTWFpbj0ke2ZpbGVuYW1lTWFpbn1gKTtcbiAgICBjb25zdCBib29rSUQgPSBmaWxlbmFtZU1haW4uc3RhcnRzV2l0aChgJHtsYW5ndWFnZUNvZGV9X2ApIHx8IGZpbGVuYW1lTWFpbi5zdGFydHNXaXRoKCdlbl8nKSA/IGZpbGVuYW1lTWFpbi5zdWJzdHJpbmcoZmlsZW5hbWVNYWluLmxlbmd0aCAtIDMpIDogZmlsZW5hbWVNYWluLnN1YnN0cmluZyhmaWxlbmFtZU1haW4ubGVuZ3RoIC0gMywgZmlsZW5hbWVNYWluLmxlbmd0aCkudG9VcHBlckNhc2UoKTtcbiAgICAvLyBmdW5jdGlvbkxvZyhgY2hlY2tGaWxlQ29udGVudHMgaGF2ZSBUU1YgYm9va0lEPSR7Ym9va0lEfWApO1xuICAgIC8vcGFyYW1ldGVyQXNzZXJ0KGJvb2tJRCA9PT0gJ09CUycgfHwgYm9va3MuaXNWYWxpZEJvb2tJRChib29rSUQpLCBgY2hlY2tGaWxlQ29udGVudHM6ICcke2Jvb2tJRH0nIGlzIG5vdCBhIHZhbGlkIFVTRk0gYm9vayBpZGVudGlmaWVyYCk7XG4gICAgaWYgKGZpbGVwYXRoLnN0YXJ0c1dpdGgoYCR7bGFuZ3VhZ2VDb2RlfV9gKSB8fCBmaWxlbmFtZU1haW4uc3RhcnRzV2l0aCgnZW5fJykpIHtcbiAgICAgIGxvZ2ljQXNzZXJ0KHJlcG9Db2RlID09PSAnVE4nLCBgVGhlc2UgZmlsZW5hbWVzICR7ZmlsZW5hbWVNYWlufSBhcmUgb25seSBmb3IgVE4gJHtyZXBvQ29kZX1gKTtcbiAgICAgIGNoZWNrRmlsZVJlc3VsdCA9IGF3YWl0IGNoZWNrVE5fVFNWOVRhYmxlKGxhbmd1YWdlQ29kZSwgcmVwb0NvZGUsIGJvb2tJRCwgZmlsZXBhdGgsIGZpbGVDb250ZW50LCBvdXJDRkxvY2F0aW9uLCBjaGVja2luZ09wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBsZXQgYWRqdXN0ZWRSZXBvQ29kZSA9IHJlcG9Db2RlO1xuICAgICAgLy8gaWYgKGFkanVzdGVkUmVwb0NvZGUuc3RhcnRzV2l0aCgnT0JTLScpKVxuICAgICAgLy8gICBhZGp1c3RlZFJlcG9Db2RlID0gYWRqdXN0ZWRSZXBvQ29kZS5zdWJzdHJpbmcoNCk7IC8vIFJlbW92ZSB0aGUgJ09CUy0nIGZyb20gdGhlIGJlZ2lubmluZ1xuICAgICAgbG9naWNBc3NlcnQocmVwb0NvZGUgIT09ICdUTicgJiYgcmVwb0NvZGUgIT09ICdUUScgJiYgcmVwb0NvZGUgIT09ICdPQlMtVE4nICYmIHJlcG9Db2RlICE9PSAnT0JTLVRRJyAmJiByZXBvQ29kZSAhPT0gJ09CU19TTicgJiYgcmVwb0NvZGUgIT09ICdPQlMtU1EnLCBgVGhpcyBjb2RlIHdpdGggJHtmaWxlbmFtZU1haW59IGlzIG5vdCBmb3IgJHtyZXBvQ29kZX1gKTtcbiAgICAgIGNvbnN0IGNoZWNrRnVuY3Rpb24gPSB7XG4gICAgICAgICdUV0wnOiBjaGVja1RXTF9UU1Y2VGFibGUsICdPQlMtVFdMJzogY2hlY2tUV0xfVFNWNlRhYmxlLFxuICAgICAgICAnVE4yJzogY2hlY2tOb3Rlc1RTVjdUYWJsZSwgJ09CUy1UTjInOiBjaGVja05vdGVzVFNWN1RhYmxlLFxuICAgICAgICAnVFEyJzogY2hlY2tRdWVzdGlvbnNUU1Y3VGFibGUsICdPQlMtVFEyJzogY2hlY2tRdWVzdGlvbnNUU1Y3VGFibGUsXG4gICAgICAgICdTTic6IGNoZWNrTm90ZXNUU1Y3VGFibGUsICdPQlMtU04yJzogY2hlY2tOb3Rlc1RTVjdUYWJsZSxcbiAgICAgICAgJ1NRJzogY2hlY2tRdWVzdGlvbnNUU1Y3VGFibGUsICdPQlMtU1EyJzogY2hlY2tRdWVzdGlvbnNUU1Y3VGFibGUsXG4gICAgICB9W3JlcG9Db2RlXTtcbiAgICAgIC8vIGRlYnVnTG9nKGBjaGVja0ZpbGVDb250ZW50cygpIGdvdCAke2NoZWNrRnVuY3Rpb259IGZ1bmN0aW9uIGZvciAke3JlcG9Db2RlfWApO1xuICAgICAgY2hlY2tGaWxlUmVzdWx0ID0gYXdhaXQgY2hlY2tGdW5jdGlvbihsYW5ndWFnZUNvZGUsIHJlcG9Db2RlLCBib29rSUQsIGZpbGVwYXRoLCBmaWxlQ29udGVudCwgb3VyQ0ZMb2NhdGlvbiwgY2hlY2tpbmdPcHRpb25zKTtcbiAgICB9XG4gIH1cbiAgZWxzZSBpZiAoZmlsZW5hbWVMb3dlci5lbmRzV2l0aCgnLnVzZm0nKSkge1xuICAgIGNvbnN0IGZpbGVuYW1lTWFpbiA9IGZpbGVwYXRoLnN1YnN0cmluZygwLCBmaWxlcGF0aC5sZW5ndGggLSA1KTsgLy8gZHJvcCAudXNmbVxuICAgIC8vIGRlYnVnTG9nKGBIYXZlIFVTRk0gZmlsZW5hbWVNYWluPSR7ZmlsZW5hbWVNYWlufWApO1xuICAgIGNvbnN0IGJvb2tJRCA9IGZpbGVuYW1lTWFpbi5zdWJzdHJpbmcoZmlsZW5hbWVNYWluLmxlbmd0aCAtIDMpO1xuICAgIC8vIGRlYnVnTG9nKGBIYXZlIFVTRk0gYm9va2NvZGU9JHtib29rSUR9YCk7XG4gICAgLy9wYXJhbWV0ZXJBc3NlcnQoYm9va3MuaXNWYWxpZEJvb2tJRChib29rSUQpLCBgY2hlY2tGaWxlQ29udGVudHM6ICcke2Jvb2tJRH0nIGlzIG5vdCBhIHZhbGlkIFVTRk0gYm9vayBpZGVudGlmaWVyYCk7XG4gICAgY2hlY2tGaWxlUmVzdWx0ID0gYXdhaXQgY2hlY2tVU0ZNVGV4dChsYW5ndWFnZUNvZGUsIHJlcG9Db2RlLCBib29rSUQsIGZpbGVwYXRoLCBmaWxlQ29udGVudCwgb3VyQ0ZMb2NhdGlvbiwgY2hlY2tpbmdPcHRpb25zKTtcbiAgfSBlbHNlIGlmIChmaWxlbmFtZUxvd2VyLmVuZHNXaXRoKCcuc2ZtJykpIHtcbiAgICBjb25zdCBmaWxlbmFtZU1haW4gPSBmaWxlcGF0aC5zdWJzdHJpbmcoMCwgZmlsZXBhdGgubGVuZ3RoIC0gNCk7IC8vIGRyb3AgLnNmbVxuICAgIHVzZXJMb2coYGNoZWNrRmlsZUNvbnRlbnRzIGhhdmUgU0ZNIGZpbGVuYW1lTWFpbj0ke2ZpbGVuYW1lTWFpbn1gKTtcbiAgICBjb25zdCBib29rSUQgPSBmaWxlbmFtZU1haW4uc3Vic3RyaW5nKDIsIDUpO1xuICAgIHVzZXJMb2coYGNoZWNrRmlsZUNvbnRlbnRzIGhhdmUgU0ZNIGJvb2tjb2RlPSR7Ym9va0lEfWApO1xuICAgIC8vcGFyYW1ldGVyQXNzZXJ0KGJvb2tzLmlzVmFsaWRCb29rSUQoYm9va0lEKSwgYGNoZWNrRmlsZUNvbnRlbnRzOiAnJHtib29rSUR9JyBpcyBub3QgYSB2YWxpZCBVU0ZNIGJvb2sgaWRlbnRpZmllcmApO1xuICAgIGNoZWNrRmlsZVJlc3VsdCA9IGF3YWl0IGNoZWNrVVNGTVRleHQobGFuZ3VhZ2VDb2RlLCByZXBvQ29kZSwgYm9va0lELCBmaWxlcGF0aCwgZmlsZUNvbnRlbnQsIG91ckNGTG9jYXRpb24sIGNoZWNraW5nT3B0aW9ucyk7XG4gIH0gZWxzZSBpZiAoZmlsZW5hbWVMb3dlci5lbmRzV2l0aCgnLm1kJykpXG4gICAgaWYgKChyZXBvQ29kZSA9PT0gJ1VIQUwnICYmIGZpbGVuYW1lWzBdID09PSAnSCcgJiYgZmlsZW5hbWUubGVuZ3RoID09PSA4KVxuICAgICAgfHwgKHJlcG9Db2RlID09PSAnVUdMJyAmJiBmaWxlbmFtZSA9PT0gJzAxLm1kJykpXG4gICAgICBjaGVja0ZpbGVSZXN1bHQgPSBhd2FpdCBjaGVja0xleGljb25GaWxlQ29udGVudHMobGFuZ3VhZ2VDb2RlLCByZXBvQ29kZSwgZmlsZXBhdGgsIGZpbGVDb250ZW50LCBvdXJDRkxvY2F0aW9uLCBjaGVja2luZ09wdGlvbnMpO1xuICAgIGVsc2VcbiAgICAgIGNoZWNrRmlsZVJlc3VsdCA9IGF3YWl0IGNoZWNrTWFya2Rvd25GaWxlQ29udGVudHMobGFuZ3VhZ2VDb2RlLCByZXBvQ29kZSwgZmlsZXBhdGgsIGZpbGVDb250ZW50LCBvdXJDRkxvY2F0aW9uLCBjaGVja2luZ09wdGlvbnMpO1xuICBlbHNlIGlmIChmaWxlbmFtZUxvd2VyLmVuZHNXaXRoKCcudHh0JykpXG4gICAgY2hlY2tGaWxlUmVzdWx0ID0gY2hlY2tQbGFpblRleHQobGFuZ3VhZ2VDb2RlLCByZXBvQ29kZSwgJ3RleHQnLCBmaWxlcGF0aCwgZmlsZUNvbnRlbnQsIG91ckNGTG9jYXRpb24sIGNoZWNraW5nT3B0aW9ucyk7XG4gIGVsc2UgaWYgKGZpbGVuYW1lTG93ZXIgPT09ICdtYW5pZmVzdC55YW1sJylcbiAgICBjaGVja0ZpbGVSZXN1bHQgPSBhd2FpdCBjaGVja01hbmlmZXN0VGV4dChsYW5ndWFnZUNvZGUsIHJlcG9Db2RlLCB1c2VybmFtZSwgcmVwb05hbWUsIGJyYW5jaCwgZmlsZUNvbnRlbnQsIG91ckNGTG9jYXRpb24sIGNoZWNraW5nT3B0aW9ucyk7IC8vIGRvbuKAmXQga25vdyB1c2VybmFtZSBvciBicmFuY2hcbiAgZWxzZSBpZiAoZmlsZW5hbWVMb3dlci5lbmRzV2l0aCgnLnlhbWwnKSlcbiAgICBjaGVja0ZpbGVSZXN1bHQgPSBjaGVja1lBTUxUZXh0KGxhbmd1YWdlQ29kZSwgcmVwb0NvZGUsIGZpbGVwYXRoLCBmaWxlQ29udGVudCwgb3VyQ0ZMb2NhdGlvbiwgY2hlY2tpbmdPcHRpb25zKTtcbiAgZWxzZSBpZiAoZmlsZW5hbWVMb3dlci5zdGFydHNXaXRoKCdsaWNlbnNlJykpIHtcbiAgICBjaGVja0ZpbGVSZXN1bHQgPSBhd2FpdCBjaGVja01hcmtkb3duRmlsZUNvbnRlbnRzKGxhbmd1YWdlQ29kZSwgcmVwb0NvZGUsIGZpbGVwYXRoLCBmaWxlQ29udGVudCwgb3VyQ0ZMb2NhdGlvbiwgY2hlY2tpbmdPcHRpb25zKTtcbiAgICBjaGVja0ZpbGVSZXN1bHQubm90aWNlTGlzdC51bnNoaWZ0KHsgcHJpb3JpdHk6IDk4MiwgbWVzc2FnZTogXCJGaWxlIGV4dGVuc2lvbiBpcyBub3QgcmVjb2duaXplZCwgc28gdHJlYXRlZCBhcyBtYXJrZG93bi5cIiwgZmlsZW5hbWU6IGZpbGVwYXRoLCBsb2NhdGlvbjogb3VyQ0ZMb2NhdGlvbiB9KTtcbiAgfSBlbHNlIHtcbiAgICBjaGVja0ZpbGVSZXN1bHQgPSBjaGVja1BsYWluVGV4dChsYW5ndWFnZUNvZGUsIHJlcG9Db2RlLCAncmF3JywgZmlsZXBhdGgsIGZpbGVDb250ZW50LCBvdXJDRkxvY2F0aW9uLCBjaGVja2luZ09wdGlvbnMpO1xuICAgIGNoZWNrRmlsZVJlc3VsdC5ub3RpY2VMaXN0LnVuc2hpZnQoeyBwcmlvcml0eTogOTk1LCBtZXNzYWdlOiBcIkZpbGUgZXh0ZW5zaW9uIGlzIG5vdCByZWNvZ25pemVkLCBzbyB0cmVhdGVkIGFzIHBsYWluIHRleHQuXCIsIGZpbGVuYW1lOiBmaWxlcGF0aCwgbG9jYXRpb246IG91ckNGTG9jYXRpb24gfSk7XG4gIH1cbiAgLy8gZGVidWdMb2coYGNoZWNrRmlsZUNvbnRlbnRzIGdvdCBpbml0aWFsIHJlc3VsdHM6ICR7SlNPTi5zdHJpbmdpZnkoY2hlY2tGaWxlUmVzdWx0KX1gKTtcbiAgLy8gZGVidWdMb2coYGNoZWNrRmlsZUNvbnRlbnRzIGdvdCBpbml0aWFsIHJlc3VsdHMgd2l0aCAke2NoZWNrRmlsZVJlc3VsdC5zdWNjZXNzTGlzdC5sZW5ndGh9IHN1Y2Nlc3MgbWVzc2FnZShzKSBhbmQgJHtjaGVja0ZpbGVSZXN1bHQubm90aWNlTGlzdC5sZW5ndGh9IG5vdGljZShzKWApO1xuXG4gIC8vIE1ha2Ugc3VyZSB0aGF0IHdlIGhhdmUgdGhlIGZpbGVuYW1lIGluIGFsbCBvZiBvdXIgbm90aWNlcyAoaW4gY2FzZSBvdGhlciBmaWxlcyBhcmUgYmVpbmcgY2hlY2tlZCBhcyB3ZWxsKVxuICBmdW5jdGlvbiBhZGRGaWxlbmFtZUZpZWxkKG5vdGljZU9iamVjdCkge1xuICAgIGlmIChub3RpY2VPYmplY3QuZGVidWdDaGFpbikgbm90aWNlT2JqZWN0LmRlYnVnQ2hhaW4gPSBgY2hlY2tGaWxlQ29udGVudHMgJHtub3RpY2VPYmplY3QuZGVidWdDaGFpbn1gO1xuICAgIGlmIChub3RpY2VPYmplY3QuZmllbGROYW1lID09PSBmaWxlcGF0aCkgZGVsZXRlIG5vdGljZU9iamVjdC5maWVsZE5hbWU7XG4gICAgLy8gVE9ETzogTWlnaHQgd2UgbmVlZCB0byBhZGQgdXNlcm5hbWUsIHJlcG9OYW1lLCBvciBicmFuY2ggaGVyZSA/Pz9cbiAgICByZXR1cm4gbm90aWNlT2JqZWN0LmV4dHJhID8gbm90aWNlT2JqZWN0IDogeyAuLi5ub3RpY2VPYmplY3QsIGZpbGVuYW1lOiBmaWxlcGF0aCB9OyAvLyBOT1RFOiBtaWdodCBiZSBhbiBpbmRpcmVjdCBjaGVjayBvbiBhIFRBIG9yIFRXIGFydGljbGVcbiAgfVxuICBjaGVja0ZpbGVSZXN1bHQubm90aWNlTGlzdCA9IGNoZWNrRmlsZVJlc3VsdC5ub3RpY2VMaXN0Lm1hcChhZGRGaWxlbmFtZUZpZWxkKTtcblxuICAvLyBBZGQgc29tZSBleHRyYSBmaWVsZHMgdG8gb3VyIGNoZWNrRmlsZVJlc3VsdCBvYmplY3RcbiAgLy8gIGluIGNhc2Ugd2UgbmVlZCB0aGlzIGluZm9ybWF0aW9uIGFnYWluIGxhdGVyXG4gIGNoZWNrRmlsZVJlc3VsdC5jaGVja2VkRmlsZUNvdW50ICs9IDE7XG4gIGNoZWNrRmlsZVJlc3VsdC5jaGVja2VkRmlsZW5hbWUgPSBmaWxlcGF0aDtcbiAgY2hlY2tGaWxlUmVzdWx0LmNoZWNrZWRGaWxlc2l6ZSA9IGZpbGVDb250ZW50Lmxlbmd0aDtcbiAgY2hlY2tGaWxlUmVzdWx0LmNoZWNrZWRPcHRpb25zID0gY2hlY2tpbmdPcHRpb25zO1xuXG4gIGNoZWNrRmlsZVJlc3VsdC5lbGFwc2VkU2Vjb25kcyA9IChuZXcgRGF0ZSgpIC0gc3RhcnRUaW1lKSAvIDEwMDA7IC8vIHNlY29uZHNcbiAgLy8gZGVidWdMb2coYGNoZWNrRmlsZUNvbnRlbnRzKCkgcmV0dXJuaW5nICR7SlNPTi5zdHJpbmdpZnkoY2hlY2tGaWxlUmVzdWx0KX1gKTtcbiAgcmV0dXJuIGNoZWNrRmlsZVJlc3VsdDtcbn07XG4vLyBlbmQgb2YgY2hlY2tGaWxlQ29udGVudHMoKVxuIl19