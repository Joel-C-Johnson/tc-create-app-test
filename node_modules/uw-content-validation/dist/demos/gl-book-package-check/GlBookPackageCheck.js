"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");var _typeof = require("@babel/runtime/helpers/typeof");Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react = _interopRequireWildcard(require("react"));

var books = _interopRequireWildcard(require("../../core/books/books"));
var _core = require("../../core");
var _noticeProcessingFunctions = require("../notice-processing-functions");
var _RenderProcessedResults = require("../RenderProcessedResults");
var _checkBookPackage = require("../book-package-check/checkBookPackage");
var _utilities = require("../../core/utilities");function _getRequireWildcardCache(nodeInterop) {if (typeof WeakMap !== "function") return null;var cacheBabelInterop = new WeakMap();var cacheNodeInterop = new WeakMap();return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {return nodeInterop ? cacheNodeInterop : cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj, nodeInterop) {if (!nodeInterop && obj && obj.__esModule) {return obj;}if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") {return { default: obj };}var cache = _getRequireWildcardCache(nodeInterop);if (cache && cache.has(obj)) {return cache.get(obj);}var newObj = {};var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;for (var key in obj) {if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;if (desc && (desc.get || desc.set)) {Object.defineProperty(newObj, key, desc);} else {newObj[key] = obj[key];}}}newObj.default = obj;if (cache) {cache.set(obj, newObj);}return newObj;} // import { withStyles } from '@material-ui/core/styles';


// const GL_BP_VALIDATOR_VERSION_STRING = '0.1.13';


function GlBookPackageCheck( /*username, languageCode, bookIDs,*/props) {
  // Check a single Bible book across many repositories
  var _useState = (0, _react.useState)("Waiting-CheckBookPackages"),_useState2 = (0, _slicedToArray2.default)(_useState, 2),result = _useState2[0],setResultValue = _useState2[1];

  // debugLog(`I'm here in GlBookPackageCheck v${GL_BP_VALIDATOR_VERSION_STRING}`);
  // consoleLogObject("props", props);
  // consoleLogObject("props.classes", props.classes);

  // TODO: We currently ignore originalLanguagesUsername
  var username = props.otherLanguageUsername;
  // debugLog(`username='${username}'`);
  var languageCode = props.languageCode;
  // debugLog(`languageCode='${languageCode}'`);
  var bookID = props.bookID;
  // debugLog(`bookID='${bookID}'`);
  var dataSet = props.dataSet;
  // debugLog(`dataSet='${dataSet}'`);
  var branch = props.branch;
  // debugLog(`branch='${branch}'`);

  var checkingOptions = { // Uncomment any of these to test them
    // excerptLength: 25,
    checkManifestFlag: true,
    checkReadmeFlag: true,
    checkLicenseFlag: true,
    suppressNoticeDisablingFlag: true // Leave this one as true (otherwise demo checks are less efficient)
  };
  // Or this allows the parameters to be specified as a GlBookPackageCheck property
  if (props.excerptLength) checkingOptions.excerptLength = (0, _core.ourParseInt)(props.excerptLength);
  if (props.cutoffPriorityLevel) checkingOptions.cutoffPriorityLevel = (0, _core.ourParseInt)(props.cutoffPriorityLevel);

  (0, _react.useEffect)(function () {
    // debugLog("GlBookPackageCheck.useEffect() called with ", JSON.stringify(props));

    // Use an IIFE (Immediately Invoked Function Expression)
    //  e.g., see https://medium.com/javascript-in-plain-english/https-medium-com-javascript-in-plain-english-stop-feeling-iffy-about-using-an-iife-7b0292aba174
    (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {var repoPreloadList, whichTestament, origLangRepo, successFlag, rawGlBPsResults, processOptions, displayType,



























































































      renderSummary, processedResults, _processedResults, _processedResults2;return _regenerator.default.wrap(function _callee$(_context) {while (1) {switch (_context.prev = _context.next) {case 0:renderSummary = function _renderSummary(processedResults) {
                return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/
                _react.default.createElement("p", null, "Checked ", /*#__PURE__*/_react.default.createElement("b", null, username, " ", languageCode, " ", bookID), " (from ", /*#__PURE__*/_react.default.createElement("i", null, branch === undefined ? 'DEFAULT' : branch), " branches)"), /*#__PURE__*/
                _react.default.createElement(_RenderProcessedResults.RenderCheckedFilesList, { username: username, results: processedResults }), /*#__PURE__*/
                _react.default.createElement(_RenderProcessedResults.RenderTotals, { rawNoticeListLength: rawGlBPsResults.noticeList.length, results: processedResults }));


              };if (!(!props.wait || props.wait !== 'N')) {_context.next = 4;break;}setResultValue( /*#__PURE__*/_react.default.createElement("p", null, /*#__PURE__*/_react.default.createElement("span", { style: { color: 'blue' } }, "Waiting for user\u2026"), " (Adjust settings below as necessary and then set ", /*#__PURE__*/_react.default.createElement("b", null, "wait='N'"), " to start)"));return _context.abrupt("return");case 4:if (!(bookID !== 'OBS' && !books.isValidBookID(bookID))) {_context.next = 8;break;}(0, _utilities.userLog)("Invalid '".concat(bookID, "' bookID given!"));setResultValue( /*#__PURE__*/_react.default.createElement("p", { style: { color: 'red' } }, "Please enter a valid USFM book identifier or 'OBS'. ('", /*#__PURE__*/_react.default.createElement("b", null, bookID), "' is not valid.)"));return _context.abrupt("return");case 8:if (!(props.reloadAllFilesFirst && props.reloadAllFilesFirst.slice(0).toUpperCase() === 'Y')) {_context.next = 15;break;}(0, _utilities.userLog)("Clearing cache before running GL book packages check…");setResultValue( /*#__PURE__*/_react.default.createElement("p", { style: { color: 'orange' } }, "Clearing cache before running GL book packages check\u2026"));_context.next = 13;return (0, _core.clearCaches)();case 13:_context.next = 17;break;case 15:_context.next = 17;return (0, _core.clearCheckedArticleCache)();case 17:if (bookID === 'OBS') {repoPreloadList = ['OBS', 'OBS-TWL', 'OBS-TN2', 'OBS-TQ2', 'OBS-SN2', 'OBS-SQ2']; // for DEFAULT
                if (dataSet === 'OLD') repoPreloadList = ['OBS', 'OBS-TWL', 'OBS-TN', 'OBS-TQ', 'OBS-SN', 'OBS-SQ'];else if (dataSet === 'NEW') repoPreloadList = ['OBS', 'OBS-TWL', 'OBS-TN2', 'OBS-TQ2', 'OBS-SN', 'OBS-SQ'];else if (dataSet === 'BOTH') repoPreloadList = ['OBS', 'OBS-TWL', 'OBS-TN', 'OBS-TN2', 'OBS-TQ', 'OBS-TQ2', 'OBS-SN', 'OBS-SN', 'OBS-SN2', 'OBS-SQ2'];} else {// not OBS
                repoPreloadList = ['TWL', 'LT', 'ST', 'TN', 'TQ', 'SN', 'SQ']; // for DEFAULT
                if (dataSet === 'OLD') repoPreloadList = ['TWL', 'LT', 'ST', 'TN', 'TQ'];else if (dataSet === 'NEW') repoPreloadList = ['TWL', 'LT', 'ST', 'TN2', 'TQ2', 'SN', 'SQ'];else if (dataSet === 'BOTH') repoPreloadList = ['TWL', 'LT', 'ST', 'TN', 'TN2', 'TQ', 'TQ2', 'SN', 'SQ'];whichTestament = books.testament(bookID); // returns 'old' or 'new'
                (0, _utilities.logicAssert)(whichTestament === 'old' || whichTestament === 'new', "BookPackageCheck() couldn't find testament for '".concat(bookID, "'"));origLangRepo = whichTestament === 'old' ? 'UHB' : 'UGNT';repoPreloadList.unshift(origLangRepo);}if (!checkingOptions.disableAllLinkFetchingFlag) {// Both Bible books and OBS refer to TW and TA
                repoPreloadList.push('TW');repoPreloadList.push('TA');} // debugLog(`GlBookPackageCheck got repoPreloadList=${repoPreloadList} for dataSet=${dataSet}`)
              setResultValue( /*#__PURE__*/_react.default.createElement("p", { style: { color: 'magenta' } }, "Preloading ", repoPreloadList.length, " repos for ", /*#__PURE__*/_react.default.createElement("i", null, username), " ", languageCode, " ready for GL book package check\u2026"));_context.next = 22;return (0, _core.preloadReposIfNecessary)(username, languageCode, [bookID], branch, repoPreloadList);case 22:successFlag = _context.sent;if (!successFlag) console.error("AllBookPackagesCheck error: Failed to pre-load all repos"); // Display our "waiting" message
              setResultValue( /*#__PURE__*/_react.default.createElement("p", { style: { color: 'magenta' } }, "Checking ", /*#__PURE__*/_react.default.createElement("i", null, username), " ", languageCode, " ", /*#__PURE__*/_react.default.createElement("b", null, bookID), " book packages\u2026"));_context.next = 27;return (0, _checkBookPackage.checkBookPackage)(username, languageCode, bookID, setResultValue, checkingOptions);case 27:rawGlBPsResults = _context.sent; // debugLog("checkBookPackage() returned", typeof rawCBPsResults); //, JSON.stringify(rawCBPsResults));
              // Add some extra fields to our rawCBPsResults object in case we need this information again later
              rawGlBPsResults.checkType = 'GLBookPackages';rawGlBPsResults.username = username;rawGlBPsResults.languageCode = languageCode;rawGlBPsResults.checkedOptions = checkingOptions; // debugLog("Here with CBPs rawCBPsResults", typeof rawCBPsResults);
              // Now do our final handling of the result -- we have some options available
              processOptions = {// Uncomment any of these to test them
                // 'maximumSimilarMessages': 4, // default is 3 -- 0 means don’t suppress
                // 'errorPriorityLevel': 800, // default is 700
                // 'cutoffPriorityLevel': 100, // default is 0
                // 'sortBy': 'ByRepo', // default is 'ByPriority', also have 'AsFound'
                // 'ignorePriorityNumberList': [123, 202], // default is []
              }; // Or this allows the parameters to be specified as a GlBookPackageCheck property
              if (props.maximumSimilarMessages) processOptions.maximumSimilarMessages = (0, _core.ourParseInt)(props.maximumSimilarMessages);if (props.errorPriorityLevel) processOptions.errorPriorityLevel = (0, _core.ourParseInt)(props.errorPriorityLevel); // if (props.cutoffPriorityLevel) processOptions.cutoffPriorityLevel = ourParseInt(props.cutoffPriorityLevel);
              if (props.sortBy) processOptions.sortBy = props.sortBy; // if (props.ignorePriorityNumberList) processOptions.ignorePriorityNumberList = props.ignorePriorityNumberList;
              displayType = 'ErrorsWarnings'; // default
              if (props.displayType) displayType = props.displayType;if (displayType === 'ErrorsWarnings') {processedResults = (0, _noticeProcessingFunctions.processNoticesToErrorsWarnings)(rawGlBPsResults, processOptions); //                 userLog(`GlBookPackageCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)
                //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numHiddenErrors=${processedResults.numHiddenErrors.toLocaleString()} numHiddenWarnings=${processedResults.numHiddenWarnings.toLocaleString()}`);
                // debugLog("Here now in rendering bit!");
                if (processedResults.errorList.length || processedResults.warningList.length) setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, renderSummary(processedResults), /*#__PURE__*/_react.default.createElement(_RenderProcessedResults.RenderSuccessesErrorsWarnings, { results: processedResults })));else // no errors or warnings
                  setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, renderSummary(processedResults), /*#__PURE__*/_react.default.createElement(_RenderProcessedResults.RenderSuccessesErrorsWarnings, { results: processedResults })));} else if (displayType === 'SevereMediumLow') {_processedResults = (0, _noticeProcessingFunctions.processNoticesToSevereMediumLow)(rawGlBPsResults, processOptions); //                 userLog(`GlBookPackageCheck got processed results with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)
                //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numHiddenErrors=${processedResults.numHiddenErrors.toLocaleString()} numHiddenWarnings=${processedResults.numHiddenWarnings.toLocaleString()}`);
                if (_processedResults.severeList.length || _processedResults.mediumList.length || _processedResults.lowList.length) setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, renderSummary(_processedResults), /*#__PURE__*/
                _react.default.createElement(_RenderProcessedResults.RenderSuccessesSevereMediumLow, { results: _processedResults })));else

                  // no severe, medium, or low notices
                  setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null,
                  renderSummary(_processedResults), /*#__PURE__*/
                  _react.default.createElement(_RenderProcessedResults.RenderSuccessesSevereMediumLow, { results: _processedResults })));


              } else if (displayType === 'SingleList') {
                _processedResults2 = (0, _noticeProcessingFunctions.processNoticesToSingleList)(rawGlBPsResults, processOptions);
                //                 userLog(`GlBookPackageCheck got processed results with ${processedResults.successList.length.toLocaleString()} success message(s) and ${processedResults.warningList.length.toLocaleString()} notice(s)
                //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numHiddenWarnings=${processedResults.numHiddenWarnings.toLocaleString()}`);

                if (_processedResults2.warningList.length)
                setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null,
                renderSummary(_processedResults2), /*#__PURE__*/
                _react.default.createElement(_RenderProcessedResults.RenderSuccessesNoticesGradient, { results: _processedResults2 })));else

                  // no warnings
                  setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null,
                  renderSummary(_processedResults2), /*#__PURE__*/
                  _react.default.createElement(_RenderProcessedResults.RenderSuccessesNoticesGradient, { results: _processedResults2 })));

              } else setResultValue( /*#__PURE__*/_react.default.createElement("b", { style: { color: 'red' } }, "Invalid displayType='", displayType, "'"));

              // debugLog("Finished rendering bit.");
            case 39:case "end":return _context.stop();}}}, _callee);}))(); // end of async part in unnamedFunction
    // Doesn’t work if we add this to next line: bookIDList,bookIDs,username,branch,checkingOptions,languageCode,props
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [bookID, branch, JSON.stringify(checkingOptions), languageCode, JSON.stringify(props), username]); // end of useEffect part

  // {/* <div className={classes.root}> */}
  return /*#__PURE__*/(
    _react.default.createElement("div", { className: "Fred" },
    result));


}

// GlBookPackageCheck.propTypes = {
//   /** @ignore */
//   username: PropTypes.object.isRequired,
//   /** @ignore */
//   languageCode: PropTypes.object.isRequired,
//   bookIDs: PropTypes.object.isRequired,
//   props: PropTypes.object,
// };

// const styles = theme => ({
//   root: {
//   },
// });
var _default =
GlBookPackageCheck;exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kZW1vcy9nbC1ib29rLXBhY2thZ2UtY2hlY2svR2xCb29rUGFja2FnZUNoZWNrLmpzIl0sIm5hbWVzIjpbIkdsQm9va1BhY2thZ2VDaGVjayIsInByb3BzIiwicmVzdWx0Iiwic2V0UmVzdWx0VmFsdWUiLCJ1c2VybmFtZSIsIm90aGVyTGFuZ3VhZ2VVc2VybmFtZSIsImxhbmd1YWdlQ29kZSIsImJvb2tJRCIsImRhdGFTZXQiLCJicmFuY2giLCJjaGVja2luZ09wdGlvbnMiLCJjaGVja01hbmlmZXN0RmxhZyIsImNoZWNrUmVhZG1lRmxhZyIsImNoZWNrTGljZW5zZUZsYWciLCJzdXBwcmVzc05vdGljZURpc2FibGluZ0ZsYWciLCJleGNlcnB0TGVuZ3RoIiwiY3V0b2ZmUHJpb3JpdHlMZXZlbCIsInJlbmRlclN1bW1hcnkiLCJwcm9jZXNzZWRSZXN1bHRzIiwidW5kZWZpbmVkIiwicmF3R2xCUHNSZXN1bHRzIiwibm90aWNlTGlzdCIsImxlbmd0aCIsIndhaXQiLCJjb2xvciIsImJvb2tzIiwiaXNWYWxpZEJvb2tJRCIsInJlbG9hZEFsbEZpbGVzRmlyc3QiLCJzbGljZSIsInRvVXBwZXJDYXNlIiwicmVwb1ByZWxvYWRMaXN0Iiwid2hpY2hUZXN0YW1lbnQiLCJ0ZXN0YW1lbnQiLCJvcmlnTGFuZ1JlcG8iLCJ1bnNoaWZ0IiwiZGlzYWJsZUFsbExpbmtGZXRjaGluZ0ZsYWciLCJwdXNoIiwic3VjY2Vzc0ZsYWciLCJjb25zb2xlIiwiZXJyb3IiLCJjaGVja1R5cGUiLCJjaGVja2VkT3B0aW9ucyIsInByb2Nlc3NPcHRpb25zIiwibWF4aW11bVNpbWlsYXJNZXNzYWdlcyIsImVycm9yUHJpb3JpdHlMZXZlbCIsInNvcnRCeSIsImRpc3BsYXlUeXBlIiwiZXJyb3JMaXN0Iiwid2FybmluZ0xpc3QiLCJzZXZlcmVMaXN0IiwibWVkaXVtTGlzdCIsImxvd0xpc3QiLCJKU09OIiwic3RyaW5naWZ5Il0sIm1hcHBpbmdzIjoibWdCQUFB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IGZyb20gJ3JlYWN0Jztcbi8vIGltcG9ydCB7IHdpdGhTdHlsZXMgfSBmcm9tICdAbWF0ZXJpYWwtdWkvY29yZS9zdHlsZXMnO1xuaW1wb3J0ICogYXMgYm9va3MgZnJvbSAnLi4vLi4vY29yZS9ib29rcy9ib29rcyc7XG5pbXBvcnQgeyBjbGVhckNhY2hlcywgY2xlYXJDaGVja2VkQXJ0aWNsZUNhY2hlLCBwcmVsb2FkUmVwb3NJZk5lY2Vzc2FyeSwgb3VyUGFyc2VJbnQgfSBmcm9tICcuLi8uLi9jb3JlJztcbmltcG9ydCB7IHByb2Nlc3NOb3RpY2VzVG9FcnJvcnNXYXJuaW5ncywgcHJvY2Vzc05vdGljZXNUb1NldmVyZU1lZGl1bUxvdywgcHJvY2Vzc05vdGljZXNUb1NpbmdsZUxpc3QgfSBmcm9tICcuLi9ub3RpY2UtcHJvY2Vzc2luZy1mdW5jdGlvbnMnO1xuaW1wb3J0IHsgUmVuZGVyQ2hlY2tlZEZpbGVzTGlzdCwgUmVuZGVyU3VjY2Vzc2VzRXJyb3JzV2FybmluZ3MsIFJlbmRlclN1Y2Nlc3Nlc1NldmVyZU1lZGl1bUxvdywgUmVuZGVyU3VjY2Vzc2VzTm90aWNlc0dyYWRpZW50LCBSZW5kZXJUb3RhbHMgfSBmcm9tICcuLi9SZW5kZXJQcm9jZXNzZWRSZXN1bHRzJztcbmltcG9ydCB7IGNoZWNrQm9va1BhY2thZ2UgfSBmcm9tICcuLi9ib29rLXBhY2thZ2UtY2hlY2svY2hlY2tCb29rUGFja2FnZSc7XG5pbXBvcnQgeyB1c2VyTG9nLCBsb2dpY0Fzc2VydCB9IGZyb20gJy4uLy4uL2NvcmUvdXRpbGl0aWVzJztcblxuXG4vLyBjb25zdCBHTF9CUF9WQUxJREFUT1JfVkVSU0lPTl9TVFJJTkcgPSAnMC4xLjEzJztcblxuXG5mdW5jdGlvbiBHbEJvb2tQYWNrYWdlQ2hlY2soLyp1c2VybmFtZSwgbGFuZ3VhZ2VDb2RlLCBib29rSURzLCovIHByb3BzKSB7XG4gICAgLy8gQ2hlY2sgYSBzaW5nbGUgQmlibGUgYm9vayBhY3Jvc3MgbWFueSByZXBvc2l0b3JpZXNcbiAgICBjb25zdCBbcmVzdWx0LCBzZXRSZXN1bHRWYWx1ZV0gPSB1c2VTdGF0ZShcIldhaXRpbmctQ2hlY2tCb29rUGFja2FnZXNcIik7XG5cbiAgICAvLyBkZWJ1Z0xvZyhgSSdtIGhlcmUgaW4gR2xCb29rUGFja2FnZUNoZWNrIHYke0dMX0JQX1ZBTElEQVRPUl9WRVJTSU9OX1NUUklOR31gKTtcbiAgICAvLyBjb25zb2xlTG9nT2JqZWN0KFwicHJvcHNcIiwgcHJvcHMpO1xuICAgIC8vIGNvbnNvbGVMb2dPYmplY3QoXCJwcm9wcy5jbGFzc2VzXCIsIHByb3BzLmNsYXNzZXMpO1xuXG4gICAgLy8gVE9ETzogV2UgY3VycmVudGx5IGlnbm9yZSBvcmlnaW5hbExhbmd1YWdlc1VzZXJuYW1lXG4gICAgbGV0IHVzZXJuYW1lID0gcHJvcHMub3RoZXJMYW5ndWFnZVVzZXJuYW1lO1xuICAgIC8vIGRlYnVnTG9nKGB1c2VybmFtZT0nJHt1c2VybmFtZX0nYCk7XG4gICAgbGV0IGxhbmd1YWdlQ29kZSA9IHByb3BzLmxhbmd1YWdlQ29kZTtcbiAgICAvLyBkZWJ1Z0xvZyhgbGFuZ3VhZ2VDb2RlPScke2xhbmd1YWdlQ29kZX0nYCk7XG4gICAgbGV0IGJvb2tJRCA9IHByb3BzLmJvb2tJRDtcbiAgICAvLyBkZWJ1Z0xvZyhgYm9va0lEPScke2Jvb2tJRH0nYCk7XG4gICAgbGV0IGRhdGFTZXQgPSBwcm9wcy5kYXRhU2V0O1xuICAgIC8vIGRlYnVnTG9nKGBkYXRhU2V0PScke2RhdGFTZXR9J2ApO1xuICAgIGxldCBicmFuY2ggPSBwcm9wcy5icmFuY2g7XG4gICAgLy8gZGVidWdMb2coYGJyYW5jaD0nJHticmFuY2h9J2ApO1xuXG4gICAgY29uc3QgY2hlY2tpbmdPcHRpb25zID0geyAvLyBVbmNvbW1lbnQgYW55IG9mIHRoZXNlIHRvIHRlc3QgdGhlbVxuICAgICAgICAvLyBleGNlcnB0TGVuZ3RoOiAyNSxcbiAgICAgICAgY2hlY2tNYW5pZmVzdEZsYWc6IHRydWUsXG4gICAgICAgIGNoZWNrUmVhZG1lRmxhZzogdHJ1ZSxcbiAgICAgICAgY2hlY2tMaWNlbnNlRmxhZzogdHJ1ZSxcbiAgICAgICAgc3VwcHJlc3NOb3RpY2VEaXNhYmxpbmdGbGFnOiB0cnVlLCAvLyBMZWF2ZSB0aGlzIG9uZSBhcyB0cnVlIChvdGhlcndpc2UgZGVtbyBjaGVja3MgYXJlIGxlc3MgZWZmaWNpZW50KVxuICAgIH07XG4gICAgLy8gT3IgdGhpcyBhbGxvd3MgdGhlIHBhcmFtZXRlcnMgdG8gYmUgc3BlY2lmaWVkIGFzIGEgR2xCb29rUGFja2FnZUNoZWNrIHByb3BlcnR5XG4gICAgaWYgKHByb3BzLmV4Y2VycHRMZW5ndGgpIGNoZWNraW5nT3B0aW9ucy5leGNlcnB0TGVuZ3RoID0gb3VyUGFyc2VJbnQocHJvcHMuZXhjZXJwdExlbmd0aCk7XG4gICAgaWYgKHByb3BzLmN1dG9mZlByaW9yaXR5TGV2ZWwpIGNoZWNraW5nT3B0aW9ucy5jdXRvZmZQcmlvcml0eUxldmVsID0gb3VyUGFyc2VJbnQocHJvcHMuY3V0b2ZmUHJpb3JpdHlMZXZlbCk7XG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICAvLyBkZWJ1Z0xvZyhcIkdsQm9va1BhY2thZ2VDaGVjay51c2VFZmZlY3QoKSBjYWxsZWQgd2l0aCBcIiwgSlNPTi5zdHJpbmdpZnkocHJvcHMpKTtcblxuICAgICAgICAvLyBVc2UgYW4gSUlGRSAoSW1tZWRpYXRlbHkgSW52b2tlZCBGdW5jdGlvbiBFeHByZXNzaW9uKVxuICAgICAgICAvLyAgZS5nLiwgc2VlIGh0dHBzOi8vbWVkaXVtLmNvbS9qYXZhc2NyaXB0LWluLXBsYWluLWVuZ2xpc2gvaHR0cHMtbWVkaXVtLWNvbS1qYXZhc2NyaXB0LWluLXBsYWluLWVuZ2xpc2gtc3RvcC1mZWVsaW5nLWlmZnktYWJvdXQtdXNpbmctYW4taWlmZS03YjAyOTJhYmExNzRcbiAgICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIGRlYnVnTG9nKFwiU3RhcnRlZCBHbEJvb2tQYWNrYWdlQ2hlY2sudW5uYW1lZEZ1bmN0aW9uKClcIik7XG5cbiAgICAgICAgICAgIC8vIE5PVEUgZnJvbSBSSkg6IEkgY2Fu4oCZdCBmaW5kIHRoZSBjb3JyZWN0IFJlYWN0IHBsYWNlIGZvciB0aGlzIC8gd2F5IHRvIGRvIHRoaXNcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgc28gaXQgc2hvd3MgYSB3YXJuaW5nIGZvciB0aGUgdXNlciwgYW5kIGRvZXNu4oCZdCBjb250aW51ZSB0byB0cnkgdG8gcHJvY2Vzc1xuICAgICAgICAgICAgaWYgKCFwcm9wcy53YWl0IHx8IHByb3BzLndhaXQgIT09ICdOJykge1xuICAgICAgICAgICAgICAgIHNldFJlc3VsdFZhbHVlKDxwPjxzcGFuIHN0eWxlPXt7IGNvbG9yOiAnYmx1ZScgfX0+V2FpdGluZyBmb3IgdXNlcuKApjwvc3Bhbj4gKEFkanVzdCBzZXR0aW5ncyBiZWxvdyBhcyBuZWNlc3NhcnkgYW5kIHRoZW4gc2V0IDxiPndhaXQ9J04nPC9iPiB0byBzdGFydCk8L3A+KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE5PVEUgZnJvbSBSSkg6IEkgY2Fu4oCZdCBmaW5kIHRoZSBjb3JyZWN0IFJlYWN0IHBsYWNlIGZvciB0aGlzIG9yIHdheSB0byBkbyB0aGlzXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgIHNvIGl0IHNob3dzIGEgd2FybmluZyBmb3IgdGhlIHVzZXIsIGFuZCBkb2VzbuKAmXQgY29udGludWUgdG8gdHJ5IHRvIHByb2Nlc3NcbiAgICAgICAgICAgIGlmIChib29rSUQgIT09ICdPQlMnICYmICFib29rcy5pc1ZhbGlkQm9va0lEKGJvb2tJRCkpIHtcbiAgICAgICAgICAgICAgICB1c2VyTG9nKGBJbnZhbGlkICcke2Jvb2tJRH0nIGJvb2tJRCBnaXZlbiFgKVxuICAgICAgICAgICAgICAgIHNldFJlc3VsdFZhbHVlKDxwIHN0eWxlPXt7IGNvbG9yOiAncmVkJyB9fT5QbGVhc2UgZW50ZXIgYSB2YWxpZCBVU0ZNIGJvb2sgaWRlbnRpZmllciBvciAnT0JTJy4gKCc8Yj57Ym9va0lEfTwvYj4nIGlzIG5vdCB2YWxpZC4pPC9wPik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocHJvcHMucmVsb2FkQWxsRmlsZXNGaXJzdCAmJiBwcm9wcy5yZWxvYWRBbGxGaWxlc0ZpcnN0LnNsaWNlKDApLnRvVXBwZXJDYXNlKCkgPT09ICdZJykge1xuICAgICAgICAgICAgICAgIHVzZXJMb2coXCJDbGVhcmluZyBjYWNoZSBiZWZvcmUgcnVubmluZyBHTCBib29rIHBhY2thZ2VzIGNoZWNr4oCmXCIpO1xuICAgICAgICAgICAgICAgIHNldFJlc3VsdFZhbHVlKDxwIHN0eWxlPXt7IGNvbG9yOiAnb3JhbmdlJyB9fT5DbGVhcmluZyBjYWNoZSBiZWZvcmUgcnVubmluZyBHTCBib29rIHBhY2thZ2VzIGNoZWNr4oCmPC9wPik7XG4gICAgICAgICAgICAgICAgYXdhaXQgY2xlYXJDYWNoZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgYXdhaXQgY2xlYXJDaGVja2VkQXJ0aWNsZUNhY2hlKCk7IC8vIG90aGVyd2lzZSB3ZSB3b3VsZG4ndCBzZWUgYW55IG9mIHRoZSB3YXJuaW5ncyBhZ2FpbiBmcm9tIGNoZWNraW5nIHRoZXNlXG5cbiAgICAgICAgICAgIC8vIExvYWQgd2hvbGUgcmVwbyB6aXAgZmlsZXMgd2hpY2ggaXMgbWF5YmUgZmFzdGVyIHRoYW4gbG9hZGluZyBzZXZlcmFsIGluZGl2aWR1YWwgZmlsZXNcbiAgICAgICAgICAgIC8vICBlc3BlY2lhbGx5IGlmIHdlIGFyZSBnb2luZyB0byBhbHNvIGNoZWNrIHRoZSBtYW5pZmVzdHMsIGxpY2Vuc2UsIGFuZCBSZWFkTWUgZmlsZXMgYXMgd2VsbCBhcyB0aGUgYm9vayBmaWxlLlxuICAgICAgICAgICAgLy8gUmVtZW1iZXIgdGhhdCB0aGUgbWFuaWZlc3QgY2hlY2sgYWN0dWFsbHkgY2hlY2tzIHRoZSBleGlzdGVuY2Ugb2YgYWxsIHRoZSBwcm9qZWN0cywgaS5lLiwgYWxsIGZpbGVzIGluIHRoZSByZXBvXG4gICAgICAgICAgICBsZXQgcmVwb1ByZWxvYWRMaXN0O1xuICAgICAgICAgICAgaWYgKGJvb2tJRCA9PT0gJ09CUycpIHtcbiAgICAgICAgICAgICAgICByZXBvUHJlbG9hZExpc3QgPSBbJ09CUycsICdPQlMtVFdMJywgJ09CUy1UTjInLCAnT0JTLVRRMicsICdPQlMtU04yJywgJ09CUy1TUTInXTsgLy8gZm9yIERFRkFVTFRcbiAgICAgICAgICAgICAgICBpZiAoZGF0YVNldCA9PT0gJ09MRCcpXG4gICAgICAgICAgICAgICAgICAgIHJlcG9QcmVsb2FkTGlzdCA9IFsnT0JTJywgJ09CUy1UV0wnLCAnT0JTLVROJywgJ09CUy1UUScsICdPQlMtU04nLCAnT0JTLVNRJ107XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZGF0YVNldCA9PT0gJ05FVycpXG4gICAgICAgICAgICAgICAgICAgIHJlcG9QcmVsb2FkTGlzdCA9IFsnT0JTJywgJ09CUy1UV0wnLCAnT0JTLVROMicsICdPQlMtVFEyJywgJ09CUy1TTicsICdPQlMtU1EnXTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChkYXRhU2V0ID09PSAnQk9USCcpXG4gICAgICAgICAgICAgICAgICAgIHJlcG9QcmVsb2FkTGlzdCA9IFsnT0JTJywgJ09CUy1UV0wnLCAnT0JTLVROJywgJ09CUy1UTjInLCAnT0JTLVRRJywgJ09CUy1UUTInLCAnT0JTLVNOJywgJ09CUy1TTicsICdPQlMtU04yJywgJ09CUy1TUTInXTtcbiAgICAgICAgICAgIH0gZWxzZSB7IC8vIG5vdCBPQlNcbiAgICAgICAgICAgICAgICByZXBvUHJlbG9hZExpc3QgPSBbJ1RXTCcsICdMVCcsICdTVCcsICdUTicsICdUUScsICdTTicsICdTUSddOyAvLyBmb3IgREVGQVVMVFxuICAgICAgICAgICAgICAgIGlmIChkYXRhU2V0ID09PSAnT0xEJylcbiAgICAgICAgICAgICAgICAgICAgcmVwb1ByZWxvYWRMaXN0ID0gWydUV0wnLCAnTFQnLCAnU1QnLCAnVE4nLCAnVFEnXTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChkYXRhU2V0ID09PSAnTkVXJylcbiAgICAgICAgICAgICAgICAgICAgcmVwb1ByZWxvYWRMaXN0ID0gWydUV0wnLCAnTFQnLCAnU1QnLCAnVE4yJywgJ1RRMicsICdTTicsICdTUSddO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRhdGFTZXQgPT09ICdCT1RIJylcbiAgICAgICAgICAgICAgICAgICAgcmVwb1ByZWxvYWRMaXN0ID0gWydUV0wnLCAnTFQnLCAnU1QnLCAnVE4nLCAnVE4yJywgJ1RRJywgJ1RRMicsICdTTicsICdTUSddO1xuICAgICAgICAgICAgICAgIGNvbnN0IHdoaWNoVGVzdGFtZW50ID0gYm9va3MudGVzdGFtZW50KGJvb2tJRCk7IC8vIHJldHVybnMgJ29sZCcgb3IgJ25ldydcbiAgICAgICAgICAgICAgICBsb2dpY0Fzc2VydCh3aGljaFRlc3RhbWVudCA9PT0gJ29sZCcgfHwgd2hpY2hUZXN0YW1lbnQgPT09ICduZXcnLCBgQm9va1BhY2thZ2VDaGVjaygpIGNvdWxkbid0IGZpbmQgdGVzdGFtZW50IGZvciAnJHtib29rSUR9J2ApO1xuICAgICAgICAgICAgICAgIGNvbnN0IG9yaWdMYW5nUmVwbyA9IHdoaWNoVGVzdGFtZW50ID09PSAnb2xkJyA/ICdVSEInIDogJ1VHTlQnO1xuICAgICAgICAgICAgICAgIHJlcG9QcmVsb2FkTGlzdC51bnNoaWZ0KG9yaWdMYW5nUmVwbyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWNoZWNraW5nT3B0aW9ucy5kaXNhYmxlQWxsTGlua0ZldGNoaW5nRmxhZykgeyAvLyBCb3RoIEJpYmxlIGJvb2tzIGFuZCBPQlMgcmVmZXIgdG8gVFcgYW5kIFRBXG4gICAgICAgICAgICAgICAgcmVwb1ByZWxvYWRMaXN0LnB1c2goJ1RXJyk7XG4gICAgICAgICAgICAgICAgcmVwb1ByZWxvYWRMaXN0LnB1c2goJ1RBJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBkZWJ1Z0xvZyhgR2xCb29rUGFja2FnZUNoZWNrIGdvdCByZXBvUHJlbG9hZExpc3Q9JHtyZXBvUHJlbG9hZExpc3R9IGZvciBkYXRhU2V0PSR7ZGF0YVNldH1gKVxuXG4gICAgICAgICAgICBzZXRSZXN1bHRWYWx1ZSg8cCBzdHlsZT17eyBjb2xvcjogJ21hZ2VudGEnIH19PlByZWxvYWRpbmcge3JlcG9QcmVsb2FkTGlzdC5sZW5ndGh9IHJlcG9zIGZvciA8aT57dXNlcm5hbWV9PC9pPiB7bGFuZ3VhZ2VDb2RlfSByZWFkeSBmb3IgR0wgYm9vayBwYWNrYWdlIGNoZWNr4oCmPC9wPik7XG4gICAgICAgICAgICBjb25zdCBzdWNjZXNzRmxhZyA9IGF3YWl0IHByZWxvYWRSZXBvc0lmTmVjZXNzYXJ5KHVzZXJuYW1lLCBsYW5ndWFnZUNvZGUsIFtib29rSURdLCBicmFuY2gsIHJlcG9QcmVsb2FkTGlzdCk7XG4gICAgICAgICAgICBpZiAoIXN1Y2Nlc3NGbGFnKVxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEFsbEJvb2tQYWNrYWdlc0NoZWNrIGVycm9yOiBGYWlsZWQgdG8gcHJlLWxvYWQgYWxsIHJlcG9zYClcblxuICAgICAgICAgICAgLy8gRGlzcGxheSBvdXIgXCJ3YWl0aW5nXCIgbWVzc2FnZVxuICAgICAgICAgICAgc2V0UmVzdWx0VmFsdWUoPHAgc3R5bGU9e3sgY29sb3I6ICdtYWdlbnRhJyB9fT5DaGVja2luZyA8aT57dXNlcm5hbWV9PC9pPiB7bGFuZ3VhZ2VDb2RlfSA8Yj57Ym9va0lEfTwvYj4gYm9vayBwYWNrYWdlc+KApjwvcD4pO1xuXG4gICAgICAgICAgICBjb25zdCByYXdHbEJQc1Jlc3VsdHMgPSBhd2FpdCBjaGVja0Jvb2tQYWNrYWdlKHVzZXJuYW1lLCBsYW5ndWFnZUNvZGUsIGJvb2tJRCwgc2V0UmVzdWx0VmFsdWUsIGNoZWNraW5nT3B0aW9ucyk7XG4gICAgICAgICAgICAvLyBkZWJ1Z0xvZyhcImNoZWNrQm9va1BhY2thZ2UoKSByZXR1cm5lZFwiLCB0eXBlb2YgcmF3Q0JQc1Jlc3VsdHMpOyAvLywgSlNPTi5zdHJpbmdpZnkocmF3Q0JQc1Jlc3VsdHMpKTtcblxuICAgICAgICAgICAgLy8gQWRkIHNvbWUgZXh0cmEgZmllbGRzIHRvIG91ciByYXdDQlBzUmVzdWx0cyBvYmplY3QgaW4gY2FzZSB3ZSBuZWVkIHRoaXMgaW5mb3JtYXRpb24gYWdhaW4gbGF0ZXJcbiAgICAgICAgICAgIHJhd0dsQlBzUmVzdWx0cy5jaGVja1R5cGUgPSAnR0xCb29rUGFja2FnZXMnO1xuICAgICAgICAgICAgcmF3R2xCUHNSZXN1bHRzLnVzZXJuYW1lID0gdXNlcm5hbWU7XG4gICAgICAgICAgICByYXdHbEJQc1Jlc3VsdHMubGFuZ3VhZ2VDb2RlID0gbGFuZ3VhZ2VDb2RlO1xuICAgICAgICAgICAgcmF3R2xCUHNSZXN1bHRzLmNoZWNrZWRPcHRpb25zID0gY2hlY2tpbmdPcHRpb25zO1xuXG4gICAgICAgICAgICAvLyBkZWJ1Z0xvZyhcIkhlcmUgd2l0aCBDQlBzIHJhd0NCUHNSZXN1bHRzXCIsIHR5cGVvZiByYXdDQlBzUmVzdWx0cyk7XG4gICAgICAgICAgICAvLyBOb3cgZG8gb3VyIGZpbmFsIGhhbmRsaW5nIG9mIHRoZSByZXN1bHQgLS0gd2UgaGF2ZSBzb21lIG9wdGlvbnMgYXZhaWxhYmxlXG4gICAgICAgICAgICBsZXQgcHJvY2Vzc09wdGlvbnMgPSB7IC8vIFVuY29tbWVudCBhbnkgb2YgdGhlc2UgdG8gdGVzdCB0aGVtXG4gICAgICAgICAgICAgICAgLy8gJ21heGltdW1TaW1pbGFyTWVzc2FnZXMnOiA0LCAvLyBkZWZhdWx0IGlzIDMgLS0gMCBtZWFucyBkb27igJl0IHN1cHByZXNzXG4gICAgICAgICAgICAgICAgLy8gJ2Vycm9yUHJpb3JpdHlMZXZlbCc6IDgwMCwgLy8gZGVmYXVsdCBpcyA3MDBcbiAgICAgICAgICAgICAgICAvLyAnY3V0b2ZmUHJpb3JpdHlMZXZlbCc6IDEwMCwgLy8gZGVmYXVsdCBpcyAwXG4gICAgICAgICAgICAgICAgLy8gJ3NvcnRCeSc6ICdCeVJlcG8nLCAvLyBkZWZhdWx0IGlzICdCeVByaW9yaXR5JywgYWxzbyBoYXZlICdBc0ZvdW5kJ1xuICAgICAgICAgICAgICAgIC8vICdpZ25vcmVQcmlvcml0eU51bWJlckxpc3QnOiBbMTIzLCAyMDJdLCAvLyBkZWZhdWx0IGlzIFtdXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLy8gT3IgdGhpcyBhbGxvd3MgdGhlIHBhcmFtZXRlcnMgdG8gYmUgc3BlY2lmaWVkIGFzIGEgR2xCb29rUGFja2FnZUNoZWNrIHByb3BlcnR5XG4gICAgICAgICAgICBpZiAocHJvcHMubWF4aW11bVNpbWlsYXJNZXNzYWdlcykgcHJvY2Vzc09wdGlvbnMubWF4aW11bVNpbWlsYXJNZXNzYWdlcyA9IG91clBhcnNlSW50KHByb3BzLm1heGltdW1TaW1pbGFyTWVzc2FnZXMpO1xuICAgICAgICAgICAgaWYgKHByb3BzLmVycm9yUHJpb3JpdHlMZXZlbCkgcHJvY2Vzc09wdGlvbnMuZXJyb3JQcmlvcml0eUxldmVsID0gb3VyUGFyc2VJbnQocHJvcHMuZXJyb3JQcmlvcml0eUxldmVsKTtcbiAgICAgICAgICAgIC8vIGlmIChwcm9wcy5jdXRvZmZQcmlvcml0eUxldmVsKSBwcm9jZXNzT3B0aW9ucy5jdXRvZmZQcmlvcml0eUxldmVsID0gb3VyUGFyc2VJbnQocHJvcHMuY3V0b2ZmUHJpb3JpdHlMZXZlbCk7XG4gICAgICAgICAgICBpZiAocHJvcHMuc29ydEJ5KSBwcm9jZXNzT3B0aW9ucy5zb3J0QnkgPSBwcm9wcy5zb3J0Qnk7XG4gICAgICAgICAgICAvLyBpZiAocHJvcHMuaWdub3JlUHJpb3JpdHlOdW1iZXJMaXN0KSBwcm9jZXNzT3B0aW9ucy5pZ25vcmVQcmlvcml0eU51bWJlckxpc3QgPSBwcm9wcy5pZ25vcmVQcmlvcml0eU51bWJlckxpc3Q7XG5cbiAgICAgICAgICAgIGxldCBkaXNwbGF5VHlwZSA9ICdFcnJvcnNXYXJuaW5ncyc7IC8vIGRlZmF1bHRcbiAgICAgICAgICAgIGlmIChwcm9wcy5kaXNwbGF5VHlwZSkgZGlzcGxheVR5cGUgPSBwcm9wcy5kaXNwbGF5VHlwZTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gcmVuZGVyU3VtbWFyeShwcm9jZXNzZWRSZXN1bHRzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICg8ZGl2PlxuICAgICAgICAgICAgICAgICAgICA8cD5DaGVja2VkIDxiPnt1c2VybmFtZX0ge2xhbmd1YWdlQ29kZX0ge2Jvb2tJRH08L2I+IChmcm9tIDxpPnticmFuY2ggPT09IHVuZGVmaW5lZCA/ICdERUZBVUxUJyA6IGJyYW5jaH08L2k+IGJyYW5jaGVzKTwvcD5cbiAgICAgICAgICAgICAgICAgICAgPFJlbmRlckNoZWNrZWRGaWxlc0xpc3QgdXNlcm5hbWU9e3VzZXJuYW1lfSByZXN1bHRzPXtwcm9jZXNzZWRSZXN1bHRzfSAvPlxuICAgICAgICAgICAgICAgICAgICA8UmVuZGVyVG90YWxzIHJhd05vdGljZUxpc3RMZW5ndGg9e3Jhd0dsQlBzUmVzdWx0cy5ub3RpY2VMaXN0Lmxlbmd0aH0gcmVzdWx0cz17cHJvY2Vzc2VkUmVzdWx0c30gLz5cbiAgICAgICAgICAgICAgICAgICAgey8qIDxSZW5kZXJSYXdSZXN1bHRzIHJlc3VsdHM9e3Jhd0NCUHNSZXN1bHRzfSAvPiAqL31cbiAgICAgICAgICAgICAgICA8L2Rpdj4pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZGlzcGxheVR5cGUgPT09ICdFcnJvcnNXYXJuaW5ncycpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9jZXNzZWRSZXN1bHRzID0gcHJvY2Vzc05vdGljZXNUb0Vycm9yc1dhcm5pbmdzKHJhd0dsQlBzUmVzdWx0cywgcHJvY2Vzc09wdGlvbnMpO1xuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICB1c2VyTG9nKGBHbEJvb2tQYWNrYWdlQ2hlY2sgZ290IGJhY2sgcHJvY2Vzc2VkUmVzdWx0cyB3aXRoICR7cHJvY2Vzc2VkUmVzdWx0cy5zdWNjZXNzTGlzdC5sZW5ndGgudG9Mb2NhbGVTdHJpbmcoKX0gc3VjY2VzcyBtZXNzYWdlKHMpLCAke3Byb2Nlc3NlZFJlc3VsdHMuZXJyb3JMaXN0Lmxlbmd0aC50b0xvY2FsZVN0cmluZygpfSBlcnJvcihzKSBhbmQgJHtwcm9jZXNzZWRSZXN1bHRzLndhcm5pbmdMaXN0Lmxlbmd0aC50b0xvY2FsZVN0cmluZygpfSB3YXJuaW5nKHMpXG4gICAgICAgICAgICAgICAgLy8gICBudW1JZ25vcmVkTm90aWNlcz0ke3Byb2Nlc3NlZFJlc3VsdHMubnVtSWdub3JlZE5vdGljZXMudG9Mb2NhbGVTdHJpbmcoKX0gbnVtSGlkZGVuRXJyb3JzPSR7cHJvY2Vzc2VkUmVzdWx0cy5udW1IaWRkZW5FcnJvcnMudG9Mb2NhbGVTdHJpbmcoKX0gbnVtSGlkZGVuV2FybmluZ3M9JHtwcm9jZXNzZWRSZXN1bHRzLm51bUhpZGRlbldhcm5pbmdzLnRvTG9jYWxlU3RyaW5nKCl9YCk7XG5cbiAgICAgICAgICAgICAgICAvLyBkZWJ1Z0xvZyhcIkhlcmUgbm93IGluIHJlbmRlcmluZyBiaXQhXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NlZFJlc3VsdHMuZXJyb3JMaXN0Lmxlbmd0aCB8fCBwcm9jZXNzZWRSZXN1bHRzLndhcm5pbmdMaXN0Lmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgc2V0UmVzdWx0VmFsdWUoPD5cbiAgICAgICAgICAgICAgICAgICAgICAgIHtyZW5kZXJTdW1tYXJ5KHByb2Nlc3NlZFJlc3VsdHMpfVxuICAgICAgICAgICAgICAgICAgICAgICAgPFJlbmRlclN1Y2Nlc3Nlc0Vycm9yc1dhcm5pbmdzIHJlc3VsdHM9e3Byb2Nlc3NlZFJlc3VsdHN9IC8+XG4gICAgICAgICAgICAgICAgICAgIDwvPik7XG4gICAgICAgICAgICAgICAgZWxzZSAvLyBubyBlcnJvcnMgb3Igd2FybmluZ3NcbiAgICAgICAgICAgICAgICAgICAgc2V0UmVzdWx0VmFsdWUoPD5cbiAgICAgICAgICAgICAgICAgICAgICAgIHtyZW5kZXJTdW1tYXJ5KHByb2Nlc3NlZFJlc3VsdHMpfVxuICAgICAgICAgICAgICAgICAgICAgICAgPFJlbmRlclN1Y2Nlc3Nlc0Vycm9yc1dhcm5pbmdzIHJlc3VsdHM9e3Byb2Nlc3NlZFJlc3VsdHN9IC8+XG4gICAgICAgICAgICAgICAgICAgIDwvPik7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGlzcGxheVR5cGUgPT09ICdTZXZlcmVNZWRpdW1Mb3cnKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkUmVzdWx0cyA9IHByb2Nlc3NOb3RpY2VzVG9TZXZlcmVNZWRpdW1Mb3cocmF3R2xCUHNSZXN1bHRzLCBwcm9jZXNzT3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIHVzZXJMb2coYEdsQm9va1BhY2thZ2VDaGVjayBnb3QgcHJvY2Vzc2VkIHJlc3VsdHMgd2l0aCAke3Byb2Nlc3NlZFJlc3VsdHMuc3VjY2Vzc0xpc3QubGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCl9IHN1Y2Nlc3MgbWVzc2FnZShzKSwgJHtwcm9jZXNzZWRSZXN1bHRzLmVycm9yTGlzdC5sZW5ndGgudG9Mb2NhbGVTdHJpbmcoKX0gZXJyb3IocykgYW5kICR7cHJvY2Vzc2VkUmVzdWx0cy53YXJuaW5nTGlzdC5sZW5ndGgudG9Mb2NhbGVTdHJpbmcoKX0gd2FybmluZyhzKVxuICAgICAgICAgICAgICAgIC8vICAgbnVtSWdub3JlZE5vdGljZXM9JHtwcm9jZXNzZWRSZXN1bHRzLm51bUlnbm9yZWROb3RpY2VzLnRvTG9jYWxlU3RyaW5nKCl9IG51bUhpZGRlbkVycm9ycz0ke3Byb2Nlc3NlZFJlc3VsdHMubnVtSGlkZGVuRXJyb3JzLnRvTG9jYWxlU3RyaW5nKCl9IG51bUhpZGRlbldhcm5pbmdzPSR7cHJvY2Vzc2VkUmVzdWx0cy5udW1IaWRkZW5XYXJuaW5ncy50b0xvY2FsZVN0cmluZygpfWApO1xuXG4gICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NlZFJlc3VsdHMuc2V2ZXJlTGlzdC5sZW5ndGggfHwgcHJvY2Vzc2VkUmVzdWx0cy5tZWRpdW1MaXN0Lmxlbmd0aCB8fCBwcm9jZXNzZWRSZXN1bHRzLmxvd0xpc3QubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICBzZXRSZXN1bHRWYWx1ZSg8PlxuICAgICAgICAgICAgICAgICAgICAgICAge3JlbmRlclN1bW1hcnkocHJvY2Vzc2VkUmVzdWx0cyl9XG4gICAgICAgICAgICAgICAgICAgICAgICA8UmVuZGVyU3VjY2Vzc2VzU2V2ZXJlTWVkaXVtTG93IHJlc3VsdHM9e3Byb2Nlc3NlZFJlc3VsdHN9IC8+XG4gICAgICAgICAgICAgICAgICAgIDwvPik7XG4gICAgICAgICAgICAgICAgZWxzZSAvLyBubyBzZXZlcmUsIG1lZGl1bSwgb3IgbG93IG5vdGljZXNcbiAgICAgICAgICAgICAgICAgICAgc2V0UmVzdWx0VmFsdWUoPD5cbiAgICAgICAgICAgICAgICAgICAgICAgIHtyZW5kZXJTdW1tYXJ5KHByb2Nlc3NlZFJlc3VsdHMpfVxuICAgICAgICAgICAgICAgICAgICAgICAgPFJlbmRlclN1Y2Nlc3Nlc1NldmVyZU1lZGl1bUxvdyByZXN1bHRzPXtwcm9jZXNzZWRSZXN1bHRzfSAvPlxuICAgICAgICAgICAgICAgICAgICA8Lz4pO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRpc3BsYXlUeXBlID09PSAnU2luZ2xlTGlzdCcpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9jZXNzZWRSZXN1bHRzID0gcHJvY2Vzc05vdGljZXNUb1NpbmdsZUxpc3QocmF3R2xCUHNSZXN1bHRzLCBwcm9jZXNzT3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIHVzZXJMb2coYEdsQm9va1BhY2thZ2VDaGVjayBnb3QgcHJvY2Vzc2VkIHJlc3VsdHMgd2l0aCAke3Byb2Nlc3NlZFJlc3VsdHMuc3VjY2Vzc0xpc3QubGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCl9IHN1Y2Nlc3MgbWVzc2FnZShzKSBhbmQgJHtwcm9jZXNzZWRSZXN1bHRzLndhcm5pbmdMaXN0Lmxlbmd0aC50b0xvY2FsZVN0cmluZygpfSBub3RpY2UocylcbiAgICAgICAgICAgICAgICAvLyAgIG51bUlnbm9yZWROb3RpY2VzPSR7cHJvY2Vzc2VkUmVzdWx0cy5udW1JZ25vcmVkTm90aWNlcy50b0xvY2FsZVN0cmluZygpfSBudW1IaWRkZW5XYXJuaW5ncz0ke3Byb2Nlc3NlZFJlc3VsdHMubnVtSGlkZGVuV2FybmluZ3MudG9Mb2NhbGVTdHJpbmcoKX1gKTtcblxuICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzZWRSZXN1bHRzLndhcm5pbmdMaXN0Lmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgc2V0UmVzdWx0VmFsdWUoPD5cbiAgICAgICAgICAgICAgICAgICAgICAgIHtyZW5kZXJTdW1tYXJ5KHByb2Nlc3NlZFJlc3VsdHMpfVxuICAgICAgICAgICAgICAgICAgICAgICAgPFJlbmRlclN1Y2Nlc3Nlc05vdGljZXNHcmFkaWVudCByZXN1bHRzPXtwcm9jZXNzZWRSZXN1bHRzfSAvPlxuICAgICAgICAgICAgICAgICAgICA8Lz4pO1xuICAgICAgICAgICAgICAgIGVsc2UgLy8gbm8gd2FybmluZ3NcbiAgICAgICAgICAgICAgICAgICAgc2V0UmVzdWx0VmFsdWUoPD5cbiAgICAgICAgICAgICAgICAgICAgICAgIHtyZW5kZXJTdW1tYXJ5KHByb2Nlc3NlZFJlc3VsdHMpfVxuICAgICAgICAgICAgICAgICAgICAgICAgPFJlbmRlclN1Y2Nlc3Nlc05vdGljZXNHcmFkaWVudCByZXN1bHRzPXtwcm9jZXNzZWRSZXN1bHRzfSAvPlxuICAgICAgICAgICAgICAgICAgICA8Lz4pO1xuICAgICAgICAgICAgfSBlbHNlIHNldFJlc3VsdFZhbHVlKDxiIHN0eWxlPXt7IGNvbG9yOiAncmVkJyB9fT5JbnZhbGlkIGRpc3BsYXlUeXBlPSd7ZGlzcGxheVR5cGV9JzwvYj4pXG5cbiAgICAgICAgICAgIC8vIGRlYnVnTG9nKFwiRmluaXNoZWQgcmVuZGVyaW5nIGJpdC5cIik7XG4gICAgICAgIH0pKCk7IC8vIGVuZCBvZiBhc3luYyBwYXJ0IGluIHVubmFtZWRGdW5jdGlvblxuICAgICAgICAvLyBEb2VzbuKAmXQgd29yayBpZiB3ZSBhZGQgdGhpcyB0byBuZXh0IGxpbmU6IGJvb2tJRExpc3QsYm9va0lEcyx1c2VybmFtZSxicmFuY2gsY2hlY2tpbmdPcHRpb25zLGxhbmd1YWdlQ29kZSxwcm9wc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gICAgfSwgW2Jvb2tJRCwgYnJhbmNoLCBKU09OLnN0cmluZ2lmeShjaGVja2luZ09wdGlvbnMpLCBsYW5ndWFnZUNvZGUsIEpTT04uc3RyaW5naWZ5KHByb3BzKSwgdXNlcm5hbWVdKTsgLy8gZW5kIG9mIHVzZUVmZmVjdCBwYXJ0XG5cbiAgICAvLyB7LyogPGRpdiBjbGFzc05hbWU9e2NsYXNzZXMucm9vdH0+ICovfVxuICAgIHJldHVybiAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiRnJlZFwiPlxuICAgICAgICAgICAge3Jlc3VsdH1cbiAgICAgICAgPC9kaXY+XG4gICAgKTtcbn1cblxuLy8gR2xCb29rUGFja2FnZUNoZWNrLnByb3BUeXBlcyA9IHtcbi8vICAgLyoqIEBpZ25vcmUgKi9cbi8vICAgdXNlcm5hbWU6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbi8vICAgLyoqIEBpZ25vcmUgKi9cbi8vICAgbGFuZ3VhZ2VDb2RlOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4vLyAgIGJvb2tJRHM6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbi8vICAgcHJvcHM6IFByb3BUeXBlcy5vYmplY3QsXG4vLyB9O1xuXG4vLyBjb25zdCBzdHlsZXMgPSB0aGVtZSA9PiAoe1xuLy8gICByb290OiB7XG4vLyAgIH0sXG4vLyB9KTtcblxuZXhwb3J0IGRlZmF1bHQgR2xCb29rUGFja2FnZUNoZWNrO1xuIl19