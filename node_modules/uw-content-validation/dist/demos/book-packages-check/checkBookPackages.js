"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");var _typeof = require("@babel/runtime/helpers/typeof");Object.defineProperty(exports, "__esModule", { value: true });exports.checkBookPackages = checkBookPackages;var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var books = _interopRequireWildcard(require("../../core/books/books"));
var _checkBookPackage = require("../book-package-check/checkBookPackage");

var _utilities = require("../../core/utilities");function _getRequireWildcardCache(nodeInterop) {if (typeof WeakMap !== "function") return null;var cacheBabelInterop = new WeakMap();var cacheNodeInterop = new WeakMap();return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {return nodeInterop ? cacheNodeInterop : cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj, nodeInterop) {if (!nodeInterop && obj && obj.__esModule) {return obj;}if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") {return { default: obj };}var cache = _getRequireWildcardCache(nodeInterop);if (cache && cache.has(obj)) {return cache.get(obj);}var newObj = {};var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;for (var key in obj) {if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;if (desc && (desc.get || desc.set)) {Object.defineProperty(newObj, key, desc);} else {newObj[key] = obj[key];}}}newObj.default = obj;if (cache) {cache.set(obj, newObj);}return newObj;}function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it.return != null) it.return();} finally {if (didErr) throw err;}} };}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) {arr2[i] = arr[i];}return arr2;}

// const BPs_VALIDATOR_VERSION_STRING = '0.2.6';


/**
 *
 * @param {string} username -- Door43 username/orgname
 * @param {string} languageCode
 * @param {*} bookIDList
 * @param {Function} setResultValue
 * @param {Object} checkingOptions
 */function
checkBookPackages(_x, _x2, _x3, _x4, _x5) {return _checkBookPackages.apply(this, arguments);}function _checkBookPackages() {_checkBookPackages = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(username, languageCode, bookIDList, setResultValue, checkingOptions) {var abortFlag, startTime, checkBookPackagesResult,














    addNotice, checkedFileCount, checkedFilenames, checkedFilenameExtensions, totalCheckedSize, checkedRepoNames, checkedBibleBPManifestFlag, _iterator, _step, bookID, bookNumberAndName, checkManifestFlag, checkReadmeFlag, checkLicenseFlag, cbpResultObject, index;return _regenerator.default.wrap(function _callee$(_context) {while (1) {switch (_context.prev = _context.next) {case 0:addNotice = function _addNotice(noticeObject) {
              // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.
              (0, _utilities.userLog)("cBPs addNotice: (priority=".concat(noticeObject.priority, ") ").concat(noticeObject.extra, " ").concat(noticeObject.message).concat(noticeObject.characterIndex > 0 ? " (at character ".concat(noticeObject.characterIndex, ")") : "").concat(noticeObject.excerpt ? " ".concat(noticeObject.excerpt) : "").concat(noticeObject.location));
              //parameterAssert(noticeObject.priority !== undefined, "cBPs addNotice: 'priority' parameter should be defined");
              //parameterAssert(typeof noticeObject.priority === 'number', `cBPs addNotice: 'priority' parameter should be a number not a '${typeof noticeObject.priority}'`);
              //parameterAssert(noticeObject.message !== undefined, "cBPs addNotice: 'message' parameter should be defined");
              //parameterAssert(typeof noticeObject.message === 'string', `cBPs addNotice: 'message' parameter should be a string not a '${typeof noticeObject.message}'`);
              // //parameterAssert(bookID !== undefined, "cBPs addNotice: 'bookID' parameter should be defined");
              if (noticeObject.bookID) {
                //parameterAssert(typeof noticeObject.bookID === 'string', `cBPs addNotice: 'bookID' parameter should be a string not a '${typeof noticeObject.bookID}'`);
                //parameterAssert(noticeObject.bookID.length === 3, `cBPs addNotice: 'bookID' parameter should be three characters long not ${noticeObject.bookID.length}`);
                //parameterAssert(books.isValidBookID(noticeObject.bookID), `cBPs addNotice: '${noticeObject.bookID}' is not a valid USFM book identifier`);
              }
              // //parameterAssert(C !== undefined, "cBPs addNotice: 'C' parameter should be defined");
              if (noticeObject.C) {//parameterAssert(typeof noticeObject.C === 'string', `cBPs addNotice: 'C' parameter should be a string not a '${typeof noticeObject.C}'`);
              }
              // //parameterAssert(V !== undefined, "cBPs addNotice: 'V' parameter should be defined");
              if (noticeObject.V) {//parameterAssert(typeof noticeObject.V === 'string', `cBPs addNotice: 'V' parameter should be a string not a '${typeof noticeObject.V}'`);
              }
              // //parameterAssert(characterIndex !== undefined, "cBPs addNotice: 'characterIndex' parameter should be defined");
              if (noticeObject.characterIndex) {//parameterAssert(typeof noticeObject.characterIndex === 'number', `cBPs addNotice: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}'`);
              }
              // //parameterAssert(excerpt !== undefined, "cBPs addNotice: 'excerpt' parameter should be defined");
              if (noticeObject.excerpt) {//parameterAssert(typeof noticeObject.excerpt === 'string', `cBPs addNotice: 'excerpt' parameter should be a string not a '${typeof noticeObject.excerpt}'`);
              }
              //parameterAssert(noticeObject.location !== undefined, "cBPs addNotice: 'location' parameter should be defined");
              //parameterAssert(typeof noticeObject.location === 'string', `cBPs addNotice: 'location' parameter should be a string not a '${typeof noticeObject.location}'`);
              //parameterAssert(noticeObject.extra !== undefined, "cBPs addNotice: 'extra' parameter should be defined");
              //parameterAssert(typeof noticeObject.extra === 'string', `cBPs addNotice: 'extra' parameter should be a string not a '${typeof extra}'`);
              checkBookPackagesResult.noticeList.push(noticeObject);
            }; // NOTE: dataSet is simply passed through here to checkBookPackage in checkingOptions
            //
            // userLog(`I'm here in checkBookPackages v${VALIDATOR_VERSION_STRING}
            //   with ${username}, ${languageCode}, ${bookIDList}, ${JSON.stringify(checkingOptions)}`);
            abortFlag = false;startTime = new Date();checkBookPackagesResult = { successList: [], noticeList: [] }; // function addSuccessMessage(successString) {
            //     // functionLog(`checkBookPackages success: ${successString}`);
            //     checkBookPackagesResult.successList.push(successString);
            // }
            // Main code for checkBookPackages()
            checkedFileCount = 0, checkedFilenames = [], checkedFilenameExtensions = new Set(), totalCheckedSize = 0, checkedRepoNames = new Set();checkedBibleBPManifestFlag = false;_iterator = _createForOfIteratorHelper(bookIDList);_context.prev = 7;_iterator.s();case 9:if ((_step = _iterator.n()).done) {_context.next = 40;break;}bookID = _step.value;if (!abortFlag) {_context.next = 13;break;}return _context.abrupt("break", 40);case 13:if (!(

            bookID !== 'OBS')) {_context.next = 23;break;}
            // eslint-disable-next-line no-unused-vars
            bookNumberAndName = void 0;_context.prev = 15;

            bookNumberAndName = books.usfmNumberName(bookID);_context.next = 23;break;case 19:_context.prev = 19;_context.t0 = _context["catch"](15);

            addNotice({ priority: 900, message: "Bad parameter: should be given a valid book abbreviation", excerpt: bookIDList, location: " (not '".concat(bookIDList, "')") });return _context.abrupt("return",
            checkBookPackagesResult);case 23:




            // We only want to check the manifest files for ONE Bible BP AND for OBS
            checkManifestFlag = false, checkReadmeFlag = false, checkLicenseFlag = false;
            if (bookID === 'OBS') {checkManifestFlag = true;checkReadmeFlag = true;checkLicenseFlag = true;} else
              // it’s a Bible book
              if (!checkedBibleBPManifestFlag) {
                checkManifestFlag = true;checkReadmeFlag = true;checkLicenseFlag = true;
                checkedBibleBPManifestFlag = true; // so we only do it once for Bible books
              }
            checkingOptions.checkManifestFlag = checkManifestFlag;
            checkingOptions.checkReadmeFlag = checkReadmeFlag;
            checkingOptions.checkLicenseFlag = checkLicenseFlag;

            // We use the generalLocation here (does not include repo name)
            //  so that we can adjust the returned strings ourselves
            _context.next = 30;return (0, _checkBookPackage.checkBookPackage)(username, languageCode, bookID, setResultValue, checkingOptions);case 30:cbpResultObject = _context.sent;
            // functionLog(`checkBookPackage() returned ${cbpResultObject.successList.length} success message(s) and ${cbpResultObject.noticeList.length} notice(s)`);

            // Concat is faster if we don’t need to process each success message individually
            checkBookPackagesResult.successList = checkBookPackagesResult.successList.concat(cbpResultObject.successList);
            // Process noticeList line by line,  appending the repoCode/bookID as an extra field as we go
            // for (const successEntry of cbpResultObject.successList) {
            //     // debugLog("  ourCheckBookPackage:", successEntry);
            //     addSuccessMessage(successEntry);
            // }

            // Concat is faster if we don’t need to process each notice individually
            checkBookPackagesResult.noticeList = checkBookPackagesResult.noticeList.concat(cbpResultObject.noticeList);
            // for (const noticeEntry of cbpResultObject.noticeList)
            //     // noticeEntry is an array of eight fields: 1=priority, 2=bookID, 3=C, 4=V, 5=msg, 6=characterIndex, 7=excerpt, 8=location
            //     // The extra value from checkBookPackage is the repo name
            //     addNotice({noticeEntry.priority, noticeEntry[1], noticeEntry[2], noticeEntry[3], noticeEntry[4], noticeEntry[5], noticeEntry[6], noticeEntry[7], noticeEntry[5]);

            checkedFileCount += cbpResultObject.checkedFileCount;
            checkedFilenames = [].concat((0, _toConsumableArray2.default)(checkedFilenames), (0, _toConsumableArray2.default)(cbpResultObject.checkedFilenames));
            checkedFilenameExtensions = new Set([].concat((0, _toConsumableArray2.default)(checkedFilenameExtensions), (0, _toConsumableArray2.default)(cbpResultObject.checkedFilenameExtensions)));
            totalCheckedSize += cbpResultObject.checkedFilesizes;
            checkedRepoNames = new Set([].concat((0, _toConsumableArray2.default)(checkedRepoNames), (0, _toConsumableArray2.default)(cbpResultObject.checkedRepoNames)));

            // addSuccessMessage(`${checkedFileCount.toLocaleString()}/ Checked ${bookID} book package`);
          case 38:_context.next = 9;break;case 40:_context.next = 45;break;case 42:_context.prev = 42;_context.t1 = _context["catch"](7);_iterator.e(_context.t1);case 45:_context.prev = 45;_iterator.f();return _context.finish(45);case 48:

            // Add some extra fields to our checkFileResult object
            //  in case we need this information again later
            checkBookPackagesResult.checkedFileCount = checkedFileCount;
            checkBookPackagesResult.checkedFilenames = checkedFilenames;
            checkBookPackagesResult.checkedFilenameExtensions = (0, _toConsumableArray2.default)(checkedFilenameExtensions); // convert Set to Array
            checkBookPackagesResult.checkedFilesizes = totalCheckedSize;
            checkedRepoNames = (0, _toConsumableArray2.default)(checkedRepoNames); // Convert set to Array
            index = checkedRepoNames.indexOf("".concat(username, "/").concat(languageCode, "_obs"));
            if (index !== -1) checkedRepoNames[index] = 'OBS'; // Looks tidier here
            checkBookPackagesResult.checkedRepoNames = checkedRepoNames;
            // checkBookPackagesResult.checkedOptions = checkingOptions; // This is done at the caller level

            // debugLog("checkBookPackages() is returning", checkBookPackagesResult.successList.length.toLocaleString(), "success message(s) and", checkBookPackagesResult.noticeList.length.toLocaleString(), "notice(s)");
            checkBookPackagesResult.elapsedSeconds = (new Date() - startTime) / 1000; // seconds
            return _context.abrupt("return", checkBookPackagesResult);case 58:case "end":return _context.stop();}}}, _callee, null, [[7, 42, 45, 48], [15, 19]]);}));return _checkBookPackages.apply(this, arguments);}
;
// end of checkBookPackages()
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kZW1vcy9ib29rLXBhY2thZ2VzLWNoZWNrL2NoZWNrQm9va1BhY2thZ2VzLmpzIl0sIm5hbWVzIjpbImNoZWNrQm9va1BhY2thZ2VzIiwidXNlcm5hbWUiLCJsYW5ndWFnZUNvZGUiLCJib29rSURMaXN0Iiwic2V0UmVzdWx0VmFsdWUiLCJjaGVja2luZ09wdGlvbnMiLCJhZGROb3RpY2UiLCJub3RpY2VPYmplY3QiLCJwcmlvcml0eSIsImV4dHJhIiwibWVzc2FnZSIsImNoYXJhY3RlckluZGV4IiwiZXhjZXJwdCIsImxvY2F0aW9uIiwiYm9va0lEIiwiQyIsIlYiLCJjaGVja0Jvb2tQYWNrYWdlc1Jlc3VsdCIsIm5vdGljZUxpc3QiLCJwdXNoIiwiYWJvcnRGbGFnIiwic3RhcnRUaW1lIiwiRGF0ZSIsInN1Y2Nlc3NMaXN0IiwiY2hlY2tlZEZpbGVDb3VudCIsImNoZWNrZWRGaWxlbmFtZXMiLCJjaGVja2VkRmlsZW5hbWVFeHRlbnNpb25zIiwiU2V0IiwidG90YWxDaGVja2VkU2l6ZSIsImNoZWNrZWRSZXBvTmFtZXMiLCJjaGVja2VkQmlibGVCUE1hbmlmZXN0RmxhZyIsImJvb2tOdW1iZXJBbmROYW1lIiwiYm9va3MiLCJ1c2ZtTnVtYmVyTmFtZSIsImNoZWNrTWFuaWZlc3RGbGFnIiwiY2hlY2tSZWFkbWVGbGFnIiwiY2hlY2tMaWNlbnNlRmxhZyIsImNicFJlc3VsdE9iamVjdCIsImNvbmNhdCIsImNoZWNrZWRGaWxlc2l6ZXMiLCJpbmRleCIsImluZGV4T2YiLCJlbGFwc2VkU2Vjb25kcyJdLCJtYXBwaW5ncyI6ImdpQkFBQTtBQUNBOztBQUVBLGlEOztBQUVBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEc7QUFDc0JBLGlCLHdNQUFmLGlCQUFpQ0MsUUFBakMsRUFBMkNDLFlBQTNDLEVBQXlEQyxVQUF6RCxFQUFxRUMsY0FBckUsRUFBcUZDLGVBQXJGOzs7Ozs7Ozs7Ozs7Ozs7QUFlTUMs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QUEsdUJBQXVCLENBQUNTLHlCQUF4QixvQ0FBd0RBLHlCQUF4RCxFQWpIRyxDQWlIaUY7QUFDcEZULFlBQUFBLHVCQUF1QixDQUFDc0IsZ0JBQXhCLEdBQTJDWCxnQkFBM0M7QUFDQUMsWUFBQUEsZ0JBQWdCLG9DQUFPQSxnQkFBUCxDQUFoQixDQW5IRyxDQW1IdUM7QUFDcENXLFlBQUFBLEtBcEhILEdBb0hXWCxnQkFBZ0IsQ0FBQ1ksT0FBakIsV0FBNEJ4QyxRQUE1QixjQUF3Q0MsWUFBeEMsVUFwSFg7QUFxSEgsZ0JBQUlzQyxLQUFLLEtBQUssQ0FBQyxDQUFmLEVBQWtCWCxnQkFBZ0IsQ0FBQ1csS0FBRCxDQUFoQixHQUEwQixLQUExQixDQXJIZixDQXFIZ0Q7QUFDbkR2QixZQUFBQSx1QkFBdUIsQ0FBQ1ksZ0JBQXhCLEdBQTJDQSxnQkFBM0M7QUFDQTs7QUFFQTtBQUNBWixZQUFBQSx1QkFBdUIsQ0FBQ3lCLGNBQXhCLEdBQXlDLENBQUMsSUFBSXBCLElBQUosS0FBYUQsU0FBZCxJQUEyQixJQUFwRSxDQTFIRyxDQTBIdUU7QUExSHZFLDZDQTJISUosdUJBM0hKLDhGO0FBNEhOO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBib29rcyBmcm9tICcuLi8uLi9jb3JlL2Jvb2tzL2Jvb2tzJztcbmltcG9ydCB7IGNoZWNrQm9va1BhY2thZ2UgfSBmcm9tICcuLi9ib29rLXBhY2thZ2UtY2hlY2svY2hlY2tCb29rUGFja2FnZSc7XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbmltcG9ydCB7IHVzZXJMb2csIHBhcmFtZXRlckFzc2VydCB9IGZyb20gJy4uLy4uL2NvcmUvdXRpbGl0aWVzJztcblxuLy8gY29uc3QgQlBzX1ZBTElEQVRPUl9WRVJTSU9OX1NUUklORyA9ICcwLjIuNic7XG5cblxuLyoqXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVzZXJuYW1lIC0tIERvb3I0MyB1c2VybmFtZS9vcmduYW1lXG4gKiBAcGFyYW0ge3N0cmluZ30gbGFuZ3VhZ2VDb2RlXG4gKiBAcGFyYW0geyp9IGJvb2tJRExpc3RcbiAqIEBwYXJhbSB7RnVuY3Rpb259IHNldFJlc3VsdFZhbHVlXG4gKiBAcGFyYW0ge09iamVjdH0gY2hlY2tpbmdPcHRpb25zXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja0Jvb2tQYWNrYWdlcyh1c2VybmFtZSwgbGFuZ3VhZ2VDb2RlLCBib29rSURMaXN0LCBzZXRSZXN1bHRWYWx1ZSwgY2hlY2tpbmdPcHRpb25zKSB7XG4gICAgLy8gTk9URTogZGF0YVNldCBpcyBzaW1wbHkgcGFzc2VkIHRocm91Z2ggaGVyZSB0byBjaGVja0Jvb2tQYWNrYWdlIGluIGNoZWNraW5nT3B0aW9uc1xuICAgIC8vXG4gICAgLy8gdXNlckxvZyhgSSdtIGhlcmUgaW4gY2hlY2tCb29rUGFja2FnZXMgdiR7VkFMSURBVE9SX1ZFUlNJT05fU1RSSU5HfVxuICAgIC8vICAgd2l0aCAke3VzZXJuYW1lfSwgJHtsYW5ndWFnZUNvZGV9LCAke2Jvb2tJRExpc3R9LCAke0pTT04uc3RyaW5naWZ5KGNoZWNraW5nT3B0aW9ucyl9YCk7XG4gICAgbGV0IGFib3J0RmxhZyA9IGZhbHNlO1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7XG5cbiAgICBjb25zdCBjaGVja0Jvb2tQYWNrYWdlc1Jlc3VsdCA9IHsgc3VjY2Vzc0xpc3Q6IFtdLCBub3RpY2VMaXN0OiBbXSB9O1xuXG4gICAgLy8gZnVuY3Rpb24gYWRkU3VjY2Vzc01lc3NhZ2Uoc3VjY2Vzc1N0cmluZykge1xuICAgIC8vICAgICAvLyBmdW5jdGlvbkxvZyhgY2hlY2tCb29rUGFja2FnZXMgc3VjY2VzczogJHtzdWNjZXNzU3RyaW5nfWApO1xuICAgIC8vICAgICBjaGVja0Jvb2tQYWNrYWdlc1Jlc3VsdC5zdWNjZXNzTGlzdC5wdXNoKHN1Y2Nlc3NTdHJpbmcpO1xuICAgIC8vIH1cblxuICAgIGZ1bmN0aW9uIGFkZE5vdGljZShub3RpY2VPYmplY3QpIHtcbiAgICAgICAgLy8gYm9va0lEIGlzIGEgdGhyZWUtY2hhcmFjdGVyIFVQUEVSQ0FTRSBVU0ZNIGJvb2sgaWRlbnRpZmllciBvciAnT0JTJy5cbiAgICAgICAgdXNlckxvZyhgY0JQcyBhZGROb3RpY2U6IChwcmlvcml0eT0ke25vdGljZU9iamVjdC5wcmlvcml0eX0pICR7bm90aWNlT2JqZWN0LmV4dHJhfSAke25vdGljZU9iamVjdC5tZXNzYWdlfSR7bm90aWNlT2JqZWN0LmNoYXJhY3RlckluZGV4ID4gMCA/IGAgKGF0IGNoYXJhY3RlciAke25vdGljZU9iamVjdC5jaGFyYWN0ZXJJbmRleH0pYCA6IFwiXCJ9JHtub3RpY2VPYmplY3QuZXhjZXJwdCA/IGAgJHtub3RpY2VPYmplY3QuZXhjZXJwdH1gIDogXCJcIn0ke25vdGljZU9iamVjdC5sb2NhdGlvbn1gKTtcbiAgICAgICAgLy9wYXJhbWV0ZXJBc3NlcnQobm90aWNlT2JqZWN0LnByaW9yaXR5ICE9PSB1bmRlZmluZWQsIFwiY0JQcyBhZGROb3RpY2U6ICdwcmlvcml0eScgcGFyYW1ldGVyIHNob3VsZCBiZSBkZWZpbmVkXCIpO1xuICAgICAgICAvL3BhcmFtZXRlckFzc2VydCh0eXBlb2Ygbm90aWNlT2JqZWN0LnByaW9yaXR5ID09PSAnbnVtYmVyJywgYGNCUHMgYWRkTm90aWNlOiAncHJpb3JpdHknIHBhcmFtZXRlciBzaG91bGQgYmUgYSBudW1iZXIgbm90IGEgJyR7dHlwZW9mIG5vdGljZU9iamVjdC5wcmlvcml0eX0nYCk7XG4gICAgICAgIC8vcGFyYW1ldGVyQXNzZXJ0KG5vdGljZU9iamVjdC5tZXNzYWdlICE9PSB1bmRlZmluZWQsIFwiY0JQcyBhZGROb3RpY2U6ICdtZXNzYWdlJyBwYXJhbWV0ZXIgc2hvdWxkIGJlIGRlZmluZWRcIik7XG4gICAgICAgIC8vcGFyYW1ldGVyQXNzZXJ0KHR5cGVvZiBub3RpY2VPYmplY3QubWVzc2FnZSA9PT0gJ3N0cmluZycsIGBjQlBzIGFkZE5vdGljZTogJ21lc3NhZ2UnIHBhcmFtZXRlciBzaG91bGQgYmUgYSBzdHJpbmcgbm90IGEgJyR7dHlwZW9mIG5vdGljZU9iamVjdC5tZXNzYWdlfSdgKTtcbiAgICAgICAgLy8gLy9wYXJhbWV0ZXJBc3NlcnQoYm9va0lEICE9PSB1bmRlZmluZWQsIFwiY0JQcyBhZGROb3RpY2U6ICdib29rSUQnIHBhcmFtZXRlciBzaG91bGQgYmUgZGVmaW5lZFwiKTtcbiAgICAgICAgaWYgKG5vdGljZU9iamVjdC5ib29rSUQpIHtcbiAgICAgICAgICAgIC8vcGFyYW1ldGVyQXNzZXJ0KHR5cGVvZiBub3RpY2VPYmplY3QuYm9va0lEID09PSAnc3RyaW5nJywgYGNCUHMgYWRkTm90aWNlOiAnYm9va0lEJyBwYXJhbWV0ZXIgc2hvdWxkIGJlIGEgc3RyaW5nIG5vdCBhICcke3R5cGVvZiBub3RpY2VPYmplY3QuYm9va0lEfSdgKTtcbiAgICAgICAgICAgIC8vcGFyYW1ldGVyQXNzZXJ0KG5vdGljZU9iamVjdC5ib29rSUQubGVuZ3RoID09PSAzLCBgY0JQcyBhZGROb3RpY2U6ICdib29rSUQnIHBhcmFtZXRlciBzaG91bGQgYmUgdGhyZWUgY2hhcmFjdGVycyBsb25nIG5vdCAke25vdGljZU9iamVjdC5ib29rSUQubGVuZ3RofWApO1xuICAgICAgICAgICAgLy9wYXJhbWV0ZXJBc3NlcnQoYm9va3MuaXNWYWxpZEJvb2tJRChub3RpY2VPYmplY3QuYm9va0lEKSwgYGNCUHMgYWRkTm90aWNlOiAnJHtub3RpY2VPYmplY3QuYm9va0lEfScgaXMgbm90IGEgdmFsaWQgVVNGTSBib29rIGlkZW50aWZpZXJgKTtcbiAgICAgICAgfVxuICAgICAgICAvLyAvL3BhcmFtZXRlckFzc2VydChDICE9PSB1bmRlZmluZWQsIFwiY0JQcyBhZGROb3RpY2U6ICdDJyBwYXJhbWV0ZXIgc2hvdWxkIGJlIGRlZmluZWRcIik7XG4gICAgICAgIGlmIChub3RpY2VPYmplY3QuQykgeyAvL3BhcmFtZXRlckFzc2VydCh0eXBlb2Ygbm90aWNlT2JqZWN0LkMgPT09ICdzdHJpbmcnLCBgY0JQcyBhZGROb3RpY2U6ICdDJyBwYXJhbWV0ZXIgc2hvdWxkIGJlIGEgc3RyaW5nIG5vdCBhICcke3R5cGVvZiBub3RpY2VPYmplY3QuQ30nYCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gLy9wYXJhbWV0ZXJBc3NlcnQoViAhPT0gdW5kZWZpbmVkLCBcImNCUHMgYWRkTm90aWNlOiAnVicgcGFyYW1ldGVyIHNob3VsZCBiZSBkZWZpbmVkXCIpO1xuICAgICAgICBpZiAobm90aWNlT2JqZWN0LlYpIHsgLy9wYXJhbWV0ZXJBc3NlcnQodHlwZW9mIG5vdGljZU9iamVjdC5WID09PSAnc3RyaW5nJywgYGNCUHMgYWRkTm90aWNlOiAnVicgcGFyYW1ldGVyIHNob3VsZCBiZSBhIHN0cmluZyBub3QgYSAnJHt0eXBlb2Ygbm90aWNlT2JqZWN0LlZ9J2ApO1xuICAgICAgICB9XG4gICAgICAgIC8vIC8vcGFyYW1ldGVyQXNzZXJ0KGNoYXJhY3RlckluZGV4ICE9PSB1bmRlZmluZWQsIFwiY0JQcyBhZGROb3RpY2U6ICdjaGFyYWN0ZXJJbmRleCcgcGFyYW1ldGVyIHNob3VsZCBiZSBkZWZpbmVkXCIpO1xuICAgICAgICBpZiAobm90aWNlT2JqZWN0LmNoYXJhY3RlckluZGV4KSB7IC8vcGFyYW1ldGVyQXNzZXJ0KHR5cGVvZiBub3RpY2VPYmplY3QuY2hhcmFjdGVySW5kZXggPT09ICdudW1iZXInLCBgY0JQcyBhZGROb3RpY2U6ICdjaGFyYWN0ZXJJbmRleCcgcGFyYW1ldGVyIHNob3VsZCBiZSBhIG51bWJlciBub3QgYSAnJHt0eXBlb2Ygbm90aWNlT2JqZWN0LmNoYXJhY3RlckluZGV4fSdgKTtcbiAgICAgICAgfVxuICAgICAgICAvLyAvL3BhcmFtZXRlckFzc2VydChleGNlcnB0ICE9PSB1bmRlZmluZWQsIFwiY0JQcyBhZGROb3RpY2U6ICdleGNlcnB0JyBwYXJhbWV0ZXIgc2hvdWxkIGJlIGRlZmluZWRcIik7XG4gICAgICAgIGlmIChub3RpY2VPYmplY3QuZXhjZXJwdCkgeyAvL3BhcmFtZXRlckFzc2VydCh0eXBlb2Ygbm90aWNlT2JqZWN0LmV4Y2VycHQgPT09ICdzdHJpbmcnLCBgY0JQcyBhZGROb3RpY2U6ICdleGNlcnB0JyBwYXJhbWV0ZXIgc2hvdWxkIGJlIGEgc3RyaW5nIG5vdCBhICcke3R5cGVvZiBub3RpY2VPYmplY3QuZXhjZXJwdH0nYCk7XG4gICAgICAgIH1cbiAgICAgICAgLy9wYXJhbWV0ZXJBc3NlcnQobm90aWNlT2JqZWN0LmxvY2F0aW9uICE9PSB1bmRlZmluZWQsIFwiY0JQcyBhZGROb3RpY2U6ICdsb2NhdGlvbicgcGFyYW1ldGVyIHNob3VsZCBiZSBkZWZpbmVkXCIpO1xuICAgICAgICAvL3BhcmFtZXRlckFzc2VydCh0eXBlb2Ygbm90aWNlT2JqZWN0LmxvY2F0aW9uID09PSAnc3RyaW5nJywgYGNCUHMgYWRkTm90aWNlOiAnbG9jYXRpb24nIHBhcmFtZXRlciBzaG91bGQgYmUgYSBzdHJpbmcgbm90IGEgJyR7dHlwZW9mIG5vdGljZU9iamVjdC5sb2NhdGlvbn0nYCk7XG4gICAgICAgIC8vcGFyYW1ldGVyQXNzZXJ0KG5vdGljZU9iamVjdC5leHRyYSAhPT0gdW5kZWZpbmVkLCBcImNCUHMgYWRkTm90aWNlOiAnZXh0cmEnIHBhcmFtZXRlciBzaG91bGQgYmUgZGVmaW5lZFwiKTtcbiAgICAgICAgLy9wYXJhbWV0ZXJBc3NlcnQodHlwZW9mIG5vdGljZU9iamVjdC5leHRyYSA9PT0gJ3N0cmluZycsIGBjQlBzIGFkZE5vdGljZTogJ2V4dHJhJyBwYXJhbWV0ZXIgc2hvdWxkIGJlIGEgc3RyaW5nIG5vdCBhICcke3R5cGVvZiBleHRyYX0nYCk7XG4gICAgICAgIGNoZWNrQm9va1BhY2thZ2VzUmVzdWx0Lm5vdGljZUxpc3QucHVzaChub3RpY2VPYmplY3QpO1xuICAgIH1cblxuXG4gICAgLy8gTWFpbiBjb2RlIGZvciBjaGVja0Jvb2tQYWNrYWdlcygpXG4gICAgbGV0IGNoZWNrZWRGaWxlQ291bnQgPSAwLCBjaGVja2VkRmlsZW5hbWVzID0gW10sIGNoZWNrZWRGaWxlbmFtZUV4dGVuc2lvbnMgPSBuZXcgU2V0KCksIHRvdGFsQ2hlY2tlZFNpemUgPSAwLCBjaGVja2VkUmVwb05hbWVzID0gbmV3IFNldCgpO1xuICAgIGxldCBjaGVja2VkQmlibGVCUE1hbmlmZXN0RmxhZyA9IGZhbHNlO1xuICAgIGZvciAoY29uc3QgYm9va0lEIG9mIGJvb2tJRExpc3QpIHtcbiAgICAgICAgLy8gZnVuY3Rpb25Mb2coYGNoZWNrQm9va1BhY2thZ2VzIGJvb2tJRDogJHtib29rSUR9YCk7XG4gICAgICAgIGlmIChhYm9ydEZsYWcpIGJyZWFrO1xuXG4gICAgICAgIC8vIGNvbnN0IGdlbmVyYWxMb2NhdGlvbiA9IGAgJHtsYW5ndWFnZUNvZGV9ICR7Ym9va0lEfSBib29rIHBhY2thZ2VzIGZyb20gJHt1c2VybmFtZX1gO1xuICAgICAgICBpZiAoYm9va0lEICE9PSAnT0JTJykge1xuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gICAgICAgICAgICBsZXQgYm9va051bWJlckFuZE5hbWU7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGJvb2tOdW1iZXJBbmROYW1lID0gYm9va3MudXNmbU51bWJlck5hbWUoYm9va0lEKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKENCUHNFcnJvcikge1xuICAgICAgICAgICAgICAgIGFkZE5vdGljZSh7IHByaW9yaXR5OiA5MDAsIG1lc3NhZ2U6IFwiQmFkIHBhcmFtZXRlcjogc2hvdWxkIGJlIGdpdmVuIGEgdmFsaWQgYm9vayBhYmJyZXZpYXRpb25cIiwgZXhjZXJwdDogYm9va0lETGlzdCwgbG9jYXRpb246IGAgKG5vdCAnJHtib29rSURMaXN0fScpYCB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2hlY2tCb29rUGFja2FnZXNSZXN1bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBkZWJ1Z0xvZyhgYm9va051bWJlckFuZE5hbWU9JyR7Ym9va051bWJlckFuZE5hbWV9JyAoJHt3aGljaFRlc3RhbWVudH0gdGVzdGFtZW50KWApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gV2Ugb25seSB3YW50IHRvIGNoZWNrIHRoZSBtYW5pZmVzdCBmaWxlcyBmb3IgT05FIEJpYmxlIEJQIEFORCBmb3IgT0JTXG4gICAgICAgIGxldCBjaGVja01hbmlmZXN0RmxhZyA9IGZhbHNlLCBjaGVja1JlYWRtZUZsYWcgPSBmYWxzZSwgY2hlY2tMaWNlbnNlRmxhZyA9IGZhbHNlO1xuICAgICAgICBpZiAoYm9va0lEID09PSAnT0JTJykgeyBjaGVja01hbmlmZXN0RmxhZyA9IHRydWU7IGNoZWNrUmVhZG1lRmxhZyA9IHRydWU7IGNoZWNrTGljZW5zZUZsYWcgPSB0cnVlOyB9XG4gICAgICAgIGVsc2UgLy8gaXTigJlzIGEgQmlibGUgYm9va1xuICAgICAgICAgICAgaWYgKCFjaGVja2VkQmlibGVCUE1hbmlmZXN0RmxhZykge1xuICAgICAgICAgICAgICAgIGNoZWNrTWFuaWZlc3RGbGFnID0gdHJ1ZTsgY2hlY2tSZWFkbWVGbGFnID0gdHJ1ZTsgY2hlY2tMaWNlbnNlRmxhZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgY2hlY2tlZEJpYmxlQlBNYW5pZmVzdEZsYWcgPSB0cnVlOyAvLyBzbyB3ZSBvbmx5IGRvIGl0IG9uY2UgZm9yIEJpYmxlIGJvb2tzXG4gICAgICAgICAgICB9XG4gICAgICAgIGNoZWNraW5nT3B0aW9ucy5jaGVja01hbmlmZXN0RmxhZyA9IGNoZWNrTWFuaWZlc3RGbGFnO1xuICAgICAgICBjaGVja2luZ09wdGlvbnMuY2hlY2tSZWFkbWVGbGFnID0gY2hlY2tSZWFkbWVGbGFnO1xuICAgICAgICBjaGVja2luZ09wdGlvbnMuY2hlY2tMaWNlbnNlRmxhZyA9IGNoZWNrTGljZW5zZUZsYWc7XG5cbiAgICAgICAgLy8gV2UgdXNlIHRoZSBnZW5lcmFsTG9jYXRpb24gaGVyZSAoZG9lcyBub3QgaW5jbHVkZSByZXBvIG5hbWUpXG4gICAgICAgIC8vICBzbyB0aGF0IHdlIGNhbiBhZGp1c3QgdGhlIHJldHVybmVkIHN0cmluZ3Mgb3Vyc2VsdmVzXG4gICAgICAgIGNvbnN0IGNicFJlc3VsdE9iamVjdCA9IGF3YWl0IGNoZWNrQm9va1BhY2thZ2UodXNlcm5hbWUsIGxhbmd1YWdlQ29kZSwgYm9va0lELCBzZXRSZXN1bHRWYWx1ZSwgY2hlY2tpbmdPcHRpb25zKTtcbiAgICAgICAgLy8gZnVuY3Rpb25Mb2coYGNoZWNrQm9va1BhY2thZ2UoKSByZXR1cm5lZCAke2NicFJlc3VsdE9iamVjdC5zdWNjZXNzTGlzdC5sZW5ndGh9IHN1Y2Nlc3MgbWVzc2FnZShzKSBhbmQgJHtjYnBSZXN1bHRPYmplY3Qubm90aWNlTGlzdC5sZW5ndGh9IG5vdGljZShzKWApO1xuXG4gICAgICAgIC8vIENvbmNhdCBpcyBmYXN0ZXIgaWYgd2UgZG9u4oCZdCBuZWVkIHRvIHByb2Nlc3MgZWFjaCBzdWNjZXNzIG1lc3NhZ2UgaW5kaXZpZHVhbGx5XG4gICAgICAgIGNoZWNrQm9va1BhY2thZ2VzUmVzdWx0LnN1Y2Nlc3NMaXN0ID0gY2hlY2tCb29rUGFja2FnZXNSZXN1bHQuc3VjY2Vzc0xpc3QuY29uY2F0KGNicFJlc3VsdE9iamVjdC5zdWNjZXNzTGlzdCk7XG4gICAgICAgIC8vIFByb2Nlc3Mgbm90aWNlTGlzdCBsaW5lIGJ5IGxpbmUsICBhcHBlbmRpbmcgdGhlIHJlcG9Db2RlL2Jvb2tJRCBhcyBhbiBleHRyYSBmaWVsZCBhcyB3ZSBnb1xuICAgICAgICAvLyBmb3IgKGNvbnN0IHN1Y2Nlc3NFbnRyeSBvZiBjYnBSZXN1bHRPYmplY3Quc3VjY2Vzc0xpc3QpIHtcbiAgICAgICAgLy8gICAgIC8vIGRlYnVnTG9nKFwiICBvdXJDaGVja0Jvb2tQYWNrYWdlOlwiLCBzdWNjZXNzRW50cnkpO1xuICAgICAgICAvLyAgICAgYWRkU3VjY2Vzc01lc3NhZ2Uoc3VjY2Vzc0VudHJ5KTtcbiAgICAgICAgLy8gfVxuXG4gICAgICAgIC8vIENvbmNhdCBpcyBmYXN0ZXIgaWYgd2UgZG9u4oCZdCBuZWVkIHRvIHByb2Nlc3MgZWFjaCBub3RpY2UgaW5kaXZpZHVhbGx5XG4gICAgICAgIGNoZWNrQm9va1BhY2thZ2VzUmVzdWx0Lm5vdGljZUxpc3QgPSBjaGVja0Jvb2tQYWNrYWdlc1Jlc3VsdC5ub3RpY2VMaXN0LmNvbmNhdChjYnBSZXN1bHRPYmplY3Qubm90aWNlTGlzdCk7XG4gICAgICAgIC8vIGZvciAoY29uc3Qgbm90aWNlRW50cnkgb2YgY2JwUmVzdWx0T2JqZWN0Lm5vdGljZUxpc3QpXG4gICAgICAgIC8vICAgICAvLyBub3RpY2VFbnRyeSBpcyBhbiBhcnJheSBvZiBlaWdodCBmaWVsZHM6IDE9cHJpb3JpdHksIDI9Ym9va0lELCAzPUMsIDQ9ViwgNT1tc2csIDY9Y2hhcmFjdGVySW5kZXgsIDc9ZXhjZXJwdCwgOD1sb2NhdGlvblxuICAgICAgICAvLyAgICAgLy8gVGhlIGV4dHJhIHZhbHVlIGZyb20gY2hlY2tCb29rUGFja2FnZSBpcyB0aGUgcmVwbyBuYW1lXG4gICAgICAgIC8vICAgICBhZGROb3RpY2Uoe25vdGljZUVudHJ5LnByaW9yaXR5LCBub3RpY2VFbnRyeVsxXSwgbm90aWNlRW50cnlbMl0sIG5vdGljZUVudHJ5WzNdLCBub3RpY2VFbnRyeVs0XSwgbm90aWNlRW50cnlbNV0sIG5vdGljZUVudHJ5WzZdLCBub3RpY2VFbnRyeVs3XSwgbm90aWNlRW50cnlbNV0pO1xuXG4gICAgICAgIGNoZWNrZWRGaWxlQ291bnQgKz0gY2JwUmVzdWx0T2JqZWN0LmNoZWNrZWRGaWxlQ291bnQ7XG4gICAgICAgIGNoZWNrZWRGaWxlbmFtZXMgPSBbLi4uY2hlY2tlZEZpbGVuYW1lcywgLi4uY2JwUmVzdWx0T2JqZWN0LmNoZWNrZWRGaWxlbmFtZXNdO1xuICAgICAgICBjaGVja2VkRmlsZW5hbWVFeHRlbnNpb25zID0gbmV3IFNldChbLi4uY2hlY2tlZEZpbGVuYW1lRXh0ZW5zaW9ucywgLi4uY2JwUmVzdWx0T2JqZWN0LmNoZWNrZWRGaWxlbmFtZUV4dGVuc2lvbnNdKTtcbiAgICAgICAgdG90YWxDaGVja2VkU2l6ZSArPSBjYnBSZXN1bHRPYmplY3QuY2hlY2tlZEZpbGVzaXplcztcbiAgICAgICAgY2hlY2tlZFJlcG9OYW1lcyA9IG5ldyBTZXQoWy4uLmNoZWNrZWRSZXBvTmFtZXMsIC4uLmNicFJlc3VsdE9iamVjdC5jaGVja2VkUmVwb05hbWVzXSk7XG5cbiAgICAgICAgLy8gYWRkU3VjY2Vzc01lc3NhZ2UoYCR7Y2hlY2tlZEZpbGVDb3VudC50b0xvY2FsZVN0cmluZygpfS8gQ2hlY2tlZCAke2Jvb2tJRH0gYm9vayBwYWNrYWdlYCk7XG4gICAgfVxuXG4gICAgLy8gQWRkIHNvbWUgZXh0cmEgZmllbGRzIHRvIG91ciBjaGVja0ZpbGVSZXN1bHQgb2JqZWN0XG4gICAgLy8gIGluIGNhc2Ugd2UgbmVlZCB0aGlzIGluZm9ybWF0aW9uIGFnYWluIGxhdGVyXG4gICAgY2hlY2tCb29rUGFja2FnZXNSZXN1bHQuY2hlY2tlZEZpbGVDb3VudCA9IGNoZWNrZWRGaWxlQ291bnQ7XG4gICAgY2hlY2tCb29rUGFja2FnZXNSZXN1bHQuY2hlY2tlZEZpbGVuYW1lcyA9IGNoZWNrZWRGaWxlbmFtZXM7XG4gICAgY2hlY2tCb29rUGFja2FnZXNSZXN1bHQuY2hlY2tlZEZpbGVuYW1lRXh0ZW5zaW9ucyA9IFsuLi5jaGVja2VkRmlsZW5hbWVFeHRlbnNpb25zXTsgLy8gY29udmVydCBTZXQgdG8gQXJyYXlcbiAgICBjaGVja0Jvb2tQYWNrYWdlc1Jlc3VsdC5jaGVja2VkRmlsZXNpemVzID0gdG90YWxDaGVja2VkU2l6ZTtcbiAgICBjaGVja2VkUmVwb05hbWVzID0gWy4uLmNoZWNrZWRSZXBvTmFtZXNdOyAvLyBDb252ZXJ0IHNldCB0byBBcnJheVxuICAgIGNvbnN0IGluZGV4ID0gY2hlY2tlZFJlcG9OYW1lcy5pbmRleE9mKGAke3VzZXJuYW1lfS8ke2xhbmd1YWdlQ29kZX1fb2JzYCk7XG4gICAgaWYgKGluZGV4ICE9PSAtMSkgY2hlY2tlZFJlcG9OYW1lc1tpbmRleF0gPSAnT0JTJzsgLy8gTG9va3MgdGlkaWVyIGhlcmVcbiAgICBjaGVja0Jvb2tQYWNrYWdlc1Jlc3VsdC5jaGVja2VkUmVwb05hbWVzID0gY2hlY2tlZFJlcG9OYW1lcztcbiAgICAvLyBjaGVja0Jvb2tQYWNrYWdlc1Jlc3VsdC5jaGVja2VkT3B0aW9ucyA9IGNoZWNraW5nT3B0aW9uczsgLy8gVGhpcyBpcyBkb25lIGF0IHRoZSBjYWxsZXIgbGV2ZWxcblxuICAgIC8vIGRlYnVnTG9nKFwiY2hlY2tCb29rUGFja2FnZXMoKSBpcyByZXR1cm5pbmdcIiwgY2hlY2tCb29rUGFja2FnZXNSZXN1bHQuc3VjY2Vzc0xpc3QubGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCksIFwic3VjY2VzcyBtZXNzYWdlKHMpIGFuZFwiLCBjaGVja0Jvb2tQYWNrYWdlc1Jlc3VsdC5ub3RpY2VMaXN0Lmxlbmd0aC50b0xvY2FsZVN0cmluZygpLCBcIm5vdGljZShzKVwiKTtcbiAgICBjaGVja0Jvb2tQYWNrYWdlc1Jlc3VsdC5lbGFwc2VkU2Vjb25kcyA9IChuZXcgRGF0ZSgpIC0gc3RhcnRUaW1lKSAvIDEwMDA7IC8vIHNlY29uZHNcbiAgICByZXR1cm4gY2hlY2tCb29rUGFja2FnZXNSZXN1bHQ7XG59O1xuLy8gZW5kIG9mIGNoZWNrQm9va1BhY2thZ2VzKClcbiJdfQ==