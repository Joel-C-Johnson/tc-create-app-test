"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");var _typeof = require("@babel/runtime/helpers/typeof");Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react = _interopRequireWildcard(require("react"));

var books = _interopRequireWildcard(require("../../core/books/books"));
var _core = require("../../core");
var _checkBookPackages = require("./checkBookPackages");
var _noticeProcessingFunctions = require("../notice-processing-functions");
var _RenderProcessedResults = require("../RenderProcessedResults");

var _utilities = require("../../core/utilities");function _getRequireWildcardCache(nodeInterop) {if (typeof WeakMap !== "function") return null;var cacheBabelInterop = new WeakMap();var cacheNodeInterop = new WeakMap();return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {return nodeInterop ? cacheNodeInterop : cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj, nodeInterop) {if (!nodeInterop && obj && obj.__esModule) {return obj;}if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") {return { default: obj };}var cache = _getRequireWildcardCache(nodeInterop);if (cache && cache.has(obj)) {return cache.get(obj);}var newObj = {};var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;for (var key in obj) {if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;if (desc && (desc.get || desc.set)) {Object.defineProperty(newObj, key, desc);} else {newObj[key] = obj[key];}}}newObj.default = obj;if (cache) {cache.set(obj, newObj);}return newObj;}function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it.return != null) it.return();} finally {if (didErr) throw err;}} };}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) {arr2[i] = arr[i];}return arr2;}


// const BPS_VALIDATOR_VERSION_STRING = '0.2.7';


/**
 *
 * @param {Object} props
 */
function BookPackagesCheck( /*username, languageCode, bookIDs,*/props) {
  // Check a single Bible book across many repositories
  var _useState = (0, _react.useState)("Waiting-CheckBookPackages"),_useState2 = (0, _slicedToArray2.default)(_useState, 2),result = _useState2[0],setResultValue = _useState2[1];

  // debugLog(`I'm here in BookPackagesCheck v${BPS_VALIDATOR_VERSION_STRING}`);
  // consoleLogObject("props", props);
  // consoleLogObject("props.classes", props.classes);

  var username = props.username;
  // debugLog(`username='${username}'`);
  var languageCode = props.languageCode;
  // debugLog(`languageCode='${languageCode}'`);
  var bookIDs = props.bookIDs;
  // debugLog(`bookIDs='${bookIDs}'`);
  var dataSet = props.dataSet;
  // debugLog(`dataSet='${dataSet}'`);
  var branch = props.branch;
  // debugLog(`branch='${branch}'`);

  var bookIDList = [];
  var bookIDInvalid;
  var haveOT = false,haveNT = false;var _iterator = _createForOfIteratorHelper(
  bookIDs.split(',')),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var bookID = _step.value;
      bookID = bookID.trim();
      if (!books.isValidBookID(bookID) && bookID !== 'OBS') {
        bookIDInvalid = bookID;
      }
      bookIDList.push(bookID);
      if (books.isValidBookID(bookID)) {
        var whichTestament = books.testament(bookID);
        (0, _utilities.logicAssert)(whichTestament === 'old' || whichTestament === 'new', "BookPackagesCheck() couldn't find testament for '".concat(bookID, "'"));
        if (whichTestament === 'old') haveOT = true;
        if (whichTestament === 'new') haveNT = true;
      }
    }
    // debugLog(`bookIDList (${bookIDList.length}) = ${bookIDList.join(', ')}`);
  } catch (err) {_iterator.e(err);} finally {_iterator.f();}
  var checkingOptions = { // Uncomment any of these to test them
    dataSet: dataSet, // Can be 'OLD' (Markdown, etc.), 'NEW' (TSV only), or 'BOTH', or 'DEFAULT'
    // excerptLength: 25,
    suppressNoticeDisablingFlag: true // Leave this one as true (otherwise demo checks are less efficient)
  };
  // Or this allows the parameters to be specified as a BookPackagesCheck property
  if (props.excerptLength) checkingOptions.excerptLength = (0, _core.ourParseInt)(props.excerptLength);
  if (props.cutoffPriorityLevel) checkingOptions.cutoffPriorityLevel = (0, _core.ourParseInt)(props.cutoffPriorityLevel);
  if (props.disableAllLinkFetchingFlag) checkingOptions.disableAllLinkFetchingFlag = props.disableAllLinkFetchingFlag.toLowerCase() === 'true';
  if (props.disableLinkedTAArticlesCheckFlag) checkingOptions.disableLinkedTAArticlesCheckFlag = props.disableLinkedTAArticlesCheckFlag.toLowerCase() === 'true';
  if (props.disableLinkedTWArticlesCheckFlag) checkingOptions.disableLinkedTWArticlesCheckFlag = props.disableLinkedTWArticlesCheckFlag.toLowerCase() === 'true';
  // functionLog(`checkingOptions.disableLinkedTAArticlesCheckFlag ${checkingOptions.disableLinkedTAArticlesCheckFlag} from '${props.disableLinkedTAArticlesCheckFlag}'`);
  // functionLog(`checkingOptions.disableLinkedTWArticlesCheckFlag ${checkingOptions.disableLinkedTWArticlesCheckFlag} from '${props.disableLinkedTWArticlesCheckFlag}'`);

  (0, _react.useEffect)(function () {
    // debugLog("BookPackagesCheck.useEffect() called with ", JSON.stringify(props));

    // Use an IIFE (Immediately Invoked Function Expression)
    //  e.g., see https://medium.com/javascript-in-plain-english/https-medium-com-javascript-in-plain-english-stop-feeling-iffy-about-using-an-iife-7b0292aba174
    (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {var repoPreloadList, obsRepoPreloadList, successFlag, rawCBPsResults, processOptions, displayType,
















































































      renderSummary, processedResults, _processedResults, _processedResults2;return _regenerator.default.wrap(function _callee$(_context) {while (1) {switch (_context.prev = _context.next) {case 0:renderSummary = function _renderSummary(processedResults) {
                return /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/
                _react.default.createElement("p", null, "Checked ", /*#__PURE__*/_react.default.createElement("b", null, username, " ", languageCode, " ", bookIDList.join(', ')), " (from ", /*#__PURE__*/_react.default.createElement("i", null, branch === undefined ? 'DEFAULT' : branch), " branches)"), /*#__PURE__*/
                _react.default.createElement(_RenderProcessedResults.RenderCheckedFilesList, { username: username, results: processedResults }), /*#__PURE__*/
                _react.default.createElement(_RenderProcessedResults.RenderTotals, { rawNoticeListLength: rawCBPsResults.noticeList.length, results: processedResults }));


              };if (!(!props.wait || props.wait !== 'N')) {_context.next = 4;break;}setResultValue( /*#__PURE__*/_react.default.createElement("p", null, /*#__PURE__*/_react.default.createElement("span", { style: { color: 'blue' } }, "Waiting for user\u2026"), " (Adjust settings below as necessary and then set ", /*#__PURE__*/_react.default.createElement("b", null, "wait='N'"), " to start)"));return _context.abrupt("return");case 4:if (!(props.reloadAllFilesFirst && props.reloadAllFilesFirst.slice(0).toUpperCase() === 'Y')) {_context.next = 11;break;}(0, _utilities.userLog)("Clearing cache before running book packages check…");setResultValue( /*#__PURE__*/_react.default.createElement("p", { style: { color: 'orange' } }, "Clearing cache before running book packages check\u2026"));_context.next = 9;return (0, _core.clearCaches)();case 9:_context.next = 13;break;case 11:_context.next = 13;return (0, _core.clearCheckedArticleCache)();case 13: // otherwise we wouldn't see any of the warnings again from checking these
              // Load whole repos, especially if we are going to check files in manifests
              repoPreloadList = ['TWL', 'LT', 'ST', 'TN', 'TQ', 'SN', 'SQ']; // for DEFAULT
              if (dataSet === 'OLD') repoPreloadList = ['TWL', 'LT', 'ST', 'TN', 'TQ'];else if (dataSet === 'NEW') repoPreloadList = ['TWL', 'LT', 'ST', 'TN2', 'TQ2', 'SN', 'SQ'];else if (dataSet === 'BOTH') repoPreloadList = ['TWL', 'LT', 'ST', 'TN', 'TN2', 'TQ', 'TQ2', 'SN', 'SQ'];if (haveNT) repoPreloadList.unshift('UGNT');if (haveOT) repoPreloadList.unshift('UHB');if (!checkingOptions.disableAllLinkFetchingFlag) {repoPreloadList.push('TW');repoPreloadList.push('TA');}if (bookIDList.includes('OBS')) {obsRepoPreloadList = ['OBS', 'OBS-TWL', 'OBS-TN2', 'OBS-TQ2', 'OBS-SN2', 'OBS-SQ2']; // for DEFAULT
                if (dataSet === 'OLD') obsRepoPreloadList = ['OBS', 'OBS-TWL', 'OBS-TN', 'OBS-TQ', 'OBS-SN', 'OBS-SQ'];else if (dataSet === 'NEW') obsRepoPreloadList = ['OBS', 'OBS-TWL', 'OBS-TN2', 'OBS-TQ2', 'OBS-SN2', 'OBS-SQ2'];else if (dataSet === 'BOTH') obsRepoPreloadList = ['OBS', 'OBS-TWL', 'OBS-TN', 'OBS-TN2', 'OBS-TQ', 'OBS-TQ2', 'OBS-SN', 'OBS-SN', 'OBS-SN2', 'OBS-SQ2'];repoPreloadList.push.apply(repoPreloadList, obsRepoPreloadList);} // debugLog(`BookPackagesCheck got repoPreloadList=${repoPreloadList} for dataSet=${dataSet}`)
              setResultValue( /*#__PURE__*/_react.default.createElement("p", { style: { color: 'magenta' } }, "Preloading ", repoPreloadList.length, " repos for ", /*#__PURE__*/_react.default.createElement("i", null, username), " ", languageCode, " ready for book packages check\u2026"));_context.next = 22;return (0, _core.preloadReposIfNecessary)(username, languageCode, bookIDList, branch, repoPreloadList);case 22:successFlag = _context.sent;if (!successFlag) console.error("BookPackagesCheck error: Failed to pre-load all repos"); // Display our "waiting" message
              setResultValue( /*#__PURE__*/_react.default.createElement("p", { style: { color: 'magenta' } }, "Checking ", /*#__PURE__*/_react.default.createElement("i", null, username), " ", languageCode, " ", /*#__PURE__*/_react.default.createElement("b", null, bookIDList.join(', ')), " book packages\u2026"));_context.next = 27;return (0, _checkBookPackages.checkBookPackages)(username, languageCode, bookIDList, setResultValue, checkingOptions);case 27:rawCBPsResults = _context.sent; // Add some extra fields to our rawCBPsResults object in case we need this information again later
              rawCBPsResults.checkType = 'BookPackages';rawCBPsResults.username = username;rawCBPsResults.languageCode = languageCode;rawCBPsResults.bookIDs = bookIDs;rawCBPsResults.bookIDList = bookIDList;rawCBPsResults.checkedOptions = checkingOptions; // debugLog("Here with CBPs rawCBPsResults", typeof rawCBPsResults);
              // Now do our final handling of the result -- we have some options available
              processOptions = {// Uncomment any of these to test them
                // 'maximumSimilarMessages': 4, // default is 3 -- 0 means don’t suppress
                // 'errorPriorityLevel': 800, // default is 700
                // 'cutoffPriorityLevel': 100, // default is 0
                // 'sortBy': 'ByRepo', // default is 'ByPriority', also have 'AsFound'
                // 'ignorePriorityNumberList': [123, 202], // default is []
              }; // Or this allows the parameters to be specified as a BookPackagesCheck property
              if (props.maximumSimilarMessages) processOptions.maximumSimilarMessages = (0, _core.ourParseInt)(props.maximumSimilarMessages);if (props.errorPriorityLevel) processOptions.errorPriorityLevel = (0, _core.ourParseInt)(props.errorPriorityLevel); // if (props.cutoffPriorityLevel) processOptions.cutoffPriorityLevel = ourParseInt(props.cutoffPriorityLevel);
              if (props.sortBy) processOptions.sortBy = props.sortBy; // if (props.ignorePriorityNumberList) processOptions.ignorePriorityNumberList = props.ignorePriorityNumberList;
              if (props.showDisabledNoticesFlag) processOptions.showDisabledNoticesFlag = props.showDisabledNoticesFlag.toLowerCase() === 'true';displayType = 'ErrorsWarnings'; // default
              if (props.displayType) displayType = props.displayType;if (displayType === 'ErrorsWarnings') {processedResults = (0, _noticeProcessingFunctions.processNoticesToErrorsWarnings)(rawCBPsResults, processOptions); //       userLog(`BookPackagesCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)
                // numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numHiddenErrors=${processedResults.numHiddenErrors.toLocaleString()} numHiddenWarnings=${processedResults.numHiddenWarnings.toLocaleString()}`);
                // debugLog("Here now in rendering bit!");
                if (processedResults.errorList.length || processedResults.warningList.length) setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, renderSummary(processedResults), /*#__PURE__*/_react.default.createElement(_RenderProcessedResults.RenderSuccessesErrorsWarnings, { results: processedResults })));else // no errors or warnings
                  setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, renderSummary(processedResults), /*#__PURE__*/_react.default.createElement(_RenderProcessedResults.RenderSuccessesErrorsWarnings, { results: processedResults })));} else if (displayType === 'SevereMediumLow') {_processedResults = (0, _noticeProcessingFunctions.processNoticesToSevereMediumLow)(rawCBPsResults, processOptions); //                 userLog(`BookPackagesCheck got processed results with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)
                //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numHiddenErrors=${processedResults.numHiddenErrors.toLocaleString()} numHiddenWarnings=${processedResults.numHiddenWarnings.toLocaleString()}`);
                if (_processedResults.severeList.length || _processedResults.mediumList.length || _processedResults.lowList.length)
                setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null,
                renderSummary(_processedResults), /*#__PURE__*/
                _react.default.createElement(_RenderProcessedResults.RenderSuccessesSevereMediumLow, { results: _processedResults })));else

                  // no severe, medium, or low notices
                  setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null,
                  renderSummary(_processedResults), /*#__PURE__*/
                  _react.default.createElement(_RenderProcessedResults.RenderSuccessesSevereMediumLow, { results: _processedResults })));


              } else if (displayType === 'SingleList') {
                _processedResults2 = (0, _noticeProcessingFunctions.processNoticesToSingleList)(rawCBPsResults, processOptions);
                //       userLog(`BookPackagesCheck got processed results with ${processedResults.successList.length.toLocaleString()} success message(s) and ${processedResults.warningList.length.toLocaleString()} notice(s)
                // numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numHiddenWarnings=${processedResults.numHiddenWarnings.toLocaleString()}`);

                if (_processedResults2.warningList.length)
                setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/
                _react.default.createElement("div", null, renderSummary(_processedResults2),
                _processedResults2.numIgnoredNotices ? " (but ".concat(_processedResults2.numIgnoredNotices.toLocaleString(), " ignored errors/warnings)") : ""), /*#__PURE__*/
                _react.default.createElement(_RenderProcessedResults.RenderSuccessesNoticesGradient, { results: _processedResults2 })));else

                  // no warnings
                  setResultValue( /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null,
                  renderSummary(_processedResults2), /*#__PURE__*/
                  _react.default.createElement(_RenderProcessedResults.RenderSuccessesNoticesGradient, { results: _processedResults2 })));

              } else setResultValue( /*#__PURE__*/_react.default.createElement("b", { style: { color: 'red' } }, "Invalid displayType='", displayType, "'"));

              // debugLog("Finished rendering bit.");
            case 42:case "end":return _context.stop();}}}, _callee);}))(); // end of async part in unnamedFunction
    // Doesn’t work if we add this to next line: bookIDList,bookIDs,username,branch,checkingOptions,languageCode,props
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [JSON.stringify(bookIDList), bookIDs, branch, JSON.stringify(checkingOptions), languageCode, JSON.stringify(props), username]); // end of useEffect part

  if (bookIDInvalid) {
    return /*#__PURE__*/_react.default.createElement("p", null, "Please enter only valid USFM book identifiers separated by commas. ('", bookIDInvalid, "' is not valid.)");
  }

  // {/* <div className={classes.root}> */}
  return /*#__PURE__*/(
    _react.default.createElement("div", { className: "Fred" },
    result));


}

// BookPackagesCheck.propTypes = {
//   /** @ignore */
//   username: PropTypes.object.isRequired,
//   /** @ignore */
//   languageCode: PropTypes.object.isRequired,
//   bookIDs: PropTypes.object.isRequired,
//   props: PropTypes.object,
// };

// const styles = theme => ({
//   root: {
//   },
// });
var _default =
BookPackagesCheck;exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kZW1vcy9ib29rLXBhY2thZ2VzLWNoZWNrL0Jvb2tQYWNrYWdlc0NoZWNrLmpzIl0sIm5hbWVzIjpbIkJvb2tQYWNrYWdlc0NoZWNrIiwicHJvcHMiLCJyZXN1bHQiLCJzZXRSZXN1bHRWYWx1ZSIsInVzZXJuYW1lIiwibGFuZ3VhZ2VDb2RlIiwiYm9va0lEcyIsImRhdGFTZXQiLCJicmFuY2giLCJib29rSURMaXN0IiwiYm9va0lESW52YWxpZCIsImhhdmVPVCIsImhhdmVOVCIsInNwbGl0IiwiYm9va0lEIiwidHJpbSIsImJvb2tzIiwiaXNWYWxpZEJvb2tJRCIsInB1c2giLCJ3aGljaFRlc3RhbWVudCIsInRlc3RhbWVudCIsImNoZWNraW5nT3B0aW9ucyIsInN1cHByZXNzTm90aWNlRGlzYWJsaW5nRmxhZyIsImV4Y2VycHRMZW5ndGgiLCJjdXRvZmZQcmlvcml0eUxldmVsIiwiZGlzYWJsZUFsbExpbmtGZXRjaGluZ0ZsYWciLCJ0b0xvd2VyQ2FzZSIsImRpc2FibGVMaW5rZWRUQUFydGljbGVzQ2hlY2tGbGFnIiwiZGlzYWJsZUxpbmtlZFRXQXJ0aWNsZXNDaGVja0ZsYWciLCJyZW5kZXJTdW1tYXJ5IiwicHJvY2Vzc2VkUmVzdWx0cyIsImpvaW4iLCJ1bmRlZmluZWQiLCJyYXdDQlBzUmVzdWx0cyIsIm5vdGljZUxpc3QiLCJsZW5ndGgiLCJ3YWl0IiwiY29sb3IiLCJyZWxvYWRBbGxGaWxlc0ZpcnN0Iiwic2xpY2UiLCJ0b1VwcGVyQ2FzZSIsInJlcG9QcmVsb2FkTGlzdCIsInVuc2hpZnQiLCJpbmNsdWRlcyIsIm9ic1JlcG9QcmVsb2FkTGlzdCIsImFwcGx5Iiwic3VjY2Vzc0ZsYWciLCJjb25zb2xlIiwiZXJyb3IiLCJjaGVja1R5cGUiLCJjaGVja2VkT3B0aW9ucyIsInByb2Nlc3NPcHRpb25zIiwibWF4aW11bVNpbWlsYXJNZXNzYWdlcyIsImVycm9yUHJpb3JpdHlMZXZlbCIsInNvcnRCeSIsInNob3dEaXNhYmxlZE5vdGljZXNGbGFnIiwiZGlzcGxheVR5cGUiLCJlcnJvckxpc3QiLCJ3YXJuaW5nTGlzdCIsInNldmVyZUxpc3QiLCJtZWRpdW1MaXN0IiwibG93TGlzdCIsIm51bUlnbm9yZWROb3RpY2VzIiwidG9Mb2NhbGVTdHJpbmciLCJKU09OIiwic3RyaW5naWZ5Il0sIm1hcHBpbmdzIjoibWdCQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsaUQ7OztBQUdBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVNBLGlCQUFULEVBQTJCLG9DQUFxQ0MsS0FBaEUsRUFBdUU7QUFDckU7QUFDQSxrQkFBaUMscUJBQVMsMkJBQVQsQ0FBakMseURBQU9DLE1BQVAsaUJBQWVDLGNBQWY7O0FBRUE7QUFDQTtBQUNBOztBQUVBLE1BQUlDLFFBQVEsR0FBR0gsS0FBSyxDQUFDRyxRQUFyQjtBQUNBO0FBQ0EsTUFBSUMsWUFBWSxHQUFHSixLQUFLLENBQUNJLFlBQXpCO0FBQ0E7QUFDQSxNQUFJQyxPQUFPLEdBQUdMLEtBQUssQ0FBQ0ssT0FBcEI7QUFDQTtBQUNBLE1BQUlDLE9BQU8sR0FBR04sS0FBSyxDQUFDTSxPQUFwQjtBQUNBO0FBQ0EsTUFBSUMsTUFBTSxHQUFHUCxLQUFLLENBQUNPLE1BQW5CO0FBQ0E7O0FBRUEsTUFBTUMsVUFBVSxHQUFHLEVBQW5CO0FBQ0EsTUFBSUMsYUFBSjtBQUNBLE1BQUlDLE1BQU0sR0FBRyxLQUFiLENBQW9CQyxNQUFNLEdBQUcsS0FBN0IsQ0FyQnFFO0FBc0JsRE4sRUFBQUEsT0FBTyxDQUFDTyxLQUFSLENBQWMsR0FBZCxDQXRCa0QsYUFzQnJFLG9EQUF1QyxLQUE5QkMsTUFBOEI7QUFDckNBLE1BQUFBLE1BQU0sR0FBR0EsTUFBTSxDQUFDQyxJQUFQLEVBQVQ7QUFDQSxVQUFJLENBQUNDLEtBQUssQ0FBQ0MsYUFBTixDQUFvQkgsTUFBcEIsQ0FBRCxJQUFnQ0EsTUFBTSxLQUFLLEtBQS9DLEVBQXNEO0FBQ3BESixRQUFBQSxhQUFhLEdBQUdJLE1BQWhCO0FB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QUFELEVBQTZCSCxPQUE3QixFQUFzQ0UsTUFBdEMsRUFBOEN3RCxJQUFJLENBQUNDLFNBQUwsQ0FBZTVDLGVBQWYsQ0FBOUMsRUFBK0VoQixZQUEvRSxFQUE2RjJELElBQUksQ0FBQ0MsU0FBTCxDQUFlaEUsS0FBZixDQUE3RixFQUFvSEcsUUFBcEgsQ0F2SkgsRUFuRHFFLENBME04RDs7QUFFbkksTUFBSU0sYUFBSixFQUFtQjtBQUNqQix3QkFBUSxpSEFBeUVBLGFBQXpFLHFCQUFSO0FBQ0Q7O0FBRUQ7QUFDQTtBQUNFLDBDQUFLLFNBQVMsRUFBQyxNQUFmO0FBQ0dSLElBQUFBLE1BREgsQ0FERjs7O0FBS0Q7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFZUYsaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlU3RhdGUsIHVzZUVmZmVjdCB9IGZyb20gJ3JlYWN0Jztcbi8vIGltcG9ydCB7IHdpdGhTdHlsZXMgfSBmcm9tICdAbWF0ZXJpYWwtdWkvY29yZS9zdHlsZXMnO1xuaW1wb3J0ICogYXMgYm9va3MgZnJvbSAnLi4vLi4vY29yZS9ib29rcy9ib29rcyc7XG5pbXBvcnQgeyBjbGVhckNhY2hlcywgY2xlYXJDaGVja2VkQXJ0aWNsZUNhY2hlLCBvdXJQYXJzZUludCwgcHJlbG9hZFJlcG9zSWZOZWNlc3NhcnkgfSBmcm9tICcuLi8uLi9jb3JlJztcbmltcG9ydCB7IGNoZWNrQm9va1BhY2thZ2VzIH0gZnJvbSAnLi9jaGVja0Jvb2tQYWNrYWdlcyc7XG5pbXBvcnQgeyBwcm9jZXNzTm90aWNlc1RvRXJyb3JzV2FybmluZ3MsIHByb2Nlc3NOb3RpY2VzVG9TZXZlcmVNZWRpdW1Mb3csIHByb2Nlc3NOb3RpY2VzVG9TaW5nbGVMaXN0IH0gZnJvbSAnLi4vbm90aWNlLXByb2Nlc3NpbmctZnVuY3Rpb25zJztcbmltcG9ydCB7IFJlbmRlckNoZWNrZWRGaWxlc0xpc3QsIFJlbmRlclN1Y2Nlc3Nlc0Vycm9yc1dhcm5pbmdzLCBSZW5kZXJTdWNjZXNzZXNTZXZlcmVNZWRpdW1Mb3csIFJlbmRlclN1Y2Nlc3Nlc05vdGljZXNHcmFkaWVudCwgUmVuZGVyVG90YWxzIH0gZnJvbSAnLi4vUmVuZGVyUHJvY2Vzc2VkUmVzdWx0cyc7XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbmltcG9ydCB7IHVzZXJMb2csIGRlYnVnTG9nLCBsb2dpY0Fzc2VydCB9IGZyb20gJy4uLy4uL2NvcmUvdXRpbGl0aWVzJztcblxuXG4vLyBjb25zdCBCUFNfVkFMSURBVE9SX1ZFUlNJT05fU1RSSU5HID0gJzAuMi43JztcblxuXG4vKipcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gcHJvcHNcbiAqL1xuZnVuY3Rpb24gQm9va1BhY2thZ2VzQ2hlY2soLyp1c2VybmFtZSwgbGFuZ3VhZ2VDb2RlLCBib29rSURzLCovIHByb3BzKSB7XG4gIC8vIENoZWNrIGEgc2luZ2xlIEJpYmxlIGJvb2sgYWNyb3NzIG1hbnkgcmVwb3NpdG9yaWVzXG4gIGNvbnN0IFtyZXN1bHQsIHNldFJlc3VsdFZhbHVlXSA9IHVzZVN0YXRlKFwiV2FpdGluZy1DaGVja0Jvb2tQYWNrYWdlc1wiKTtcblxuICAvLyBkZWJ1Z0xvZyhgSSdtIGhlcmUgaW4gQm9va1BhY2thZ2VzQ2hlY2sgdiR7QlBTX1ZBTElEQVRPUl9WRVJTSU9OX1NUUklOR31gKTtcbiAgLy8gY29uc29sZUxvZ09iamVjdChcInByb3BzXCIsIHByb3BzKTtcbiAgLy8gY29uc29sZUxvZ09iamVjdChcInByb3BzLmNsYXNzZXNcIiwgcHJvcHMuY2xhc3Nlcyk7XG5cbiAgbGV0IHVzZXJuYW1lID0gcHJvcHMudXNlcm5hbWU7XG4gIC8vIGRlYnVnTG9nKGB1c2VybmFtZT0nJHt1c2VybmFtZX0nYCk7XG4gIGxldCBsYW5ndWFnZUNvZGUgPSBwcm9wcy5sYW5ndWFnZUNvZGU7XG4gIC8vIGRlYnVnTG9nKGBsYW5ndWFnZUNvZGU9JyR7bGFuZ3VhZ2VDb2RlfSdgKTtcbiAgbGV0IGJvb2tJRHMgPSBwcm9wcy5ib29rSURzO1xuICAvLyBkZWJ1Z0xvZyhgYm9va0lEcz0nJHtib29rSURzfSdgKTtcbiAgbGV0IGRhdGFTZXQgPSBwcm9wcy5kYXRhU2V0O1xuICAvLyBkZWJ1Z0xvZyhgZGF0YVNldD0nJHtkYXRhU2V0fSdgKTtcbiAgbGV0IGJyYW5jaCA9IHByb3BzLmJyYW5jaDtcbiAgLy8gZGVidWdMb2coYGJyYW5jaD0nJHticmFuY2h9J2ApO1xuXG4gIGNvbnN0IGJvb2tJRExpc3QgPSBbXTtcbiAgbGV0IGJvb2tJREludmFsaWQ7XG4gIGxldCBoYXZlT1QgPSBmYWxzZSwgaGF2ZU5UID0gZmFsc2U7XG4gIGZvciAobGV0IGJvb2tJRCBvZiBib29rSURzLnNwbGl0KCcsJykpIHtcbiAgICBib29rSUQgPSBib29rSUQudHJpbSgpO1xuICAgIGlmICghYm9va3MuaXNWYWxpZEJvb2tJRChib29rSUQpICYmIGJvb2tJRCAhPT0gJ09CUycpIHtcbiAgICAgIGJvb2tJREludmFsaWQgPSBib29rSUQ7XG4gICAgfVxuICAgIGJvb2tJRExpc3QucHVzaChib29rSUQpO1xuICAgIGlmIChib29rcy5pc1ZhbGlkQm9va0lEKGJvb2tJRCkpIHtcbiAgICAgIGNvbnN0IHdoaWNoVGVzdGFtZW50ID0gYm9va3MudGVzdGFtZW50KGJvb2tJRCk7XG4gICAgICBsb2dpY0Fzc2VydCh3aGljaFRlc3RhbWVudCA9PT0gJ29sZCcgfHwgd2hpY2hUZXN0YW1lbnQgPT09ICduZXcnLCBgQm9va1BhY2thZ2VzQ2hlY2soKSBjb3VsZG4ndCBmaW5kIHRlc3RhbWVudCBmb3IgJyR7Ym9va0lEfSdgKTtcbiAgICAgIGlmICh3aGljaFRlc3RhbWVudCA9PT0gJ29sZCcpIGhhdmVPVCA9IHRydWU7XG4gICAgICBpZiAod2hpY2hUZXN0YW1lbnQgPT09ICduZXcnKSBoYXZlTlQgPSB0cnVlO1xuICAgIH1cbiAgfVxuICAvLyBkZWJ1Z0xvZyhgYm9va0lETGlzdCAoJHtib29rSURMaXN0Lmxlbmd0aH0pID0gJHtib29rSURMaXN0LmpvaW4oJywgJyl9YCk7XG5cbiAgY29uc3QgY2hlY2tpbmdPcHRpb25zID0geyAvLyBVbmNvbW1lbnQgYW55IG9mIHRoZXNlIHRvIHRlc3QgdGhlbVxuICAgIGRhdGFTZXQ6IGRhdGFTZXQsIC8vIENhbiBiZSAnT0xEJyAoTWFya2Rvd24sIGV0Yy4pLCAnTkVXJyAoVFNWIG9ubHkpLCBvciAnQk9USCcsIG9yICdERUZBVUxUJ1xuICAgIC8vIGV4Y2VycHRMZW5ndGg6IDI1LFxuICAgIHN1cHByZXNzTm90aWNlRGlzYWJsaW5nRmxhZzogdHJ1ZSwgLy8gTGVhdmUgdGhpcyBvbmUgYXMgdHJ1ZSAob3RoZXJ3aXNlIGRlbW8gY2hlY2tzIGFyZSBsZXNzIGVmZmljaWVudClcbiAgfTtcbiAgLy8gT3IgdGhpcyBhbGxvd3MgdGhlIHBhcmFtZXRlcnMgdG8gYmUgc3BlY2lmaWVkIGFzIGEgQm9va1BhY2thZ2VzQ2hlY2sgcHJvcGVydHlcbiAgaWYgKHByb3BzLmV4Y2VycHRMZW5ndGgpIGNoZWNraW5nT3B0aW9ucy5leGNlcnB0TGVuZ3RoID0gb3VyUGFyc2VJbnQocHJvcHMuZXhjZXJwdExlbmd0aCk7XG4gIGlmIChwcm9wcy5jdXRvZmZQcmlvcml0eUxldmVsKSBjaGVja2luZ09wdGlvbnMuY3V0b2ZmUHJpb3JpdHlMZXZlbCA9IG91clBhcnNlSW50KHByb3BzLmN1dG9mZlByaW9yaXR5TGV2ZWwpO1xuICBpZiAocHJvcHMuZGlzYWJsZUFsbExpbmtGZXRjaGluZ0ZsYWcpIGNoZWNraW5nT3B0aW9ucy5kaXNhYmxlQWxsTGlua0ZldGNoaW5nRmxhZyA9IHByb3BzLmRpc2FibGVBbGxMaW5rRmV0Y2hpbmdGbGFnLnRvTG93ZXJDYXNlKCkgPT09ICd0cnVlJztcbiAgaWYgKHByb3BzLmRpc2FibGVMaW5rZWRUQUFydGljbGVzQ2hlY2tGbGFnKSBjaGVja2luZ09wdGlvbnMuZGlzYWJsZUxpbmtlZFRBQXJ0aWNsZXNDaGVja0ZsYWcgPSBwcm9wcy5kaXNhYmxlTGlua2VkVEFBcnRpY2xlc0NoZWNrRmxhZy50b0xvd2VyQ2FzZSgpID09PSAndHJ1ZSc7XG4gIGlmIChwcm9wcy5kaXNhYmxlTGlua2VkVFdBcnRpY2xlc0NoZWNrRmxhZykgY2hlY2tpbmdPcHRpb25zLmRpc2FibGVMaW5rZWRUV0FydGljbGVzQ2hlY2tGbGFnID0gcHJvcHMuZGlzYWJsZUxpbmtlZFRXQXJ0aWNsZXNDaGVja0ZsYWcudG9Mb3dlckNhc2UoKSA9PT0gJ3RydWUnO1xuICAvLyBmdW5jdGlvbkxvZyhgY2hlY2tpbmdPcHRpb25zLmRpc2FibGVMaW5rZWRUQUFydGljbGVzQ2hlY2tGbGFnICR7Y2hlY2tpbmdPcHRpb25zLmRpc2FibGVMaW5rZWRUQUFydGljbGVzQ2hlY2tGbGFnfSBmcm9tICcke3Byb3BzLmRpc2FibGVMaW5rZWRUQUFydGljbGVzQ2hlY2tGbGFnfSdgKTtcbiAgLy8gZnVuY3Rpb25Mb2coYGNoZWNraW5nT3B0aW9ucy5kaXNhYmxlTGlua2VkVFdBcnRpY2xlc0NoZWNrRmxhZyAke2NoZWNraW5nT3B0aW9ucy5kaXNhYmxlTGlua2VkVFdBcnRpY2xlc0NoZWNrRmxhZ30gZnJvbSAnJHtwcm9wcy5kaXNhYmxlTGlua2VkVFdBcnRpY2xlc0NoZWNrRmxhZ30nYCk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAvLyBkZWJ1Z0xvZyhcIkJvb2tQYWNrYWdlc0NoZWNrLnVzZUVmZmVjdCgpIGNhbGxlZCB3aXRoIFwiLCBKU09OLnN0cmluZ2lmeShwcm9wcykpO1xuXG4gICAgLy8gVXNlIGFuIElJRkUgKEltbWVkaWF0ZWx5IEludm9rZWQgRnVuY3Rpb24gRXhwcmVzc2lvbilcbiAgICAvLyAgZS5nLiwgc2VlIGh0dHBzOi8vbWVkaXVtLmNvbS9qYXZhc2NyaXB0LWluLXBsYWluLWVuZ2xpc2gvaHR0cHMtbWVkaXVtLWNvbS1qYXZhc2NyaXB0LWluLXBsYWluLWVuZ2xpc2gtc3RvcC1mZWVsaW5nLWlmZnktYWJvdXQtdXNpbmctYW4taWlmZS03YjAyOTJhYmExNzRcbiAgICAoYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gZGVidWdMb2coXCJTdGFydGVkIEJvb2tQYWNrYWdlc0NoZWNrLnVubmFtZWRGdW5jdGlvbigpXCIpO1xuXG4gICAgICAvLyBOT1RFIGZyb20gUkpIOiBJIGNhbuKAmXQgZmluZCB0aGUgY29ycmVjdCBSZWFjdCBwbGFjZSBmb3IgdGhpcyAvIHdheSB0byBkbyB0aGlzXG4gICAgICAvLyAgICAgICAgICAgICAgICAgIHNvIGl0IHNob3dzIGEgd2FybmluZyBmb3IgdGhlIHVzZXIsIGFuZCBkb2VzbuKAmXQgY29udGludWUgdG8gdHJ5IHRvIHByb2Nlc3NcbiAgICAgIGlmICghcHJvcHMud2FpdCB8fCBwcm9wcy53YWl0ICE9PSAnTicpIHtcbiAgICAgICAgc2V0UmVzdWx0VmFsdWUoPHA+PHNwYW4gc3R5bGU9e3sgY29sb3I6ICdibHVlJyB9fT5XYWl0aW5nIGZvciB1c2Vy4oCmPC9zcGFuPiAoQWRqdXN0IHNldHRpbmdzIGJlbG93IGFzIG5lY2Vzc2FyeSBhbmQgdGhlbiBzZXQgPGI+d2FpdD0nTic8L2I+IHRvIHN0YXJ0KTwvcD4pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChwcm9wcy5yZWxvYWRBbGxGaWxlc0ZpcnN0ICYmIHByb3BzLnJlbG9hZEFsbEZpbGVzRmlyc3Quc2xpY2UoMCkudG9VcHBlckNhc2UoKSA9PT0gJ1knKSB7XG4gICAgICAgIHVzZXJMb2coXCJDbGVhcmluZyBjYWNoZSBiZWZvcmUgcnVubmluZyBib29rIHBhY2thZ2VzIGNoZWNr4oCmXCIpO1xuICAgICAgICBzZXRSZXN1bHRWYWx1ZSg8cCBzdHlsZT17eyBjb2xvcjogJ29yYW5nZScgfX0+Q2xlYXJpbmcgY2FjaGUgYmVmb3JlIHJ1bm5pbmcgYm9vayBwYWNrYWdlcyBjaGVja+KApjwvcD4pO1xuICAgICAgICBhd2FpdCBjbGVhckNhY2hlcygpO1xuICAgICAgfVxuICAgICAgZWxzZSBhd2FpdCBjbGVhckNoZWNrZWRBcnRpY2xlQ2FjaGUoKTsgLy8gb3RoZXJ3aXNlIHdlIHdvdWxkbid0IHNlZSBhbnkgb2YgdGhlIHdhcm5pbmdzIGFnYWluIGZyb20gY2hlY2tpbmcgdGhlc2VcblxuICAgICAgLy8gTG9hZCB3aG9sZSByZXBvcywgZXNwZWNpYWxseSBpZiB3ZSBhcmUgZ29pbmcgdG8gY2hlY2sgZmlsZXMgaW4gbWFuaWZlc3RzXG4gICAgICBsZXQgcmVwb1ByZWxvYWRMaXN0ID0gWydUV0wnLCAnTFQnLCAnU1QnLCAnVE4nLCAnVFEnLCAnU04nLCAnU1EnXTsgLy8gZm9yIERFRkFVTFRcbiAgICAgIGlmIChkYXRhU2V0ID09PSAnT0xEJylcbiAgICAgICAgcmVwb1ByZWxvYWRMaXN0ID0gWydUV0wnLCAnTFQnLCAnU1QnLCAnVE4nLCAnVFEnXTtcbiAgICAgIGVsc2UgaWYgKGRhdGFTZXQgPT09ICdORVcnKVxuICAgICAgICByZXBvUHJlbG9hZExpc3QgPSBbJ1RXTCcsICdMVCcsICdTVCcsICdUTjInLCAnVFEyJywgJ1NOJywgJ1NRJ107XG4gICAgICBlbHNlIGlmIChkYXRhU2V0ID09PSAnQk9USCcpXG4gICAgICAgIHJlcG9QcmVsb2FkTGlzdCA9IFsnVFdMJywgJ0xUJywgJ1NUJywgJ1ROJywgJ1ROMicsICdUUScsICdUUTInLCAnU04nLCAnU1EnXTtcbiAgICAgIGlmIChoYXZlTlQpIHJlcG9QcmVsb2FkTGlzdC51bnNoaWZ0KCdVR05UJyk7XG4gICAgICBpZiAoaGF2ZU9UKSByZXBvUHJlbG9hZExpc3QudW5zaGlmdCgnVUhCJyk7XG4gICAgICBpZiAoIWNoZWNraW5nT3B0aW9ucy5kaXNhYmxlQWxsTGlua0ZldGNoaW5nRmxhZykge1xuICAgICAgICByZXBvUHJlbG9hZExpc3QucHVzaCgnVFcnKTtcbiAgICAgICAgcmVwb1ByZWxvYWRMaXN0LnB1c2goJ1RBJyk7XG4gICAgICB9XG4gICAgICBpZiAoYm9va0lETGlzdC5pbmNsdWRlcygnT0JTJykpIHtcbiAgICAgICAgbGV0IG9ic1JlcG9QcmVsb2FkTGlzdCA9IFsnT0JTJywgJ09CUy1UV0wnLCAnT0JTLVROMicsICdPQlMtVFEyJywgJ09CUy1TTjInLCAnT0JTLVNRMiddOyAvLyBmb3IgREVGQVVMVFxuICAgICAgICBpZiAoZGF0YVNldCA9PT0gJ09MRCcpXG4gICAgICAgICAgb2JzUmVwb1ByZWxvYWRMaXN0ID0gWydPQlMnLCAnT0JTLVRXTCcsICdPQlMtVE4nLCAnT0JTLVRRJywgJ09CUy1TTicsICdPQlMtU1EnXTtcbiAgICAgICAgZWxzZSBpZiAoZGF0YVNldCA9PT0gJ05FVycpXG4gICAgICAgICAgb2JzUmVwb1ByZWxvYWRMaXN0ID0gWydPQlMnLCAnT0JTLVRXTCcsICdPQlMtVE4yJywgJ09CUy1UUTInLCAnT0JTLVNOMicsICdPQlMtU1EyJ107XG4gICAgICAgIGVsc2UgaWYgKGRhdGFTZXQgPT09ICdCT1RIJylcbiAgICAgICAgICBvYnNSZXBvUHJlbG9hZExpc3QgPSBbJ09CUycsICdPQlMtVFdMJywgJ09CUy1UTicsICdPQlMtVE4yJywgJ09CUy1UUScsICdPQlMtVFEyJywgJ09CUy1TTicsICdPQlMtU04nLCAnT0JTLVNOMicsICdPQlMtU1EyJ107XG4gICAgICAgIHJlcG9QcmVsb2FkTGlzdC5wdXNoLmFwcGx5KHJlcG9QcmVsb2FkTGlzdCwgb2JzUmVwb1ByZWxvYWRMaXN0KTtcbiAgICAgIH1cbiAgICAgIC8vIGRlYnVnTG9nKGBCb29rUGFja2FnZXNDaGVjayBnb3QgcmVwb1ByZWxvYWRMaXN0PSR7cmVwb1ByZWxvYWRMaXN0fSBmb3IgZGF0YVNldD0ke2RhdGFTZXR9YClcblxuICAgICAgc2V0UmVzdWx0VmFsdWUoPHAgc3R5bGU9e3sgY29sb3I6ICdtYWdlbnRhJyB9fT5QcmVsb2FkaW5nIHtyZXBvUHJlbG9hZExpc3QubGVuZ3RofSByZXBvcyBmb3IgPGk+e3VzZXJuYW1lfTwvaT4ge2xhbmd1YWdlQ29kZX0gcmVhZHkgZm9yIGJvb2sgcGFja2FnZXMgY2hlY2vigKY8L3A+KTtcbiAgICAgIGNvbnN0IHN1Y2Nlc3NGbGFnID0gYXdhaXQgcHJlbG9hZFJlcG9zSWZOZWNlc3NhcnkodXNlcm5hbWUsIGxhbmd1YWdlQ29kZSwgYm9va0lETGlzdCwgYnJhbmNoLCByZXBvUHJlbG9hZExpc3QpO1xuICAgICAgaWYgKCFzdWNjZXNzRmxhZylcbiAgICAgICAgY29uc29sZS5lcnJvcihgQm9va1BhY2thZ2VzQ2hlY2sgZXJyb3I6IEZhaWxlZCB0byBwcmUtbG9hZCBhbGwgcmVwb3NgKVxuXG4gICAgICAvLyBEaXNwbGF5IG91ciBcIndhaXRpbmdcIiBtZXNzYWdlXG4gICAgICBzZXRSZXN1bHRWYWx1ZSg8cCBzdHlsZT17eyBjb2xvcjogJ21hZ2VudGEnIH19PkNoZWNraW5nIDxpPnt1c2VybmFtZX08L2k+IHtsYW5ndWFnZUNvZGV9IDxiPntib29rSURMaXN0LmpvaW4oJywgJyl9PC9iPiBib29rIHBhY2thZ2Vz4oCmPC9wPik7XG5cbiAgICAgIGNvbnN0IHJhd0NCUHNSZXN1bHRzID0gYXdhaXQgY2hlY2tCb29rUGFja2FnZXModXNlcm5hbWUsIGxhbmd1YWdlQ29kZSwgYm9va0lETGlzdCwgc2V0UmVzdWx0VmFsdWUsIGNoZWNraW5nT3B0aW9ucyk7XG5cbiAgICAgIC8vIEFkZCBzb21lIGV4dHJhIGZpZWxkcyB0byBvdXIgcmF3Q0JQc1Jlc3VsdHMgb2JqZWN0IGluIGNhc2Ugd2UgbmVlZCB0aGlzIGluZm9ybWF0aW9uIGFnYWluIGxhdGVyXG4gICAgICByYXdDQlBzUmVzdWx0cy5jaGVja1R5cGUgPSAnQm9va1BhY2thZ2VzJztcbiAgICAgIHJhd0NCUHNSZXN1bHRzLnVzZXJuYW1lID0gdXNlcm5hbWU7XG4gICAgICByYXdDQlBzUmVzdWx0cy5sYW5ndWFnZUNvZGUgPSBsYW5ndWFnZUNvZGU7XG4gICAgICByYXdDQlBzUmVzdWx0cy5ib29rSURzID0gYm9va0lEcztcbiAgICAgIHJhd0NCUHNSZXN1bHRzLmJvb2tJRExpc3QgPSBib29rSURMaXN0O1xuICAgICAgcmF3Q0JQc1Jlc3VsdHMuY2hlY2tlZE9wdGlvbnMgPSBjaGVja2luZ09wdGlvbnM7XG5cbiAgICAgIC8vIGRlYnVnTG9nKFwiSGVyZSB3aXRoIENCUHMgcmF3Q0JQc1Jlc3VsdHNcIiwgdHlwZW9mIHJhd0NCUHNSZXN1bHRzKTtcbiAgICAgIC8vIE5vdyBkbyBvdXIgZmluYWwgaGFuZGxpbmcgb2YgdGhlIHJlc3VsdCAtLSB3ZSBoYXZlIHNvbWUgb3B0aW9ucyBhdmFpbGFibGVcbiAgICAgIGxldCBwcm9jZXNzT3B0aW9ucyA9IHsgLy8gVW5jb21tZW50IGFueSBvZiB0aGVzZSB0byB0ZXN0IHRoZW1cbiAgICAgICAgLy8gJ21heGltdW1TaW1pbGFyTWVzc2FnZXMnOiA0LCAvLyBkZWZhdWx0IGlzIDMgLS0gMCBtZWFucyBkb27igJl0IHN1cHByZXNzXG4gICAgICAgIC8vICdlcnJvclByaW9yaXR5TGV2ZWwnOiA4MDAsIC8vIGRlZmF1bHQgaXMgNzAwXG4gICAgICAgIC8vICdjdXRvZmZQcmlvcml0eUxldmVsJzogMTAwLCAvLyBkZWZhdWx0IGlzIDBcbiAgICAgICAgLy8gJ3NvcnRCeSc6ICdCeVJlcG8nLCAvLyBkZWZhdWx0IGlzICdCeVByaW9yaXR5JywgYWxzbyBoYXZlICdBc0ZvdW5kJ1xuICAgICAgICAvLyAnaWdub3JlUHJpb3JpdHlOdW1iZXJMaXN0JzogWzEyMywgMjAyXSwgLy8gZGVmYXVsdCBpcyBbXVxuICAgICAgfTtcbiAgICAgIC8vIE9yIHRoaXMgYWxsb3dzIHRoZSBwYXJhbWV0ZXJzIHRvIGJlIHNwZWNpZmllZCBhcyBhIEJvb2tQYWNrYWdlc0NoZWNrIHByb3BlcnR5XG4gICAgICBpZiAocHJvcHMubWF4aW11bVNpbWlsYXJNZXNzYWdlcykgcHJvY2Vzc09wdGlvbnMubWF4aW11bVNpbWlsYXJNZXNzYWdlcyA9IG91clBhcnNlSW50KHByb3BzLm1heGltdW1TaW1pbGFyTWVzc2FnZXMpO1xuICAgICAgaWYgKHByb3BzLmVycm9yUHJpb3JpdHlMZXZlbCkgcHJvY2Vzc09wdGlvbnMuZXJyb3JQcmlvcml0eUxldmVsID0gb3VyUGFyc2VJbnQocHJvcHMuZXJyb3JQcmlvcml0eUxldmVsKTtcbiAgICAgIC8vIGlmIChwcm9wcy5jdXRvZmZQcmlvcml0eUxldmVsKSBwcm9jZXNzT3B0aW9ucy5jdXRvZmZQcmlvcml0eUxldmVsID0gb3VyUGFyc2VJbnQocHJvcHMuY3V0b2ZmUHJpb3JpdHlMZXZlbCk7XG4gICAgICBpZiAocHJvcHMuc29ydEJ5KSBwcm9jZXNzT3B0aW9ucy5zb3J0QnkgPSBwcm9wcy5zb3J0Qnk7XG4gICAgICAvLyBpZiAocHJvcHMuaWdub3JlUHJpb3JpdHlOdW1iZXJMaXN0KSBwcm9jZXNzT3B0aW9ucy5pZ25vcmVQcmlvcml0eU51bWJlckxpc3QgPSBwcm9wcy5pZ25vcmVQcmlvcml0eU51bWJlckxpc3Q7XG4gICAgICBpZiAocHJvcHMuc2hvd0Rpc2FibGVkTm90aWNlc0ZsYWcpIHByb2Nlc3NPcHRpb25zLnNob3dEaXNhYmxlZE5vdGljZXNGbGFnID0gcHJvcHMuc2hvd0Rpc2FibGVkTm90aWNlc0ZsYWcudG9Mb3dlckNhc2UoKSA9PT0gJ3RydWUnO1xuXG4gICAgICBsZXQgZGlzcGxheVR5cGUgPSAnRXJyb3JzV2FybmluZ3MnOyAvLyBkZWZhdWx0XG4gICAgICBpZiAocHJvcHMuZGlzcGxheVR5cGUpIGRpc3BsYXlUeXBlID0gcHJvcHMuZGlzcGxheVR5cGU7XG5cbiAgICAgIGZ1bmN0aW9uIHJlbmRlclN1bW1hcnkocHJvY2Vzc2VkUmVzdWx0cykge1xuICAgICAgICByZXR1cm4gKDxkaXY+XG4gICAgICAgICAgPHA+Q2hlY2tlZCA8Yj57dXNlcm5hbWV9IHtsYW5ndWFnZUNvZGV9IHtib29rSURMaXN0LmpvaW4oJywgJyl9PC9iPiAoZnJvbSA8aT57YnJhbmNoID09PSB1bmRlZmluZWQgPyAnREVGQVVMVCcgOiBicmFuY2h9PC9pPiBicmFuY2hlcyk8L3A+XG4gICAgICAgICAgPFJlbmRlckNoZWNrZWRGaWxlc0xpc3QgdXNlcm5hbWU9e3VzZXJuYW1lfSByZXN1bHRzPXtwcm9jZXNzZWRSZXN1bHRzfSAvPlxuICAgICAgICAgIDxSZW5kZXJUb3RhbHMgcmF3Tm90aWNlTGlzdExlbmd0aD17cmF3Q0JQc1Jlc3VsdHMubm90aWNlTGlzdC5sZW5ndGh9IHJlc3VsdHM9e3Byb2Nlc3NlZFJlc3VsdHN9IC8+XG4gICAgICAgICAgey8qIDxSZW5kZXJSYXdSZXN1bHRzIHJlc3VsdHM9e3Jhd0NCUHNSZXN1bHRzfSAvPiAqL31cbiAgICAgICAgPC9kaXY+KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGRpc3BsYXlUeXBlID09PSAnRXJyb3JzV2FybmluZ3MnKSB7XG4gICAgICAgIGNvbnN0IHByb2Nlc3NlZFJlc3VsdHMgPSBwcm9jZXNzTm90aWNlc1RvRXJyb3JzV2FybmluZ3MocmF3Q0JQc1Jlc3VsdHMsIHByb2Nlc3NPcHRpb25zKTtcbiAgICAgICAgLy8gICAgICAgdXNlckxvZyhgQm9va1BhY2thZ2VzQ2hlY2sgZ290IGJhY2sgcHJvY2Vzc2VkUmVzdWx0cyB3aXRoICR7cHJvY2Vzc2VkUmVzdWx0cy5zdWNjZXNzTGlzdC5sZW5ndGgudG9Mb2NhbGVTdHJpbmcoKX0gc3VjY2VzcyBtZXNzYWdlKHMpLCAke3Byb2Nlc3NlZFJlc3VsdHMuZXJyb3JMaXN0Lmxlbmd0aC50b0xvY2FsZVN0cmluZygpfSBlcnJvcihzKSBhbmQgJHtwcm9jZXNzZWRSZXN1bHRzLndhcm5pbmdMaXN0Lmxlbmd0aC50b0xvY2FsZVN0cmluZygpfSB3YXJuaW5nKHMpXG4gICAgICAgIC8vIG51bUlnbm9yZWROb3RpY2VzPSR7cHJvY2Vzc2VkUmVzdWx0cy5udW1JZ25vcmVkTm90aWNlcy50b0xvY2FsZVN0cmluZygpfSBudW1IaWRkZW5FcnJvcnM9JHtwcm9jZXNzZWRSZXN1bHRzLm51bUhpZGRlbkVycm9ycy50b0xvY2FsZVN0cmluZygpfSBudW1IaWRkZW5XYXJuaW5ncz0ke3Byb2Nlc3NlZFJlc3VsdHMubnVtSGlkZGVuV2FybmluZ3MudG9Mb2NhbGVTdHJpbmcoKX1gKTtcblxuICAgICAgICAvLyBkZWJ1Z0xvZyhcIkhlcmUgbm93IGluIHJlbmRlcmluZyBiaXQhXCIpO1xuXG4gICAgICAgIGlmIChwcm9jZXNzZWRSZXN1bHRzLmVycm9yTGlzdC5sZW5ndGggfHwgcHJvY2Vzc2VkUmVzdWx0cy53YXJuaW5nTGlzdC5sZW5ndGgpXG4gICAgICAgICAgc2V0UmVzdWx0VmFsdWUoPD5cbiAgICAgICAgICAgIHtyZW5kZXJTdW1tYXJ5KHByb2Nlc3NlZFJlc3VsdHMpfVxuICAgICAgICAgICAgPFJlbmRlclN1Y2Nlc3Nlc0Vycm9yc1dhcm5pbmdzIHJlc3VsdHM9e3Byb2Nlc3NlZFJlc3VsdHN9IC8+XG4gICAgICAgICAgPC8+KTtcbiAgICAgICAgZWxzZSAvLyBubyBlcnJvcnMgb3Igd2FybmluZ3NcbiAgICAgICAgICBzZXRSZXN1bHRWYWx1ZSg8PlxuICAgICAgICAgICAge3JlbmRlclN1bW1hcnkocHJvY2Vzc2VkUmVzdWx0cyl9XG4gICAgICAgICAgICA8UmVuZGVyU3VjY2Vzc2VzRXJyb3JzV2FybmluZ3MgcmVzdWx0cz17cHJvY2Vzc2VkUmVzdWx0c30gLz5cbiAgICAgICAgICA8Lz4pO1xuXG4gICAgICB9IGVsc2UgaWYgKGRpc3BsYXlUeXBlID09PSAnU2V2ZXJlTWVkaXVtTG93Jykge1xuICAgICAgICBjb25zdCBwcm9jZXNzZWRSZXN1bHRzID0gcHJvY2Vzc05vdGljZXNUb1NldmVyZU1lZGl1bUxvdyhyYXdDQlBzUmVzdWx0cywgcHJvY2Vzc09wdGlvbnMpO1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgdXNlckxvZyhgQm9va1BhY2thZ2VzQ2hlY2sgZ290IHByb2Nlc3NlZCByZXN1bHRzIHdpdGggJHtwcm9jZXNzZWRSZXN1bHRzLnN1Y2Nlc3NMaXN0Lmxlbmd0aC50b0xvY2FsZVN0cmluZygpfSBzdWNjZXNzIG1lc3NhZ2UocyksICR7cHJvY2Vzc2VkUmVzdWx0cy5lcnJvckxpc3QubGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCl9IGVycm9yKHMpIGFuZCAke3Byb2Nlc3NlZFJlc3VsdHMud2FybmluZ0xpc3QubGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCl9IHdhcm5pbmcocylcbiAgICAgICAgLy8gICBudW1JZ25vcmVkTm90aWNlcz0ke3Byb2Nlc3NlZFJlc3VsdHMubnVtSWdub3JlZE5vdGljZXMudG9Mb2NhbGVTdHJpbmcoKX0gbnVtSGlkZGVuRXJyb3JzPSR7cHJvY2Vzc2VkUmVzdWx0cy5udW1IaWRkZW5FcnJvcnMudG9Mb2NhbGVTdHJpbmcoKX0gbnVtSGlkZGVuV2FybmluZ3M9JHtwcm9jZXNzZWRSZXN1bHRzLm51bUhpZGRlbldhcm5pbmdzLnRvTG9jYWxlU3RyaW5nKCl9YCk7XG5cbiAgICAgICAgaWYgKHByb2Nlc3NlZFJlc3VsdHMuc2V2ZXJlTGlzdC5sZW5ndGggfHwgcHJvY2Vzc2VkUmVzdWx0cy5tZWRpdW1MaXN0Lmxlbmd0aCB8fCBwcm9jZXNzZWRSZXN1bHRzLmxvd0xpc3QubGVuZ3RoKVxuICAgICAgICAgIHNldFJlc3VsdFZhbHVlKDw+XG4gICAgICAgICAgICB7cmVuZGVyU3VtbWFyeShwcm9jZXNzZWRSZXN1bHRzKX1cbiAgICAgICAgICAgIDxSZW5kZXJTdWNjZXNzZXNTZXZlcmVNZWRpdW1Mb3cgcmVzdWx0cz17cHJvY2Vzc2VkUmVzdWx0c30gLz5cbiAgICAgICAgICA8Lz4pO1xuICAgICAgICBlbHNlIC8vIG5vIHNldmVyZSwgbWVkaXVtLCBvciBsb3cgbm90aWNlc1xuICAgICAgICAgIHNldFJlc3VsdFZhbHVlKDw+XG4gICAgICAgICAgICB7cmVuZGVyU3VtbWFyeShwcm9jZXNzZWRSZXN1bHRzKX1cbiAgICAgICAgICAgIDxSZW5kZXJTdWNjZXNzZXNTZXZlcmVNZWRpdW1Mb3cgcmVzdWx0cz17cHJvY2Vzc2VkUmVzdWx0c30gLz5cbiAgICAgICAgICA8Lz4pO1xuXG4gICAgICB9IGVsc2UgaWYgKGRpc3BsYXlUeXBlID09PSAnU2luZ2xlTGlzdCcpIHtcbiAgICAgICAgY29uc3QgcHJvY2Vzc2VkUmVzdWx0cyA9IHByb2Nlc3NOb3RpY2VzVG9TaW5nbGVMaXN0KHJhd0NCUHNSZXN1bHRzLCBwcm9jZXNzT3B0aW9ucyk7XG4gICAgICAgIC8vICAgICAgIHVzZXJMb2coYEJvb2tQYWNrYWdlc0NoZWNrIGdvdCBwcm9jZXNzZWQgcmVzdWx0cyB3aXRoICR7cHJvY2Vzc2VkUmVzdWx0cy5zdWNjZXNzTGlzdC5sZW5ndGgudG9Mb2NhbGVTdHJpbmcoKX0gc3VjY2VzcyBtZXNzYWdlKHMpIGFuZCAke3Byb2Nlc3NlZFJlc3VsdHMud2FybmluZ0xpc3QubGVuZ3RoLnRvTG9jYWxlU3RyaW5nKCl9IG5vdGljZShzKVxuICAgICAgICAvLyBudW1JZ25vcmVkTm90aWNlcz0ke3Byb2Nlc3NlZFJlc3VsdHMubnVtSWdub3JlZE5vdGljZXMudG9Mb2NhbGVTdHJpbmcoKX0gbnVtSGlkZGVuV2FybmluZ3M9JHtwcm9jZXNzZWRSZXN1bHRzLm51bUhpZGRlbldhcm5pbmdzLnRvTG9jYWxlU3RyaW5nKCl9YCk7XG5cbiAgICAgICAgaWYgKHByb2Nlc3NlZFJlc3VsdHMud2FybmluZ0xpc3QubGVuZ3RoKVxuICAgICAgICAgIHNldFJlc3VsdFZhbHVlKDw+XG4gICAgICAgICAgICA8ZGl2PntyZW5kZXJTdW1tYXJ5KHByb2Nlc3NlZFJlc3VsdHMpfVxuICAgICAgICAgICAgICB7cHJvY2Vzc2VkUmVzdWx0cy5udW1JZ25vcmVkTm90aWNlcyA/IGAgKGJ1dCAke3Byb2Nlc3NlZFJlc3VsdHMubnVtSWdub3JlZE5vdGljZXMudG9Mb2NhbGVTdHJpbmcoKX0gaWdub3JlZCBlcnJvcnMvd2FybmluZ3MpYCA6IFwiXCJ9PC9kaXY+XG4gICAgICAgICAgICA8UmVuZGVyU3VjY2Vzc2VzTm90aWNlc0dyYWRpZW50IHJlc3VsdHM9e3Byb2Nlc3NlZFJlc3VsdHN9IC8+XG4gICAgICAgICAgPC8+KTtcbiAgICAgICAgZWxzZSAvLyBubyB3YXJuaW5nc1xuICAgICAgICAgIHNldFJlc3VsdFZhbHVlKDw+XG4gICAgICAgICAgICB7cmVuZGVyU3VtbWFyeShwcm9jZXNzZWRSZXN1bHRzKX1cbiAgICAgICAgICAgIDxSZW5kZXJTdWNjZXNzZXNOb3RpY2VzR3JhZGllbnQgcmVzdWx0cz17cHJvY2Vzc2VkUmVzdWx0c30gLz5cbiAgICAgICAgICA8Lz4pO1xuICAgICAgfSBlbHNlIHNldFJlc3VsdFZhbHVlKDxiIHN0eWxlPXt7IGNvbG9yOiAncmVkJyB9fT5JbnZhbGlkIGRpc3BsYXlUeXBlPSd7ZGlzcGxheVR5cGV9JzwvYj4pXG5cbiAgICAgIC8vIGRlYnVnTG9nKFwiRmluaXNoZWQgcmVuZGVyaW5nIGJpdC5cIik7XG4gICAgfSkoKTsgLy8gZW5kIG9mIGFzeW5jIHBhcnQgaW4gdW5uYW1lZEZ1bmN0aW9uXG4gICAgLy8gRG9lc27igJl0IHdvcmsgaWYgd2UgYWRkIHRoaXMgdG8gbmV4dCBsaW5lOiBib29rSURMaXN0LGJvb2tJRHMsdXNlcm5hbWUsYnJhbmNoLGNoZWNraW5nT3B0aW9ucyxsYW5ndWFnZUNvZGUscHJvcHNcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gIH0sIFtKU09OLnN0cmluZ2lmeShib29rSURMaXN0KSwgYm9va0lEcywgYnJhbmNoLCBKU09OLnN0cmluZ2lmeShjaGVja2luZ09wdGlvbnMpLCBsYW5ndWFnZUNvZGUsIEpTT04uc3RyaW5naWZ5KHByb3BzKSwgdXNlcm5hbWVdKTsgLy8gZW5kIG9mIHVzZUVmZmVjdCBwYXJ0XG5cbiAgaWYgKGJvb2tJREludmFsaWQpIHtcbiAgICByZXR1cm4gKDxwPlBsZWFzZSBlbnRlciBvbmx5IHZhbGlkIFVTRk0gYm9vayBpZGVudGlmaWVycyBzZXBhcmF0ZWQgYnkgY29tbWFzLiAoJ3tib29rSURJbnZhbGlkfScgaXMgbm90IHZhbGlkLik8L3A+KTtcbiAgfVxuXG4gIC8vIHsvKiA8ZGl2IGNsYXNzTmFtZT17Y2xhc3Nlcy5yb290fT4gKi99XG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9XCJGcmVkXCI+XG4gICAgICB7cmVzdWx0fVxuICAgIDwvZGl2PlxuICApO1xufVxuXG4vLyBCb29rUGFja2FnZXNDaGVjay5wcm9wVHlwZXMgPSB7XG4vLyAgIC8qKiBAaWdub3JlICovXG4vLyAgIHVzZXJuYW1lOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4vLyAgIC8qKiBAaWdub3JlICovXG4vLyAgIGxhbmd1YWdlQ29kZTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuLy8gICBib29rSURzOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4vLyAgIHByb3BzOiBQcm9wVHlwZXMub2JqZWN0LFxuLy8gfTtcblxuLy8gY29uc3Qgc3R5bGVzID0gdGhlbWUgPT4gKHtcbi8vICAgcm9vdDoge1xuLy8gICB9LFxuLy8gfSk7XG5cbmV4cG9ydCBkZWZhdWx0IEJvb2tQYWNrYWdlc0NoZWNrO1xuIl19